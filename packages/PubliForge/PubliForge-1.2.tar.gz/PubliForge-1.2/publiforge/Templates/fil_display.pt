<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head>
  <title></title>
  <link metal:fill-slot="css" tal:repeat="css opener.css(mode)"
        rel="stylesheet" href="${css}" type="text/css" media="screen"/>
  <script metal:fill-slot="js" tal:repeat="js opener.javascript(mode)"
          src="${js}" type="text/javascript"></script>
</head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(route('file_%s' % mode, storage_id=storage['storage_id'], path=path),
    multipart=True)}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last">Â 
      <div tal:condition="opener.can_write() and storage['perm'] == 'writer'" tal:omit-tag="">
        ${form.button(route('file_edit', storage_id=storage['storage_id'], path=path),
          _('Edit'), class_='buttonMain')}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="opener" title="${_('File content')} (${opener.opener_id})">
      ${storage['label']} <em>${filename}</em>
    </h2> 
    <!-- ........................... Containers ........................... -->
    <div tal:define="container_one load: container_one.macro.pt" metal:use-macro="container_one"/>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ............................ Action list ......................... -->
    <div class="listActions">
      <div id="actionParams" tal:condition="action in ('dup?', 'upl?')">
        <div tal:condition="action == 'dup?'">${form.grid_text('name', _('File name:'))}</div>
        <div tal:condition="action == 'upl?'">${form.grid_upload('upload_file', _('File:'))}</div>
        <div tal:define="file_vcs_params load: fil_vcs_params.macro.pt" metal:use-macro="file_vcs_params"></div>
        <div class="submit">
          <span tal:switch="action" tal:omit-tag="">
            <span tal:case="'dup?'">${form.submit('dup!.x', _('Duplicate file'), class_='button')}</span>
            <span tal:case="'upl?'">${form.submit('upl!.x', _('Replace file'), class_='button')}</span>
          </span>
          ${form.submit_cancel(_('Cancel'))}
        </div>
      </div>
      <div class="first path">
        <h3>
          <img src="/Static/Images/MimeTypes/${mime_type[1]}.png"
               alt="${mime_type[1]}" title="${mime_type[1]}"/>
          <span>${storage['storage_id']}/${path}</span>
        </h3>
      </div>
      <div class="last">
        <span tal:condition="'project' in request.session
                             and request.session['project']['perm'] in ('leader', 'packmaker')"
              tal:omit-tag="">
          ${form.submit_image('npk!', _('Create a pack with this file for "${p}"',
            dict(p=request.session['project']['label'])), '/Static/Images/action_pack.png')}
          <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
        </span>
        ${form.button(route('file_info', storage_id=storage['storage_id'], path=path),
          src='/Static/Images/action_info.png', title=_('Display file information'))}
        <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
        ${form.button(route('file_download', storage_id=storage['storage_id'], path=path),
          src='/Static/Images/action_download.png', title=_('Download file'))}
        <span tal:condition="storage['perm'] == 'writer'" tal:omit-tag="">
          <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
          ${form.submit_image('upl?', _('Replace file'),
            '/Static/Images/action_upload.png')}
          ${form.submit_image('dup?', _('Duplicate file'),
            '/Static/Images/action_duplicate.png')}
        </span>
        <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
        ${form.button(route('storage_browse', storage_id=storage['storage_id'], path=path),
          src='/Static/Images/action_browse.png', title=_('View in storage'), class_="slow")}
        <span tal:condition="position[0] &gt; 1" tal:omit-tag="">  
          ${form.button(route('file_navigate', direction='previous', storage_id=storage['storage_id'], path=path),
            src='/Static/Images/go_previous_file.png',
            title=_('Goto to the previous file of the same type in the same directory'), class_="slow")}
        </span>
        ${position[0]} / ${position[1]}
        <span tal:condition="position[0] &lt; position[1]" tal:omit-tag="">  
          ${form.button(route('file_navigate', direction='next', storage_id=storage['storage_id'], path=path),
            src='/Static/Images/go_next_file.png',
            title=_('Goto to the next file of the same type in the same directory'), class_="slow")}
        </span>
        <span tal:condition="searches" tal:omit-tag="">
          <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
          ${form.button(route('file_search'), src='/Static/Images/action_search.png',
            title=_('View search results'), class_="slow")}
          <span tal:condition="searches[0] &gt; 1" tal:omit-tag="">  
            ${form.button(route('file_navigate_search', direction='previous', storage_id=storage['storage_id'], path=path),
              src='/Static/Images/go_previous_search.png',
              title=_('Goto to the previous file in the search results'), class_="slow")}
          </span>
          ${searches[0]} / ${searches[1]}
          <span tal:condition="searches[0] &lt; searches[1]" tal:omit-tag="">  
            ${form.button(route('file_navigate_search', direction='next', storage_id=storage['storage_id'], path=path),
              src='/Static/Images/go_next_search.png',
              title=_('Goto to the next file in the search results'), class_="slow")}
          </span>
        </span>
        <span tal:condition="opener.can_render()" tal:omit-tag="">
          <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
          <span tal:switch="mode" tal:omit-tag="">
            <span tal:case="'render'" tal:omit-tag="">
              ${form.button(route('file_read', storage_id=storage['storage_id'], path=path),
                src='/Static/Images/action_render.png', title=_('Display file content'))}
            </span>
            <span tal:case="'read'" tal:omit-tag="">
              ${form.button(route('file_render', storage_id=storage['storage_id'], path=path),
                src='/Static/Images/action_display.png', title=_('Display file rendering'))}
            </span>
          </span>
        </span>
      </div>
    </div>
    <!-- ............................... Content .......................... -->
    <div id="content" class="display">
      ${content}
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>
