<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_anchor='current'), multipart=True)}
  <div id="main">
    <!-- ............................... Filter ........................... -->
    <div class="filter">
      <h3><span>${_('Storage filter')}</span></h3>
      <div class="col11">
        <div class="colFirst">
          ${form.grid_text('f_id', _('Identifier:'))}
          ${form.grid_select('f_engine', _('Versions:'),
            [('', '')] + vcs_engines.items(), autosubmit=True)}
          ${form.grid_text('f_login', _('User:'))}
        </div>
        <div class="colLast">
          ${form.grid_text('f_label', _('Label:'))}
          ${form.grid_select('f_access', _('Access:'),
            [('', ''), ('*', _('all'))] + STORAGE_ACCESS.items(), autosubmit=True)}
          <div tal:condition="groups" tal:omit-tag="">
            ${form.grid_select('f_group', _('Group:'), [('', '')] + groups, autosubmit=True)}
          </div>
        </div>
        <div class="submit">${form.submit('filter', _('Apply filter'), class_='button')}</div>
      </div>
    </div>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"></div>
    <!-- ............................ Action list ......................... -->
    <h3 class="list">${_('Storage List')}</h3>
    <div class="listActions">
      <div id="actionParams" tal:condition="action == 'imp?'">
        ${form.grid_upload('xml_file', _('Storage file:'))}
        <div class="submit">
          ${form.submit('imp!.x', _('Import file'), class_='button')}
          ${form.submit_cancel(_('Cancel'))}
        </div>
      </div>
      <div class="first">${paging.pager_top('storage22', _('Storages'))}</div>
      <div class="last" tal:switch="i_manager and action == 'del?#'">Â 
        <span tal:case="True" tal:omit-tag="">
          ${form.submit('del!#.x', _('Confirm deletion'), class_='button')}
          ${form.submit_cancel(_('Cancel'))}
        </span>
        <span tal:case="False" tal:condition="action in ('', 'ccl!')" tal:omit-tag="">
          <span tal:condition="i_manager" tal:omit-tag="">
            ${form.button(route('storage_create', _anchor='tab0'),
              title=_('Create storage'), src='/Static/Images/action_create.png')}
            ${form.submit_image('imp?', _('Import storages'),
              '/Static/Images/action_import.png')}
            ${paging.pipe()}
          </span>
          ${form.submit_image('exp!#', _('Export selected storage settings'),
            '/Static/Images/action_export.png')}
          <span tal:condition="i_manager" tal:omit-tag="">
            ${paging.pipe()}
            ${form.submit_image('del?#', _('Delete selected storages'),
              '/Static/Images/action_delete.png')}
          </span>
        </span>
      </div>
    </div>
    <!-- ............................ Storages .......................... -->
    <div id="content">
      <table class="list">
        <caption>${_('Storages')}</caption>
        <tr>
          <th class="checkbox" id="check_all"></th>
          <th>${paging.sortable_column(_('Label'), 'label')}</th>
          <th>${paging.sortable_column(_('Identifier'), 'storage_id')}</th>
          <th>${paging.sortable_column(_('Version control'), 'vcs_engine')}</th>
          <th>${paging.sortable_column(_('Access'), 'access')}</th>
          <th class="last">${_('Actions')}</th>
        </tr>
        <tr tal:repeat="storage paging">
          <td class="checkbox">
            ${form.checkbox('#%s' % storage.storage_id, id=None, class_='listCheck')}
          </td>
          <td>
            <a href="${route('storage_view', storage_id=storage.storage_id)}"
               title="${storage.description}">${storage.label}</a>
          </td>
          <td>
            <a href="${route('storage_view', storage_id=storage.storage_id)}"
               title="${storage.description}">${storage.storage_id}</a>
          </td>
          <td>${vcs_engines.get(storage.vcs_engine, storage.vcs_engine)}</td>
          <td>${STORAGE_ACCESS[storage.access]}</td>
          <td class="last actions" tal:switch="i_manager and action == 'del?%s' % storage.storage_id">
            <span tal:case="True" id="current">
              ${form.submit('del!%s.x' % storage.storage_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.button(route('storage_root', storage_id=storage.storage_id),
                src='/Static/Images/action_browse_one.png', title=_('Browse storage'), class_="slow")}
              <span tal:condition="i_editor" tal:omit-tag="">
                ${form.button(route('storage_edit', storage_id=storage.storage_id),
                  src='/Static/Images/action_edit_one.png', title=_('Edit settings'))}
              </span>
              ${form.submit_image('exp!%s' % storage.storage_id, _('Export storage settings'),
                '/Static/Images/action_export_one.png')}
              <span tal:condition="i_manager" tal:omit-tag="">
                ${form.submit_image('del?%s' % storage.storage_id, _('Delete storage'),
                  '/Static/Images/action_delete_one.png')}
              </span>
            </span>
         </td>
        </tr>
      </table>
    </div>
    <div class="listPager">
      <div class="first">${paging.pager_bottom('storage', _('Storages'))}</div>
      <div class="last">
        ${_('Lines per page:')} ${form.select('page_size', '', paging.page_sizes, True)}
      </div>
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
