<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head>
  <title></title>
  <script metal:fill-slot="js"
          src="/Static/Js/bld_progress.js" type="text/javascript"></script>
</head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last">
      <div tal:condition="is_owner" tal:switch="'stp?' in request.params" tal:omit-tag="">
        <span tal:case="True" tal:omit-tag="">
          ${form.submit('stp!', _('Confirm STOP'), class_='button')}
          ${form.submit_cancel(_('Cancel'))}
        </span>
        <span tal:case="False" tal:omit-tag="">
          ${form.submit('stp?', _('STOP'), class_='buttonMain')}
          ${form.button(route('project_dashboard', project_id=project['project_id']), _('View dashboard'))}
        </span>
      </div>
      <img tal:condition="'stp?' not in request.params" src="/Static/Images/wait_build.gif" alt="wait"/>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main" tal:define="datetime import: datetime ; time import: time">
    <h2 id="subtitle" class="build" title="${_('Build')}">${project['label']}</h2>
    <!-- ........................... Informations ......................... -->
    ${form.grid_item(_('Processing:'), dict(project['processing_labels'])[build['processing_id']], class_='')}
    ${form.grid_item(_('Pack:'), build['pack_label'], class_='')}
    <div class="formItem" tal:condition="build['output']">
      <label><em>${_('Output:')}</em></label>
      <div id="output">${build['output']['storage_label']} (${build['output']['storage_id']}/${build['output']['path']})</div>
    </div>
    <!-- .............................. Build ............................. -->
    <div class="formItem"><label></label><div><hr/></div></div>
    <div class="formItem">
      <label><em>${_('Build:')}</em></label>
      <div id="build"><h3>${datetime.datetime.fromtimestamp(progress[3]).isoformat(' ').split('.')[0]}</h3></div>
    </div>
    <div class="formItem">
      <label><em>${_('Agent:')}</em></label>
      <div id="agent">${agent}Â </div>
    </div>
    <div class="formItem">
      <label><em>${_('Playing time:')}</em></label>
      <div id="playing">${playing}</div>
    </div>
    <div class="formItem">
      <label><em>${_('Progress:')}</em></label>
      <div id="progress" class="${refresh}">
        <div id="progressGauge"><div style="${'width: {p}%;'.format(p=progress[1])}"></div></div>
        <div id="progressStep">${progress[2]}</div>
      </div>
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
