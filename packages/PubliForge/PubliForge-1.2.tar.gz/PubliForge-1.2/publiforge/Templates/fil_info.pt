<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head>
  <title></title>
  <link  rel="stylesheet" metal:fill-slot="css"
         href="/Static/Css/pygments.css" type="text/css" media="screen"></link>
</head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_anchor='current'))}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div>
      ${request.breadcrumbs.back_button()}
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="info" title="${_('File information')}">
      ${storage['label']} <em>${filename}</em>
    </h2>
    <!-- ............................. Description ........................ -->
    <div class="description">
      ${form.grid_item(_('Storage:'), storage['label'], hint=storage['storage_id'], class_='')}
      <div class="formItem">
        <label><em>${_('Path:')}</em></label>
        <div>
          ${form.button(route('storage_browse', storage_id=storage['storage_id'], path=path),
            src='/Static/Images/action_browse.png', title=_('View in storage'), class_="slow")}
          /${path}
        </div>
      </div>
      <div class="formItem">
        <label><em>${_('Name:')}</em></label>
        <div>
          ${form.button(route('file_download', storage_id=storage['storage_id'], path=path),
            src='/Static/Images/action_download.png', title=_('Download file'))}
          <a href="${route('file_render', storage_id=storage['storage_id'], path=path)}">${filename}</a>
        </div>
      </div>
      <div class="formItem">
        <label><em>${_('MIME type:')}</em></label>
        <div>
          <img src="/Static/Images/MimeTypes/${mime_type[1] if mime_type[1] in MIME_TYPES else 'unknown'}.png"
               alt="${mime_type[1]}"/>
          ${mime_type[0] == 'folder' and _('Directory') or mime_type[0]}
        </div>
      </div>
    </div>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ................................ Log ............................. -->
    <div class="formItem" tal:condition="log" id="current">
      <label><em>${_('Revision log:')}</em></label>
      <div id="log">
        <table class="list smallList">
          <tr>
            <th>${_('Age/Date')}</th>
            <th class="center">${_('Revision')}</th>
            <th>${_('Author')}</th>
            <th>${_('Message')}</th>
            <th class="last" tal:condition="mime_type[0] != 'folder'">${_('Actions')}</th>
          </tr>
          <tr tal:repeat="entry log">
            <td title="${entry[0].isoformat(' ').partition('.')[0]}">${age(entry[0])}</td>
            <td class="center">${entry[1]}</td>
            <td>${entry[2]}</td>
            <td>${entry[3]}</td>
            <td class="last" tal:condition="mime_type[0] != 'folder'">
              <span tal:condition="has_lexer and entry[1] != '-'" tal:omit-tag="">
                ${form.submit_image('dif!%s' % entry[1], _('Display differences with current revision'),
                  '/Static/Images/action_diff_one.png')}
              </span>
              <span tal:condition="has_lexer" tal:omit-tag="">
                ${form.submit_image('shw!%s' % entry[1], _('Display this revision'),
                  '/Static/Images/action_view_one.png')}
              </span>
              ${form.button(route('file_revision', storage_id=storage['storage_id'],
                path=path, revision=entry[1]),
                src='/Static/Images/action_download_one.png', title=_('Download this revision'))}
            </td>
          </tr>
        </table>
        <div class="listPager smallList">
          <div class="last">
            ${_('Log size:')} ${form.select('page_size', '', page_sizes, True)}
          </div>
        </div>
      </div>
    </div>
    <!-- ............................ Action list ......................... -->
    <div class="listActions" tal:condition="content">
      <div class="first path">
        <h3>
          <img src="/Static/Images/MimeTypes/${mime_type[1] if mime_type[1] in MIME_TYPES else 'unknown'}.png"
               alt="${mime_type[1]}"/>
          <span>${storage['storage_id']}/${path}</span>
       </h3>
      </div>
      <div class="last">
        ${content['label']}
        ${form.button(route(content['route'], storage_id=storage['storage_id'], path=path,
          revision=content['revision']), src='/Static/Images/action_download.png',
          title=_('Download file'))}
      </div>
    </div>
    <!-- ............................... Content .......................... -->
    <div id="content" tal:condition="content">
      ${content['file']}
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>
