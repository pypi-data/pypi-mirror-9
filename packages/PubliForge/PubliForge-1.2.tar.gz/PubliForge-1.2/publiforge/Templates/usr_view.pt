<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last">
      <div tal:condition="i_editor" tal:omit-tag="">
        ${form.button(route('user_edit', user_id=user.user_id), _('Edit'), class_='buttonMain')}
      </div>
      ${form.submit('exp!.x', _('Export'))}
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="user" title="${_('User settings')}">${user.name}</h2>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabUser')}
      <!-- ........ Identity ...... -->
      ${tab_set.tab_begin(0, 'i')}
      ${form.grid_item(_('Status:'), _(USER_STATUS[user.status]), class_='')}
      ${form.grid_item(_('Login:'), user.login, class_='')}
      ${form.grid_item(_('Name:'), user.name, class_='')}
      ${form.grid_item(_('Email:'), user.email, class_='')}
      ${form.grid_item(_('Language:'), user.lang, class_='')}
      ${form.grid_item(_('Home:'), _(HOMES[user.home]), class_='')}
      ${form.grid_item(_('Page size:'), str(user.page_size), class_='')}
      <div class="formItem" tal:condition="user.updated">
        <label><em>${_('Update:')}</em></label>
        <div id="updated" title="${user.updated.isoformat(' ').partition('.')[0]}">
          ${age(user.updated)}
        </div>
      </div>
      <div class="formItem">
        <label><em>${_('Creation:')}</em></label>
        <div id="created" title="${user.created.isoformat(' ').partition('.')[0]}">
          ${age(user.created)}
        </div>
      </div>
      ${tab_set.tab_end()}
      <!--.. .... Permissions ..... -->
      ${tab_set.tab_begin(1, 'p')}
      <div tal:condition="user.perms"
           tal:define="perms dict([(k.scope, k.level) for k in user.perms])">
        <strong class="caption">${_('User specific permissions:')}</strong>
        <div tal:repeat="scope PERM_SCOPES" tal:omit-tag="">
          ${form.grid_item(_(PERM_SCOPES[scope]),
            scope in perms and _(USER_PERMS.get(perms[scope], _('Administrator'))) or None,
            class_='')}
        </div>
      </div>
      <div tal:repeat="group user.groups" tal:omit-tag="">
        <div tal:condition="group.perms"
             tal:define="perms dict([(k.scope, k.level) for k in group.perms])">
          <strong class="caption">
            ${_('Permissions supplied by group "${g}":', dict(g=group.label))}
          </strong>
          <div tal:repeat="scope PERM_SCOPES" tal:omit-tag="">
            ${form.grid_item(_(PERM_SCOPES[scope]),
              scope in perms and _(USER_PERMS[perms[scope]]) or None, class_='')}
          </div>
        </div>
      </div>
      <div tal:condition="not user.perms and not user.groups">
        ${_('No permission.')}
      </div>
      ${tab_set.tab_end()}
      <!--.. ...... Security ...... -->
      ${tab_set.tab_begin(2, 's')}
      <div tal:condition="user.expiration" tal:omit-tag="">
        ${form.grid_item(_('Expiration:'), user.expiration.isoformat(), class_='')}
      </div>
      <div class="formItem" tal:condition="user.last_login">
        <label><em>${_('Last connection:')}</em></label>
        <div id="last_login" title="${user.last_login.isoformat(' ').partition('.')[0]}">
          ${age(user.last_login)}
        </div>
        <div class="clear"> </div>
      </div>
      <div tal:condition="user.ips" class="formItem">
        <label><em>${_('Authorized IP:')}</em></label>
        <div tal:repeat="ip user.ips">
          ${ip.ip}<br/>
        </div>
      </div>
      <div tal:condition="not user.expiration and not user.ips">${_('No restriction.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
