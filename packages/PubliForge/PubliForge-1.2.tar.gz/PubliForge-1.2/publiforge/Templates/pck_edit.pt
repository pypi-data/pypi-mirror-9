<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_anchor='current'), multipart=True)}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="pack is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('project_dashboard', project_id=project['project_id']), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('pack_view', project_id=pack.project_id, pack_id=pack.pack_id), _('Cancel'))}
        ${form.button(route('project_dashboard', project_id=project['project_id']), _('View dashboard'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="pack" title="${_('Pack')}">
      ${project['label']} <em>${pack and pack.label}</em>
    </h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet" tal:define="file_types ('file', 'resource', 'template') ; i_am 'pack'">
      ${tab_set.toc('tabPack')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_text('label', _('Pack:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      ${form.grid_checkbox('recursive', _('Recursive:'))}
      ${tab_set.tab_end()}
      <!-- ......... Files ........ -->
      ${tab_set.tab_begin(1, 'f')}
      <div tal:condition="pack"
           tal:define="files_edit load: files_edit.macro.pt" metal:use-macro="files_edit"/>
      <div tal:condition="not pack">${_('Create pack before adding files.')}</div>
      ${tab_set.tab_end()}
      <!-- .......... Note ........ -->
      ${tab_set.tab_begin(2, 'n')}
      ${form.textarea('note', rows=8, cols=79)}
      ${tab_set.tab_end()}
      <!-- .......... Task ........ -->
      ${tab_set.tab_begin(3, 't')}
      <div tal:condition="pack" tal:switch="len(project['task_labels']) &gt; 0" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_select('task_id', _('Task:'),
            [('', '')] + sorted(project['task_labels'].items(), key=lambda k: k[1]))}
          ${form.grid_select('operator', _('Operator:'),
            [('', '')] + sorted(operators,  key=lambda k: k[1]),
            hint=_('Keep empty to assign normal operator.'))}
        </div>
        <div tal:case="False">
          ${_('No task in this project.')}
        </div>
      </div>
      <div tal:condition="not pack">${_('Create pack before assigning a task.')}</div>
      ${tab_set.tab_end()}
      <!-- ........ History ....... -->
      ${tab_set.tab_begin(4, 'h')}
      <div tal:define="pck_events load: pck_events.macro.pt" metal:use-macro="pck_events"/>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
