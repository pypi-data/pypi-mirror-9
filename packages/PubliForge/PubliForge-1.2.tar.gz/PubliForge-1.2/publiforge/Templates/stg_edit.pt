<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head>
  <title></title>
  <script metal:fill-slot="js"
          src="/Static/Js/stg_edit.js" type="text/javascript"></script>
</head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_query=paging and {'paging_id': paging.paging_id} or {}))}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="storage is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('storage_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('storage_view', storage_id=storage.storage_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="storage" title="${_('Storage settings')}">${storage and storage.label}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- .......................... Elements to add ....................... -->
    <div id="dialogBox" tal:condition="allopeners">
      <div id="dialogBoxTitle">
        <div class="first">${_('Openers to add')}</div>
        <div class="last">
          ${form.submit_image('ccl!', _('Close'), '/Static/Images/close_light.png')}
        </div>
      </div>
      <div id="dialogBoxContent">
        <h3 class="list">${_('Openers to add')}</h3>
        <div class="listActions">
          <div class="first"> </div>
          <div class="last">
            ${form.submit('aop!#.x', _('Add openers'))}
          </div>
        </div>
        <table class="list smallList">
          <caption>${_('Openers')}</caption>
          <tr>
            <th class="checkbox" id="check_all"></th>
            <th>${_('Identifier')}</th>
            <th>${_('Label')}</th>
            <th>${_('Description')}</th>
            <th class="last">${_('Actions')}</th>
          </tr>
          <tr tal:repeat="opener_id allopeners">
            <td class="checkbox">${form.checkbox('#%s' % opener_id, id=None, class_='listCheck')}</td>
            <td>${opener_id}</td>
            <td>${allopeners[opener_id][0]}</td>
            <td>${allopeners[opener_id][1]}</td>
            <td class="last actions">
              ${form.submit_image('aop!%s' % opener_id, _('Add opener'),
                '/Static/Images/action_add_one.png')}
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div tal:define="mbr_paging load: mbr_paging.macro.pt" metal:use-macro="mbr_paging"/>
    <div tal:define="mbr_groups_paging load: mbr_groups_paging.macro.pt" metal:use-macro="mbr_groups_paging"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabStorage')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_select('access', _('Access:'), STORAGE_ACCESS.items(), required=True)}
      <div tal:switch="storage is None" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_text('storage_id', _('Identifier:'), required=True)}
        </div>
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_item(_('Identifier:'), storage.storage_id, class_='')}
        </div>
      </div>
      ${form.grid_text('label', _('Label:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      <div tal:switch="storage is None" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_select('vcs_engine', _('Version control:'), vcs_engines.items(), required=True)}
        </div>
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_item(_('Version control:'),
            _(vcs_engines.get(storage.vcs_engine, storage.vcs_engine)).partition(u'–')[2], class_='')}
        </div>
      </div>
      <div tal:condition="not storage or storage.vcs_engine not in ('none', 'local')"
           id="vcsParams">
        ${form.grid_text('vcs_url', _('Source URL:'))}
        ${form.grid_text('vcs_user', _('Default user:'))}
        ${form.grid_password('password', _('Password:'))}
      </div>
      ${form.grid_select('refresh', _('Synchronization:'), REFRESH.items())}
      <div tal:condition="not storage or storage.vcs_engine in ('none', 'local')"
           id="stgURL">
        ${form.grid_text('public_url', _('Public URL:'))}
      </div>
      ${form.grid_select('indexed_files', _('Indexed files:'), [('', '')] +
        sorted(INDEXED.items(), key=lambda k: k[1]))}
      ${tab_set.tab_end()}
      <!-- ....... Openers ......... -->
      ${tab_set.tab_begin(1, 'o')}
      <div class="listActions" tal:condition="storage">
        <div class="first">
          <img src="/Static/Images/opener22.png" alt="${_('Openers')}"/>
          <label>${_('Openers')}</label>
        </div>
        <div class="last">
          ${form.submit_image('aop?', _('Add opener'), '/Static/Images/action_add.png')}
        </div>
      </div>
      <table class="list" tal:condition="storage">
        <caption>${_('Openers')}</caption>
        <tr>
          <th>${_('Identifier')}</th>
          <th>${_('Label')}</th>
          <th>${_('Description')}</th>
          <th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="opener_id openers">
          <td>${opener_id}</td>
          <td>${openers[opener_id][0]}</td>
          <td>${openers[opener_id][1]}</td>
          <td class="last actions" tal:switch="action == 'rop?%s' % opener_id">
            <span tal:case="True" id="current">
              ${form.submit('rop!%s.x' % opener_id, _('Confirm removal'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('mup!%s' % opener_id, _('Move up'),
                '/Static/Images/action_up_one.png')}
              ${form.submit_image('dwn!%s' % opener_id, _('Move down'),
                '/Static/Images/action_down_one.png')}
              ${form.submit_image('rop?%s' % opener_id, _('Remove opener'),
                '/Static/Images/action_remove_one.png')}
            </span>
          </td>
        </tr>
      </table>
      <div tal:condition="not storage">${_('Create storage before adding openers.')}</div>
      ${tab_set.tab_end()}
      <!-- ....... Members ........ -->
      ${tab_set.tab_begin(2, 'u')}
      <div tal:condition="storage" tal:omit-tag="">
        <div tal:define="mbr_edit load: mbr_edit.macro.pt" metal:use-macro="mbr_edit"/>
      </div>
      <div tal:condition="not storage">${_('Create storage before adding authorized users.')}</div>
      ${tab_set.tab_end()}
      <!-- .... Member groups ..... -->
      ${tab_set.tab_begin(3, 'g')}
      <div tal:condition="storage" tal:omit-tag="">
        <div tal:define="mbr_groups_edit load: mbr_groups_edit.macro.pt" metal:use-macro="mbr_groups_edit"/>
      </div>
      <div tal:condition="not storage">${_('Create storage before adding authorized groups.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>
