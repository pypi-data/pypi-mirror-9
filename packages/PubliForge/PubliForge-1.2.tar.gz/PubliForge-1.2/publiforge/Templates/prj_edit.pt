<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_query=paging and {'paging_id': paging.paging_id} or {}),
    multipart=True)}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="project is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('project_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('project_view', project_id=project.project_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="project" title="${_('Project settings')}">${project and project.label}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ........................... Members to add ....................... -->
    <div tal:define="mbr_paging load: mbr_paging.macro.pt" metal:use-macro="mbr_paging"/>
    <div tal:define="mbr_groups_paging load: mbr_groups_paging.macro.pt" metal:use-macro="mbr_groups_paging"/>
    <!-- ............................. Tabs ............................... -->
    <div id="tabSet">
      ${tab_set.toc('tabProject')}
      <!-- ...... Description ..... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_select('status', _('Status:'), PROJECT_STATUS.items(), required=True)}
      ${form.grid_text('label', _('Project label:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      ${form.grid_text('deadline', _('Deadline:'),
        hint=_('Format: YYYY-MM-DD'), class_='formItem date')}
      ${tab_set.tab_end()}
      <!-- ......... Roles ........ -->
      ${tab_set.tab_begin(1, 'r')}
      <div class="listActions" tal:condition="project">
        <div class="first">
          <img src="/Static/Images/role22.png" alt="${_('Roles')}"/>
          <label>${_('Roles')}</label>
        </div>
        <div class="last">
          ${form.button(route('role_create', project_id=project.project_id, _anchor='tab0'),
           title=_('Create role'), src='/Static/Images/action_create.png')}
        </div>
      </div>
      <table class="list smallList" tal:condition="project">
        <caption>${_('Roles')}</caption>
        <tr>
          <th>${_('Label')}</th>
          <th>${_('Description')}</th>
          <th>${_('Operators')}</th>
          <th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="role project.roles">
          <td>
            <a href="${route('role_view', project_id=project.project_id, role_id=role.role_id)}">
              ${role.label}
            </a>
          </td>
          <td class="info">${role.description}</td>
          <td>${len(role.users)}</td>
          <td class="last actions" tal:switch="action == 'drl?%d' % role.role_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('drl!%d.x' % role.role_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('drl?%d' % role.role_id, _('Delete role'), '/Static/Images/action_remove_one.png')}
            </span>
          </td>
        </tr>
      </table>
      <div tal:condition="not project">${_('Create project before adding roles.')}</div>
      ${tab_set.tab_end()}
      <!-- ...... Processings ..... -->
      ${tab_set.tab_begin(2, 'p')}
      <div class="listActions" tal:condition="project">
        <div id="actionParams" tal:condition="action == 'imp?'">
          ${form.grid_upload('xml_file', _('Processing file:'))}
          <div class="submit">
            ${form.submit('imp!.x', _('Import file'), class_='button')}
            ${form.submit_cancel(_('Cancel'))}
          </div>
        </div>
        <div class="first">
          <img src="/Static/Images/processing22.png" alt="${_('Processings')}"/>
          <label>${_('Processings')}</label>
        </div>
        <div class="last">
          ${form.button(route('processing_create', project_id=project.project_id, _anchor='tab0'),
            title=_('Create processing'), src='/Static/Images/action_create.png')}
          ${form.submit_image('imp?', _('Import processing'), '/Static/Images/action_import.png')}
        </div>
      </div>
      <table class="list smallList" tal:condition="project">
        <caption>${_('Processings')}</caption>
        <tr>
          <th>${_('Label')}</th><th>${_('Description')}</th><th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="processing project.processings">
          <td>
            <a href="${route('processing_view', project_id=project.project_id, processing_id=processing.processing_id)}">
              ${processing.label}
            </a>
          </td>
          <td class="info">${processing.description}</td>
          <td class="last actions" tal:switch="action == 'del?%d' % processing.processing_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('del!%d.x' % processing.processing_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('del?%d' % processing.processing_id, _('Delete processing'), '/Static/Images/action_remove_one.png')}
            </span>
          </td>
        </tr>
      </table>
      <div tal:condition="not project">${_('Create project before adding processings.')}</div>
      ${tab_set.tab_end()}
      <!-- ......... Tasks ........ -->
      ${tab_set.tab_begin(3, 't')}
      <div class="listActions" tal:condition="project">
        <div class="first">
          <img src="/Static/Images/task22.png" alt="${_('Tasks')}"/>
          <label>${_('Tasks')}</label>
        </div>
        <div class="last">
          ${form.button(route('task_create', project_id=project.project_id, _anchor='tab0'),
           title=_('Create task'), src='/Static/Images/action_create.png')}
        </div>
      </div>
      <table class="list smallList" tal:condition="project">
        <caption>${_('Tasks')}</caption>
        <tr>
          <th>${_('Label')}</th>
          <th>${_('Description')}</th>
          <th>${_('Operator')}</th>
          <th>${_('Connections')}</th>
          <th class="last">${_('Actions')}</th>
        </tr>
        <tr tal:repeat="task sorted(project.tasks, key=lambda k: k.label)">
          <td>
            <a href="${route('task_view', project_id=project.project_id, task_id=task.task_id)}">
              ${task.label}
            </a>
          </td>
          <td class="info">${task.description}</td>
          <td>
            ${operator_labels.get('%s%s' % (task.operator_type, str(task.operator_id)), '?')}
          </td>
          <td class="actions">
            <div tal:repeat="link task.links">
              ${link.link_type == 'back' and u'←' or u'→'}
              ${request.session['project']['task_labels'][link.target_id]}
            </div>
          </td>
          <td class="last actions" tal:switch="action == 'dtk?%d' % task.task_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('dtk!%d.x' % task.task_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.button(route('task_edit', project_id=project.project_id, task_id=task.task_id),
                src='/Static/Images/action_edit_one.png', title=_('Edit task'), class_="slow")}
              ${form.submit_image('dtk?%d' % task.task_id, _('Delete task'),
                '/Static/Images/action_remove_one.png')}
            </span>
          </td>
        </tr>
      </table>
      <div tal:condition="not project">${_('Create project before adding tasks.')}</div>
      ${tab_set.tab_end()}
      <!-- ..... Documentation .... -->
      <!-- ........ Members ....... -->
      ${tab_set.tab_begin(4, 'u')}
      <div tal:condition="project" tal:omit-tag="">
        <div tal:define="mbr_edit load: mbr_edit.macro.pt" metal:use-macro="mbr_edit"/>
      </div>
      <div tal:condition="not project">${_('Create project before adding team members.')}</div>
      ${tab_set.tab_end()}
      <!-- ..... Member groups .... -->
      ${tab_set.tab_begin(5, 'g')}
      <div tal:condition="project" tal:omit-tag="">
        <div tal:define="mbr_groups_edit load: mbr_groups_edit.macro.pt" metal:use-macro="mbr_groups_edit"/>
      </div>
      <div tal:condition="not project">${_('Create project before adding authorized groups.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
