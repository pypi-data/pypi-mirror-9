<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:condition="i_editor"> 
      ${form.button(route('task_edit', project_id=task.project_id, task_id=task.task_id),
        _('Edit'), class_='buttonMain')}
      ${form.button(route('project_%s' % ('edit' in request.breadcrumbs.back_path() and 'edit' or 'view'),
         project_id=task.project_id), _('View project settings'))}
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="task" title="${_('Task')}">
      ${project['label']} <em>${task.label}</em>
    </h2>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabTask')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_item(_('Label:'), task.label, class_='')}
      ${form.grid_item(_('Description:'), task.description, class_='')}
      ${form.grid_item(_('Operator:'), operator, class_='')}
      <div tal:condition="task.deadline" tal:omit-tag="">
        ${form.grid_item(_('Deadline:'), task.deadline.strftime(_('%m/%d/%Y')), class_='')}
      </div>
      ${tab_set.tab_end()}
      <!-- ..... Processings ...... -->
      ${tab_set.tab_begin(1, 'p')}
      <div class="listActions" tal:condition="task.processings">
        <div class="first"><img src="/Static/Images/processing22.png" alt="${_('Processings')}"/></div>
        <div class="last"> </div>
      </div>
      <table class="list smallList" tal:condition="task.processings">
        <caption>${_('Processings')}</caption>
        <tr>
          <th>${_('Available processings')}</th>
        </tr>
        <tr tal:repeat="processing task.processings">
          <td>
            <a href="${route('processing_view', project_id=task.project_id, processing_id=processing.processing_id)}">
              ${dict(project['processing_labels'])[processing.processing_id]}
            </a>
          </td>
        </tr>
      </table>
      <div tal:condition="not task.processings">${_('No processing.')}</div>
      ${tab_set.tab_end()}
      <!-- ..... Connections ...... -->
      ${tab_set.tab_begin(2, 'c')}
      <div class="listActions" tal:condition="task.links">
        <div class="first"><img src="/Static/Images/link22.png" alt="${_('Connections')}"/></div>
        <div class="last"> </div>
      </div>
      <table class="list smallList" tal:condition="task.links">
        <caption>${_('Connections')}</caption>
        <tr>
          <th>${_('To task')}</th>
          <th>${_('Mode')}</th>
        </tr>
        <tr tal:repeat="link task.links">
          <td>${project['task_labels'].get(link.target_id, '?')}</td>
          <td>${LINK_TYPES[link.link_type]}</td>
        </tr>
      </table>
      <div tal:condition="not task.links">${_('No connection.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
