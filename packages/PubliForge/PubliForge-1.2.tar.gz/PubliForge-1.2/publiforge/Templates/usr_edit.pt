<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="user is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('user_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('user_view', user_id=user.user_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="user" title="${_('User settings')}">${user and user.name or ''}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabUser')}
      <!-- ........ Identity ...... -->
      ${tab_set.tab_begin(0, 'i')}
      <div tal:condition="not is_me and not i_admin" tal:omit-tag="">
        ${form.grid_select('status', _('Status:'), USER_STATUS.items(), required=True)}
      </div>
      <div tal:switch="is_me" tal:omit-tag="">
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_text('login', _('Login:'), required=True)}
        </div>
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_item(_('Login:'), user.login, class_='')}
          ${form.hidden('login', user.login)}
        </div>
      </div>
      ${form.grid_password('password1', _('Password:'), required=user is None)}
      ${form.grid_password('password2', _('Confirmation:'), required=user is None)}
      ${form.grid_text('name', _('Name:'), required=True)}
      ${form.grid_text('email', _('Email:'), required=True)}
      ${form.grid_select('lang', _('Language:'), languages, required=True)}
      ${form.grid_select('home', _('Home:'), homes.items(), hint=_('Home page main content'))}
      ${form.grid_select('page_size', _('Page size:'), page_sizes, hint=_('Items per page in lists'))}
      ${tab_set.tab_end()}
      <!--.. .... Permissions ..... -->
      ${tab_set.tab_begin(1, 'p')}
      <strong class="caption">${_('User specific permissions:')}</strong>
      <div tal:switch="i_manager and not i_admin and not is_me" tal:omit-tag="">
        <div tal:case="True" tal:repeat="scope PERM_SCOPES" tal:omit-tag="">
          ${form.grid_select('perm_%s' % scope, _(PERM_SCOPES[scope]),
            [('', '')] + USER_PERMS.items())}
        </div>
        <div tal:case="False" tal:omit-tag="">${_('Not editable.')}</div>
      </div>
      ${tab_set.tab_end()}
      <!--.. ...... Security ...... -->
      ${tab_set.tab_begin(2, 's')}
      <div tal:condition="user and user.last_login" tal:omit-tag="">
        ${form.grid_item(_('Last login:'),
          user.last_login.isoformat(' ').partition('.')[0], class_='')}
      </div>
      <div tal:condition="not is_me and not i_admin" tal:omit-tag="">
        ${form.grid_text('expiration', _('Expiration:'),
        hint=_('Format: YYYY-MM-DD'), class_='formItem date')}
      </div>
      <strong class="caption">${_('IP restriction:')}</strong>
      <div tal:condition="user and user.ips" class="formItem">
        <label><em>${_('Authorized IP:')}</em></label>
        <div tal:repeat="ip user.ips">
          ${ip.ip}
          ${form.submit_image('rmv!%s' % ip.ip, _('Remove IP'),
          '/Static/Images/action_remove_one.png')}<br/>
        </div>
      </div>
      ${form.grid_text('new_ip', _('New IP:'), hint=_('Format: XXX.XXX.XXX.XXX'))}
      ${tab_set.tab_end()}
     </div>
  </div>
  ${form.end()}
</div>
</body>
</html>
