<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head>
  <title></title>
  <link metal:fill-slot="css" tal:repeat="css opener.css(mode, request)"
        rel="stylesheet" href="${css}" type="text/css" media="screen"/>
  <script metal:fill-slot="js" tal:repeat="js opener.javascript(mode, request)"
          src="${js}" type="text/javascript"></script>
</head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(route('file_%s' % mode, storage_id=storage['storage_id'], path=path))}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last"> 
      <div tal:condition="not preview" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain slow')}
        <div tal:condition="opener.can_render()" tal:omit-tag="">
          ${form.submit('pre!.x', _('Preview'), class_='button slow')}
        </div>
        ${form.button(route('file_render', storage_id=storage['storage_id'], path=path),
          _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="opener" title="${_('File editing')} (${opener.opener_id})">
      ${storage['label']} <em>${filename}</em>
    </h2> 
    <!-- .......................... VCS parameters ........................ -->
    <div tal:define="file_vcs_params load: fil_vcs_params.macro.pt"
         metal:use-macro="file_vcs_params" tal:condition="not preview"></div>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <div id="toolTip" tal:condition="description">${description}</div>
    <!-- ............................ Action list ......................... -->
    <div class="listActions" tal:condition="not preview">
      <div class="first path">
        <h3>
          <img src="/Static/Images/MimeTypes/${mime_type[1]}.png"
               alt="${mime_type[1]}" title="${mime_type[1]}"/>
          <span>${storage['storage_id']}/${path}</span>
        </h3>
      </div>
      <div class="last"> 
        <span tal:condition="opener.can_write() and opener.can_edit()" tal:omit-tag="">
          <span tal:switch="mode" tal:omit-tag="">
            <span tal:case="'edit'" tal:omit-tag="">
              ${form.submit_image('wrt!', _('Edit the native content'),
                '/Static/Images/action_render.png')}
            </span>
            <span tal:case="'write'" tal:omit-tag="">
              ${form.submit_image('edt!', _('Edit with an editor'),
                '/Static/Images/action_display.png')}
            </span>
          </span>
        </span>
      </div>
    </div>
    <!-- ............................... Preview .......................... -->
    <div id="content" tal:condition="preview">
      <div id="dialogBox" class="preview">
        <div id="dialogBoxTitle">
          <div class="first">${_(u'Preview ')}</div>
          <div class="last">
            ${form.submit_image('ccl!', _('Close'), '/Static/Images/close_light.png')}
          </div>
        </div>
        <div id="dialogBoxContent">
          ${preview}
        </div>
      </div>
      <div class="hidden">
        ${content}
      </div>
    </div>
    <!-- ............................... Content .......................... -->
    <div id="content" class="display" tal:condition="not preview">
      ${content}
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>
