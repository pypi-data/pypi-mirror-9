<div metal:define-macro="files_edit" tal:omit-tag=""
       xmlns:tal="http://xml.zope.org/namespaces/tal"
       xmlns:metal="http://xml.zope.org/namespaces/metal">
  <div class="listActions">
    <div class="first">
      <img src="/Static/Images/storage22.png" alt="${_('Storages')}"/>
    </div>
    <div class="last">
      ${form.button(route('storage_index'), src='/Static/Images/action_add.png',
        title=_('Add files'), class_='slow')}
    </div>
  </div>
  <table class="list">
    <caption>${_('Files')}</caption>
    <thead>
      <tr>
        <th colspan="2">${_('Path in storage')}</th>
        <th>${_('Path in target')}</th>
        <th class="center" tal:condition="i_am == 'pack'">${_('Visible')}</th>
        <th class="last">${_('Actions')}</th>
      </tr>
    </thead>
    <tbody tal:repeat="file_type file_types" class="group">
      <tr>
        <th colspan="5">${file_type_labels[file_type]}</th>
      </tr>
      <tr tal:repeat="(idx, item) enumerate(files[file_type])"
          tal:attributes="id (action == 'upl?%s_%s/%s' % (file_type, item[1], item[2])) and 'current'">
        <td class="checkbox"></td>
        <td>
          <img src="/Static/Images/MimeTypes/${item[0] if item[0] in MIME_TYPES else 'unknown'}.png"
               alt="${item[0]}" title="${item[0]}"/>
          <a href="${route('file_render', storage_id=item[1], path=item[2])}">${'%s/%s' % (item[1], item[2])}</a>
          <div tal:condition="action == 'upl?%s_%s/%s' % (file_type, item[1], item[2])" id="actionParams">
            ${form.grid_upload('upload_file', _('File:'))}
            <div tal:condition="'none' not in storage['vcs_engine']">${form.grid_text('message', _('Message:'))}</div>
            ${form.submit('upl!%s/%s.x' % (item[1], item[2]), _('Replace file'), class_='button')}
            ${form.submit_cancel(_('Cancel'))}
          </div>
        </td>
        <td>
          <span tal:condition="file_type == 'template'" tal:omit-tag="">
            ${form.text('template_%s/%s' % (item[1], item[2]))}
            <span class="error" tal:condition="form.has_error('template_%s/%s' % (item[1], item[2]))">
              ${form.error('template_%s/%s' % (item[1], item[2]))}
            </span>
          </span>
        </td>
        <td class="center" tal:condition="i_am == 'pack'">
          ${form.checkbox('%s_%d_see' % (file_type, idx))}
        </td>
        <td class="last actions"
            tal:switch="action == 'rmv?%s_%s/%s' % (file_type, item[1], item[2])">
          <span tal:case="True" id="current">
            ${form.submit('rmv!%s_%s/%s.x' % (file_type, item[1], item[2]), _('Confirm removal'), class_='button')}
            ${form.submit_cancel(_('Cancel'))}
          </span>
          <span tal:case="False" tal:omit-tag="">
            <span tal:condition="item[0] != 'folder'">
              ${form.submit_image('upl?%s_%s/%s' % (file_type, item[1], item[2]), _('Replace file'),
                '/Static/Images/action_upload_one.png')}
            </span>
            ${form.button(route('file_download', storage_id=item[1], path=item[2]),
              src='/Static/Images/action_download_one.png', title=_('Download file'))}
            ${form.button(route('file_info', storage_id=item[1], path=item[2]),
              src='/Static/Images/action_info_one.png', title=_('Display file information'), class_="slow")}
            ${form.button(route('storage_browse', storage_id=item[1], path=item[2]),
              src='/Static/Images/action_browse.png', title=_('View in storage'), class_='slow')}
            ${form.submit_image('mup!%s_%d' % (file_type, idx), _('Move up'),
              '/Static/Images/action_up_one.png')}
            ${form.submit_image('dwn!%s_%d' % (file_type, idx), _('Move down'),
              '/Static/Images/action_down_one.png')}
            ${form.submit_image('rmv?%s_%s/%s' % (file_type, item[1], item[2]), _('Remove file'),
              '/Static/Images/action_remove_one.png')}
          </span>
      </td>
      </tr>
    </tbody>
  </table>
</div>
