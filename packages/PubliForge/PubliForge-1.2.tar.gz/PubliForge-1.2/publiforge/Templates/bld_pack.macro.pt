<div metal:define-macro="build_pack" tal:omit-tag=""
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal">
  <div tal:switch="action[4:] == '%s' % item.path" tal:omit-tag=""
       tal:define="sid item.path.partition('/')[0] ; path item.path.partition('/')[2]">
    ${form.button(route('file_download', storage_id=sid, path=path),
      src='/Static/Images/action_download.png', title=_('Download file'))}
    ${form.button(route('storage_browse', storage_id=sid, path=path),
      src='/Static/Images/action_browse.png', title=_('View in storage'), class_="slow")}
    <div tal:case="True" tal:omit-tag="">
      <img id="current" src="/Static/Images/action_upload.png" alt="upload"/>
      ${FILE_TYPE_MARKS[item.file_type]}
      <a href="${route('file_render', storage_id=sid, path=path)}">${item.path}</a>
      <div id="actionParams">
        ${form.grid_upload('upload_file', _('File:'))}
        <div>${form.grid_text('message', _('Message:'))}</div>
        ${form.submit('upl!%s.x' % item.path, _('Replace file'), class_='button')}
        ${form.submit_cancel(_('Cancel'))}
      </div>
    </div>
    <div tal:case="False" tal:omit-tag="">
      ${form.submit_image('upl?%s' % item.path, _('Replace file'), '/Static/Images/action_upload.png')}
      ${FILE_TYPE_MARKS[item.file_type]}
      <a href="${route('file_render', storage_id=sid, path=path)}">${item.path}</a>
    </div>
  </div>
</div>