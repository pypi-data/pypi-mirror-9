{% load i18n humanize djinn_announcements_tags auth_tags %}

<section id="serviceannouncements" class="editmode">
  
  <header>
    <h2>{% trans "Service announcements" %}

      {% ifpermission "" request.user 'djinn_announcements.add_serviceannouncement' %}
      <span class="controls">
        <a
           data-toggle="tooltip"
           title="{% trans 'Add service announcement' %}"
           href="{% url 'djinn_announcements_add_serviceannouncement' %}">
          <i class="icon-plus"></i>
        </a>
      </span>
      {% endifpermission %}
  </header>

  {% if view.announcements|length > 0 %}

  <ul>
    {% for announcement in view.announcements %}
    <li class="announcement">
      <a
         href="{% url 'djinn_announcements_view_serviceannouncement' announcement.id announcement.slug %}"
        {{ announcement.title_slice }}
      </a>
      {% if announcement.status > -1 %}
      <span class="label label-{{ announcement.status|statusclass }}">
        {{ announcement.formatted_status }}
      </span>
      {% endif %}
      
      <time>{{ announcement.start_date }} {% if announcement.end_date %}- {{ announcement.end_date }}{% endif %}</time>
      
      {{ announcement.text|safe|truncatechars:"150" }}
      
      {% if announcement.updates.all.exists %}
      <time class="pull-left">Update {{ announcement.sorted_updates.0.date }}</time>: {{ announcement.sorted_updates.0.text|safe }}
      {% endif %}
    </li>
    {% endfor %}
  </ul>

  {% if view.show_more %}
  <a href="{% url 'haystack_search' %}?content_type=serviceannouncement&sortorder=-changed&restrict_filters=">{% trans "All service announcements" %}</a>
  {% endif %}

  {% else %}
  
  <div class="alert alert-info" id="announcements-alert">
    {% trans "No announcements" %}
  </div>
  
  {% endif %}
  
</section>
