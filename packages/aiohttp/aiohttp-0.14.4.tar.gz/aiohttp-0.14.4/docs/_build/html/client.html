<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTTP Client &mdash; aiohttp 0.14.3- documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.14.3-',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/aiohttp-icon.ico"/>
    <link rel="top" title="aiohttp 0.14.3- documentation" href="index.html" />
    <link rel="next" title="HTTP Server Usage" href="web.html" />
    <link rel="prev" title="aiohttp" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="web.html" title="HTTP Server Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="aiohttp"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">aiohttp 0.14.3- documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="http-client">
<span id="aiohttp-client"></span><h1>HTTP Client<a class="headerlink" href="#http-client" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-aiohttp.client"></span><div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Because most of <em>aiohttp</em> methods are generators, they will not work
in the interactive python interpreter like regular functions
would. For convenience, we show our examples as if they were run in
the interactive interpreter, but please remember that actually running
them requires that you wrap them in functions and run them with an
<a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.4)"><em class="xref std std-ref">asyncio loop</em></a>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
<span class="gp">... </span>  <span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://python.org&#39;</span><span class="p">)</span>
<span class="gp">... </span>  <span class="n">raw</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="gp">... </span>  <span class="k">print</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">run</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="make-a-request">
<h2>Make a Request<a class="headerlink" href="#make-a-request" title="Permalink to this headline">¶</a></h2>
<p>Begin by importing the aiohttp module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">aiohttp</span>
</pre></div>
</div>
<p>Now, let&#8217;s try to get a webpage. For this example, let&#8217;s get GitHub&#8217;s public
timeline</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://github.com/timeline.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we have a <tt class="xref py py-class docutils literal"><span class="pre">ClientResponse</span></tt> object called <tt class="docutils literal"><span class="pre">r</span></tt>. We can get all the
information we need from this object.
First parameter is http method, in that case it is get and second is http url.
this is how you make an HTTP POST request:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/post&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>First parameter could be any valid http method. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;put&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/put&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/delete&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;head&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;options&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-parameters-in-urls">
<h2>Passing Parameters In URLs<a class="headerlink" href="#passing-parameters-in-urls" title="Permalink to this headline">¶</a></h2>
<p>You often want to send some sort of data in the URL&#8217;s query string. If
you were constructing the URL by hand, this data would be given as key/value
pairs in the URL after a question mark, e.g. <tt class="docutils literal"><span class="pre">httpbin.org/get?key=val</span></tt>.
Requests allows you to provide these arguments as a dictionary, using the
<tt class="docutils literal"><span class="pre">params</span></tt> keyword argument. As an example, if you wanted to pass
<tt class="docutils literal"><span class="pre">key1=value1</span></tt> and <tt class="docutils literal"><span class="pre">key2=value2</span></tt> to <tt class="docutils literal"><span class="pre">httpbin.org/get</span></tt>, you would use the
following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;key1&#39;</span><span class="p">:</span> <span class="s">&#39;value1&#39;</span><span class="p">,</span> <span class="s">&#39;key2&#39;</span><span class="p">:</span> <span class="s">&#39;value2&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see that the URL has been correctly encoded by printing the URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
<span class="go">http://httpbin.org/get?key2=value2&amp;key1=value1</span>
</pre></div>
</div>
<p>Also it is possible to pass list of 2 items tuples as parameters, in
that case you can specifiy multiple values for each key:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">payload</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;value2&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
<span class="go">http://httpbin.org/get?key=value2&amp;key=value1</span>
</pre></div>
</div>
</div>
<div class="section" id="response-content">
<h2>Response Content<a class="headerlink" href="#response-content" title="Permalink to this headline">¶</a></h2>
<p>We can read the content of the server&#8217;s response. Consider the GitHub timeline
again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://github.com/timeline.json&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="go">&#39;[{&quot;repository&quot;:{&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https://github.com/...</span>
</pre></div>
</div>
<p>aiohttp will automatically decode content from the server. You can
specify custom encoding for <tt class="docutils literal"><span class="pre">text()</span></tt> method.</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;windows-1251&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-response-content">
<h2>Binary Response Content<a class="headerlink" href="#binary-response-content" title="Permalink to this headline">¶</a></h2>
<p>You can also access the response body as bytes, for non-text requests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">b&#39;[{&quot;repository&quot;:{&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https://github.com/...</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">gzip</span></tt> and <tt class="docutils literal"><span class="pre">deflate</span></tt> transfer-encodings are automatically
decoded for you.</p>
</div>
<div class="section" id="json-response-content">
<h2>JSON Response Content<a class="headerlink" href="#json-response-content" title="Permalink to this headline">¶</a></h2>
<p>There&#8217;s also a builtin JSON decoder, in case you&#8217;re dealing with JSON data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://github.com/timeline.json&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">[{&#39;repository&#39;: {&#39;open_issues&#39;: 0, &#39;url&#39;: &#39;https://github.com/...</span>
</pre></div>
</div>
<p>In case the JSON decoding fails, <tt class="docutils literal"><span class="pre">r.json()</span></tt> raises an exception. It
is possible to specify custom encoding and decoder function for
<tt class="docutils literal"><span class="pre">json()</span></tt> call.</p>
</div>
<div class="section" id="streaming-response-content">
<h2>Streaming Response Content<a class="headerlink" href="#streaming-response-content" title="Permalink to this headline">¶</a></h2>
<p>While methods <tt class="docutils literal"><span class="pre">read()</span></tt>, <tt class="docutils literal"><span class="pre">json()</span></tt> and <tt class="docutils literal"><span class="pre">text()</span></tt> are very convenient
you should be careful. All of this methods load whole response into memory.
For example if you want to download several gigabyte sized file, this methods
will load whole data into memory. But you can use <tt class="docutils literal"><span class="pre">ClientResponse.content</span></tt>
attribute. It is instance of <tt class="docutils literal"><span class="pre">aiohttp.StreamReader</span></tt> class. The <tt class="docutils literal"><span class="pre">gzip</span></tt>
and <tt class="docutils literal"><span class="pre">deflate</span></tt> transfer-encodings are automatically decoded for you.</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://github.com/timeline.json&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">content</span>
<span class="go">&lt;aiohttp.streams.StreamReader object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&#39;\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03&#39;</span>
</pre></div>
</div>
<p>In general, however, you should use a pattern like this to save what is being
streamed to a file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">break</span>
<span class="gp">... </span>        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>It is not possible to use <tt class="docutils literal"><span class="pre">read()</span></tt>, <tt class="docutils literal"><span class="pre">json()</span></tt> and <tt class="docutils literal"><span class="pre">text()</span></tt> after that.</p>
</div>
<div class="section" id="custom-headers">
<h2>Custom Headers<a class="headerlink" href="#custom-headers" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;d like to add HTTP headers to a request, simply pass in a <tt class="docutils literal"><span class="pre">dict</span></tt> to the
<tt class="docutils literal"><span class="pre">headers</span></tt> parameter.</p>
<p>For example, we didn&#8217;t specify our content-type in the previous example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.github.com/some/endpoint&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;some&#39;</span><span class="p">:</span> <span class="s">&#39;data&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;application/json&#39;</span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">url</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span>
<span class="gp">... </span>                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="more-complicated-post-requests">
<h2>More complicated POST requests<a class="headerlink" href="#more-complicated-post-requests" title="Permalink to this headline">¶</a></h2>
<p>Typically, you want to send some form-encoded data — much like an HTML form.
To do this, simply pass a dictionary to the <tt class="docutils literal"><span class="pre">data</span></tt> argument. Your
dictionary of data will automatically be form-encoded when the request is made:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;key1&#39;</span><span class="p">:</span> <span class="s">&#39;value1&#39;</span><span class="p">,</span> <span class="s">&#39;key2&#39;</span><span class="p">:</span> <span class="s">&#39;value2&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="go">{</span>
<span class="go">  ...</span>
<span class="go">  &quot;form&quot;: {</span>
<span class="go">    &quot;key2&quot;: &quot;value2&quot;,</span>
<span class="go">    &quot;key1&quot;: &quot;value1&quot;</span>
<span class="go">  },</span>
<span class="go">  ...</span>
<span class="go">}</span>
</pre></div>
</div>
<p>There are many times that you want to send data that is not
form-encoded. If you pass in a <tt class="docutils literal"><span class="pre">string</span></tt> instead of a <tt class="docutils literal"><span class="pre">dict</span></tt>, that
data will be posted directly.</p>
<p>For example, the GitHub API v3 accepts JSON-Encoded POST/PATCH data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.github.com/some/endpoint&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;some&#39;</span><span class="p">:</span> <span class="s">&#39;data&#39;</span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="post-a-multipart-encoded-file">
<h2>POST a Multipart-Encoded File<a class="headerlink" href="#post-a-multipart-encoded-file" title="Permalink to this headline">¶</a></h2>
<p>To upload Multipart-encoded files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://httpbin.org/post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set the filename, content_type explicitly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://httpbin.org/post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">FormData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s">&#39;report.xls&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="nb">open</span><span class="p">(</span><span class="s">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">),</span>
<span class="gp">... </span>               <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/vnd.ms-excel&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want, you can send strings to be received as files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://httpbin.org/post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;report.csv&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="s">&#39;some,data,to,send</span><span class="se">\n</span><span class="s">another,row,to,send</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<p>If you pass file object as data parameter, aiohttp will stream it to server
automatically. Check <tt class="xref py py-class docutils literal"><span class="pre">aiohttp.stream.StreamReader</span></tt> for supported format
information.</p>
</div>
<div class="section" id="streaming-uploads">
<h2>Streaming uploads<a class="headerlink" href="#streaming-uploads" title="Permalink to this headline">¶</a></h2>
<p>aiohttp support multiple types of streaming uploads, which allows you to
send large files without reading them into memory.</p>
<p>In simple case, simply provide a file-like object for your body:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;massive-body&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>      <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="s">&#39;http://some.url/streamed&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Or you can provide <tt class="docutils literal"><span class="pre">asyncio</span></tt> coroutine that yields bytes objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nd">@asyncio.coroutine</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">my_coroutine</span><span class="p">():</span>
<span class="gp">... </span>   <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read_some_data_from_somewhere</span><span class="p">()</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
<span class="gp">... </span>      <span class="k">return</span>
<span class="gp">... </span>   <span class="k">yield</span> <span class="n">chunk</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not a standard <tt class="docutils literal"><span class="pre">asyncio</span></tt> coroutine as it yields values so it
can not be used like <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">my_coroutine()</span></tt>.
<tt class="docutils literal"><span class="pre">aiohttp</span></tt> internally handles such a coroutines.</p>
</div>
<p>Also it is possible to use <tt class="docutils literal"><span class="pre">StreamReader</span></tt> object. Lets say we want to upload
file from another request and calculate file sha1 hash:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">feed_stream</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="k">with</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>      <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">readany</span><span class="p">()</span>
<span class="gp">... </span>      <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
<span class="gp">... </span>         <span class="k">break</span>
<span class="gp">... </span>      <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="gp">... </span>      <span class="n">s</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/post&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">StreamReader</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">asyncio</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;post&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">file_hash</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">feed_stream</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
<p>Because response&#8217;s content attribute is a StreamReader, you can chain get and
post requests togethere:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://python.org&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;post&#39;</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="s">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="keep-alive-and-connection-pooling">
<span id="aiohttp-client-keep-alive"></span><h2>Keep-Alive and connection pooling<a class="headerlink" href="#keep-alive-and-connection-pooling" title="Permalink to this headline">¶</a></h2>
<p>By default aiohttp does not use connection pooling. To enable connection pooling
you should use one of the <tt class="docutils literal"><span class="pre">connector</span></tt> objects. There are several of them.
Most widly used is <a class="reference internal" href="api.html#aiohttp.connector.TCPConnector" title="aiohttp.connector.TCPConnector"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.connector.TCPConnector</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://python.org&#39;</span><span class="p">,</span> <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="ssl-control-for-tcp-sockets">
<h2>SSL control for tcp sockets<a class="headerlink" href="#ssl-control-for-tcp-sockets" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="api.html#aiohttp.connector.TCPConnector" title="aiohttp.connector.TCPConnector"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.connector.TCPConnector</span></tt></a> constructor accepts mutually
exclusive <em>verify_ssl</em> and <em>ssl_context</em> params.</p>
<p>By default it uses strict checks for HTTPS protocol. Certification
checks can be relaxed by passing <tt class="docutils literal"><span class="pre">verify_ssl=False</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">verify_ssl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to setup custom ssl parameters (use own certification
files for example) you can create <a class="reference external" href="http://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">ssl.SSLContext</span></tt></a> instance and
pass it into connector:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sslcontext</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_SSLv23</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="s">&quot;/etc/ssl/certs/ca-bundle.crt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">verify_ssl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="unix-domain-sockets">
<h2>Unix domain sockets<a class="headerlink" href="#unix-domain-sockets" title="Permalink to this headline">¶</a></h2>
<p>If your http server uses unix domain socket you can use
<a class="reference internal" href="api.html#aiohttp.connector.UnixConnector" title="aiohttp.connector.UnixConnector"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.connector.UnixConnector</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">UnixConnector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;/path/to/socket&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://python.org&#39;</span><span class="p">,</span> <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="proxy-support">
<h2>Proxy support<a class="headerlink" href="#proxy-support" title="Permalink to this headline">¶</a></h2>
<p>aiohttp supports proxy. You have to use
<a class="reference internal" href="api.html#aiohttp.connector.ProxyConnector" title="aiohttp.connector.ProxyConnector"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.connector.ProxyConnector</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ProxyConnector</span><span class="p">(</span><span class="n">proxy</span><span class="o">=</span><span class="s">&quot;http://some.proxy.com&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://python.org&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">ProxyConnector</span></tt> also supports proxy authorization:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ProxyConnector</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;http://some.proxy.com&quot;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="n">proxy_auth</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;pass&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://python.org&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p>Auth credentials can be passed in proxy URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ProxyConnector</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;http://user:pass@some.proxy.com&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s">&#39;http://python.org&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="response-status-codes">
<h2>Response Status Codes<a class="headerlink" href="#response-status-codes" title="Permalink to this headline">¶</a></h2>
<p>We can check the response status code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">status</span>
<span class="go">200</span>
</pre></div>
</div>
</div>
<div class="section" id="response-headers">
<h2>Response Headers<a class="headerlink" href="#response-headers" title="Permalink to this headline">¶</a></h2>
<p>We can view the server&#8217;s response headers using a Python dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">headers</span>
<span class="go">{&#39;ACCESS-CONTROL-ALLOW-ORIGIN&#39;: &#39;*&#39;,</span>
<span class="go"> &#39;CONTENT-TYPE&#39;: &#39;application/json&#39;,</span>
<span class="go"> &#39;DATE&#39;: &#39;Tue, 15 Jul 2014 16:49:51 GMT&#39;,</span>
<span class="go"> &#39;SERVER&#39;: &#39;gunicorn/18.0&#39;,</span>
<span class="go"> &#39;CONTENT-LENGTH&#39;: &#39;331&#39;,</span>
<span class="go"> &#39;CONNECTION&#39;: &#39;keep-alive&#39;}</span>
</pre></div>
</div>
<p>The dictionary is special, though: it&#8217;s made just for HTTP headers. According to
<a class="reference external" href="http://tools.ietf.org/html/rfc7230#section-3.2">RFC 7230</a>, HTTP Header names
are case-insensitive.</p>
<p>So, we can access the headers using any capitalization we want:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span>
<span class="go">&#39;application/json&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-type&#39;</span><span class="p">)</span>
<span class="go">&#39;application/json&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="cookies">
<h2>Cookies<a class="headerlink" href="#cookies" title="Permalink to this headline">¶</a></h2>
<p>If a response contains some Cookies, you can quickly access them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://example.com/some/cookie/setting/url&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s">&#39;example_cookie_name&#39;</span><span class="p">]</span>
<span class="go">&#39;example_cookie_value&#39;</span>
</pre></div>
</div>
<p>To send your own cookies to the server, you can use the <tt class="docutils literal"><span class="pre">cookies</span></tt>
parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://httpbin.org/cookies&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cookies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cookies_are</span><span class="o">=</span><span class="s">&#39;working&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="go">&#39;{&quot;cookies&quot;: {&quot;cookies_are&quot;: &quot;working&quot;}}&#39;</span>
</pre></div>
</div>
<p>With <a class="reference internal" href="#aiohttp-client-keep-alive"><em>connection pooling</em></a> you can
share cookies between requests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="hll"> <span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">share_cookies</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
 <span class="o">...</span>     <span class="s">&#39;get&#39;</span><span class="p">,</span>
 <span class="o">...</span>     <span class="s">&#39;http://httpbin.org/cookies/set?k1=v1&#39;</span><span class="p">,</span>
 <span class="o">...</span>     <span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
 <span class="s">&#39;{&quot;cookies&quot;: {&quot;k1&quot;: &quot;v1&quot;}}&#39;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span>
 <span class="o">...</span>                                <span class="s">&#39;http://httpbin.org/cookies&#39;</span><span class="p">,</span>
 <span class="o">...</span>                                <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">yield from</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
 <span class="s">&#39;{&quot;cookies&quot;: {&quot;k1&quot;: &quot;v1&quot;}}&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default <tt class="docutils literal"><span class="pre">share_cookies</span></tt> is set to <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</div>
</div>
<div class="section" id="timeouts">
<h2>Timeouts<a class="headerlink" href="#timeouts" title="Permalink to this headline">¶</a></h2>
<p>You should use <tt class="docutils literal"><span class="pre">asyncio.wait_for()</span></tt> method if you want to limit
time to wait for a response from a server:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">yield from</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;http://github.com&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="mf">0.001</span><span class="p">)</span>
<span class="go">Traceback (most recent call last)\:</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">asyncio.TimeoutError()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><tt class="docutils literal"><span class="pre">timeout</span></tt> is not a time limit on the entire response download;
rather, an exception is raised if the server has not issued a
response for <tt class="docutils literal"><span class="pre">timeout</span></tt> seconds (more precisely, if no bytes have been
received on the underlying socket for <tt class="docutils literal"><span class="pre">timeout</span></tt> seconds).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/aiohttp-icon-128x128.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">http client/server for asyncio</p>



<p>
<iframe src="http://ghbtns.com/github-btn.html?user=KeepSafe&repo=aiohttp&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




    

<p>
<a href="https://travis-ci.org/KeepSafe/aiohttp">
    <img
        alt="https://secure.travis-ci.org/KeepSafe/aiohttp.png?branch=master"
        src="https://secure.travis-ci.org/KeepSafe/aiohttp.png?branch=master"
    >
</a>
</p>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">HTTP Client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-a-request">Make a Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="#passing-parameters-in-urls">Passing Parameters In URLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#response-content">Response Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#binary-response-content">Binary Response Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#json-response-content">JSON Response Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#streaming-response-content">Streaming Response Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-headers">Custom Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-complicated-post-requests">More complicated POST requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-a-multipart-encoded-file">POST a Multipart-Encoded File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#streaming-uploads">Streaming uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keep-alive-and-connection-pooling">Keep-Alive and connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ssl-control-for-tcp-sockets">SSL control for tcp sockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unix-domain-sockets">Unix domain sockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proxy-support">Proxy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#response-status-codes">Response Status Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#response-headers">Response Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cookies">Cookies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timeouts">Timeouts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web.html">HTTP Server Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_reference.html">HTTP Server Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Low-level HTTP Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="multidict.html">Multidicts</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Helpers API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">CHANGES</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013, 2014, 2015, KeepSafe.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.2</a>
      
      |
      <a href="_sources/client.txt"
          rel="nofollow">Page source</a></li>
    </div>

    
    <a href="https://github.com/KeepSafe/aiohttp" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>