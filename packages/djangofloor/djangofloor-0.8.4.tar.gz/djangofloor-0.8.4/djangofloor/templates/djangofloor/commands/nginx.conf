# /etc/nginx/sites-available/{{ project_name }}.conf
{% for hostname in hostnames %}server {
  listen {{ port }};
  listen   [::]:{{ port }} default ipv6only=on;
  server_name {{ hostname }};
  root {{ static_root }};

  access_log {{ access_log_file }};
  error_log {{ error_log_file }};
  location {{ static_url }} {
    alias {{ static_root }};
  }
  location {{ media_url }} {
    alias {{ media_root }};
  }
{% if ssl_crt_file %}
    ssl on;
    ssl_certificate {{ ssl_crt_file }};
    {% if ssl_key_file %}ssl_certificate_key {{ ssl_key_file }};
{% endif %}{% endif %}{% for accel in x_accel_redirect %}
    location {{ accel.1 }} {
      internal;
      alias   {{ accel.0 }}; # note the trailing slash
    }
{% endfor %}  location / {
    proxy_pass_header Server;
    proxy_redirect off;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Server $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_connect_timeout {{ timeout }};
    proxy_read_timeout {{ timeout }};
    proxy_pass http://{{ bind_address }}/;
  }
}
{% endfor %}