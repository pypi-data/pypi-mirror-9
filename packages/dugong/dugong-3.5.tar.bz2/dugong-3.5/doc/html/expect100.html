<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>100-Continue Support &mdash; dugong 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="dugong 1.0 documentation" href="index.html" />
    <link rel="next" title="Coroutine Support" href="coroutine.html" />
    <link rel="prev" title="API Reference" href="api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="coroutine.html" title="Coroutine Support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">dugong 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="continue-support">
<h1>100-Continue Support<a class="headerlink" href="#continue-support" title="Permalink to this headline">Â¶</a></h1>
<p>When having to transfer large amounts of request bodies to the server, you
typically do not want to sent all the data over the network just to find out
that the server rejected the request because of e.g. insufficient
permissions. To avoid this situation, HTTP 1.1 specifies the &#8220;100-continue&#8221;
mechanism. When using 100-continue, the client transmits an additional
<tt class="docutils literal"><span class="pre">Expect:</span> <span class="pre">100-continue</span></tt> request header, and then waits for the server to
reply with status <tt class="docutils literal"><span class="pre">100</span> <span class="pre">Continue</span></tt> before sending the request body data. If
the server instead responds with an error, the client can avoid pointless
transmission of the request body.</p>
<p>To use this mechanism with the dugong module, simply pass the
<em>expect100</em> parameter to <a class="reference internal" href="api.html#dugong.HTTPConnection.send_request" title="dugong.HTTPConnection.send_request"><tt class="xref py py-obj docutils literal"><span class="pre">send_request</span></tt></a>, and call
<a class="reference internal" href="api.html#dugong.HTTPConnection.read_response" title="dugong.HTTPConnection.read_response"><tt class="xref py py-obj docutils literal"><span class="pre">read_response</span></tt></a> twice: once before sending body data,
and a second time to read the final response:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">conn</span> <span class="o">=</span> <span class="n">HTTPConnection</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="s">&#39;PUT&#39;</span><span class="p">,</span> <span class="s">&#39;/huge_file&#39;</span><span class="p">,</span> <span class="n">expect100</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">body</span><span class="o">=</span><span class="n">BodyFollowing</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_response</span><span class="p">()</span>
<span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Server said: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">resp</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">co_sendfile</span><span class="p">(</span><span class="n">fh</span><span class="p">):</span>
        <span class="c"># Something is probably wrong, the server send a response</span>
        <span class="c"># before we sent all the data. Expect to get an error</span>
        <span class="c"># response below.</span>
        <span class="k">break</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_response</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">204</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">100-Continue Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="coroutine.html">Coroutine Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">Changelog</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="api.html"
                        title="previous chapter">API Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coroutine.html"
                        title="next chapter">Coroutine Support</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="coroutine.html" title="Coroutine Support"
             >next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             >previous</a> |</li>
        <li><a href="index.html">dugong 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Nikolaus Rath.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>