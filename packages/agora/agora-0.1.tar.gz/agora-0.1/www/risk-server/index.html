<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8"> 

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
    <script src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.12.1.js"></script>

    <style>
        body {
            padding: 20px!important;
        }

        .table thead > tr > th.orange {
            color: #FF9900;
            font-size: 10pt;
            text-align: right;
        }

        .positions-table {
            font-size: 8pt;
            text-align: right;
        }

        .table-extra-condensed > thead > tr > th,
        .table-extra-condensed > tbody > tr > th,
        .table-extra-condensed > tfoot > tr > th,
        .table-extra-condensed > thead > tr > td,
        .table-extra-condensed > tbody > tr > td,
        .table-extra-condensed > tfoot > tr > td {
            padding: 1px;
        }

        .red {
            font-weight: bold;
            color: #CC3300;
        }

        .green {
            font-weight: bold;
            color: #339900;
        }

        .soft-warning {
            background-color: #FFFF00;
        }

        .hard-warning {
            background-color: #FFA700;
        }

        .limit-breached {
            background-color: #FF3800;
        }

    </style>
</head>

<body ng-app="riskServerApp" >

    <!-- header -->
    <div class="page-header container-fluid" ng-controller="ReportCtrl">

        <!--
        <div class="row">
            <div class="pull-left">
                <h2>Risk Server</h2>
            </div>
        </div>
        -->

        <div class="row">
            <div class="pull-right">
                <form class="form-inline">
    
                    <div class="input-group">
                        <select class="form-control"
                                ng-model="fund"
                                ng-options="fund for fund in getFunds()">
                        </select>
                    </div>
    
                    <div class="input-group">
                        <select class="form-control"
                                ng-model="portfolio"
                                ng-options="port for port in getPortfolios()">
                        </select>
                    </div>
        
                    <div class="input-group">
                        <input type="text" class="form-control" datepicker-popup="dd-MMMM-yyyy"
                               ng-model="reportDate" is-open="opened" ng-required="true" close-text="Close"/>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="open($event)">
                                <i class="glyphicon glyphicon-calendar"></i>
                            </button>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">

            <!-- side bar for navigation -->
            <div class="col-sm-2">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation" class="active">
                        <a href="#positions" data-toggle="pill">Positions</a>
                    </li>
                    <li role="presentation">
                        <a href="#risks" data-toggle="pill">Risk Metrics</a>
                    </li>
                    <li role="presentation">
                        <a href="#attributions" data-toggle="pill">Risk Attributions</a>
                    </li>
                    <li role="presentation">
                        <a href="#stress" data-toggle="pill">Stress Scenarios</a>
                    </li>
                    <li role="presentation">
                        <a href="#commodity" data-toggle="pill">Commodity Exposures</a>
                    </li>
                    <li role="presentation">
                        <a href="#whatif" data-toggle="pill">What-If Analysis</a>
                    </li>
                    <li role="presentation">
                        <a href="#admin" data-toggle="pill">Administration</a>
                    </li>
                </ul>
            </div>


            <!-- Tab panes -->
            <div class="tab-content col-sm-10">
                <div role="tabpanel" class="tab-pane active" id="positions">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Positions</h3>
                        </div>
                        <div ng-include src="'positions.html'"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="risks">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Risk Metrics</h3>
                        </div>
                        <div ng-include src="'risk_metrics.html'"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="attributions">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Risk Attributions</h3>
                        </div>
                        <div class="panel-body"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="stress">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Stress Scenarios</h3>
                        </div>
                        <div class="panel-body"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="commodity">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Commodity Exposures</h3>
                        </div>
                        <div class="panel-body"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="whatif">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">What-If Analysis</h3>
                        </div>
                        <div ng-include src="'whatif.html'"></div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="admin">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Administration</h3>
                        </div>
                        <div class="panel-body"></div>
                    </div>
                </div>


            </div>
        </div>

    </div>

    <script src="formatters.js"></script>
    <script src="data.js"></script>

    <script>
        angular.module("riskServerApp", ["ui.bootstrap", "formatters"])
            .factory("parms", function () {
                 return {
                     aum: 70000000,
                     fund: "ABC Turbo Long/Short",
                     portfolio: "Master",
                     reportDate: new Date(),
                 };
            })
            .controller("ReportCtrl", function($scope, parms){
                $scope.reportDate = parms.reportDate;
                $scope.fund = parms.fund;
                $scope.portfolio = parms.portfolio;

                $scope.getFunds = function(){
                    // simulate GET query
                    return ["ABC Turbo Long/Short"];
                };

                $scope.getPortfolios = function(parms){
                    // simulate GET query with paramenter parms.fund
                    return ["Master", "Funamental", "Event",
                            "Opportunistic", "Relative Value", "Hedges"];
                };

                $scope.open = function($event){
                    $event.preventDefault();
                    $event.stopPropagation();
                    $scope.opened = true;
                };

            })
            .controller("PositionsCtrl", function($scope, parms){
                $scope.aum = parms.aum;
                $scope.positions = {
                    "Master": MASTER_POSITIONS,
                    "Fundamental": [],
                    "Event": [],
                    "Opportunistic": [],
                    "Relative Value": [],
                    "Hedges": []
                };

                $scope.selectedPositions = function(){
                    return $scope.positions[parms.portfolio];
                };

                $scope.applyColor = function(pos){
                    if (pos < 0.0){
                        return "red";
                    } else {
                        return "green";
                    };
                };

                validator = function(value, limit){
                    if (value > 1.0*limit){
                        return "limit-breached";
                    };
                    if (value > 0.9*limit){
                        return "hard-warning";
                    };
                    if (value > 0.8*limit){
                        return "soft-warning";
                    };
                    return "plain";
                }

                $scope.validateWeight = function(weight){
                    return validator(Math.abs(weight), 0.15);
                };

                $scope.validateDays = function(days){
                    return validator(days, 5.0);
                };
            })
            .controller("WhatIfCtrl", function($scope){
                $scope.positions = [{"security": "", "quantity": 0}];
                $scope.add = function(){
                    $scope.positions.push({"security": "", "quantity": 0})
                };
                $scope.remove = function(i){
                    $scope.positions.splice(i, 1)
                };
                $scope.run = function(){};
            });
    </script>
</body>
</html>