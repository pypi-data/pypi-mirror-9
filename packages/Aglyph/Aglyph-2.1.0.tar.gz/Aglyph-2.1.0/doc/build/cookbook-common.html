

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Common usage scenarios &mdash; Aglyph 2.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Aglyph 2.1.0 documentation" href="index.html"/>
        <link rel="up" title="Aglyph cookbook" href="cookbook.html"/>
        <link rel="next" title="Component inheritance using templates" href="cookbook-templating.html"/>
        <link rel="prev" title="Choose a configuration approach for Aglyph" href="cookbook-configuration.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Aglyph</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whats-new.html">What&#8217;s new in release 2.1.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="whats-new.html#previous-releases-of-aglyph">Previous releases of Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Getting started with Aglyph</a><ul>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#download-and-install-aglyph">1. Download and install Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#download-extract-and-run-the-movielisterapp-application">2. Download, extract, and run the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#a-very-brief-introduction-to-dependency-injection">3. A <em>(very)</em> brief introduction to Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#make-some-general-improvements-to-the-movielisterapp-application">4. Make some general improvements to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#add-dependency-injection-support-to-the-movielisterapp-application">5. Add Dependency Injection support to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#make-changes-to-the-movielisterapp-application">6. Make changes to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-started.html#suggested-next-steps">Suggested next steps</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="cookbook.html">Aglyph cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cookbook-understanding.html">Understand the general features of Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-configuration.html">Choose a configuration approach for Aglyph</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Common usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-templating.html">Component inheritance using templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-notable.html">Other notable usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-integration.html">Integrating Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-ref.html">Aglyph API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aglyph.html"><tt class="docutils literal"><span class="pre">aglyph</span></tt> &#8212; Dependency Injection for Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.assembler.html"><tt class="docutils literal"><span class="pre">aglyph.assembler</span></tt> &#8212; The Aglyph component assembler</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.binder.html"><tt class="docutils literal"><span class="pre">aglyph.binder</span></tt> &#8212; The Aglyph component binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.cache.html"><tt class="docutils literal"><span class="pre">aglyph.cache</span></tt> &#8212; Simple object caching support for Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.compat.html"><tt class="docutils literal"><span class="pre">aglyph.compat</span></tt> &#8212; Python version/variant compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.compat.ipyetree.html"><tt class="docutils literal"><span class="pre">aglyph.compat.ipyetree</span></tt> &#8212; an <em>ElementTree</em> parser for <em>IronPython</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.component.html"><tt class="docutils literal"><span class="pre">aglyph.component</span></tt> &#8212; Defining components and their dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.context.html"><tt class="docutils literal"><span class="pre">aglyph.context</span></tt> &#8212; Defining component contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="aglyph.integration.cherrypy.html"><tt class="docutils literal"><span class="pre">aglyph.integration.cherrypy</span></tt> &#8212; Integrating Aglyph with CherryPy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Aglyph 2.1.0 testing summary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="testing.html#id1">CPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#id2">PyPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#id3">Stackless Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#id4">IronPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#id5">Jython</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#previous-releases-of-aglyph">Previous releases of Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap for future releases</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Aglyph</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="cookbook.html">Aglyph cookbook</a> &raquo;</li>
      
    <li>Common usage scenarios</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/cookbook-common.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="common-usage-scenarios">
<h1>Common usage scenarios<a class="headerlink" href="#common-usage-scenarios" title="Permalink to this headline">¶</a></h1>
<p>All examples are shown with XML configuration <em>and</em> programmatic configuration,
where appropriate.</p>
<ul class="simple">
<li><a class="reference internal" href="#simple-component"><em>Describe a simple component (a class or an unbound factory function)</em></a></li>
<li><a class="reference internal" href="#builtin-components"><em>Describe any Python builtin type as a component</em></a></li>
<li><a class="reference internal" href="#component-reference"><em>Use a reference to another component as a dependency</em></a></li>
<li><a class="reference internal" href="#deferred-resolution"><em>Defer the resolution of injection values until assembly time</em></a></li>
<li><a class="reference internal" href="#after-inject-lifecycle-method"><em>Declare a method to be called on an object after its dependencies have been injected</em></a></li>
<li><a class="reference internal" href="#before-clear-lifecycle-method"><em>Declare a method to be called on a singleton, borg, or weakref object before it is cleared from cache</em></a></li>
<li><a class="reference internal" href="#avoid-circular-deps"><em>Avoid circular dependencies</em></a></li>
</ul>
<div class="section" id="describe-a-simple-component-a-class-or-an-unbound-factory-function">
<span id="simple-component"></span><h2>Describe a simple component (a class or an unbound factory function)<a class="headerlink" href="#describe-a-simple-component-a-class-or-an-unbound-factory-function" title="Permalink to this headline">¶</a></h2>
<p>The simplest and most common kind of component is one that describes a
module-level class or unbound factory function.</p>
<p>To demonstrate, we will describe a component for the Python standard library
<a class="reference external" href="http://docs.python.org/3/library/http.client.html#http.client.HTTPConnection" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">http.client.HTTPConnection</span></tt></a> class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although we are using the Python standard library
<a class="reference external" href="http://docs.python.org/3/library/http.client.html#http.client.HTTPConnection" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">http.client.HTTPConnection</span></tt></a> class here, this example applies to
<strong>any</strong> class or unbound function, whether defined as part of your
application, the Python standard library, or a 3rd-party library.</p>
</div>
<div class="section" id="using-declarative-xml-configuration">
<h3>Using declarative XML configuration<a class="headerlink" href="#using-declarative-xml-configuration" title="Permalink to this headline">¶</a></h3>
<p>In the XML context document <em>&#8220;cookbook-context.xml&#8221;</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;www.ninthtest.net&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>To assemble and use this component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="kn">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="kn">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s">&quot;http.client.HTTPConnection&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">conx</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
<p>If we want to describe more than one component of the same class or function,
then we need to use something other than the dotted name as the component IDs
so that they are unique:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;ninthtest-net-conx&quot; dotted-name=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;www.ninthtest.net&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;python-org-conx&quot; dotted-name=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;www.python.org&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>Accordingly, we use the component IDs to assemble these components:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="kn">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="kn">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_net</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s">&quot;ninthtest-net-conx&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">python_org</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s">&quot;python-org-conx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-programmatic-binder-configuration">
<h3>Using programmatic Binder configuration<a class="headerlink" href="#using-programmatic-binder-configuration" title="Permalink to this headline">¶</a></h3>
<p>Using <a class="reference internal" href="aglyph.binder.html#aglyph.binder.Binder" title="aglyph.binder.Binder"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.binder.Binder</span></tt></a> to describe a simple component in a
<em>bindings.py</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">http.client</span> <span class="kn">import</span> <span class="n">HTTPConnection</span>
<span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;www.ninthtest.net&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>To assemble and use the component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="kn">import</span> <span class="n">binder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;http.client.HTTPConnection&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">conx</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
<p>And like XML contexts, when we wish to use multiple components of the same
dotted name, we must give them unique component IDs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">http.client</span> <span class="kn">import</span> <span class="n">HTTPConnection</span>
<span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;ninthtest-net-conx&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;www.ninthtest.net&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;python-org-conx&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>Assembling these components now requires the custom component IDs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="kn">import</span> <span class="n">binder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_net</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;ninthtest-net-conx&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">python_org</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;python-org-conx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="describe-any-python-builtin-type-as-a-component">
<span id="builtin-components"></span><h2>Describe any Python builtin type as a component<a class="headerlink" href="#describe-any-python-builtin-type-as-a-component" title="Permalink to this headline">¶</a></h2>
<p>Python builtin types (e.g. <a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">int</span></tt></a>, <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">list</span></tt></a>) can be identified by an
importable dotted name, and so may specified as components in Aglyph.</p>
<div class="section" id="id1">
<h3>Using declarative XML configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The name of the module in which builtin types are defined differs between
Python 2 and 3, so any Aglyph XML configuration that uses this approach
will, by definition, <strong>not</strong> be compatible across Python versions.</p>
<p class="last">The example given below uses the Python 3 <a class="reference external" href="http://docs.python.org/3/library/builtins.html#module-builtins" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">builtins</span></tt></a> module. To make
this example work on Python 2, the <tt class="docutils literal"><span class="pre">__builtin__</span></tt> module would be used
instead.</p>
</div>
<p>In the XML context document <em>&#8220;cookbook-context.xml&#8221;</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;foods&quot; dotted-name=&quot;builtins.frozenset&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;
                &lt;list&gt;
                    &lt;str&gt;spam&lt;/str&gt;
                    &lt;str&gt;eggs&lt;/str&gt;
                &lt;/list&gt;
            &lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;opened-file&quot; dotted-name=&quot;builtins.open&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;/path/to/file.txt&lt;/str&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;encoding&quot;&gt;&lt;str&gt;ISO-8859-1&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Using programmatic Binder configuration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Because the builtin types are accessible without having to do an explicit
import, the Binder configuration is very simple.</p>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;foods&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">([</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">])</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;opened-file&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="nb">open</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;/path/to/file.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-a-reference-to-another-component-as-a-dependency">
<span id="component-reference"></span><h2>Use a reference to another component as a dependency<a class="headerlink" href="#use-a-reference-to-another-component-as-a-dependency" title="Permalink to this headline">¶</a></h2>
<p>An <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> is a powerful mechanism for creating
cross-references between components.</p>
<p>A <tt class="docutils literal"><span class="pre">Reference</span></tt> value is just a component ID, but a <tt class="docutils literal"><span class="pre">Reference</span></tt> triggers
special behavior within an <a class="reference internal" href="aglyph.assembler.html#aglyph.assembler.Assembler" title="aglyph.assembler.Assembler"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.assembler.Assembler</span></tt></a> or
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> when it is encountered during assembly or
evaluation (respectively): wherever the <tt class="docutils literal"><span class="pre">Reference</span></tt> appears, it will be
automatically replaced with the fully-assembled component it identifies.</p>
<p>A <tt class="docutils literal"><span class="pre">Reference</span></tt> may be used in <em>any</em> of the following places, allowing for
extremely flexible configurations:</p>
<ul class="simple">
<li>an initialization argument value (positional or keyword) for an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Component</span></tt></a> or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a></li>
<li>an attribute value for an <a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Component</span></tt></a></li>
<li>a key and/or value of a <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">dict</span></tt></a></li>
<li>an item of any sequence type (e.g. <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">list</span></tt></a>, <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">tuple</span></tt></a>)</li>
</ul>
<p>In a nutshell: an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> may be used in <em>any</em>
case where a value is being defined, and will be replaced at assembly-time by
the fully-assembled component identified by that reference.</p>
<p>To demonstrate, we will describe components for the Python standard library
<a class="reference external" href="http://docs.python.org/3/library/urllib.request.html#urllib.request.Request" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">urllib.request.Request</span></tt></a> class and <a class="reference external" href="http://docs.python.org/3/library/urllib.request.html#urllib.request.urlopen" title="(in Python v3.4)"><tt class="xref py py-func docutils literal"><span class="pre">urllib.request.urlopen()</span></tt></a>
function. (The former will be referenced as a dependency for the latter.)</p>
<div class="section" id="id3">
<h3>Using declarative XML configuration<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In the <em>&#8220;cookbook-context.xml&#8221;</em> document:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;ninthtest-home-page&quot; dotted-name=&quot;urllib.request.Request&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;http://www.ninthtest.net/&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;ninthtest-url&quot; dotted-name=&quot;urllib.request.urlopen&quot;&gt;
        &lt;init&gt;
            &lt;arg reference=&quot;ninthtest-home-page&quot; /&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>When the <em>&#8220;ninthtest-url&#8221;</em> component is assembled, the assembler will
automatically assemble and inject the <em>&#8220;ninthtest-home-page&#8221;</em> component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="kn">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="kn">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_url</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s">&quot;ninthtest-url&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ninthtest_url</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">ninthtest_url</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Using programmatic Binder configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>
<span class="kn">from</span> <span class="nn">aglyph.component</span> <span class="kn">import</span> <span class="n">Reference</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;ninthtest-home-page&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">Request</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;http://www.ninthtest.net/&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;ninthtest-url&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">urlopen</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="n">Reference</span><span class="p">(</span><span class="s">&quot;ninthtest-home-page&quot;</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>When the <em>&#8220;ninthtest-url&#8221;</em> component is assembled, the binder will
automatically assemble and inject the <em>&#8220;ninthtest-home-page&#8221;</em> component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="kn">import</span> <span class="n">binder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_url</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;ninthtest-url&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ninthtest_url</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">ninthtest_url</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="defer-the-resolution-of-injection-values-until-assembly-time">
<span id="deferred-resolution"></span><h2>Defer the resolution of injection values until assembly time<a class="headerlink" href="#defer-the-resolution-of-injection-values-until-assembly-time" title="Permalink to this headline">¶</a></h2>
<p>When specifying the values that should be injected into an object of a
component as it is assembled, it is sometimes desired (or necessary) that
those values be resolved <strong>at the time the component is being assembled.</strong></p>
<p>The textbook example of such a case is a component that accepts some mutable
sequence type (e.g. a <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">list</span></tt></a>) as an injection value. If the value (the
list) were resolved at the time the component is being defined, then all
objects of that component would share a reference to the same list This means
that changes to the list belonging to <em>any</em> instance will actually apply to
<em>all</em> instances.</p>
<p>In almost all cases, this is not desired behavior. What we actually desire is
for each instance of the component to have its <em>own</em> copy of the list.</p>
<p>The solution to this problem is to specify a dependency such that its actual
value is determined on-the-fly when the component is being assembled. Aglyph
supports several ways of accomplishing this.</p>
<div class="section" id="use-a-reference-to-defer-the-assembly-of-a-component">
<span id="deferred-reference"></span><h3>Use a Reference to defer the assembly of a component<a class="headerlink" href="#use-a-reference-to-defer-the-assembly-of-a-component" title="Permalink to this headline">¶</a></h3>
<p>Whenever an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> is used to identify a component
as a dependency, that component is not assembled until the <em>parent</em> component
is assembled.</p>
<div class="section" id="id5">
<h4>Using declarative XML configuration<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Aglyph automatically creates an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> for any
<tt class="docutils literal"><span class="pre">&lt;reference&gt;</span></tt> element encountered, or for any <tt class="docutils literal"><span class="pre">&lt;arg&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;attribute&gt;</span></tt>,
<tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt>, or <tt class="docutils literal"><span class="pre">&lt;value&gt;</span></tt> element that specifies a <tt class="docutils literal"><span class="pre">reference</span></tt> attribute:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;cookbook-formatter&quot; dotted-name=&quot;logging.Formatter&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;%(asctime)s %(levelname)s %(message)s&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;cookbook-handler&quot; dotted-name=&quot;logging.handlers.RotatingFileHandler&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;/var/log/cookbook.log&lt;/str&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;maxBytes&quot;&gt;&lt;int&gt;1048576&lt;/int&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;backupCount&quot;&gt;&lt;int&gt;3&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
        &lt;attributes&gt;
            &lt;attribute name=&quot;setFormatter&quot;&gt;
                &lt;reference id=&quot;cookbook-formatter&quot; /&gt;
            &lt;/attribute&gt;
        &lt;/attributes&gt;
    &lt;/component&gt;
    &lt;component id=&quot;cookbook-logger&quot; dotted-name=&quot;logging.getLogger&quot; strategy=&quot;singleton&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;cookbook&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
        &lt;attributes&gt;
            &lt;attribute name=&quot;addHandler&quot; ref=&quot;cookbook-handler&quot; /&gt;
        &lt;/attributes&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Using programmatic Binder configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>
<span class="kn">from</span> <span class="nn">aglyph.component</span> <span class="kn">import</span> <span class="n">Reference</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cookbook-formatter&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;logging.Formatter&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cookbook-handler&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;logging.handlers.RotatingFileHandler&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;/var/log/cookbook.log&quot;</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>
    <span class="n">attributes</span><span class="p">(</span><span class="n">setFormatter</span><span class="o">=</span><span class="n">Reference</span><span class="p">(</span><span class="s">&quot;cookbook-formatter&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cookbook-logger&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;logging.getLogger&quot;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s">&quot;singleton&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;cookbook&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">attributes</span><span class="p">(</span><span class="n">addHandler</span><span class="o">=</span><span class="n">Reference</span><span class="p">(</span><span class="s">&quot;cookbook-handler&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-a-partial-function-or-an-evaluator-to-defer-the-evaluation-of-a-runtime-value">
<span id="deferred-partial-evaluator"></span><h3>Use a partial function or an Evaluator to defer the evaluation of a runtime value<a class="headerlink" href="#use-a-partial-function-or-an-evaluator-to-defer-the-evaluation-of-a-runtime-value" title="Permalink to this headline">¶</a></h3>
<p>Though almost all scenarios can be addressed by using components and
References, in some cases you may prefer that a dependency is <em>not</em> defined as
another component. In Aglyph, you can defer the evaluation of such a value
until component assembly time by using either a <a class="reference external" href="http://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">functools.partial</span></tt></a> object
or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>.</p>
<p>A partial function and an Evaluator serve the same purpose, and share the same
signature - <em>(func, *args, **keywords)</em> - but an Evaluator is capable of
recognizing and assembling any <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> that appears
in <em>args</em> or <em>keywords</em>, while a partial function is not.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the arguments and/or keywords to a callable must specify an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a>, use
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>. Otherwise, use either
<a class="reference external" href="http://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">functools.partial</span></tt></a> <em>or</em> an Evaluator.</p>
</div>
<div class="section" id="id7">
<h4>Using declarative XML configuration<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>When using XML configuration, an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> is
<em>automatically</em> created for any <tt class="docutils literal"><span class="pre">&lt;list&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;tuple&gt;</span></tt>, or <tt class="docutils literal"><span class="pre">&lt;dict&gt;</span></tt>.</p>
<p>There is no support for explicitly specifying either a <a class="reference external" href="http://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">functools.partial</span></tt></a>
or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>. There is nothing <em>preventing</em> you
from declaring a component of <a class="reference external" href="http://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">functools.partial</span></tt></a> or
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>, though the usefulness of the latter is
questionable (and would very strongly suggest that a simpler configuration
is possible).</p>
<p>In the following <em>&#8220;cookbook-context.xml&#8221;</em> document, the &#8220;states&#8221; keyword
argument is automatically turned into an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;cookbook.WorkflowManager&quot;&gt;
        &lt;init&gt;
            &lt;arg keyword=&quot;states&quot;&gt;
                &lt;dict&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;UNA&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Unassigned&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;OPE&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Open (Assigned)&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;CLO&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Closed&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                &lt;/dict&gt;
            &lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>Using programmatic Binder configuration<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike XML configuration, there is no provision for automatically creating
an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> when using Binder. Any value that
should be the result of a <a class="reference external" href="http://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.4)"><tt class="xref py py-obj docutils literal"><span class="pre">functools.partial</span></tt></a> or an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> must be <strong>explicitly</strong> specified as
such.</p>
</div>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cookbook.WorkflowManager&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span>
                                  <span class="n">UNA</span><span class="o">=</span><span class="s">&quot;Unassigned&quot;</span><span class="p">,</span>
                                  <span class="n">OPE</span><span class="o">=</span><span class="s">&quot;Open (Assigned)&quot;</span><span class="p">,</span>
                                  <span class="n">CLO</span><span class="o">=</span><span class="s">&quot;Closed&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="declare-a-method-to-be-called-on-an-object-after-its-dependencies-have-been-injected">
<span id="after-inject-lifecycle-method"></span><h2>Declare a method to be called on an object after its dependencies have been injected<a class="headerlink" href="#declare-a-method-to-be-called-on-an-object-after-its-dependencies-have-been-injected" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.1.0.</span></p>
</div>
<p>At times it may be desirable (or necessary) to call an &#8220;initialization&#8221; method
on an assembled object before it is returned to the caller for use. For this
purpose, Aglyph allows you to declare such a method name at the context,
template, and/or component level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please refer to <a class="reference internal" href="aglyph.component.html#lifecycle-method-lookup-process"><em>The lifecycle method lookup process</em></a> to understand how Aglyph determines
<em>which</em> lifecycle method to call on an object when multiple options are
declared at the context, template, and/or component level for a given
object.</p>
</div>
<p>In the following examples, we assume that all of the objects implement a
<tt class="docutils literal"><span class="pre">prepare()</span></tt> method. In such cases, a context-level <tt class="docutils literal"><span class="pre">after_inject</span></tt> lifecycle
method may be appropriate. Alternatively, it could be declared in a template
(see <a class="reference internal" href="cookbook-templating.html"><em>Component inheritance using templates</em></a>).</p>
<p>Regardless of the configuration approach, the behavior is that the assembled
object&#8217;s <tt class="docutils literal"><span class="pre">prepare()</span></tt> method is called <strong>before</strong> the object is returned from
the assembler or binder to the caller.</p>
<div class="section" id="id9">
<h3>Using declarative XML configuration<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Note the use of the <em>after-inject</em> attribute on the <tt class="docutils literal"><span class="pre">&lt;context&gt;</span></tt> element:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot; after-inject=&quot;prepare&quot;&gt;
   &lt;component id=&quot;object-a&quot; dotted-name=&quot;cookbook.PreparableObjectA&quot; /&gt;
   &lt;component id=&quot;object-b&quot; dotted-name=&quot;cookbook.PreparableObjectB&quot; /&gt;
   &lt;component id=&quot;object-c&quot; dotted-name=&quot;cookbook.PreparableObjectC&quot; /&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Using programmatic Binder configuration<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Note the use of the <em>after_inject</em> keyword argument to
<a class="reference internal" href="aglyph.binder.html#aglyph.binder.Binder" title="aglyph.binder.Binder"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.binder.Binder</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">,</span> <span class="n">after_inject</span><span class="o">=</span><span class="s">&quot;prepare&quot;</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;object-a&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;cookbook.PreparableObjectA&quot;</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;object-b&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;cookbook.PreparableObjectB&quot;</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;object-c&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;cookbook.PreparableObjectC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="declare-a-method-to-be-called-on-a-singleton-borg-or-weakref-object-before-it-is-cleared-from-cache">
<span id="before-clear-lifecycle-method"></span><h2>Declare a method to be called on a <em>singleton</em>, <em>borg</em>, or <em>weakref</em> object before it is cleared from cache<a class="headerlink" href="#declare-a-method-to-be-called-on-a-singleton-borg-or-weakref-object-before-it-is-cleared-from-cache" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.1.0.</span></p>
</div>
<p>At times it may be desirable (or necessary) to call a &#8220;finalization&#8221; method on
a cached object before it is cleared from Aglyph&#8217;s internal cache. For this
purpose, Aglyph allows you to declare such a method name at the context,
template, and/or component level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please refer to <a class="reference internal" href="aglyph.component.html#lifecycle-method-lookup-process"><em>The lifecycle method lookup process</em></a> to understand how Aglyph determines
<em>which</em> lifecycle method to call on an object when multiple options are
declared at the context, template, and/or component level for a given
object.</p>
</div>
<p>Following is an example that declares a <em>singleton</em> <a class="reference external" href="http://www.gnu.org.ua/software/gdbm/">GNU dbm</a> key/data store using Python&#8217;s
<a class="reference external" href="http://docs.python.org/3/library/dbm.html#module-dbm.gnu" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">dbm.gnu</span></tt></a> module. The store is configured to be opened in &#8220;fast&#8221; mode,
meaning that writes are not synchronized. When using GDBM, it is important that
every file opened is also closed (which causes any pending writes to be
synchronized - i.e. written to disk). The example shows how to declare that the
<tt class="docutils literal"><span class="pre">close()</span></tt> method is to be called before the cached GDBM object is evicted
from the Aglyph singleton cache.</p>
<div class="section" id="id11">
<h3>Using declarative XML configuration<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Here we declare the <tt class="docutils literal"><span class="pre">close()</span></tt> method for the <tt class="docutils literal"><span class="pre">before_clear</span></tt> lifecycle state
of the component by using the <em>before-clear</em> attribute of the <tt class="docutils literal"><span class="pre">&lt;component&gt;</span></tt>
element:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
   &lt;component id=&quot;store&quot; dotted-name=&quot;dbm.gnu&quot; factory-name=&quot;open&quot;
         strategy=&quot;singleton&quot; before-clear=&quot;close&quot;&gt;
      &lt;init&gt;
         &lt;arg&gt;&lt;str&gt;/var/cookbook-store.db&lt;/str&gt;&lt;/arg&gt;
         &lt;arg&gt;&lt;str&gt;cf&lt;/str&gt;&lt;/arg&gt;
      &lt;/init&gt;
   &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>Using programmatic Binder configuration<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Here we use the <em>before_clear</em> keyword argument when binding the GDBM store
object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">aglyph.binder</span> <span class="kn">import</span> <span class="n">Binder</span>

<span class="n">binder</span> <span class="o">=</span> <span class="n">Binder</span><span class="p">(</span><span class="s">&quot;cookbook-binder&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">&quot;dbm.gnu&quot;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="s">&quot;open&quot;</span><span class="p">,</span>
             <span class="n">strategy</span><span class="o">=</span><span class="s">&quot;singleton&quot;</span><span class="p">,</span> <span class="n">before_clear</span><span class="o">=</span><span class="s">&quot;close&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s">&quot;/var/cookbook-store.db&quot;</span><span class="p">,</span> <span class="s">&quot;cf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful when declaring <tt class="docutils literal"><span class="pre">before_clear</span></tt> lifecycle methods for <em>weakref</em>
component objects, as the nature of weak references means that Aglyph
<strong>cannot</strong> guarantee that the object still exists when the
<a class="reference internal" href="aglyph.assembler.html#aglyph.assembler.Assembler.clear_weakrefs" title="aglyph.assembler.Assembler.clear_weakrefs"><tt class="xref py py-meth docutils literal"><span class="pre">aglyph.assembler.Assembler.clear_weakrefs()</span></tt></a> method is called! Please
refer to <a class="reference external" href="http://docs.python.org/3/library/weakref.html#module-weakref" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">weakref</span></tt></a> for details.</p>
</div>
</div>
</div>
<div class="section" id="avoid-circular-dependencies">
<span id="avoid-circular-deps"></span><h2>Avoid circular dependencies<a class="headerlink" href="#avoid-circular-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Consider two components, <strong>A</strong> and <strong>B</strong>. If <strong>B</strong> is a dependency of <strong>A</strong>,
and <strong>A</strong> is also a dependency of <strong>B</strong>, then a circular dependency exists:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;component id=&quot;cookbook.A&quot;&gt;
    &lt;init&gt;
        &lt;arg reference=&quot;cookbook.B&quot;/&gt;
    &lt;/init&gt;
&lt;/comonent&gt;
&lt;component id=&quot;cookbook.B&quot;&gt;
    &lt;init&gt;
        &lt;arg reference=&quot;cookbook.A&quot;/&gt;
    &lt;/init&gt;
&lt;/comonent&gt;
</pre></div>
</div>
<p>Aglyph will raise <a class="reference internal" href="aglyph.html#aglyph.AglyphError" title="aglyph.AglyphError"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.AglyphError</span></tt></a> when it detects a circular
reference during assembly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In software design in general, circular dependencies are frowned upon
because they can lead to problems ranging from increased maintenance costs
to infinite recursion and memory leaks. The existence of a circular
dependency usually implies that the design can be improved to avoid such a
relationship.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cookbook-templating.html" class="btn btn-neutral float-right" title="Component inheritance using templates">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cookbook-configuration.html" class="btn btn-neutral" title="Choose a configuration approach for Aglyph"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2006-2015, Matthew Zipay.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>