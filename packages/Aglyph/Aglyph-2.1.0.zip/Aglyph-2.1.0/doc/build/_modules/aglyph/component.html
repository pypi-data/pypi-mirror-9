

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aglyph.component &mdash; Aglyph 2.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Aglyph 2.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="aglyph" href="../aglyph.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> Aglyph</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../whats-new.html">What&#8217;s new in release 2.1.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../whats-new.html#previous-releases-of-aglyph">Previous releases of Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started.html">Getting started with Aglyph</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#download-and-install-aglyph">1. Download and install Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#download-extract-and-run-the-movielisterapp-application">2. Download, extract, and run the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#a-very-brief-introduction-to-dependency-injection">3. A <em>(very)</em> brief introduction to Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#make-some-general-improvements-to-the-movielisterapp-application">4. Make some general improvements to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#add-dependency-injection-support-to-the-movielisterapp-application">5. Add Dependency Injection support to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#make-changes-to-the-movielisterapp-application">6. Make changes to the <em>movielisterapp</em> application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started.html#suggested-next-steps">Suggested next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook.html">Aglyph cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-understanding.html">Understand the general features of Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-configuration.html">Choose a configuration approach for Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-common.html">Common usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-templating.html">Component inheritance using templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-notable.html">Other notable usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cookbook-integration.html">Integrating Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api-ref.html">Aglyph API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.html"><tt class="docutils literal"><span class="pre">aglyph</span></tt> &#8212; Dependency Injection for Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.assembler.html"><tt class="docutils literal"><span class="pre">aglyph.assembler</span></tt> &#8212; The Aglyph component assembler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.binder.html"><tt class="docutils literal"><span class="pre">aglyph.binder</span></tt> &#8212; The Aglyph component binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.cache.html"><tt class="docutils literal"><span class="pre">aglyph.cache</span></tt> &#8212; Simple object caching support for Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.compat.html"><tt class="docutils literal"><span class="pre">aglyph.compat</span></tt> &#8212; Python version/variant compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.compat.ipyetree.html"><tt class="docutils literal"><span class="pre">aglyph.compat.ipyetree</span></tt> &#8212; an <em>ElementTree</em> parser for <em>IronPython</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.component.html"><tt class="docutils literal"><span class="pre">aglyph.component</span></tt> &#8212; Defining components and their dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.context.html"><tt class="docutils literal"><span class="pre">aglyph.context</span></tt> &#8212; Defining component contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aglyph.integration.cherrypy.html"><tt class="docutils literal"><span class="pre">aglyph.integration.cherrypy</span></tt> &#8212; Integrating Aglyph with CherryPy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../testing.html">Aglyph 2.1.0 testing summary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#id1">CPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#id2">PyPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#id3">Stackless Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#id4">IronPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#id5">Jython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#previous-releases-of-aglyph">Previous releases of Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap for future releases</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Aglyph</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../aglyph.html">aglyph</a> &raquo;</li>
      
    <li>aglyph.component</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for aglyph.component</h1><div class="highlight"><pre>
<span class="c"># -*- coding: UTF-8 -*-</span>

<span class="c"># Copyright (c) 2006-2015 Matthew Zipay &lt;mattz@ninthtest.net&gt;</span>
<span class="c">#</span>
<span class="c"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c"># in the Software without restriction, including without limitation the rights</span>
<span class="c"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c"># furnished to do so, subject to the following conditions:</span>
<span class="c">#</span>
<span class="c"># The above copyright notice and this permission notice shall be included in</span>
<span class="c"># all copies or substantial portions of the Software.</span>
<span class="c">#</span>
<span class="c"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="c"># SOFTWARE.</span>

<span class="sd">&quot;&quot;&quot;The classes in this module are used to define components and their</span>
<span class="sd">dependencies.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Matthew Zipay &lt;mattz@ninthtest.net&gt;&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;2.1.0&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">aglyph</span> <span class="kn">import</span> <span class="n">AglyphDeprecationWarning</span><span class="p">,</span> <span class="n">AglyphError</span><span class="p">,</span> <span class="n">_safe_repr</span>
<span class="kn">from</span> <span class="nn">aglyph.compat</span> <span class="kn">import</span> <span class="n">is_callable</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">,</span> <span class="n">TextType</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;Component&quot;</span><span class="p">,</span>
    <span class="s">&quot;Evaluator&quot;</span><span class="p">,</span>
    <span class="s">&quot;LifecycleState&quot;</span><span class="p">,</span>
    <span class="s">&quot;Reference&quot;</span><span class="p">,</span>
    <span class="s">&quot;Strategy&quot;</span><span class="p">,</span>
    <span class="s">&quot;Template&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">Strategy</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;Strategy&quot;</span><span class="p">,</span>
                      <span class="p">(</span><span class="s">&quot;PROTOTYPE&quot;</span><span class="p">,</span> <span class="s">&quot;SINGLETON&quot;</span><span class="p">,</span> <span class="s">&quot;BORG&quot;</span><span class="p">,</span> <span class="s">&quot;WEAKREF&quot;</span><span class="p">))(</span>
                       <span class="s">&quot;prototype&quot;</span><span class="p">,</span> <span class="s">&quot;singleton&quot;</span><span class="p">,</span> <span class="s">&quot;borg&quot;</span><span class="p">,</span> <span class="s">&quot;weakref&quot;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Define the component assembly strategies implemented by Aglyph.</span>

<span class="sd">.. versionchanged:: 2.0.0</span>
<span class="sd">   ``Strategy`` is now a named tuple. In prior versions, it was a class.</span>

<span class="sd">.. rubric:: &quot;prototype&quot;</span>

<span class="sd">A new object is always created, initialized, wired, and returned.</span>

<span class="sd">.. note::</span>
<span class="sd">   &quot;prototype&quot; is the default assembly strategy for Aglyph components.</span>

<span class="sd">.. rubric:: &quot;singleton&quot;</span>

<span class="sd">The cached object is returned if it exists. Otherwise, the object is</span>
<span class="sd">created, initialized, wired, cached, and returned.</span>

<span class="sd">Singleton component objects are cached by :attr:`Component.unique_id`.</span>

<span class="sd">.. rubric:: &quot;borg&quot;</span>

<span class="sd">A new instance is always created. The shared-state is assigned to the</span>
<span class="sd">new instance&#39;s ``__dict__`` if it exists. Otherwise, the new instance is</span>
<span class="sd">initialized and wired, its instance ``__dict__`` is cached, and then the</span>
<span class="sd">instance is returned.</span>

<span class="sd">Borg component instance shared-states are cached by</span>
<span class="sd">:attr:`Component.component_id`.</span>

<span class="sd">.. warning::</span>
<span class="sd">   * The borg assembly strategy is **only** supported for</span>
<span class="sd">     components that are non-builtin classes.</span>
<span class="sd">   * The borg assembly strategy is **not** supported for</span>
<span class="sd">     classes that define or inherit a ``__slots__`` member.</span>

<span class="sd">.. rubric:: &quot;weakref&quot;</span>

<span class="sd">.. versionadded:: 2.1.0</span>

<span class="sd">In the simplest terms, this is a &quot;prototype&quot; that can exhibit</span>
<span class="sd">&quot;singleton&quot; behavior: as long as there is at least one &quot;live&quot; reference</span>
<span class="sd">to the assembled object in the application runtime, then requests to</span>
<span class="sd">assemble this component will return the same (cached) object.</span>

<span class="sd">When the only reference to the assembled object that remains is the</span>
<span class="sd">cached weak reference, the Python garbage collector is free to destroy</span>
<span class="sd">the object, at which point it is automatically removed from the Aglyph</span>
<span class="sd">cache.</span>

<span class="sd">Subsequent requests to assemble the same component will cause a new</span>
<span class="sd">object to be created, initialized, wired, cached (as a weak reference),</span>
<span class="sd">and returned.</span>

<span class="sd">.. note::</span>
<span class="sd">   Please refer to the :mod:`weakref` module for a detailed explanation</span>
<span class="sd">   of weak reference behavior.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">LifecycleState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;LifecycleState&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s">&quot;AFTER_INJECT&quot;</span><span class="p">,</span> <span class="s">&quot;BEFORE_CLEAR&quot;</span><span class="p">))(</span>
                             <span class="s">&quot;after_inject&quot;</span><span class="p">,</span> <span class="s">&quot;before_clear&quot;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Define the lifecycle states for which Aglyph will call object methods</span>
<span class="sd">on your behalf.</span>

<span class="sd">.. _lifecycle-methods:</span>

<span class="sd">.. rubric:: Lifecycle methods</span>

<span class="sd">Lifecycle methods are called with **no arguments** (positional or</span>
<span class="sd">keyword).</span>

<span class="sd">If a called lifecycle method raises an exception, the exception is</span>
<span class="sd">caught, logged at :attr:`logging.ERROR` level (including a traceback) to</span>
<span class="sd">the &quot;aglyph.assembler.Assembler&quot; channel, and a :class:`RuntimeWarning`</span>
<span class="sd">is issued.</span>

<span class="sd">A method may be registered for a lifecycle state by specifying the</span>
<span class="sd">method name at the context (least specific), template, and/or component</span>
<span class="sd">(most specific) level.</span>

<span class="sd">.. note::</span>
<span class="sd">   Aglyph only calls **one** method on an object for any lifecycle</span>
<span class="sd">   state. Refer to **The lifecycle method lookup process** (below) for</span>
<span class="sd">   details.</span>

<span class="sd">Aglyph recognizes the following lifecycle states:</span>

<span class="sd">.. rubric:: &quot;after_inject&quot;</span>

<span class="sd">A component object is in this state after **all** dependencies (both</span>
<span class="sd">initialization arguments and attributes) have been injected into a</span>
<span class="sd">newly-created instance, but before the object is cached and/or returned</span>
<span class="sd">to the caller.</span>

<span class="sd">Aglyph will only call **one** &quot;after_inject&quot; method on any object, and</span>
<span class="sd">will determine which method to call by using the lookup process</span>
<span class="sd">described below.</span>

<span class="sd">.. rubric:: &quot;before_clear&quot;</span>

<span class="sd">A component object is in this state after is has been removed from an</span>
<span class="sd">internal cache (singleton, borg, or weakref), but before the object</span>
<span class="sd">itself is actually discarded.</span>

<span class="sd">Aglyph will only call **one** &quot;before_clear&quot; method on any object, and</span>
<span class="sd">will determine which method to call by using the lookup process</span>
<span class="sd">described below.</span>

<span class="sd">.. _lifecycle-method-lookup-process:</span>

<span class="sd">.. rubric:: The lifecycle method lookup process</span>

<span class="sd">Lifecyle methods may be specified at the context (least specific),</span>
<span class="sd">template, and component (most specific) levels.</span>

<span class="sd">In order to determine which named method is called for a particular</span>
<span class="sd">object, Aglyph looks up the appropriate lifecycle method name in the</span>
<span class="sd">following order, using the **first** one found that is not ``None``</span>
<span class="sd">*and* is actually defined on the object:</span>

<span class="sd">#. The method named by the object&#39;s ``Component.&lt;lifecycle-state&gt;``</span>
<span class="sd">   property.</span>
<span class="sd">#. If the object&#39;s :attr:`Component.parent_id` is not ``None``, the</span>
<span class="sd">   method named by the corresponding parent</span>
<span class="sd">   ``Template.&lt;lifecycle-state&gt;`` or ``Component.&lt;lifecycle-state&gt;``</span>
<span class="sd">   property.</span>
<span class="sd">   (If necessary, lookup continues by examining the</span>
<span class="sd">   parent-of-the-parent and so on.)</span>
<span class="sd">#. The method named by the ``Context.&lt;lifecycle-state&gt;`` property.</span>

<span class="sd">When Aglyph finds a named lifecycle method that applies to an object,</span>
<span class="sd">but the object itself does not define that method, a</span>
<span class="sd">:attr:`logging.WARNING` message is emitted.</span>

<span class="sd">.. note::</span>
<span class="sd">  Either a :class:`Component` or :attr:`Template` may serve as the</span>
<span class="sd">  parent identified by a ``parent_id``.</span>

<span class="sd">  However, only a :class:`Component` may actually be assembled into</span>
<span class="sd">  a usable object. (A :attr:`Template` is like an abstract class -</span>
<span class="sd">  it defines common dependencies and/or lifecycle methods, but it</span>
<span class="sd">  cannot be assembled.)</span>

<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Reference"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Reference">[docs]</a><span class="k">class</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">TextType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A place-holder used to refer to another :class:`Component`.</span>

<span class="sd">    A ``Reference`` is used as an alias to identify a component that is a</span>
<span class="sd">    dependency of another component. The value of a ``Reference`` can be</span>
<span class="sd">    either a dotted-name or a user-provided unique ID.</span>

<span class="sd">    A ``Reference`` value MUST correspond to a component ID in the same</span>
<span class="sd">    context.</span>

<span class="sd">    A ``Reference`` can be used as an argument for an</span>
<span class="sd">    :class:`Evaluator`, and can be assembled directly by an</span>
<span class="sd">    :class:`aglyph.assembler.Assembler`.</span>

<span class="sd">    .. note::</span>
<span class="sd">        In Python versions &lt; 3.0, a ``Reference`` representing a</span>
<span class="sd">        dotted-name *must* consist only of characters in the ASCII</span>
<span class="sd">        subset of the source encoding (see :pep:`0263`).</span>

<span class="sd">        But in Python versions &gt;= 3.0, a ``Reference`` representing a</span>
<span class="sd">        dotted-name *may* contain non-ASCII characters</span>
<span class="sd">        (see :pep:`3131`).</span>

<span class="sd">        However, a ``Reference`` may also represent a user-defined</span>
<span class="sd">        identifier. To accommodate all cases, the super class of</span>
<span class="sd">        ``Reference`` is &quot;dynamic&quot; with respect to the version of Python</span>
<span class="sd">        under which Aglyph is running (:class:`unicode` under Python 2,</span>
<span class="sd">        :class:`str` under Python 3). This documentation shows the base</span>
<span class="sd">        class as ``str`` because the `Sphinx &lt;http://sphinx-doc.org/&gt;`_</span>
<span class="sd">        documentation generator runs under CPython 3.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TextType</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

</div>
<span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reference extends </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TextType</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_InitializationSupport</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;_args&quot;</span><span class="p">,</span> <span class="s">&quot;_keywords&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_InitializationSupport</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span>


<div class="viewcode-block" id="Evaluator"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Evaluator">[docs]</a><span class="k">class</span> <span class="nc">Evaluator</span><span class="p">(</span><span class="n">_InitializationSupport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform lazy creation of objects.&quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;_func&quot;</span><span class="p">]</span>

    <span class="n">__logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.Evaluator&quot;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param callable func: any callable that returns an object</span>
<span class="sd">        :param tuple args: the positional arguments to *func*</span>
<span class="sd">        :param dict keywords: the keyword arguments to *func*</span>

<span class="sd">        An ``Evaluator`` is similar to a :func:`functools.partial` in</span>
<span class="sd">        that they both collect a function and related arguments into a</span>
<span class="sd">        :obj:`callable` object with a simplified signature that can be</span>
<span class="sd">        called repeatedly to produce a new object.</span>

<span class="sd">        *Unlike* a partial function, an ``Evaluator`` may have arguments</span>
<span class="sd">        that are not truly &quot;frozen,&quot; in the sense that any argument may</span>
<span class="sd">        be defined as a :class:`Reference`, a :func:`functools.partial`,</span>
<span class="sd">        or even another ``Evaluator``, which needs to be resolved (i.e.</span>
<span class="sd">        assembled/called) before calling *func*.</span>

<span class="sd">        When an ``Evaluator`` is called, its arguments (positional and</span>
<span class="sd">        keyword) are each resolve in one of the following ways:</span>

<span class="sd">        * If the argument value is a :class:`Reference`, it is assembled</span>
<span class="sd">          (by an :class:`aglyph.assembler.Assembler` or</span>
<span class="sd">          :class:`aglyph.binder.Binder` reference passed to</span>
<span class="sd">          :meth:`__call__`)</span>
<span class="sd">        * If the argument value is an ``Evaluator`` or a</span>
<span class="sd">          :func:`functools.partial`, it is called to produce its value.</span>
<span class="sd">        * If the argument is a dictionary or a sequence other than a</span>
<span class="sd">          string type, each item is resolved according to these rules.</span>
<span class="sd">        * If none of the above cases apply, the argument value is used</span>
<span class="sd">          as-is.</span>

<span class="sd">        .. note::</span>
<span class="sd">           An ``Evaluator`` can handle any level of nesting (e.g. a</span>
<span class="sd">           :func:`functools.partial` within an ``Evaluator`` within</span>
<span class="sd">           *another* ``Evaluator``).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;TRACE </span><span class="si">%r</span><span class="s">, *</span><span class="si">%r</span><span class="s">, **</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Evaluator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_callable</span><span class="p">(</span><span class="n">func</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not callable&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span> <span class="o">=</span> <span class="n">keywords</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Evaluator.func"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Evaluator.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :obj:`callable` that creates new objects *(read-only)*.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span>
</div>
<div class="viewcode-block" id="Evaluator.__call__"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Evaluator.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assembler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call ``func(*args, **keywords)`` and return the new object.</span>

<span class="sd">        :param assembler: a reference to an\</span>
<span class="sd">                          :class:`aglyph.assembly.Assembler` or\</span>
<span class="sd">                          :class:`aglyph.binder.Binder`</span>

<span class="sd">        *assembler* is used to assemble any :class:`Reference` that is</span>
<span class="sd">        encountered in the function arguments.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;TRACE </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">assembler</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span>
        <span class="n">resolve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span>
        <span class="n">resolved_args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">resolve</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">assembler</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
        <span class="c"># keywords MUST be strings!</span>
        <span class="n">resolved_keywords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">resolve</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">assembler</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="n">keywords</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">resolved_args</span><span class="p">,</span> <span class="o">**</span><span class="n">resolved_keywords</span><span class="p">)</span>
        <span class="c"># do not log str/repr of assembled objects; may contain sensitive data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;RETURN </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">_safe_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
    <span class="k">def</span> <span class="nf">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">assembler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the resolved *arg*.</span>

<span class="sd">        :param arg: represents an argument (positional or keyword) to\</span>
<span class="sd">                    :attr:`func`.</span>
<span class="sd">        :param assembler: a reference to an\</span>
<span class="sd">                          :class:`aglyph.assembly.Assembler` or\</span>
<span class="sd">                          :class:`aglyph.binder.Binder`</span>
<span class="sd">        :return: the resolved argument value that will actually be\</span>
<span class="sd">                 passed to :attr:`func`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Reference</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Evaluator</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">arg</span><span class="p">(</span><span class="n">assembler</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">partial</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">arg</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
            <span class="c"># either keys or values may themselves be References, partials, or</span>
            <span class="c"># Evaluators</span>
            <span class="n">resolve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">resolve</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">assembler</span><span class="p">),</span> <span class="n">resolve</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">assembler</span><span class="p">))</span>
                         <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">))):</span>
            <span class="n">resolve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span>
            <span class="c"># assumption: the iterable class supports initialization with</span>
            <span class="c"># __init__(iterable)</span>
            <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="n">__class__</span><span class="p">([</span><span class="n">resolve</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">assembler</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arg</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">(</span><span class="si">%r</span><span class="s">, *</span><span class="si">%r</span><span class="s"> **</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">_DependencySupport</span><span class="p">(</span><span class="n">_InitializationSupport</span><span class="p">):</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;_attributes&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_DependencySupport</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>


<div class="viewcode-block" id="Template"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Template">[docs]</a><span class="k">class</span> <span class="nc">Template</span><span class="p">(</span><span class="n">_DependencySupport</span><span class="p">):</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;_after_inject&quot;</span><span class="p">,</span>
        <span class="s">&quot;_before_clear&quot;</span><span class="p">,</span>
        <span class="s">&quot;_parent_id&quot;</span><span class="p">,</span>
        <span class="s">&quot;_unique_id&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">__logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.Template&quot;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">after_inject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">before_clear</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :arg str template_id: context-unique identifier for this\</span>
<span class="sd">                              template</span>
<span class="sd">        :keyword str parent_id: specifies the ID of a template or\</span>
<span class="sd">                                component that describes the default\</span>
<span class="sd">                                dependencies and/or lifecyle methods\</span>
<span class="sd">                                for this template</span>
<span class="sd">        :keyword str after_inject: specifies the name of the method\</span>
<span class="sd">                                   that will be called on objects of\</span>
<span class="sd">                                   components that reference this\</span>
<span class="sd">                                   template after all component\</span>
<span class="sd">                                   dependencies have been injected</span>
<span class="sd">        :keyword str before_clear: specifies the name of the method\</span>
<span class="sd">                                   that will be called on objects of\</span>
<span class="sd">                                   components that reference this\</span>
<span class="sd">                                   template immediately before they are\</span>
<span class="sd">                                   cleared from cache</span>

<span class="sd">        .. note::</span>
<span class="sd">           A ``Template`` cannot be assembled (it is equivalent to an</span>
<span class="sd">           abstract class).</span>

<span class="sd">           However, a :class:`Component` can also serve as a template,</span>
<span class="sd">           so if you need the ability to assemble an object *and* use</span>
<span class="sd">           its definition as the basis for other components, then define</span>
<span class="sd">           the default dependencies and/or lifecycle methods in a</span>
<span class="sd">           :class:`Component` and use that component&#39;s ID as the</span>
<span class="sd">           :attr:`Component.parent_id` in other components.</span>

<span class="sd">        *unique_id* must be a user-provided identifier that is unique</span>
<span class="sd">        within the context to which this template is added. A component</span>
<span class="sd">        may then be instructed to use a template by specifying the same</span>
<span class="sd">        value for :attr:`Component.parent_id`.</span>

<span class="sd">        *parent_id* is **another** :attr:`Component.unique_id` or</span>
<span class="sd">        :attr:`Template.unique_id` in the same context that descibes</span>
<span class="sd">        **this** template&#39;s default dependencies and/or lifecycle</span>
<span class="sd">        methods.</span>

<span class="sd">        *after_inject* is the name of a method *of objects of this</span>
<span class="sd">        component* that will be called after **all** dependencies have</span>
<span class="sd">        been injected, but before the object is returned to the caller.</span>
<span class="sd">        This method will be called with **no** arguments (positional or</span>
<span class="sd">        keyword). Exceptions raised by this method are not caught.</span>

<span class="sd">        .. note::</span>
<span class="sd">           ``Template.after_inject``, if specified, **replaces**</span>
<span class="sd">           :attr:`aglyph.context.Context.after_inject` for any component</span>
<span class="sd">           that uses the template.</span>

<span class="sd">        *before_clear* is the name of a method *of objects of this</span>
<span class="sd">        component* that will be called immediately before the object is</span>
<span class="sd">        cleared from cache via</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_singletons()`,</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_borgs()`, or</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_weakrefs()`.</span>

<span class="sd">        .. note::</span>
<span class="sd">           ``Template.before_clear``, if specified, **replaces**</span>
<span class="sd">           :attr:`aglyph.context.Context.before_clear` for any component</span>
<span class="sd">           that uses the template.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           The *before_clear* keyword argument has no meaning for and is</span>
<span class="sd">           ignored by &quot;prototype&quot; components. If *before_clear* is</span>
<span class="sd">           specified for a prototype, a :class:`RuntimeWarning` will be</span>
<span class="sd">           issued.</span>

<span class="sd">           For &quot;weakref&quot; components, there is a possibility that the</span>
<span class="sd">           object no longer exists at the moment when the *before_clear*</span>
<span class="sd">           method would be called. In such cases, the *before_clear*</span>
<span class="sd">           method is **not** called. No warning is issued, but a</span>
<span class="sd">           :attr:`logging.WARNING` message is emitted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s">&quot;TRACE </span><span class="si">%r</span><span class="s">, parent_id=</span><span class="si">%r</span><span class="s">, after_inject=</span><span class="si">%r</span><span class="s">, before_clear=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">template_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">after_inject</span><span class="p">,</span> <span class="n">before_clear</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Template</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_id</span> <span class="o">=</span> <span class="n">template_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after_inject</span> <span class="o">=</span> <span class="n">after_inject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before_clear</span> <span class="o">=</span> <span class="n">before_clear</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Template.unique_id"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Template.unique_id">[docs]</a>    <span class="k">def</span> <span class="nf">unique_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uniquely identifies this template in a context *(read-only)*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_id</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Template.parent_id"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Template.parent_id">[docs]</a>    <span class="k">def</span> <span class="nf">parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identifies this template&#39;s parent template or component</span>
<span class="sd">        *(read-only)*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Template.after_inject"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Template.after_inject">[docs]</a>    <span class="k">def</span> <span class="nf">after_inject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of the component object method that will be called</span>
<span class="sd">        after **all** dependencies have been injected.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_inject</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Template.before_clear"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Template.before_clear">[docs]</a>    <span class="k">def</span> <span class="nf">before_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of the component object method that will be called</span>
<span class="sd">        immediately before the object is cleared from cache.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           This property is not applicable to &quot;prototype&quot; component</span>
<span class="sd">           objects, and is **not** guaranteed to be called for &quot;weakref&quot;</span>
<span class="sd">           component objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_clear</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">(</span><span class="si">%r</span><span class="s">, parent_id=</span><span class="si">%r</span><span class="s">, after_inject=</span><span class="si">%r</span><span class="s">, before_clear=</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unique_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_inject</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_before_clear</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Component"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component">[docs]</a><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">Template</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Define a component and the dependencies needed to create a new</span>
<span class="sd">    object of that component at runtime.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;_dotted_name&quot;</span><span class="p">,</span>
        <span class="s">&quot;_factory_name&quot;</span><span class="p">,</span>
        <span class="s">&quot;_member_name&quot;</span><span class="p">,</span>
        <span class="s">&quot;_strategy&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">__logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.Component&quot;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_id</span><span class="p">,</span> <span class="n">dotted_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">factory_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">member_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="n">Strategy</span><span class="o">.</span><span class="n">PROTOTYPE</span><span class="p">,</span>
                 <span class="n">parent_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">after_inject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">before_clear</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :arg str component_id: context-unique identifier for this\</span>
<span class="sd">                               component</span>
<span class="sd">        :keyword str dotted_name: an **importable** dotted name</span>
<span class="sd">        :keyword str factory_name: names a :obj:`callable` member of\</span>
<span class="sd">                                   the object identified by\</span>
<span class="sd">                                   *component_id* or *dotted_name*</span>
<span class="sd">        :keyword str member_name: names **any** member of the object\</span>
<span class="sd">                                  identified by *component_id* or\</span>
<span class="sd">                                  *dotted_name*</span>
<span class="sd">        :keyword str strategy: specifies the component assembly strategy</span>
<span class="sd">        :keyword str parent_id: specifies the ID of a template or\</span>
<span class="sd">                                component that describes the default\</span>
<span class="sd">                                dependencies and/or lifecyle methods\</span>
<span class="sd">                                for this component</span>
<span class="sd">        :keyword str after_inject: specifies the name of the method\</span>
<span class="sd">                                   that will be called on objects of\</span>
<span class="sd">                                   this component after all of its\</span>
<span class="sd">                                   dependencies have been injected</span>
<span class="sd">        :keyword str before_clear: specifies the name of the method\</span>
<span class="sd">                                   that will be called on objects of\</span>
<span class="sd">                                   this component immediately before\</span>
<span class="sd">                                   they are cleared from cache</span>
<span class="sd">        :raise aglyph.AglyphError: if both *factory_name* and\</span>
<span class="sd">                                   *member_name* are specified</span>
<span class="sd">        :raise ValueError: if *strategy* is not a recognized assembly\</span>
<span class="sd">                           strategy</span>

<span class="sd">        *component_id* must be a user-provided identifier that is unique</span>
<span class="sd">        within the context to which this component is added. An</span>
<span class="sd">        **importable** dotted name may be used (see</span>
<span class="sd">        :func:`aglyph.resolve_dotted_name`).</span>

<span class="sd">        *dotted_name*, if provided, must be an **importable** dotted</span>
<span class="sd">        name (see :func:`aglyph.resolve_dotted_name`).</span>

<span class="sd">        .. note::</span>
<span class="sd">           If *dotted_name* is not specified, then *component_id*</span>
<span class="sd">           will be used as the component&#39;s dotted name. In this case,</span>
<span class="sd">           *component_id* **must** be an importable dotted name.</span>

<span class="sd">        .. versionadded:: 2.0.0</span>
<span class="sd">           the *factory_name* keyword argument</span>

<span class="sd">        *factory_name* is the name of a :obj:`callable` member of</span>
<span class="sd">        *dotted-name* (i.e. a function, class, staticmethod, or</span>
<span class="sd">        classmethod). When provided, the assembler will call this member</span>
<span class="sd">        to create an object of this component.</span>

<span class="sd">        *factory_name* enables Aglyph to inject dependencies into</span>
<span class="sd">        objects that can only be initialized via nested classes,</span>
<span class="sd">        :obj:`staticmethod`, or :obj:`classmethod`. See</span>
<span class="sd">        :attr:`factory_name` for details.</span>

<span class="sd">        .. versionadded:: 2.0.0</span>
<span class="sd">           the *member_name* keyword argument</span>

<span class="sd">        *member_name* is the name of a member of *dotted-name*, which</span>
<span class="sd">        **may or may not** be callable.</span>

<span class="sd">        *member_name* differs from *factory_name* in two ways:</span>

<span class="sd">        1. *member_name* is not restricted to callable members; it may</span>
<span class="sd">           identify attributes and/or properties as well.</span>
<span class="sd">        2. When an assembler assembles a component with a</span>
<span class="sd">           *member_name*, initialization of the object is *bypassed*</span>
<span class="sd">           (i.e. the assembler will not call the member, and any</span>
<span class="sd">           initialization arguments defined for the component will be</span>
<span class="sd">           **ignored**).</span>

<span class="sd">        *member_name* enables Aglyph to reference class, function,</span>
<span class="sd">        :obj:`staticmethod`, and :obj:`classmethod` obejcts, as well as</span>
<span class="sd">        simple attributes or properties, as components and dependencies.</span>
<span class="sd">        See :attr:`member_name` for details.</span>

<span class="sd">        .. note::</span>

<span class="sd">           Both *factory_name* and *member_name* can be dot-separated</span>
<span class="sd">           names to reference nested members.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           The *factory_name* and *member_name* arguments are mutually</span>
<span class="sd">           exclusive. An exception is raised if both are provided.</span>

<span class="sd">        *strategy* must be a recognized component assembly strategy, and</span>
<span class="sd">        defaults to ``Strategy.PROTOTYPE`` (*&quot;prototype&quot;*) if not</span>
<span class="sd">        specified.</span>

<span class="sd">        Please see :data:`Strategy` for a description of the component</span>
<span class="sd">        assembly strategies supported by Aglyph.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           The ``Strategy.BORG`` (*&quot;borg&quot;*) component assembly strategy</span>
<span class="sd">           is only supported for classes that **do not** define or</span>
<span class="sd">           inherit ``__slots__``!</span>

<span class="sd">        .. versionadded:: 2.1.0</span>
<span class="sd">           the *parent_id* keyword argument</span>

<span class="sd">        *parent_id* is the context-unique ID of a :class:`Template` (or</span>
<span class="sd">        another ``Component``) that defines default dependencies and/or</span>
<span class="sd">        lifecycle methods for this component.</span>

<span class="sd">        .. versionadded:: 2.1.0</span>
<span class="sd">           the *after_inject* keyword argument</span>

<span class="sd">        *after_inject* is the name of a method *of objects of this</span>
<span class="sd">        component* that will be called after **all** dependencies have</span>
<span class="sd">        been injected, but before the object is returned to the caller.</span>
<span class="sd">        This method will be called with **no** arguments (positional or</span>
<span class="sd">        keyword). Exceptions raised by this method are not caught.</span>

<span class="sd">        .. note::</span>
<span class="sd">           ``Component.after_inject``, if specified, **replaces** either</span>
<span class="sd">           :attr:`Template.after_inject` (if this component also</span>
<span class="sd">           specifies :attr:`parent_id`) or</span>
<span class="sd">           :attr:`aglyph.context.Context.after_inject`.</span>

<span class="sd">        .. versionadded:: 2.1.0</span>
<span class="sd">           the *before_clear* keyword argument</span>

<span class="sd">        *before_clear* is the name of a method *of objects of this</span>
<span class="sd">        component* that will be called immediately before the object is</span>
<span class="sd">        cleared from cache via</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_singletons()`,</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_borgs()`, or</span>
<span class="sd">        :meth:`aglyph.assembler.Assembler.clear_weakrefs()`.</span>

<span class="sd">        .. note::</span>
<span class="sd">           ``Component.before_clear``, if specified, **replaces** either</span>
<span class="sd">           :attr:`Template.before_clear` (if this component also</span>
<span class="sd">           specifies :attr:`parent_id`) or</span>
<span class="sd">           :attr:`aglyph.context.Context.before_clear`.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           The *before_clear* keyword argument has no meaning for and is</span>
<span class="sd">           ignored by &quot;prototype&quot; components. If *before_clear* is</span>
<span class="sd">           specified for a prototype, a :class:`RuntimeWarning` will be</span>
<span class="sd">           issued.</span>

<span class="sd">           For &quot;weakref&quot; components, there is a possibility that the</span>
<span class="sd">           object no longer exists at the moment when the *before_clear*</span>
<span class="sd">           method would be called. In such cases, the *before_clear*</span>
<span class="sd">           method is **not** called. No warning is issued, but a</span>
<span class="sd">           :attr:`logging.WARNING` message is emitted.</span>

<span class="sd">        Once a ``Component`` instance is initialized, the ``args``</span>
<span class="sd">        (:obj:`list`), ``keywords`` (:obj:`dict`), and ``attributes``</span>
<span class="sd">        (:class:`collections.OrderedDict`) members can be modified</span>
<span class="sd">        in-place to define the dependencies that must be injected into</span>
<span class="sd">        objects of this component at assembly time. For example::</span>

<span class="sd">           component = Component(&quot;http.client.HTTPConnection&quot;)</span>
<span class="sd">           component.args.append(&quot;www.ninthtest.net&quot;)</span>
<span class="sd">           component.args.append(80)</span>
<span class="sd">           component.keywords[&quot;strict&quot;] = True</span>
<span class="sd">           component.attributes[&quot;set_debuglevel&quot;] = 1</span>

<span class="sd">        In Aglyph, a component may:</span>

<span class="sd">        * be assembled directly by an</span>
<span class="sd">          :class:`aglyph.assembler.Assembler` or</span>
<span class="sd">          :class:`aglyph.binder.Binder`</span>
<span class="sd">        * identify other components as dependencies (using a</span>
<span class="sd">          :class:`Reference`)</span>
<span class="sd">        * be used by other components as a dependency</span>
<span class="sd">        * use common dependencies and behaviors (*after_inject*,</span>
<span class="sd">          *before_clear*) defined in a</span>
<span class="sd">          :class:`aglyph.component.Template`</span>
<span class="sd">        * use any combination of the above behaviors</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s">&quot;TRACE </span><span class="si">%r</span><span class="s">, dotted_name=</span><span class="si">%r</span><span class="s">, factory_name=</span><span class="si">%r</span><span class="s">, member_name=</span><span class="si">%r</span><span class="s">, &quot;</span>
            <span class="s">&quot;strategy=</span><span class="si">%r</span><span class="s">, parent_id=</span><span class="si">%r</span><span class="s">, after_inject=</span><span class="si">%r</span><span class="s">, before_clear=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">component_id</span><span class="p">,</span> <span class="n">dotted_name</span><span class="p">,</span> <span class="n">factory_name</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span>
            <span class="n">parent_id</span><span class="p">,</span> <span class="n">after_inject</span><span class="p">,</span> <span class="n">before_clear</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">factory_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">member_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">AglyphError</span><span class="p">(</span>
                <span class="s">&quot;only one of factory_name or member_name may be specified&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">component_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span>
                                        <span class="n">after_inject</span><span class="o">=</span><span class="n">after_inject</span><span class="p">,</span>
                                        <span class="n">before_clear</span><span class="o">=</span><span class="n">before_clear</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dotted_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dotted_name</span> <span class="o">=</span> <span class="n">dotted_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dotted_name</span> <span class="o">=</span> <span class="n">component_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_factory_name</span> <span class="o">=</span> <span class="n">factory_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_member_name</span> <span class="o">=</span> <span class="n">member_name</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="n">Strategy</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_strategy</span> <span class="o">=</span> <span class="n">strategy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unrecognized assembly strategy </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">strategy</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">strategy</span> <span class="o">==</span> <span class="n">Strategy</span><span class="o">.</span><span class="n">PROTOTYPE</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">before_clear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_before_clear</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">warning_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;ignoring before_clear=</span><span class="si">%r</span><span class="s"> for prototype component </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">before_clear</span><span class="p">,</span> <span class="n">component_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">RuntimeWarning</span><span class="p">(</span><span class="n">warning_msg</span><span class="p">))</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.component_id"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.component_id">[docs]</a>    <span class="k">def</span> <span class="nf">component_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unique component identifier *(read-only)*.</span>

<span class="sd">        .. deprecated:: 2.1.0</span>
<span class="sd">           use :attr:`unique_id` instead.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">AglyphDeprecationWarning</span><span class="p">(</span><span class="s">&quot;Component.component_id&quot;</span><span class="p">,</span>
                                     <span class="n">replacement</span><span class="o">=</span><span class="s">&quot;Component.unique_id&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_id</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.dotted_name"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.dotted_name">[docs]</a>    <span class="k">def</span> <span class="nf">dotted_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The importable dotted name for objects of this component</span>
<span class="sd">        *(read-only)*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dotted_name</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.factory_name"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.factory_name">[docs]</a>    <span class="k">def</span> <span class="nf">factory_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of a :obj:`callable` member of :attr:`dotted_name`</span>
<span class="sd">        *(read-only)*.</span>

<span class="sd">        ``factory_name`` can be used to initialize objects of the</span>
<span class="sd">        component when a class is not directly importable (e.g. the</span>
<span class="sd">        component class is a nested class), or when component objects</span>
<span class="sd">        need to be initialized via :obj:`staticmethod` or</span>
<span class="sd">        :obj:`classmethod`.</span>

<span class="sd">        Consider the following::</span>

<span class="sd">           # module.py</span>
<span class="sd">           class Example:</span>
<span class="sd">               class Nested:</span>
<span class="sd">                   pass</span>

<span class="sd">        The following examples show how to define a component that will</span>
<span class="sd">        produce an *instance* of the ``module.Example.Nested`` class</span>
<span class="sd">        when assembled.</span>

<span class="sd">        Programmatic configuration using :class:`Component`::</span>

<span class="sd">           component = Component(&quot;nested-object&quot;,</span>
<span class="sd">                                 dotted_name=&quot;module.Example&quot;,</span>
<span class="sd">                                 factory_name=&quot;Nested&quot;)</span>

<span class="sd">        Programmatic configuration using :class:`aglyph.binder.Binder`::</span>

<span class="sd">           from aglyph.binder import Binder</span>
<span class="sd">           from module import Example</span>

<span class="sd">           binder = Binder()</span>
<span class="sd">           binder.bind(&quot;nested-object&quot;, to=Example, factory=&quot;Nested&quot;)</span>

<span class="sd">        Declarative XML configuration::</span>

<span class="sd">           &lt;component id=&quot;nested-object&quot; dotted-name=&quot;module.Example&quot;</span>
<span class="sd">               factory-name=&quot;Nested&quot; /&gt;</span>

<span class="sd">        ``factory_name`` may also be a dot-separated name to specify an</span>
<span class="sd">        arbitrarily-nested callable:</span>

<span class="sd">        Programmatic configuration using :class:`Component`::</span>

<span class="sd">           component = Component(&quot;nested-object&quot;, dotted_name=&quot;module&quot;,</span>
<span class="sd">                                 factory_name=&quot;Example.Nested&quot;)</span>

<span class="sd">        Programmatic configuration using :class:`aglyph.binder.Binder`::</span>

<span class="sd">           from aglyph.binder import Binder</span>
<span class="sd">           import module</span>

<span class="sd">           binder = Binder()</span>
<span class="sd">           binder.bind(&quot;nested-object&quot;, to=module,</span>
<span class="sd">                       factory=&quot;Example.Nested&quot;)</span>

<span class="sd">        Declarative XML configuration::</span>

<span class="sd">           &lt;component id=&quot;nested-object&quot; dotted-name=&quot;module&quot;</span>
<span class="sd">               factory-name=&quot;Example.Nested&quot; /&gt;</span>

<span class="sd">        .. note::</span>
<span class="sd">           The important thing to remember is that :attr:`dotted_name`</span>
<span class="sd">           must be **importable**, and ``factory_name`` must be</span>
<span class="sd">           accessible from the imported class or module via attribute</span>
<span class="sd">           access.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory_name</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.member_name"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.member_name">[docs]</a>    <span class="k">def</span> <span class="nf">member_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of any member of :attr:`dotted_name` *(read-only)*.</span>

<span class="sd">        ``member_name`` can be used to obtain an object *directly* from</span>
<span class="sd">        an importable module or class. The named member is simply</span>
<span class="sd">        accessed and returned (it is **not** called, even if it is</span>
<span class="sd">        callable).</span>

<span class="sd">        Consider the following::</span>

<span class="sd">           # module.py</span>
<span class="sd">           class Example:</span>
<span class="sd">               class Nested:</span>
<span class="sd">                   pass</span>

<span class="sd">        The following examples show how to define a component that will</span>
<span class="sd">        produce the ``module.Example.Nested`` class *itself* when</span>
<span class="sd">        assembled.</span>

<span class="sd">        Programmatic configuration using :class:`Component`::</span>

<span class="sd">           component = Component(&quot;nested-class&quot;,</span>
<span class="sd">                                 dotted_name=&quot;module.Example&quot;,</span>
<span class="sd">                                 member_name=&quot;Nested&quot;)</span>

<span class="sd">        Programmatic configuration using :class:`aglyph.binder.Binder`::</span>

<span class="sd">           from aglyph.binder import Binder</span>
<span class="sd">           from module import Example</span>

<span class="sd">           binder = Binder()</span>
<span class="sd">           binder.bind(&quot;nested-class&quot;, to=Example, member=&quot;Nested&quot;)</span>

<span class="sd">        Declarative XML configuration::</span>

<span class="sd">           &lt;component id=&quot;nested-class&quot; dotted-name=&quot;module.Example&quot;</span>
<span class="sd">               member-name=&quot;Nested&quot; /&gt;</span>

<span class="sd">        ``member_name`` may also be a dot-separated name to specify an</span>
<span class="sd">        arbitrarily-nested member:</span>

<span class="sd">        Programmatic configuration using :class:`Component`::</span>

<span class="sd">           component = Component(&quot;nested-class&quot;, dotted_name=&quot;module&quot;,</span>
<span class="sd">                                 member_name=&quot;Example.Nested&quot;)</span>

<span class="sd">        Programmatic configuration using :class:`aglyph.binder.Binder`::</span>

<span class="sd">           from aglyph.binder import Binder</span>
<span class="sd">           import module</span>

<span class="sd">           binder = Binder()</span>
<span class="sd">           binder.bind(&quot;nested-class&quot;, to=module,</span>
<span class="sd">                       member=&quot;Example.Nested&quot;)</span>

<span class="sd">        Declarative XML configuration::</span>

<span class="sd">           &lt;component id=&quot;nested-class&quot; dotted-name=&quot;module&quot;</span>
<span class="sd">               member-name=&quot;Example.Nested&quot; /&gt;</span>

<span class="sd">        .. note::</span>
<span class="sd">           The important thing to remember is that :attr:`dotted_name`</span>
<span class="sd">           must be **importable**, and ``member_name`` must be</span>
<span class="sd">           accessible from the imported class or module via attribute</span>
<span class="sd">           access.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           When a component specifies ``member_name``, initialization is</span>
<span class="sd">           assumed. In other words, Aglyph **will not** attempt to</span>
<span class="sd">           initialize the member, and will **ignore** any</span>
<span class="sd">           :attr:`init_args` or :attr:`init_keywords`.</span>

<span class="sd">           On assembly, if any initialization arguments and/or keyword</span>
<span class="sd">           arguments have been defined for such a component, they are</span>
<span class="sd">           discarded and a WARN-level log record is emitted to the</span>
<span class="sd">           &quot;aglyph.assembler.Assembler&quot; channel.</span>

<span class="sd">           Any :attr:`attributes` that have been specified for the</span>
<span class="sd">           component will still be processed as setter injection</span>
<span class="sd">           dependencies, however.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_name</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.strategy"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.strategy">[docs]</a>    <span class="k">def</span> <span class="nf">strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The component assembly strategy *(read-only)*.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strategy</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.init_args"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.init_args">[docs]</a>    <span class="k">def</span> <span class="nf">init_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The positional arguments for constructor injection of</span>
<span class="sd">        component object dependencies.</span>

<span class="sd">        .. deprecated:: 2.1.0</span>
<span class="sd">           use :attr:`args` instead.</span>

<span class="sd">        .. note::</span>
<span class="sd">           This property may not be set; it must be modified by</span>
<span class="sd">           reference.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">AglyphDeprecationWarning</span><span class="p">(</span><span class="s">&quot;Component.init_args&quot;</span><span class="p">,</span>
                                               <span class="n">replacement</span><span class="o">=</span><span class="s">&quot;Component.args&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Component.init_keywords"><a class="viewcode-back" href="../../aglyph.component.html#aglyph.component.Component.init_keywords">[docs]</a>    <span class="k">def</span> <span class="nf">init_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The keyword arguments for constructor injection of component</span>
<span class="sd">        object dependencies.</span>

<span class="sd">        .. deprecated:: 2.1.0</span>
<span class="sd">           use :attr:`keywords` instead.</span>

<span class="sd">        .. note::</span>
<span class="sd">           This property may not be set; it must be modified by</span>
<span class="sd">           reference.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">AglyphDeprecationWarning</span><span class="p">(</span><span class="s">&quot;Component.init_keywords&quot;</span><span class="p">,</span>
                                     <span class="n">replacement</span><span class="o">=</span><span class="s">&quot;Component.keywords&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">(</span><span class="si">%r</span><span class="s">, dotted_name=</span><span class="si">%r</span><span class="s">, factory_name=</span><span class="si">%r</span><span class="s">, member_name=</span><span class="si">%r</span><span class="s">, &quot;</span>
                <span class="s">&quot;strategy=</span><span class="si">%r</span><span class="s">, parent_id=</span><span class="si">%r</span><span class="s">, after_inject=</span><span class="si">%r</span><span class="s">, &quot;</span>
                <span class="s">&quot;before_clear=</span><span class="si">%r</span><span class="s">)&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_unique_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dotted_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory_name</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_member_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_after_inject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_clear</span><span class="p">)</span>
</pre></div></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2006-2015, Matthew Zipay.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>