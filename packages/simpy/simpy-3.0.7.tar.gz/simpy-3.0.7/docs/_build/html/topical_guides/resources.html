<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Shared Resources &mdash; SimPy 3.0.6 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="SimPy 3.0.6 documentation" href="../index.html" />
    <link rel="up" title="Topical Guides" href="index.html" />
    <link rel="next" title="Real-time simulations" href="real-time-simulations.html" />
    <link rel="prev" title="Process Interaction" href="process_interaction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="real-time-simulations.html" title="Real-time simulations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="process_interaction.html" title="Process Interaction"
             accesskey="P">previous</a> |</li>
        <li><a href="../contents.html">SimPy 3.0.6 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Topical Guides</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="shared-resources">
<h1>Shared Resources<a class="headerlink" href="#shared-resources" title="Permalink to this headline">¶</a></h1>
<p>Shared resources are another way to model <a class="reference internal" href="process_interaction.html"><em>Process Interaction</em></a>. They form
a congestion point where processes queue up in order to use them.</p>
<p>SimPy defines three categories of resources:</p>
<ul class="simple">
<li><a class="reference internal" href="#res-type-resource"><em>Resources</em></a> – Resources that can be used by a limited
number of processes at a time (e.g., a gas station with a limited number of
fuel pumps).</li>
<li><a class="reference internal" href="#res-type-container"><em>Containers</em></a> – Resources that model the production and
consumption of a homogeneous, undifferentiated bulk. It may either be
continuous (like water) or discrete (like apples).</li>
<li><a class="reference internal" href="#res-type-store"><em>Stores</em></a> – Resources that allow the production and
consumption of Python objects.</li>
</ul>
<div class="section" id="the-basic-concept-of-resources">
<h2>The basic concept of resources<a class="headerlink" href="#the-basic-concept-of-resources" title="Permalink to this headline">¶</a></h2>
<p>All resources share the same basic concept: The resource itself is some kind of
a container with a, usually limited, <em>capacity</em>. Processes can either try to
<em>put</em> something into the resource or try to <em>get</em> something out. If the
resource is full or empty, they have to <em>queue</em> up and wait.</p>
<p>This is roughly, how every resource looks like:</p>
<div class="highlight-python"><div class="highlight"><pre>BaseResource(capacity):
   put_queue
   get_queue

   put(): event
   get(): event
</pre></div>
</div>
<p>Every resources a maximum capacity and two queues, one for processes that want
to put something into it and one for processes that want to get something out.
The <tt class="docutils literal"><span class="pre">put()</span></tt> and <tt class="docutils literal"><span class="pre">get()</span></tt> methods both return an event that is triggered when
the corresponding action was successful.</p>
<div class="section" id="resources-and-interrupts">
<h3>Resources and interrupts<a class="headerlink" href="#resources-and-interrupts" title="Permalink to this headline">¶</a></h3>
<p>While a process is waiting for a put or get event to succeed, it may be
<a class="reference internal" href="process_interaction.html#interrupting-another-process"><em>interrupted</em></a> by another process. After
catching the interrupt, the process has two possibilities:</p>
<ol class="arabic">
<li><p class="first">It may continue to wait for the request (by yielding the event again).</p>
</li>
<li><p class="first">It may stop waiting for the request. In this case, it has to call the
event&#8217;s <tt class="docutils literal"><span class="pre">cancel()</span></tt> method.</p>
<p>Since you can easily forget this, all resources events are <em>context
managers</em> (see the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#with">Python docs</a> for
details).</p>
</li>
</ol>
<hr class="docutils" />
<p>The resource system is modular and extensible. Resources can, for example, use
specialized queues and event types. This allows them to use sorted queues, to
add priorities to events, or to offer preemption.</p>
</div>
</div>
<div class="section" id="resources">
<span id="res-type-resource"></span><h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>Resources can be used by a limited number of processes at a time (e.g.,
a gas station with a limited number of fuel pumps). Processes <em>request</em> these
resources to become a user (or to &#8220;own&#8221; them) and have to <em>release</em> them once
they are done (e.g., vehicles arrive at the gas station, use a fuel-pump, if
one is available, and leave when they are done).</p>
<p>Requesting a resources is modeled as &#8220;putting a process&#8217; token into the
resources&#8221; and releasing a resources correspondingly as &#8220;getting a process&#8217;
token out of the resource&#8221;. Thus, calling <tt class="docutils literal"><span class="pre">request()</span></tt>/<tt class="docutils literal"><span class="pre">release()</span></tt> is
equivalent to calling <tt class="docutils literal"><span class="pre">put()</span></tt>/<tt class="docutils literal"><span class="pre">get()</span></tt>. Releasing a resource will always
succeed immediately.</p>
<p>SimPy implements three <em>resource</em> types:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="../api_reference/simpy.resources.html#simpy.resources.resource.Resource" title="simpy.resources.resource.Resource"><tt class="xref py py-class docutils literal"><span class="pre">Resource</span></tt></a></li>
<li><a class="reference internal" href="../api_reference/simpy.resources.html#simpy.resources.resource.PriorityResource" title="simpy.resources.resource.PriorityResource"><tt class="xref py py-class docutils literal"><span class="pre">PriorityResource</span></tt></a>, where queueing processes are sorted by priority</li>
<li><a class="reference internal" href="../api_reference/simpy.resources.html#simpy.resources.resource.PreemptiveResource" title="simpy.resources.resource.PreemptiveResource"><tt class="xref py py-class docutils literal"><span class="pre">PreemptiveResource</span></tt></a>, where processes additionally may preempt other
processes with a lower priority</li>
</ol>
<div class="section" id="resource">
<h3>Resource<a class="headerlink" href="#resource" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">Resource</span></tt> is conceptually a <em>semaphore</em>. Its only parameter – apart from
the obligatory reference to an <a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment" title="simpy.core.Environment"><tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt></a> – is its
<em>capacity</em>. It must be a positive number and defaults to 1: <tt class="docutils literal"><span class="pre">Resource(env,</span>
<span class="pre">capacity=1)</span></tt>.</p>
<p>Instead of just counting its current users, it stores the request event as an
&#8220;access token&#8221; for each user. This is, for example, useful for adding
preemption (see below).</p>
<p>Here is as basic example for using a resource:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simpy</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">resource_user</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">request</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>  <span class="c"># Generate a request event</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">request</span>                 <span class="c"># Wait for access</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>          <span class="c"># Do something</span>
<span class="gp">... </span>    <span class="n">resource</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>     <span class="c"># Release the resource</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note, that you have to release the resource under all conditions; for example,
if you got interrupted while waiting for or using the resource. In order to
help you with that and to avoid too many <tt class="docutils literal"><span class="pre">try:</span> <span class="pre">...</span> <span class="pre">finally:</span> <span class="pre">...</span></tt> constructs,
request events can be used as context manager:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">resource_user</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>  <span class="c"># Generate a request event</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">req</span>                    <span class="c"># Wait for access</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c"># Do something</span>
<span class="gp">... </span>                                     <span class="c"># Resource released automatically</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Resources allow you retrieve the list of users and queued as well as the
number of users and resource&#8217;s capacity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s"> slots are allocated.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">capacity</span><span class="p">))</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;  Users:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;  Queued events:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">queue</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">print_stats</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">res</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">req</span>
<span class="gp">... </span>        <span class="n">print_stats</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_stats</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="n">res</span><span class="p">)),</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="n">res</span><span class="p">))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">0 of 1 slots are allocated.</span>
<span class="go">  Users: []</span>
<span class="go">  Queued events: []</span>
<span class="go">1 of 1 slots are allocated.</span>
<span class="go">  Users: [&lt;Request() object at 0x...&gt;]</span>
<span class="go">  Queued events: []</span>
<span class="go">1 of 1 slots are allocated.</span>
<span class="go">  Users: [&lt;Request() object at 0x...&gt;]</span>
<span class="go">  Queued events: [&lt;Request() object at 0x...&gt;]</span>
<span class="go">0 of 1 slots are allocated.</span>
<span class="go">  Users: []</span>
<span class="go">  Queued events: [&lt;Request() object at 0x...&gt;]</span>
<span class="go">1 of 1 slots are allocated.</span>
<span class="go">  Users: [&lt;Request() object at 0x...&gt;]</span>
<span class="go">  Queued events: []</span>
<span class="go">0 of 1 slots are allocated.</span>
<span class="go">  Users: []</span>
<span class="go">  Queued events: []</span>
</pre></div>
</div>
</div>
<div class="section" id="priorityresource">
<h3>PriorityResource<a class="headerlink" href="#priorityresource" title="Permalink to this headline">¶</a></h3>
<p>As you may know from the real world, not every one is equally important. To map
that to SimPy, there&#8217;s the <em>PriorityResource</em>. This subclass of <em>Resource</em> lets
requesting processes provide a priority for each request. More important
requests will gain access to the resource earlier than less important ones.
Priority is expressed by integer numbers; smaller numbers mean a higher
priority.</p>
<p>Apart form that, it works like a normal <em>Resource</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">resource_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">wait</span><span class="p">,</span> <span class="n">prio</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">prio</span><span class="p">)</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> requesting at </span><span class="si">%s</span><span class="s"> with priority=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">prio</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">req</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> got resource at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">PriorityResource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p3</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">prio</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">1 requesting at 0 with priority=0</span>
<span class="go">1 got resource at 0</span>
<span class="go">2 requesting at 1 with priority=0</span>
<span class="go">3 requesting at 2 with priority=-1</span>
<span class="go">3 got resource at 3</span>
<span class="go">2 got resource at 6</span>
</pre></div>
</div>
<p>Although <em>p3</em> requested the resource later than <em>p2</em>, it could use it earlier
because its priority was higher.</p>
</div>
<div class="section" id="preemptiveresource">
<h3>PreemptiveResource<a class="headerlink" href="#preemptiveresource" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, new requests are so important that queue-jumping is not enough and
they need to kick existing users out of the resource (this is called
<em>preemption</em>). The <em>PreemptiveResource</em> allows you to do exactly this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">resource_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">wait</span><span class="p">,</span> <span class="n">prio</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">prio</span><span class="p">)</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> requesting at </span><span class="si">%s</span><span class="s"> with priority=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">prio</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">req</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> got resource at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Interrupt</span> <span class="k">as</span> <span class="n">interrupt</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">by</span> <span class="o">=</span> <span class="n">interrupt</span><span class="o">.</span><span class="n">cause</span><span class="o">.</span><span class="n">by</span>
<span class="gp">... </span>            <span class="n">usage</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">interrupt</span><span class="o">.</span><span class="n">cause</span><span class="o">.</span><span class="n">usage_since</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> got preempted by </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s"> after </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
<span class="gp">... </span>                  <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">usage</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">PreemptiveResource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p3</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">resource_user</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">prio</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">1 requesting at 0 with priority=0</span>
<span class="go">1 got resource at 0</span>
<span class="go">2 requesting at 1 with priority=0</span>
<span class="go">3 requesting at 2 with priority=-1</span>
<span class="go">1 got preempted by &lt;Process(resource_user) object at 0x...&gt; at 2 after 2</span>
<span class="go">3 got resource at 2</span>
<span class="go">2 got resource at 5</span>
</pre></div>
</div>
<p><em>PreemptiveResource</em> inherits from <em>PriorityResource</em> and adds a <em>preempt</em>
flag (that defaults to <tt class="docutils literal"><span class="pre">True</span></tt>) to <tt class="docutils literal"><span class="pre">request()</span></tt>. By setting this to <tt class="docutils literal"><span class="pre">False</span></tt>
(<tt class="docutils literal"><span class="pre">resource.request(priority=x,</span> <span class="pre">preempt=False)</span></tt>), a process can decide to not
preempt another resource user. It will still be put in the queue according to
its priority, though.</p>
<p>The implementation of <em>PreemptiveResource</em> values priorities higher than
preemption. That means preempt request are not allowed to cheat and jump over
a higher prioritized request. The following example shows that preemptive low
priority requests cannot queue-jump over high priority requests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">prio</span><span class="p">,</span> <span class="n">preempt</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">res</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">prio</span><span class="p">,</span> <span class="n">preempt</span><span class="o">=</span><span class="n">preempt</span><span class="p">)</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> requesting at </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">req</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> got resource at </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Interrupt</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> got preempted at </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">PreemptiveResource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">preempt</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># Give A a head start</span>
<span class="go">A requesting at 0</span>
<span class="go">A got resource at 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">prio</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">preempt</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">prio</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">preempt</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">B requesting at 1</span>
<span class="go">C requesting at 1</span>
<span class="go">B got resource at 3</span>
<span class="go">C got resource at 6</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Process <em>A</em> requests the resource with priority 0. It immediately becomes
a user.</li>
<li>Process <em>B</em> requests the resource with priority -2 but sets <em>preempt</em> to
<tt class="docutils literal"><span class="pre">False</span></tt>. It will queue up and wait.</li>
<li>Process <em>C</em> requests the resource with priority -1 but leaves <em>preempt</em>
<tt class="docutils literal"><span class="pre">True</span></tt>. Normally, it would preempt <em>A</em> but in this case, <em>B</em> is queued up
before <em>C</em> and prevents <em>C</em> from preempting <em>A</em>. <em>C</em> can also not preempt
<em>B</em> since its priority is not high enough.</li>
</ol>
<p>Thus, the behavior in the example is the same as if no preemption was used at
all. Be careful when using mixed preemption!</p>
<p>Due to the higher priority of process <em>B</em>, no preemption occurs in this
example. Note that an additional request with a priority of -3 would be able
to preempt <em>A</em>.</p>
<p>If your use-case requires a different behaviour, for example queue-jumping or
valuing preemption over priorities, you can subclass <em>PreemptiveResource</em> and
override the default behaviour.</p>
</div>
</div>
<div class="section" id="containers">
<span id="res-type-container"></span><h2>Containers<a class="headerlink" href="#containers" title="Permalink to this headline">¶</a></h2>
<p>Containers help you modelling the production and consumption of a homogeneous,
undifferentiated bulk. It may either be continuous (like water) or discrete
(like apples).</p>
<p>You can use this, for example, to model the gas / petrol tank of a gas station.
Tankers increase the amount of gasoline in the tank while cars decrease it.</p>
<p>The following example is a very simple model of a gas station with a limited
number of fuel dispensers (modeled as <tt class="docutils literal"><span class="pre">Resource</span></tt>) and a tank modeled as
<tt class="docutils literal"><span class="pre">Container</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">GasStation</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">fuel_dispensers</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_tank</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">mon_proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor_tank</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">monitor_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_tank</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<span class="gp">... </span>                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Calling tanker at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tanker</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">tanker</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">gas_station</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c"># Need 10 Minutes to arrive</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Tanker arriving at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">amount</span> <span class="o">=</span> <span class="n">gas_station</span><span class="o">.</span><span class="n">gas_tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">-</span> <span class="n">gas_station</span><span class="o">.</span><span class="n">gas_tank</span><span class="o">.</span><span class="n">level</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">gas_station</span><span class="o">.</span><span class="n">gas_tank</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">car</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">gas_station</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Car </span><span class="si">%s</span><span class="s"> arriving at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">gas_station</span><span class="o">.</span><span class="n">fuel_dispensers</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">req</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Car </span><span class="si">%s</span><span class="s"> starts refueling at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">gas_station</span><span class="o">.</span><span class="n">gas_tank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Car </span><span class="si">%s</span><span class="s"> done refueling at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">car_generator</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">gas_station</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">car</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">gas_station</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gas_station</span> <span class="o">=</span> <span class="n">GasStation</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_gen</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">car_generator</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">gas_station</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
<span class="go">Car 0 arriving at 0</span>
<span class="go">Car 0 starts refueling at 0</span>
<span class="go">Car 1 arriving at 5</span>
<span class="go">Car 0 done refueling at 5</span>
<span class="go">Car 1 starts refueling at 5</span>
<span class="go">Car 2 arriving at 10</span>
<span class="go">Car 1 done refueling at 10</span>
<span class="go">Car 2 starts refueling at 10</span>
<span class="go">Calling tanker at 15</span>
<span class="go">Car 3 arriving at 15</span>
<span class="go">Car 3 starts refueling at 15</span>
<span class="go">Tanker arriving at 25</span>
<span class="go">Car 2 done refueling at 30</span>
<span class="go">Car 3 done refueling at 30</span>
</pre></div>
</div>
<p>Containers allow you to retrieve their current <tt class="docutils literal"><span class="pre">level</span></tt> as well as their
<tt class="docutils literal"><span class="pre">capacity</span></tt> (see <tt class="docutils literal"><span class="pre">GasStation.monitor_tank()</span></tt> and <tt class="docutils literal"><span class="pre">tanker()</span></tt>). You can also
access the list of waiting events via the <tt class="docutils literal"><span class="pre">put_queue</span></tt> and <tt class="docutils literal"><span class="pre">get_queue</span></tt>
attributes (similar to <tt class="docutils literal"><span class="pre">Resource.queue</span></tt>).</p>
</div>
<div class="section" id="stores">
<span id="res-type-store"></span><h2>Stores<a class="headerlink" href="#stores" title="Permalink to this headline">¶</a></h2>
<p>Using Stores you can model the production and consumption of concrete objects
(in contrast to the rather abstract &#8220;amount&#8221; stored in containers). A single
Store can even contain multiple types of objects.</p>
<p>Beside <a class="reference internal" href="../api_reference/simpy.resources.html#simpy.resources.store.Store" title="simpy.resources.store.Store"><tt class="xref py py-class docutils literal"><span class="pre">Store</span></tt></a>, there is a <a class="reference internal" href="../api_reference/simpy.resources.html#simpy.resources.store.FilterStore" title="simpy.resources.store.FilterStore"><tt class="xref py py-class docutils literal"><span class="pre">FilterStore</span></tt></a> that lets you use
a custom function to filter the objects you get out of the store.</p>
<p>Here is a simple example modelling a generic producer/consumer scenario:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;spam </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Produced spam at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;requesting spam at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">item</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;got&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">store</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prod</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">producer</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">store</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">consumers</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">consumer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">store</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">0 requesting spam at 1</span>
<span class="go">1 requesting spam at 1</span>
<span class="go">Produced spam at 2</span>
<span class="go">0 got spam 0 at 2</span>
<span class="go">0 requesting spam at 3</span>
<span class="go">Produced spam at 4</span>
<span class="go">1 got spam 1 at 4</span>
</pre></div>
</div>
<p>As with the other resource types, you can get a store&#8217;s capacity via the
<tt class="docutils literal"><span class="pre">capacity</span></tt> attribute. The attribute <tt class="docutils literal"><span class="pre">items</span></tt> points to the list of items
currently available in the store. The put and get queues can be accessed via
the <tt class="docutils literal"><span class="pre">put_queue</span></tt> and <tt class="docutils literal"><span class="pre">get_queue</span></tt> attributes.</p>
<p><em>FilterStore</em> can, for example, be used to model machine shops where machines
have varying attributes. This can be useful if the homogeneous slots of
a <em>Resource</em> are not what you need:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Machine</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;Machine&#39;</span><span class="p">,</span> <span class="s">&#39;size, duration&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c"># Small and slow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># Big and fast</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">machine_shop</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">FilterStore</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">machine_shop</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">]</span>  <span class="c"># Pre-populate the machine shop</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">machine</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="k">lambda</span> <span class="n">machine</span><span class="p">:</span> <span class="n">machine</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">size</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;got&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="s">&#39;at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="n">ms</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;released&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="s">&#39;at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">user</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">machine_shop</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">0 got Machine(size=1, duration=2) at 0</span>
<span class="go">1 got Machine(size=2, duration=1) at 0</span>
<span class="go">1 released Machine(size=2, duration=1) at 1</span>
<span class="go">0 released Machine(size=1, duration=2) at 2</span>
<span class="go">2 got Machine(size=1, duration=2) at 2</span>
<span class="go">2 released Machine(size=1, duration=2) at 4</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../contents.html">
              <img class="logo" src="../_static/simpy-logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Shared Resources</a><ul>
<li><a class="reference internal" href="#the-basic-concept-of-resources">The basic concept of resources</a><ul>
<li><a class="reference internal" href="#resources-and-interrupts">Resources and interrupts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resources">Resources</a><ul>
<li><a class="reference internal" href="#resource">Resource</a></li>
<li><a class="reference internal" href="#priorityresource">PriorityResource</a></li>
<li><a class="reference internal" href="#preemptiveresource">PreemptiveResource</a></li>
</ul>
</li>
<li><a class="reference internal" href="#containers">Containers</a></li>
<li><a class="reference internal" href="#stores">Stores</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="process_interaction.html"
                        title="previous chapter">Process Interaction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="real-time-simulations.html"
                        title="next chapter">Real-time simulations</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/topical_guides/resources.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="real-time-simulations.html" title="Real-time simulations"
             >next</a> |</li>
        <li class="right" >
          <a href="process_interaction.html" title="Process Interaction"
             >previous</a> |</li>
        <li><a href="../contents.html">SimPy 3.0.6 documentation</a> &raquo;</li>
          <li><a href="index.html" >Topical Guides</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2002–2015, Team SimPy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>