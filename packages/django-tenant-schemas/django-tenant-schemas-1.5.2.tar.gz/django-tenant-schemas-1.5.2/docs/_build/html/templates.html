<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Specializing templates based on tenants &mdash; django-tenant-schema dev documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-tenant-schema dev documentation" href="index.html" />
    <link rel="next" title="Tests" href="test.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="test.html" title="Tests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-tenant-schema dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="specializing-templates-based-on-tenants">
<h1>Specializing templates based on tenants<a class="headerlink" href="#specializing-templates-based-on-tenants" title="Permalink to this headline">¶</a></h1>
<div class="section" id="multitenant-aware-filesystem-template-loader">
<h2>Multitenant aware filesystem template loader<a class="headerlink" href="#multitenant-aware-filesystem-template-loader" title="Permalink to this headline">¶</a></h2>
<p>The classical Django filesystem template loader cannot make the search path for template vary based on the current tenant so it&#8217;s needed to use a special one which adapt the search path based on the tenant. For using it add it to your <code class="docutils literal"><span class="pre">TEMPLATE_LOADERS</span></code> setting.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_LOADERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;tenant_schemas.template_loaders.FilesystemLoader&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.template.loaders.filesystem.Loader&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.template.loaders.app_directories.Loader&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This loader is looking for templates based on the setting <code class="docutils literal"><span class="pre">MULTITENANT_TEMPLATE_DIRS</span></code> instead of the path in <code class="docutils literal"><span class="pre">TEMPLATE_DIRS</span></code>. Templates are not searched directly in each directory <code class="docutils literal"><span class="pre">template_dir</span></code> but in the directory <code class="docutils literal"><span class="pre">os.path.join(template_dir,</span> <span class="pre">tenant.domain_url)</span></code>. If <code class="docutils literal"><span class="pre">template_dir</span></code> contains a <code class="docutils literal"><span class="pre">%s</span></code> formatting placeholder the directory used is <code class="docutils literal"><span class="pre">template_dir</span> <span class="pre">%</span> <span class="pre">tenant.domain_url</span></code> so that you can store your templates in a subdirectory of your tenant directory. Like with the Django <code class="docutils literal"><span class="pre">FilesystemLoader</span></code> the first found file is returned.</p>
</div>
<div class="section" id="multitenant-aware-cached-template-loader">
<h2>Multitenant aware cached template loader<a class="headerlink" href="#multitenant-aware-cached-template-loader" title="Permalink to this headline">¶</a></h2>
<p>If you are using template caching with the multitenant filesystem loader it is not gonna work as the cache is ignoring the tenant. So the first template loaded for any tenant will be returned for all other tenants. To remediate to this problem you can use a new loader whose cache is based on the template path and the primary key of the tenant model.</p>
<p>The multitenant cached loader works exactly like the Django cached loader but is tenant aware.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_LOADERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&#39;tenant_schemas.template_loaders.CachedLoader&#39;</span><span class="p">,</span> <span class="p">(</span>
      <span class="s">&#39;tenant_schemas.template_loaders.FilesystemLoader&#39;</span><span class="p">,</span>
      <span class="s">&#39;django.template.loaders.filesystem.Loader&#39;</span><span class="p">,</span>
      <span class="s">&#39;django.template.loaders.app_directories.Loader&#39;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Specializing templates based on tenants</a><ul>
<li><a class="reference internal" href="#multitenant-aware-filesystem-template-loader">Multitenant aware filesystem template loader</a></li>
<li><a class="reference internal" href="#multitenant-aware-cached-template-loader">Multitenant aware cached template loader</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="test.html"
                        title="next chapter">Tests</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/templates.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="test.html" title="Tests"
             >next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             >previous</a> |</li>
        <li><a href="index.html">django-tenant-schema dev documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Bernardo Pires Carneiro.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>