<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MailViews &mdash; django-mailer2 master documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'master',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-mailer2 master documentation" href="index.html" />
    <link rel="next" title="Settings" href="settings.html" />
    <link rel="prev" title="Usage" href="queue.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="settings.html" title="Settings"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="queue.html" title="Usage"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-mailer2 master documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mailviews">
<h1>MailViews<a class="headerlink" href="#mailviews" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Rendering and sending emails in Django can quickly become repetitive and
error-prone. By encapsulating message rendering within view classes, you can
easily compose messages in a structured and clear manner.</p>
<p>The idea behind the method is identhical to the template class based view: you can select the template to use, in our
case one for the subject and one for the body (and one extra for the html), you can pass the data you need overriding
the <cite>get_context_data</cite> method and the message rendering is made in <cite>render_to_message</cite> where you can also customize
the parameters as sender, cc, cco, etc. or delay the decision to the <cite>send</cite> method.</p>
<p>Managing mails could become a crazy thing quite fast, so the idea is to be able to organize the mail templates in folders
and use the mailview classes to provide them with the data you need.</p>
<p>Using inheritance in templates, mixins and inheritance will give you again the control.</p>
</div>
<div class="section" id="sending-your-first-e-mail">
<h2>Sending your first e-mail<a class="headerlink" href="#sending-your-first-e-mail" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s suppose we want to send notificantion message to a mailing list. We don&#8217;t have a customized email, but we want
to be able to render the e-mail</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_mailer.messages</span> <span class="kn">import</span> <span class="n">TemplatedEmailMessageView</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">NewsletterView</span><span class="p">(</span><span class="n">EmailMessageView</span><span class="p">):</span>
    <span class="n">subject_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/subject.txt&#39;</span>
    <span class="n">body_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/body.txt&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        here we can get the addtional data we want</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NewsletterView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="c"># Instantiate and send a message.</span>

<span class="n">NewsletterView</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;mynewsletter@example.com&#39;</span><span class="p">,)</span> <span class="p">)</span>
</pre></div>
</div>
<p>This would render and send a message to the newsletter with the DEFAULT_FROM_EMAIL` emails settings. Sometimes we&#8217;d like
to send it with different e-mail, so we can customize it as</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">NewsletterView</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">from_email</span><span class="o">=</span><span class="s">&#39;no-reply@example.com&#39;</span><span class="p">,</span>
                      <span class="n">to</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;mynewsletter@exemple.com&#39;</span><span class="p">,</span> <span class="p">))</span>
</pre></div>
</div>
<p>Any keywords you pass in send will be forwarded to the django mail calss, so you can use the same parameters you have
in the Django <cite>EmailMessage</cite> class documentation:</p>
<ul class="simple">
<li><strong>from_email</strong>: The sender’s address. Both <a class="reference external" href="mailto:fred&#37;&#52;&#48;example&#46;com">fred<span>&#64;</span>example<span>&#46;</span>com</a> and Fred &lt;<a class="reference external" href="mailto:fred&#37;&#52;&#48;example&#46;com">fred<span>&#64;</span>example<span>&#46;</span>com</a>&gt; forms are legal. If omitted, the DEFAULT_FROM_EMAIL setting is used.</li>
<li><strong>to</strong>: A list or tuple of recipient addresses.</li>
<li><strong>bcc</strong>: A list or tuple of addresses used in the “Bcc” header when sending the email.</li>
<li><strong>cc</strong>: A list or tuple of recipient addresses used in the “Cc” header when sending the email.</li>
</ul>
<p>Instead of using <cite>send</cite> you can use <cite>render_to_message</cite> method. It&#8217;s parameters are the same as the <cite>send</cite> method, but
instead of sending the e-mail it will return you an instance of <cite>EmailMessage</cite> that you can use to customize the
e-mail before sending it.</p>
<p>In our example, we could write:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_mailer.messages</span> <span class="kn">import</span> <span class="n">TemplatedEmailMessageView</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">NewsletterView</span><span class="p">(</span><span class="n">EmailMessageView</span><span class="p">):</span>
    <span class="n">subject_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/subject.txt&#39;</span>
    <span class="n">body_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/body.txt&#39;</span>

    <span class="k">def</span> <span class="nf">render_to_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;mynewsletter@example.com&#39;</span><span class="p">,)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;from_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no-reply@example.com&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NewsletterView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render_to_message</span><span class="p">(</span><span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        here we can get the addtional data we want</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NewsletterView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="c"># Instantiate and send a message.</span>

<span class="n">NewsletterView</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>Supose now that we wan&#8217;t to send a second newsletter, the monthly one for exaple, then we could just write</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_mailer.messages</span> <span class="kn">import</span> <span class="n">TemplatedEmailMessageView</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">MonthlyNewsletterView</span><span class="p">(</span><span class="n">NewsletterView</span><span class="p">):</span>
    <span class="n">subject_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/monthly_subject.txt&#39;</span>
    <span class="n">body_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/newsletter/monthly_body.txt&#39;</span>

<span class="n">MonthlyNewsletterView</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-html-emails">
<h2>Sending HTML Emails<a class="headerlink" href="#sending-html-emails" title="Permalink to this headline">¶</a></h2>
<p>In the previous example we have sent just text emails. If we want to send HTML email we need also an additional template
to render the HTML content. You just have to inherit your class from <cite>TemplatedHTMLEmailMessageView</cite> and write the
template you&#8217;re going to use in <cite>html_body_template_name</cite>, so usually we&#8217;ll have somethins</p>
</div>
<div class="section" id="sending-mail-to-a-user">
<h2>Sending mail to a user<a class="headerlink" href="#sending-mail-to-a-user" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_mailer.messages</span> <span class="kn">import</span> <span class="n">TemplatedEmailMessageView</span>

<span class="c"># Subclass the `TemplatedEmailMessageView`, adding the templates you want to render.</span>
<span class="k">class</span> <span class="nc">WelcomeMessageView</span><span class="p">(</span><span class="n">EmailMessageView</span><span class="p">):</span>
    <span class="n">subject_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/welcome/subject.txt&#39;</span>
    <span class="n">body_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/welcome/body.txt&#39;</span>

<span class="c"># Instantiate and send a message.</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">WelcomeMessageView</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">extra_context</span><span class="o">=</span><span class="p">{</span>
    <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
<span class="p">},</span> <span class="n">to</span><span class="o">=</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,))</span>
</pre></div>
</div>
<p>This isn&#8217;t actually the best pattern for sending customized messages to a user</p>
<p>Try and avoid using the <tt class="docutils literal"><span class="pre">extra_context</span></tt> argument when sending emails.
Instead, create an <tt class="docutils literal"><span class="pre">TemplatedEmailMessageView</span></tt> subclass whose constructor accepts
as arguments all of the objects that you require to generate the context and
send the message. For example, the code shown in &#8220;Basic Usage&#8221; could written
instead as the following:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_mailer.messages</span> <span class="kn">import</span> <span class="n">TemplatedEmailMessageView</span>

<span class="k">class</span> <span class="nc">WelcomeMessageView</span><span class="p">(</span><span class="n">EmailMessageView</span><span class="p">):</span>
    <span class="n">subject_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/welcome/subject.txt&#39;</span>
    <span class="n">body_template_name</span> <span class="o">=</span> <span class="s">&#39;emails/welcome/body.txt&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WelcomeMessageView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">WelcomeMessageView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">render_to_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s">&#39;to&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span>  <span class="c"># this should only be sent to the user</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">WelcomeMessageView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render_to_message</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># Instantiate and send a message.</span>
<span class="n">WelcomeMessageView</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>In fact, you might find it helpful to encapsulate the above &#8220;message for a user&#8221;
pattern into a mixin or subclass that provides a standard abstraction for all
user-related emails.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MailViews</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#sending-your-first-e-mail">Sending your first e-mail</a></li>
<li><a class="reference internal" href="#sending-html-emails">Sending HTML Emails</a></li>
<li><a class="reference internal" href="#sending-mail-to-a-user">Sending mail to a user</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="queue.html"
                        title="previous chapter">Usage</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="settings.html"
                        title="next chapter">Settings</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/mailviews.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="settings.html" title="Settings"
             >next</a> |</li>
        <li class="right" >
          <a href="queue.html" title="Usage"
             >previous</a> |</li>
        <li><a href="index.html">django-mailer2 master documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Tauber, Beaven &amp; APSL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>