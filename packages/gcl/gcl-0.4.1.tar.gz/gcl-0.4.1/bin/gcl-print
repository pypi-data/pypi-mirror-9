#!/usr/bin/env python
"""Script to print a GCL model."""

import argparse
import sys

import gcl
from gcl import util

parser = argparse.ArgumentParser(description='Print a GCL model file.')
parser.add_argument('files', metavar='FILES', type=str, nargs='*',
                    help='Files to print')

args = parser.parse_args()

class PrintWalker(util.ExpressionWalker):
  def enterTuple(self, tuple, path):
    if path:
      print ('| ' * len(path)) + '+ ' + path[-1]

  def leaveTuple(self, tuple, path):
    pass

  def visitError(self, key, ex, path):
    print ex
    pass

  def visitScalar(self, key, value, path):
    print ('| ' * len(path)) + '+ ' + key
    pass


def print_model(model):
  util.walk(model, PrintWalker())

if args.files:
  for filename in args.files:
    try:
      model = gcl.load(filename)
    except gcl.ParseError as e:
      print e
      break
    else:
      print_model(model)
else:
  try:
    model = gcl.loads(sys.stdin.read(), filename='<stdin>')
  except gcl.ParseError as e:
    print e
  else:
    print_model(model)
