<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>formbar.config &mdash; Formbar 0.8.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Formbar 0.8.3 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Formbar 0.8.3 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for formbar.config</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">gettext</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">formbar.rules</span> <span class="kn">import</span> <span class="n">Rule</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">gettext</span><span class="o">.</span><span class="n">gettext</span>



<div class="viewcode-block" id="load"><a class="viewcode-back" href="../../api.html#formbar.config.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the parsed XML form the given file. The function will load</span>
<span class="sd">    the file located in path and than returns the parsed content.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="parse"><a class="viewcode-back" href="../../api.html#formbar.config.parse">[docs]</a><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">xml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the parsed XML. This is a helper function to be used in</span>
<span class="sd">    connection with loading the configuration files.</span>
<span class="sd">    :xml: XML string to be parsed</span>
<span class="sd">    :returns: DOM of the parsed XML</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Config"><a class="viewcode-back" href="../../api.html#formbar.config.Config">[docs]</a><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for accessing the form configuration file. It provides methods to</span>
<span class="sd">    get certain elements from the configuration. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Config.__init__"><a class="viewcode-back" href="../../api.html#formbar.config.Config.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a configuration with the DOM tree of an XML configuration</span>
<span class="sd">        for the form. If tree is not an instance of an ElementTree than raise a</span>
<span class="sd">        TypeError</span>

<span class="sd">        :tree: XML DOM tree of the configuration file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Config must instanciated with a &#39;</span>
                   <span class="s">&#39;ElementTree.Element instance. &quot;</span><span class="si">%s</span><span class="s">&quot; was provided&#39;</span> <span class="o">%</span> <span class="n">tree</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">get_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of all elements found in the tree with the given</span>
<span class="sd">        name. If no elements can be found. Return an empty list.</span>

<span class="sd">        :name: name of the elements to be found</span>
<span class="sd">        :returns: list of elements</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qstr</span> <span class="o">=</span> <span class="s">&quot;.//</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">qstr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an ``Element`` from the configuration. If the element can</span>
<span class="sd">        not be found it returns None. If there are more than one element of</span>
<span class="sd">        this name and the id, than raise an KeyException.</span>

<span class="sd">        If the intitail found element refers to another element by the &#39;ref&#39;</span>
<span class="sd">        attribute the function is recalled as long as it can find the element.</span>
<span class="sd">        :name: Name of the element (e.g entity)</span>
<span class="sd">        :id: ID of the element</span>
<span class="sd">        :returns: ``Element`` or ``None``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qstr</span> <span class="o">=</span> <span class="s">&quot;.//</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">qstr</span> <span class="o">+=</span> <span class="s">&quot;[@id=&#39;</span><span class="si">%s</span><span class="s">&#39;]&quot;</span> <span class="o">%</span> <span class="nb">id</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">qstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Element is ambigous&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># If the found elements refernces another element than retry</span>
            <span class="c"># getting the refed element</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a ``FormConfig`` instance with the configuration for a form</span>
<span class="sd">        with id in the configuration file. If the form can not be found a</span>
<span class="sd">        KeyError is raised.</span>

<span class="sd">        :id: ID of the form in the configuration file</span>
<span class="sd">        :returns: ``FormConfig`` instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&#39;Form with id &quot;</span><span class="si">%s</span><span class="s">&quot; can not be found&#39;</span> <span class="o">%</span> <span class="nb">id</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Form</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">Form</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for accessing the configuration of a specific form. The form</span>
<span class="sd">    configuration only provides a subset of available attributes for forms.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a form configuration with the DOM tree of a XML form</span>
<span class="sd">        configuration. On initialisation the form will be configured that means</span>
<span class="sd">        that all included fields will be configured.</span>

<span class="sd">        :tree: XML DOM tree of the form configuration.</span>
<span class="sd">        :parent: XML DOM tree of the parent configuration.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="sd">&quot;&quot;&quot;Reference to parent configuration&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;id. ID of the form&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;readonly&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span>
        <span class="sd">&quot;&quot;&quot;Flag to set the form as a readonly form. If set all fields in</span>
<span class="sd">        the form.  will be rendered as a simple textfield which does not</span>
<span class="sd">        allow to change or enter any data. Defaults to False&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;css&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;css. CSS class(es) to be added to the form&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autocomplete</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;autocomplete&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;autocomplete. Configure the form to autocomplete (prefill) the</span>
<span class="sd">        fields in the form. Defaults to &#39;on&#39;&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;method&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;method. HTTP method used for sending the data. Defaults to &#39;POST&#39;</span>
<span class="sd">        Valid values are GET and POST.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;action. URL where to send the data. Defaults to an empty string</span>
<span class="sd">        which means send data to the current url again.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enctype</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;enctype&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;enctype. Encoding type of the subbmitted values. Use</span>
<span class="sd">        &#39;multipart/form-data&#39; if you want to upload files. Defaults to an empty</span>
<span class="sd">        string.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id2name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dictionary with a mapping of id to fieldnames&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="sd">&quot;&quot;&quot;Flag to indicate that the form has been setup&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_buttons</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Buttons of the form&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="sd">&quot;&quot;&quot;Dictionary with all fields in the form. The name of the field is the</span>
<span class="sd">        key in the dictionary&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Get all Buttons for the form.</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;.//button&#39;</span><span class="p">):</span>
            <span class="n">buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buttons</span>

    <span class="k">def</span> <span class="nf">get_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Get all fields for the form.</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>

        <span class="c"># Search for fields</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;.//page&#39;</span><span class="p">):</span>
            <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c"># Now search for snippets</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;.//snippet&#39;</span><span class="p">):</span>
            <span class="n">sref</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sref</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s">&#39;snippet&#39;</span><span class="p">,</span> <span class="n">sref</span><span class="p">)</span>
                <span class="n">pages</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pages</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pages</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Will walk the tree recursivley and yields every field node.</span>
<span class="sd">        If evaluate parameter is true, then the function will only</span>
<span class="sd">        return fields which are relevant after the conditionals in the</span>
<span class="sd">        form has been evaluated.</span>

<span class="sd">        :root: Root node</span>
<span class="sd">        :values: Dictionary with values which are used for evaluating</span>
<span class="sd">        conditionals.</span>
<span class="sd">        :evaluate: Flag to indicate if evaluation should be done on</span>
<span class="sd">        conditionals</span>
<span class="sd">        :returns: yields field elements</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;if&quot;</span><span class="p">:</span>
                    <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expr&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">evaluate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rule</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">elem</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">elem</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;snippet&quot;</span><span class="p">:</span>
                <span class="n">sref</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sref</span><span class="p">:</span>
                    <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s">&#39;snippet&#39;</span><span class="p">,</span> <span class="n">sref</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">elem</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;field&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{},</span>
                   <span class="n">reload_fields</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of included fields in the form. Fields fetched</span>
<span class="sd">        by searching all field elements in the form or snippets and</span>
<span class="sd">        &quot;subsnippets&quot; in the forms.</span>

<span class="sd">        :returns: A dictionary with the configured fields in the form. The name</span>
<span class="sd">        of the field is the key of the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Are the fields already initialized? Ignore cache if we get</span>
        <span class="c"># fields for a particular page</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="ow">and</span> <span class="n">root</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">reload_fields</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span>

        <span class="c"># Get all fields for the form.</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s">&#39;entity&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="c"># Inherit readonly flag to all fields in this field.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="n">field</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id2name</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">fields</span>

    <span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the field with the name from the form. If the field can not</span>
<span class="sd">        be found a KeyError is raised.</span>

<span class="sd">        :name: name of the field to get</span>
<span class="sd">        :returns: ``Field``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Tried to get field &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span>
                      <span class="s">&#39; which is not included in the form&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>


<span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration of a Field&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inits a field with the entity DOM element.</span>

<span class="sd">        :entity: entity DOM element</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>

        <span class="c"># Attributes of the field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Id of the field. Usally only used to refer to the field.</span>
<span class="sd">        Example labels.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Name of the field. values will be submitted using this name&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="sd">&quot;&quot;&quot;Label of the field. If no label is provied the a capitalized</span>
<span class="sd">        form of the name is used. To not render a label at all define a</span>
<span class="sd">        label with an empty string.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;A ordering number for the field. In some form it is helpfull</span>
<span class="sd">        to be able to refer to a specific field by its number. The</span>
<span class="sd">        number will be rendered next to the label of the field.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The datatype for this field. The data type is important for</span>
<span class="sd">        converting the submitted data into a python value. Note that</span>
<span class="sd">        this option is ignored if the form is used to render an</span>
<span class="sd">        SQLAlchemy mapped item.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;css&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;A string which will be added to the class tag of the form&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;required&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span>
        <span class="sd">&quot;&quot;&quot;Flag to mark the field as a required field. If this tag is</span>
<span class="sd">        set an additional rule will be added to the field and an astrix</span>
<span class="sd">        is rendered at the label of the field. Note that this option</span>
<span class="sd">        might not be needed to be set if the form is used to render a</span>
<span class="sd">        SQLAlchemy mapped item as this. In this case the required flag</span>
<span class="sd">        is already set by the underlying FormAlchemy library by checking</span>
<span class="sd">        if the database field is &#39;NOT NULL&#39;. Defaults to False&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">desired</span><span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;desired&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span>
        <span class="sd">&quot;&quot;&quot;Flag to mark the field as a desired field. If this tag is</span>
<span class="sd">        set an additional rule will be added to the field and an star</span>
<span class="sd">        symbol is rendered at the label of the field. Defaults to</span>
<span class="sd">        False&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;readonly&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span>
        <span class="sd">&quot;&quot;&quot;Flag to set the field as a readonly field. If set the field</span>
<span class="sd">        will be rendered as a simple textfield which does not allow to</span>
<span class="sd">        change or enter any data. Defaults to False&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autocomplete</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;autocomplete&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Flag to enable or disable the automcomplete feature for this</span>
<span class="sd">        field. Defaults to enabled autocompletion&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Default value of the field. Note that this value might be</span>
<span class="sd">        overwritten while rendering the form if the field is within the</span>
<span class="sd">        submitted values on a form submission. Defaults to empty</span>
<span class="sd">        string. This attribute is also used for Infofields to define the</span>
<span class="sd">        value which should be displayed (If no expression is defined)&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;Tags of the field. Fields can have tags. Tags can be used to</span>
<span class="sd">        mark fields in the form and become handy if a application wants</span>
<span class="sd">        to find fields having a specific tag.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c"># Subelements of the fields</span>
        <span class="c"># Options (For dropdown, checkbox and radio fields)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;options&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">option</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)))</span>

        <span class="c"># Help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">text</span>

        <span class="c"># Renderer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">renderer_config</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;renderer&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">renderer_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">Renderer</span><span class="p">(</span><span class="n">renderer_config</span><span class="p">)</span>

        <span class="c"># Get rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Add automatic genertated rules based on the required or</span>
        <span class="c"># desired flag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="s">&quot;bool($</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;This field is required. You must provide a value&quot;</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;pre&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="s">&quot;bool($</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;This field is desired. Pleas provide a value&quot;</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;pre&quot;</span>
            <span class="n">triggers</span> <span class="o">=</span> <span class="s">&quot;warning&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">triggers</span><span class="p">))</span>
        <span class="c"># Add rules added the the field.</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;rule&#39;</span><span class="p">):</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expr&#39;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">)</span>
            <span class="n">triggers</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;triggers&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">triggers</span><span class="p">))</span>



<span class="k">class</span> <span class="nc">Renderer</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration class for FieldRenderers. This class gives an</span>
<span class="sd">    interface to the Renderer configuration for fields if the field</span>
<span class="sd">    should be rendererd differently than the standard way.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;@todo: to be defined &quot;&quot;&quot;</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>

        <span class="c"># Attributes of the Renderer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_type</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Type of the Renderer. Known Renderers:</span>
<span class="sd">        - Datepicker</span>
<span class="sd">        - Textarea</span>
<span class="sd">        - HTML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_position</span> <span class="o">=</span> <span class="s">&quot;top&quot;</span>
        <span class="sd">&quot;&quot;&quot;Optional. If defined the label will placed left, top</span>
<span class="sd">        or right to the field.  Defaults to top&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_align</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span>
        <span class="sd">&quot;&quot;&quot;Optional. If defined the label will be aligned left or right,</span>
<span class="sd">        Defaults to left This only applies for lables which are</span>
<span class="sd">        positioned on the left or right side&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="sd">&quot;&quot;&quot;Optional. If defined the label will have the defined width.</span>
<span class="sd">        Defaults to 2 cols. The Fieldwidth will be reduced by the label</span>
<span class="sd">        width. This only applies for lables which are positioned on the</span>
<span class="sd">        left or right side.&quot;&quot;&quot;</span>
        <span class="n">label_config</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_position</span> <span class="o">=</span> <span class="n">label_config</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;top&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_position</span> <span class="o">==</span> <span class="s">&quot;left&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_align</span> <span class="o">=</span> <span class="n">label_config</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;align&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;right&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_position</span> <span class="o">==</span> <span class="s">&quot;right&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_align</span> <span class="o">=</span> <span class="n">label_config</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;align&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;left&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">label_config</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Warning! The body of the renderer may include all valid and</span>
        <span class="c"># invalid html data including scripting. Use with caution here as</span>
        <span class="c"># this may become a large security hole if some users inject</span>
        <span class="c"># malicious code!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The body attribute is currently only used by the HTML</span>
<span class="sd">        Renderer and has the content to be rendererd.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_type</span> <span class="o">==</span> <span class="s">&quot;html&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Formbar 0.8.3 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, 2014 Torsten Irlnder.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>