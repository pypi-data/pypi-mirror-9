#!/usr/bin/env python
# -*- coding: utf-8 -*-
__author__ = 'Mike Cole'
__email__ = 'mcole@uievolution.com'
__dateCreated__ = '2/25/15'


from selenium import webdriver
# from selenium.webdriver.common.keys import Keys
from time import sleep

debug = False

if not debug:
    input_prompt = '>>>'
    print "Enter login page URL, including protocol and path. (eg https://server.to.test/admin/)"
    url = raw_input(input_prompt)
    print "Enter user name:"
    username = raw_input(input_prompt)
    print "Enter password:"
    password = raw_input(input_prompt)
    print "Enter path to group or endpoint summary page you with to fire actions against"
    targetUrl = raw_input(input_prompt)
    print "Enter BSP hosted file location to download from."
    downloadLink = raw_input(input_prompt)
else:
    url = 'https://testv2.uiexm.com/admin/'
    username = 'exmadmin@uievolution.com'
    password = 'games4u'
    targetUrl = 'https://testv2.uiexm.com/admin/groups/#D5B76A600CCE41BE838402705417CD13'
    downloadLink = 'http://mcolesystem76.corp.uievolution.com/firmware/2.0.0.13_test12.zip'

driver = webdriver.Firefox()
driver.get(url)
sleep(2)

assert "UIE ExperienceManager" in driver.title
uname = driver.find_element_by_name("email")
uname.send_keys(username)
pword = driver.find_element_by_name("password")
pword.send_keys(password)
subButton = driver.find_element_by_partial_link_text("Sign in")
subButton.click()
sleep(2)

driver.get(targetUrl)
sleep(2)
moreActions = driver.find_element_by_class_name("more-actions")
moreActions.click()

updateLink = driver.find_element_by_partial_link_text('Update')
updateLink.click()

updateType = driver.find_element_by_xpath("//div[@id='action-info-body']/div/div[2]/div/div")
updateType.click()
updateTypeBSP = driver.find_element_by_xpath("//*[@id='action-info-body']/div[1]/div[2]/div/div[2]/span[2]")
updateTypeBSP.click()
sleep(2)

downloadUrlElement = driver.find_element_by_xpath('//*[@id="action-info-body"]/div[2]/div[2]/input')
downloadUrlElement.send_keys(downloadLink)

try:
    saveActionButton = driver.find_element_by_xpath('//*[@id="endpoint"]/div[1]/div[2]/a[2]')
    saveActionButton.click()
except:
    saveActionButton = driver.find_element_by_xpath('//*[@id="group"]/div[1]/div[2]/a[2]')
    saveActionButton.click()

# Cleanup
# Wait 10 seconds, then close the browser session
sleep(5)
driver.close()
