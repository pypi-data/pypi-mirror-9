<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LadonType for complex service types &mdash; Ladon 0.9.23 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.23',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Ladon 0.9.23 documentation" href="index.html" />
    <link rel="next" title="Ladon Tasks" href="tasks.html" />
    <link rel="prev" title="Ladonize" href="ladonize.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/Ladon_24.jpg">
          Ladon</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ladonize.html">Ladonize</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">LadonType for complex service types</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Ladon Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending Ladon with new interface protocols</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">LadonType for complex service types</a><ul>
<li><a class="reference internal" href="#direct-type-assignment-old-style">Direct Type Assignment (old-style)</a></li>
<li><a class="reference internal" href="#portable-types">Portable types</a></li>
<li><a class="reference internal" href="#dictionary-type-definition">Dictionary Type-Definition</a><ul>
<li><a class="reference internal" href="#null-and-default-values">Null and default values</a></li>
<li><a class="reference internal" href="#reuse-code-for-dictionary-type-definition">Reuse code for dictionary type-definition</a></li>
<li><a class="reference internal" href="#attribute-filter-functions">Attribute filter functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="ladonize.html" title="Previous Chapter: Ladonize"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Ladonize</span>
    </a>
  </li>
  <li>
    <a href="tasks.html" title="Next Chapter: Ladon Tasks"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Ladon Tasks &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/ladontype.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ladontype-for-complex-service-types">
<h1>LadonType for complex service types<a class="headerlink" href="#ladontype-for-complex-service-types" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="ladon.types.ladontype.LadonType">
<em class="property">class </em><tt class="descclassname">ladon.types.ladontype.</tt><tt class="descname">LadonType</tt><big>(</big><em>prime_dict=None</em>, <em>tc=None</em>, <em>export_dict=None</em><big>)</big><a class="headerlink" href="#ladon.types.ladontype.LadonType" title="Permalink to this definition">¶</a></dt>
<dd><p>LadonType must be specialized by all complex service types. It tells the Ladon
framework that it should expect multiple primitives and/or lists to be defined as
class attributes. Using LadonType it is possible to build nested types.</p>
<p>LadonType specializations must define it&#8217;s attributes as types (either primitive
types, other LadonType specialization types, lists of primitive or lists of 
LadonType specialization). This explains the Ladon framework what to expect. There
are 5 primitive types:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Python 2</th>
<th class="head">Python 3</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>str</td>
<td>bytes</td>
</tr>
<tr class="row-odd"><td>unicode</td>
<td>str</td>
</tr>
<tr class="row-even"><td>bool</td>
<td>bool</td>
</tr>
<tr class="row-odd"><td>float</td>
<td>float</td>
</tr>
<tr class="row-even"><td>int</td>
<td>int</td>
</tr>
<tr class="row-odd"><td>attachment</td>
<td>attachment</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<div class="section" id="direct-type-assignment-old-style">
<h2>Direct Type Assignment (old-style)<a class="headerlink" href="#direct-type-assignment-old-style" title="Permalink to this headline">¶</a></h2>
<p>There are two ways of defining LadonType attributes. Either you can assign an
attribute directly to a type (old-style type-definition) or you can use the
new-style dictionary type-definition.</p>
<p>Using the old-style type-definition means that every attribute in your
LadonType is assigned to a type (primitive or other LadonType) rather than a
value. You can also tell ladon that the attribute should expect a list of
values of a certain type, by assigning the attribute to list containing only
one element; the type to expect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">balance</span> <span class="o">=</span> <span class="nb">float</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Transaction</span> <span class="p">]</span>
</pre></div>
</div>
<p><em>In the example above example Transaction is another LadonType.</em></p>
<p>This is a very nice and clear way to declare a service structure. The downside is that
it offers no way to tell the framework if the attribute is optional, has a
default value, is nullable or to write service documentation on attribute level.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">unicode</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span>
        <span class="n">age</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">Group</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="portable-types">
<h2>Portable types<a class="headerlink" href="#portable-types" title="Permalink to this headline">¶</a></h2>
<p>You can use Ladon&#8217;s compatability module for LadonTypes the same way as when you define
parameter types with &#64;ladonize. This makes it easier to write Python 2/3 compatible
LadonTypes.</p>
<p>Let&#8217;s re-write the above example in a portable version:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ladon.types.ladontype</span> <span class="kn">import</span> <span class="n">LadonType</span>
<span class="kn">from</span> <span class="nn">ladon.compat</span> <span class="kn">import</span> <span class="n">PORTABLE_STRING</span><span class="p">,</span><span class="n">PORTABLE_BYTES</span>

<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="n">PORTABLE_BYTES</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">PORTABLE_BYTES</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>
        <span class="n">age</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">Group</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionary-type-definition">
<h2>Dictionary Type-Definition<a class="headerlink" href="#dictionary-type-definition" title="Permalink to this headline">¶</a></h2>
<p>The new-style dictionary type-definition allows the service developer to specify
additional attribute properties like default value and whether or not an attribute
can be Null. It also offers the abillity to write documentation for the attribute.</p>
<div class="section" id="null-and-default-values">
<h3>Null and default values<a class="headerlink" href="#null-and-default-values" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s take a look at nullable values.</p>
<p>In the following example the attributes &#8220;description&#8221; and &#8220;age&#8221; are marked as
nullable, &#8220;recieve_newsletter&#8221; is not nullable but has a default value that will
be used if the attribute is skipped by the client:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">}</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">unicode</span>
        <span class="p">}</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c"># &quot;description&quot; is nullable, so it is allowed to force Null to this</span>
                <span class="c"># value, if the attribute is skipped it will also be interpreted as Null</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">,</span>
                <span class="s">&#39;nullable&#39;</span><span class="p">:</span><span class="bp">True</span>
        <span class="p">}</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">}</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">unicode</span>
        <span class="p">}</span>
        <span class="n">age</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c"># &quot;age&quot; is nullable, so it is allowed to force Null to this value,</span>
                <span class="c"># if the attribute is skipped it will also be interpreted as Null</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="s">&#39;nullable&#39;</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>
        <span class="n">recieve_newsletter</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c"># Client cannot force Null to this attribute (Ladon will raise a</span>
                <span class="c"># ClientFault exception), but if the attribute is unset it will default</span>
                <span class="c"># to False</span>
                <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                <span class="s">&#39;nullable&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">Group</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="reuse-code-for-dictionary-type-definition">
<h3>Reuse code for dictionary type-definition<a class="headerlink" href="#reuse-code-for-dictionary-type-definition" title="Permalink to this headline">¶</a></h3>
<p>It is advised that you define common dictionary typedefs so you don&#8217;t have to rewrite code
for attribute types that have the exact same properties:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">email_typedef</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">PORTABLE_STRING</span><span class="p">,</span>
        <span class="s">&#39;nullable&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;doc&#39;</span><span class="p">:</span> <span class="s">&#39;Enter a valid email address&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">email_typedef</span>
        <span class="c"># more attributes go here...</span>
</pre></div>
</div>
</div>
<div class="section" id="attribute-filter-functions">
<h3>Attribute filter functions<a class="headerlink" href="#attribute-filter-functions" title="Permalink to this headline">¶</a></h3>
<p>Furthermore it is possible to register filter functions for both incoming and outgoing
attribute values which can be used to add validation/modification triggers on certain
attributes. So if you have the attribute &#8220;zip_code&#8221; in your LadonType and you want to
make sure that users of your service only type in zip-codes from the US. You add a
filter on the attribute&#8217;s &#8220;incoming&#8221; filter list that does the check and raises a
clientfault on non-US zip-codes.</p>
<p>In the following example a classic email validation function is registered on the incoming &#8220;username&#8221; attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ladon.ladonizer</span> <span class="kn">import</span> <span class="n">ladonize</span>
<span class="kn">from</span> <span class="nn">ladon.types.ladontype</span> <span class="kn">import</span> <span class="n">LadonType</span>
<span class="kn">from</span> <span class="nn">ladon.compat</span> <span class="kn">import</span> <span class="n">PORTABLE_STRING</span><span class="p">,</span><span class="n">PORTABLE_BYTES</span>
<span class="kn">from</span> <span class="nn">ladon.exceptions.service</span> <span class="kn">import</span> <span class="n">ClientFault</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">check_email</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$&#39;</span><span class="p">,</span><span class="n">email</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ClientFault</span><span class="p">(</span><span class="s">&#39;Invalid email&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">email</span>

<span class="n">email_typedef</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">PORTABLE_STRING</span><span class="p">,</span>
        <span class="s">&#39;nullable&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;doc&#39;</span><span class="p">:</span> <span class="s">&#39;Enter a valid email address&#39;</span><span class="p">,</span>
        <span class="s">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;incoming&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">check_email</span><span class="p">]</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="n">LadonType</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">email_typedef</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>
        <span class="n">firstname</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>
        <span class="n">lastname</span> <span class="o">=</span> <span class="n">PORTABLE_STRING</span>


<span class="k">class</span> <span class="nc">UserService</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="nd">@ladonize</span><span class="p">(</span><span class="n">UserType</span><span class="p">,</span><span class="n">rtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">addUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">):</span>
                <span class="c"># Add user implementation goes here</span>
                <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Notice in the above example that the filter function is contained in a list. This is because
the Ladon framework can accept multiple filter functions. The filters are executed in the same
order as their placement in the list.</p>
<p>Filter functions can be injected in 4 different points of the RPC process. In the request stage
you can inject filters before and after the Ladon framework parses an attribute, in the response
stage you can inject triggers before and after an attribute is converted to the response object.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Filter Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>incoming_raw</td>
<td>Applied before the attribute is parsed</td>
</tr>
<tr class="row-odd"><td>incoming</td>
<td>Applied after the attribute has been parsed</td>
</tr>
<tr class="row-even"><td>outgoing</td>
<td>Applied before the attriute is converted to response format</td>
</tr>
<tr class="row-odd"><td>outgoing_raw</td>
<td>Applied after the attribute has been converted to response format</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><em>Note: &#8220;outgoing_raw&#8221; filters cannot expect that the attribute value type is always the same
because some interfaces require convertion to string format before the final response object
is built.</em></p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright Jakob Simon-Gaarde.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>