


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Business rules &mdash; Shinken Manual 2.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'2.2',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Shinken Manual 2.2 documentation" href="../index.html"/>
        <link rel="up" title="Medium" href="index.html"/>
        <link rel="next" title="Monitoring a DMZ" href="dmz-monitoring.html"/>
        <link rel="prev" title="Medium" href="index.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Shinken Manual</a>
        <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_about/about.html">About Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/whatsnew.html">Feature comparison between Shinken and Nagios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/shinken-innovative-features.html">Shinken notable innovations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/the-project-vision.html">The project Vision</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/features-and-release-cycle.html">Feature selection and release cycle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02_gettingstarted/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/beginners.html">Advice for Beginners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/quickstart.html">Quickstart Installation Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/installations/index.html">Installations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/upgrading-shinken.html">Upgrading Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03_configuration/index.html">Configuring Shinken</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/config.html">Configuration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configmain.html">Main Configuration File (shinken.cfg) Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configobject.html">Object Configuration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/objectdefinitions.html">Object Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/customobjectvars.html">Custom Object Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configmain-advanced.html">Main advanced configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../04_runningshinken/index.html">Running Shinken</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_runningshinken/verifyconfig.html">Verifying Your Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_runningshinken/startstop.html">Starting and Stopping Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../05_thebasics/index.html">The Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/configure-shinken.html">Setting up a basic Shinken Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/plugins.html">Monitoring Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/macros.html">Understanding Macros and How They Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/macrolist.html">Standard Macros in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/hostchecks.html">Host Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/servicechecks.html">Service Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/activechecks.html">Active Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/passivechecks.html">Passive Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/statetypes.html">State Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/timeperiods.html">Time Periods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/networkreachability.html">Determining Status and Reachability of Network Hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/active-module-checks.html">Active data acquisition modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/dependencies-in-shinken.html">Setup Network and logical dependencies in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/update.html">Update Shinken</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Medium</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Business rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="dmz-monitoring.html">Monitoring a DMZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="high-availability.html">Shinken High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="mix-windows-and-linux-polling.html">Mixed GNU/linux AND Windows pollers</a></li>
<li class="toctree-l2"><a class="reference internal" href="notification-escalations.html">Notifications and escalations</a></li>
<li class="toctree-l2"><a class="reference internal" href="notification-ways.html">The Notification Ways, AKA mail 24x7, SMS only the night for a same contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="passive-checks.html">Passive data acquisition</a></li>
<li class="toctree-l2"><a class="reference internal" href="snapshots.html">Snapshots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../07_advanced/index.html">Advanced Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/extcommands.html">External Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/eventhandlers.html">Event Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/volatileservices.html">Volatile Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/freshness.html">Service and Host Freshness Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/distributed.html">Distributed Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/redundancy.html">Redundant and Failover Network Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/flapping.html">Detection and Handling of State Flapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/escalations.html">Notification Escalations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/oncallrotation.html">On-Call Rotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/clusters.html">Monitoring Service and Host Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/dependencies.html">Host and Service Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/stalking.html">State Stalking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/perfdata.html">Performance Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/downtime.html">Scheduled Downtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/adaptative.html">Adaptive Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/dependencychecks.html">Predictive Dependency Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/cachedchecks.html">Cached Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/passivestatetranslation.html">Passive Host State Translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/checkscheduling.html">Service and Host Check Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/objectinheritance.html">Object Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/objecttricks.html">Advanced tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/migratingfromnagios.html">Migrating from Nagios to Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/multi-layer-discovery.html">Multi layer discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/multiple-urls.html">Multiple action urls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/rule-agregation.html">Aggregation rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/scaling-shinken.html">Scaling Shinken for large deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/advanced-dependencies.html">Defining advanced service dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/distributed-shinken.html">Shinken&#8217;s distributed architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/distributed-with-realm.html">Shinken&#8217;s distributed architecture with realms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/macro-modulations.html">Macro modulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/sms-with-android.html">Shinken and Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/sms-with-gateway.html">Send sms by gateway</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/triggers.html">Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/unused-nagios-parameters.html">Unused nagios parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/discovery-with-shinken-advanced.html">Advanced discovery with Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced/discovery-with-shinken.html">Discovery with Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../08_configobjects/index.html">Config</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/host.html">Host Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostgroup.html">Host Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/service.html">Service Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/servicegroup.html">Service Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/contact.html">Contact Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/contactgroup.html">Contact Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/timeperiod.html">Time Period Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/command.html">Command Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/servicedependency.html">Service Dependency Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/serviceescalation.html">Service Escalation Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostdependency.html">Host Dependency Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostescalation.html">Host Escalation Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostextinfo.html">Extended Host Information Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/serviceextinfo.html">Extended Service Information Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/notificationway.html">Notification Way Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/realm.html">Realm Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/arbiter.html">Arbiter Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/scheduler.html">Scheduler Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/poller.html">Poller Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/reactionner.html">Reactionner Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/broker.html">Broker Definition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../09_architecture/index.html">Shinken Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/about-the-high-availability.html">Arbiter supervision of Shinken processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/advanced-features.html">Advanced architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/how-dispatching-works.html">How are commands and configurations managed in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/problems-and-impacts.html">Problems and impacts correlation management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/the-shinken-architecture.html">Shinken Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../10_troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../10_troubleshooting/troubleshooting-shinken.html">FAQ - Shinken troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_integration/index.html">Integration With Other Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/integration.html">Integration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/snmptrap.html">SNMP Trap Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/tcpwrappers.html">TCP Wrappers Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/thruk.html">Use Shinken with Thruk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/specific-cgi-parameters.html">Nagios CGI UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/thruk-screenshot.html">Thruk interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/use-shinken-with.html">Use Shinken with ...</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/centreon.html">Use Shinken with Centreon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/graphite.html">Use Shinken with Graphite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/multisite.html">Use Shinken with Multisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/nagvis.html">Use Shinken with Nagvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/old-cgi-and-vshell.html">Use Shinken with Old CGI and VShell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/pnp.html">Use Shinken with PNP4Nagios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/webui.html">Use Shinken with WebUI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../12_tuning/index.html">Security and Performance Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/security.html">Security Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/tuning.html">Tuning Shinken For Maximum Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/largeinstalltweaks.html">Scaling a Shinken installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/statistics.html">Shinken performance statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/mrtggraphs.html">Graphing Performance Info With MRTG and nagiostats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../13_monitoring/index.html">How to monitor ...</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/dc.html">Monitoring Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/asterisk.html">Monitoring Asterisk servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/dhcp.html">Monitoring DHCP servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/iis.html">Monitoring IIS servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/linux.html">Monitoring Linux devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux.html">Monitoring Linux devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux-via-local-agent.html">Monitoring Linux devices via a Local Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux-via-snmp.html">Monitoring Linux devices via SNMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/exchange.html">Monitoring Microsoft Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/mssql.html">Monitoring Microsoft SQL databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/mysql.html">Monitoring MySQL databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/routers.html">Monitoring Routers and Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/router-or-switch.html">Monitoring Network devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/oracle.html">Monitoring Oracle databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/printer.html">Monitoring Printers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/network-service.html">Monitoring Publicly Available Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/vmware.html">Monitoring VMware hosts and machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/windows.html">Monitoring Windows devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/windows-monitoring-with-nsclient.html">Monitoring Windows devices via NSClient++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/configure-check-wmi-plus-onwindows.html">Monitoring Windows devices via WMI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../14_contributing/index.html">How to contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/create-and-push-packs.html">Shinken packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/create-a-package.html">Shinken modules and Shinken packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/help-the-project.html">Help the Shinken project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/how-to-contribute.html">Getting Help and Ways to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/spm.html">Shinken Package Manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../15_development/index.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../15_development/programming-rules.html">Shinken Programming Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/test-driven-development.html">Test Driven Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/pluginapi.html">Shinken Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/modules.html">Developing Shinken Daemon Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/hackingcode.html">Hacking the Shinken Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/documentation.html">Shinken documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../98_deprecated/index.html">Deprecated</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/install-script.html">Review of script&#8217;s option and parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/install-script.html#review-of-variable-used-in-the-script">Review of variable used in the script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/redhat-thruk-pnp4nagios-howto.html">Shinken on RedHat 6 with Thruk and PNP4Nagios HOWTO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../89_packages/index.html">Shinken modules</a><ul class="simple">
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../99_references/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../99_references/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/modules.html">shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.html">shinken Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.clients.html">clients Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.daemons.html">daemons Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.discovery.html">discovery Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.misc.html">misc Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.objects.html">objects Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.webui.html">webui Package</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../index.html">Shinken Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">Business rules</a></li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="../_sources/06_medium/business-rules.txt" rel="nofollow"> View page source</a>
      
    </li>
</ul>
<hr/>

          
  <div class="section" id="business-rules">
<span id="medium-business-rules"></span><h1>Business rules<a class="headerlink" href="#business-rules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="view-your-infrastructure-from-a-business-perspective">
<h2>View your infrastructure from a business perspective<a class="headerlink" href="#view-your-infrastructure-from-a-business-perspective" title="Permalink to this headline">¶</a></h2>
<p>The main role of this feature is to allow users to have in one &#8220;indicator&#8221; the aggregation of other states. This indicator can provide a unique view for users focused on different roles.</p>
<p>Typical roles:</p>
<blockquote>
<div><ul class="simple">
<li>Service delivery Management</li>
<li>Business Management</li>
<li>Engineering</li>
<li>IT support</li>
</ul>
</div></blockquote>
<p>Let&#8217;s take a simple example of a service delivery role for an ERP application. It mainly consists of the following IT components:</p>
<blockquote>
<div><ul class="simple">
<li>2 databases, in high availability, so with one database active, the service is considered up</li>
<li>2 web servers, in load sharing, so with one web server active, the service is considered up</li>
<li>2 load balancers, again in high availability</li>
</ul>
</div></blockquote>
<p>These IT components (Hosts in this example) will be the basis for the ERP service.</p>
<p>With business rules, you can have an &#8220;indicator&#8221; representing the &#8220;aggregated service&#8221; state for the ERP service! Shinken already checks all of the IT components one by one including processing for root cause analysis from a host and service perspective.</p>
</div>
<div class="section" id="how-to-define-business-rules">
<h2>How to define Business Rules?<a class="headerlink" href="#how-to-define-business-rules" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s a simple service (or a host) with a &#8220;special&#8221; check_command named bp_rule. :)</p>
<p>This makes it compatible with all your current habits and UIs. As the service aggregation is considered as any other state from a host or service, you can get notifications, actions and escalations. This means you can have contacts that will receive only the relevant notifications based on their role.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You do not have to define &#8220;bp_rule&#8221; command, it&#8217;s purely internal. You should NOT define it in you checkcommands.cfg file, or the configuration will be invalid due to duplicate commands!</p>
</div>
<p>Here is a configuration for the ERP service example, attached to a dummy host named &#8220;servicedelivery&#8221;.</p>
<div class="highlight-python"><pre>define service{
       use                  standard-service
       host_name            servicedelivery
       service_description  ERP
       check_command        bp_rule!(h1,database1 | h2,database2) &amp; (h3,Http1 | h4,Http4) &amp; (h5,IPVS1 | h6,IPVS2)
}</pre>
</div>
<p>That&#8217;s all!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A complete service delivery view should include an aggregated view of the end user availability perspective states, end user performance perspective states, IT component states, application error states, application performance states. This aggregated state can then be used as a metric for Service Management (basis for defining an SLA).</p>
</div>
</div>
<div class="section" id="with-need-at-least-x-elements-clusters">
<h2>With &#8220;need at least X elements&#8221; clusters<a class="headerlink" href="#with-need-at-least-x-elements-clusters" title="Permalink to this headline">¶</a></h2>
<p>In some cases, you know that in a cluster of N elements, you need at least X of them to run OK. This is easily defined, you just need to use the &#8220;X of:&#8221; operator.</p>
<p>Here is an example of the same ERP but with 3 http web servers, and you need at least 2 of them (to handle the load):</p>
<div class="highlight-python"><pre>define service{
       use                  standard-service
       host_name            servicedelivery
       service_description  ERP
       check_command        bp_rule!(h1,database1 | h2,database2) &amp; (2 of: h3,Http1 &amp; h4,Http4 &amp; h5,Http5) &amp; (h6,IPVS1 | h7,IPVS2)
}</pre>
</div>
<p>It&#8217;s done :)</p>
<div class="section" id="possible-values-of-x-in-x-of-expressions">
<h3>Possible values of X in X of: expressions<a class="headerlink" href="#possible-values-of-x-in-x-of-expressions" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">X</span> <span class="pre">of:</span></tt> expression may be configured different values depending on the needs. The supported expressions are described below:</p>
<blockquote>
<div><ul class="simple">
<li><strong>A positive integer</strong>, which means &#8220;<em>at least X host/servicices should be up</em>&#8220;</li>
<li><strong>A positive percentage</strong>, which means &#8220;<em>at least X percents of hosts/services should be up</em>&#8221;. This percentage expression may be combined with Groupping expression expansion to build expressions such as &#8220;<em>95 percents of the web front ends shoud be up</em>&#8221;. This way, adding hosts in the web frontend hostgroup is sufficient, and the QoS remains the same.</li>
<li><strong>A negative integer</strong>, which means &#8220;<em>at most X host/servicices may be down</em>&#8220;</li>
<li><strong>A negative percentage</strong>, which means &#8220;<em>at most X percents of hosts/services should may be down</em>&#8221;. This percentage expression may be combined with Groupping expression expansion to build expressions such as &#8220;<em>5 percents of the web front ends may be down</em>&#8221;. This way, adding hosts in the web frontend hostgroup is sufficient, and the QoS remains the same.</li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><pre>define service{
       use                  standard-service
       host_name            servicedelivery
       service_description  ERP
       check_command        bp_rule!(h1,database1 | h2,database2) &amp; (h6,IPVS1 | h7,IPVS2) &amp; 95% of: g:frontend,Http
}</pre>
</div>
</div>
</div>
<div class="section" id="the-not-rule">
<h2>The NOT rule<a class="headerlink" href="#the-not-rule" title="Permalink to this headline">¶</a></h2>
<p>You can define a not state rule. It can be useful for active/passive setups for example. You just need to add a ! before your element name.</p>
<p>Example:</p>
<div class="highlight-python"><pre>define service{
       use                  generic-service
       host_name            servicedelivery
       service_description  Cluster_state
       check_command        bp_rule!(h1,database1 &amp; !h2,database2)
}</pre>
</div>
<p>Aggregated state will be ok if database1 is ok and database2 is warning or critical (stopped).</p>
</div>
<div class="section" id="manage-degraded-status">
<h2>Manage degraded status<a class="headerlink" href="#manage-degraded-status" title="Permalink to this headline">¶</a></h2>
<p>In the <tt class="docutils literal"><span class="pre">Xof:</span></tt> way the only case where you got a &#8220;warning&#8221; (=&#8221;degraded but not dead&#8221;) it&#8217;s when all your elements are in warning. But you should want to be in warning if 1 or your 3 http server is critical: the service is still running, but in a degraded state.</p>
<dl class="docutils">
<dt>For this you can use the extended operator <em>X,Y,Zof:</em></dt>
<dd><ul class="first last simple">
<li>X: number min of OK to get an overall OK state</li>
<li>Y: number min of WARNING to get an overall WARNING state</li>
<li>Z: number min of CRITICAL to get an overall CRITICAL state</li>
</ul>
</dd>
<dt>State processing will be done the following order:</dt>
<dd><ul class="first last simple">
<li>is Ok possible?</li>
<li>is critical possible?</li>
<li>is warning possible?</li>
<li>if none is possible, set OK.</li>
</ul>
</dd>
</dl>
<p>Here are some example for business rules about 5 services A, B, C, D and E. Like 5,1,1of:A|B|C|D|E</p>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td>Ok</td>
<td>Ok</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>4of:  &#8211;&gt; Ok</li>
<li>5,1,1of: &#8211;&gt; Warning</li>
<li>5,2,1of: &#8211;&gt; Ok</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td>Warn</td>
<td>Ok</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>4of:  &#8211;&gt; Warning</li>
<li>3of: &#8211;&gt; Ok</li>
<li>4,1,1of: &#8211;&gt; Warning</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Crit</td>
<td>Crit</td>
<td>Ok</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>4of:  &#8211;&gt; Critical</li>
<li>3of: &#8211;&gt; Ok</li>
<li>4,1,1of: &#8211;&gt; Critical</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-4">
<h3>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td>Crit</td>
<td>Ok</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>4of:  &#8211;&gt; Critical</li>
<li>4,1,1of: &#8211;&gt; Critical</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-5">
<h3>Example 5<a class="headerlink" href="#example-5" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td>Warn</td>
<td>Crit</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>2of:  &#8211;&gt; Ok</li>
<li>4,1,1of: &#8211;&gt; Critical</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-6">
<h3>Example 6<a class="headerlink" href="#example-6" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>A</strong></td>
<td><strong>B</strong></td>
<td><strong>C</strong></td>
<td><strong>D</strong></td>
<td><strong>E</strong></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td>Crit</td>
<td>Crit</td>
<td>Ok</td>
<td>Ok</td>
</tr>
</tbody>
</table>
<p>Rules and overall states:</p>
<blockquote>
<div><ul class="simple">
<li>2of:  &#8211;&gt; Ok</li>
<li>2,4,4of: &#8211;&gt; Ok</li>
<li>4,1,1of: &#8211;&gt; Critical</li>
<li>4,1,2of: &#8211;&gt; Critical</li>
<li>4,1,3of: &#8211;&gt; Warning</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="classic-cases">
<h3>Classic cases<a class="headerlink" href="#classic-cases" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s look at some classic setups, for MAX elements.</p>
<blockquote>
<div><ul class="simple">
<li>ON/OFF setup: MAXof: &lt;=&gt; MAX,MAX,MAXof:</li>
<li>Warning as soon as problem, and critical if all criticals: MAX,1,MAXof:</li>
<li>Worse state: MAX,1,1</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="grouping-expression-expansion">
<h2>Grouping expression expansion<a class="headerlink" href="#grouping-expression-expansion" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, you do not want to specify explicitly the hosts/services contained in a business rule, but prefer use a grouping expression such as <em>hosts from the hostgroup xxx</em>, <em>services holding lablel yyy</em> or <em>hosts which name matches regex zzz</em>.</p>
<p>To do so, it is possible to use a <em>grouping expression</em> which is expanded into hosts or services. The supported expressions use the following syntax:</p>
<div class="highlight-python"><pre>flag:expression</pre>
</div>
<p>The flag is a single character qualifying the expansion type. The supported types (and associated flags) are described in the table below.</p>
<div class="section" id="host-flags">
<h3>Host flags<a class="headerlink" href="#host-flags" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="45%" />
<col width="15%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>F</strong></td>
<td><strong>Expansion</strong></td>
<td><strong>Example</strong></td>
<td><strong>Equivalent to</strong></td>
</tr>
<tr class="row-even"><td>g</td>
<td>Content of the hostgroup</td>
<td>g:webs</td>
<td>web-srv1 &amp; web-srv2 &amp; ...</td>
</tr>
<tr class="row-odd"><td>l</td>
<td>Hosts which are holding label</td>
<td>l:front</td>
<td>web-srv1 &amp; db-srv1 &amp; ...</td>
</tr>
<tr class="row-even"><td>r</td>
<td>Hosts which name matches regex</td>
<td>r:^web</td>
<td>web-srv1 &amp; web-srv2 &amp; ...</td>
</tr>
<tr class="row-odd"><td>t</td>
<td>Hosts which are holding tag</td>
<td>t:http</td>
<td>web-srv1 &amp; web-srv2 &amp; ...</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="service-flags">
<h3>Service flags<a class="headerlink" href="#service-flags" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="45%" />
<col width="13%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>F</strong></td>
<td><strong>Expansion</strong></td>
<td><strong>Example</strong></td>
<td><strong>Equivalent to</strong></td>
</tr>
<tr class="row-even"><td>g</td>
<td>Content of the servicegroup</td>
<td>g:web</td>
<td>web-srv1,HTTP &amp; web-srv2,HTTP &amp; ...</td>
</tr>
<tr class="row-odd"><td>l</td>
<td>Services which are holding label</td>
<td>l:front</td>
<td>web-srv1,HTTP &amp; db-srv1,MySQL &amp; ...</td>
</tr>
<tr class="row-even"><td>r</td>
<td>Services which description matches regex</td>
<td>r:^HTTPS?</td>
<td>web-srv1,HTTP &amp; db-srv2,HTTPS &amp; ...</td>
</tr>
<tr class="row-odd"><td>t</td>
<td>Services which are holding tag</td>
<td>t:http</td>
<td>web-srv1,HTTP &amp; db-srv2,HTTPS &amp; ...</td>
</tr>
</tbody>
</table>
<blockquote>
<div><ul class="simple">
<li><strong>Labels</strong> are arbitrary names which may be set on any host or service using the <tt class="docutils literal"><span class="pre">label</span></tt> directive.</li>
<li><strong>Tags</strong> are the template names inherited by hosts or services, generally coming from packs.</li>
</ul>
</div></blockquote>
<p>It is possible to combine both <strong>host</strong> and <strong>service</strong> expansion expression to build complex business rules.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A business rule expression always has to be made of a host expression (selector if you prefer)
AND a service expression (still selector) separated by a coma when looking at service status.
If not so, there is no mean to distinguish a host status from a service status in the expression.
In servicegroup flag case, as you do not want to apply any filter on the host (you want ALL services which are member of the XXX service group, whichever host they are bound to),
you may use the * host selector expression. The correct expression syntax should be:
<tt class="docutils literal"><span class="pre">bp_rule!*,g:my-servicegroup</span></tt>
The same rule applies to other service selectors (l, r, t, and so on).</p>
</div>
</div>
<div class="section" id="examples-of-combined-expansion-expression">
<h3>Examples of combined expansion expression<a class="headerlink" href="#examples-of-combined-expansion-expression" title="Permalink to this headline">¶</a></h3>
<p>You want to build a business rule including all web servers composing the application frontend.</p>
<div class="highlight-python"><pre>l:front,r:HTTPS?

which is equivalent to:

web-srv1,HTTP &amp; web-srv3,HTTPS</pre>
</div>
<p>You may obviously combine expression expansion with standard expressions.</p>
<div class="highlight-python"><pre>l:front,h:HTTPS? &amp; db-srv1,MySQL

which is equivalent to:

(web-srv1,HTTP &amp; web-srv3,HTTPS) &amp; db-srv1,MySQL</pre>
</div>
</div>
</div>
<div class="section" id="smart-notifications">
<h2>Smart notifications<a class="headerlink" href="#smart-notifications" title="Permalink to this headline">¶</a></h2>
<p>As of any host or service check, a business rule having its state in a non <tt class="docutils literal"><span class="pre">OK</span></tt> state may send notifications depending on its <tt class="docutils literal"><span class="pre">notification_options</span></tt> directive. But what if the underlying problems are known, and may be acknowledged ? The default behaviour is to continue sending notifications.</p>
<p>This may be what you need, but what if you want the business rule to stop sending notifications ?</p>
<p>Imagine your business rule is composed of all your site&#8217;s web front ends. If a host fails, you want to know it, but once someone starts to fix the issue, you don&#8217;t want to be notified anymore. A possible solution is to acknowledge the business rule itself. But if you do so, any other failing host won&#8217;t get notified. Another solution is to enable <em>smart notification</em> on the business rule check.</p>
<p><em>Smart notifications</em> is a way to disable notifications on a business rule having all its problems acknowledged. If a new problem occurs, notifications will be enabled back while it has not been acknowledged.</p>
<p>To enable smart notifications, simply set the <tt class="docutils literal"><span class="pre">business_rule_smart_notifications</span></tt> to <tt class="docutils literal"><span class="pre">1</span></tt>.</p>
<div class="section" id="downtimes-management">
<h3>Downtimes management<a class="headerlink" href="#downtimes-management" title="Permalink to this headline">¶</a></h3>
<p>Downtimes are a bit more tricky to handle. While acknowledgement are necessarily set by humans, downtimes may be set automatically (for instance, by <em>maintenance periods</em>). You may still want to be notified during downtime periods. As a consequence, downtimes are not taken into account by smart notification processing, unless explicitly told to do so.</p>
<p>To enable downtimes in smart notifications processing, simply set the <tt class="docutils literal"><span class="pre">business_rule_downtime_as_ack</span></tt> to <tt class="docutils literal"><span class="pre">1</span></tt>.</p>
</div>
</div>
<div class="section" id="consolidated-services">
<h2>Consolidated services<a class="headerlink" href="#consolidated-services" title="Permalink to this headline">¶</a></h2>
<p>Another useful usage of business rules is consolidated services. Imagine you have a large web cluster, composed of hundreds of nodes. If a small portion of the nodes fail, you may receive a large number of notifications, which is not convenient. To prevent this, you may use a business rule looking like <tt class="docutils literal"><span class="pre">bp_rule!g:web,...</span></tt>. If you disable notifications by setting <tt class="docutils literal"><span class="pre">notification_options</span></tt> to <tt class="docutils literal"><span class="pre">n</span></tt> on the underlying hosts or services, you would receive a single notification with all the failing nodes in one time, which may be clearer.</p>
<p>To avoid having to manually set <tt class="docutils literal"><span class="pre">notification_options</span></tt> on each node, you may use two convenient directives on the business rule side: <tt class="docutils literal"><span class="pre">business_rule_host_notification_options</span></tt> which enforces notification options of underlying hosts, and <tt class="docutils literal"><span class="pre">business_rule_service_notification_options</span></tt> which does the same for services.</p>
<p>This feature, combined with the convenience of packs and <a class="reference internal" href="#smart-notifications">Smart notifications</a> allows to build large consolidated services very easily.</p>
<p>Example:</p>
<div class="highlight-python"><pre>define host {
       use http
       host_name web-01
       hostgroups web
       ...
       }

define host {
       use http
       host_name web-02
       hostgroups web
       ...
       }

define host {
       host_name meta
       ...
       }

define service {
       host_name meta
       service_description Web cluster
       check_command bp_rule!g:web,g:HTTPS?
       business_rule_service_notification_options n
       ...
       }</pre>
</div>
<p>In the previous example, HTTP/HTTPS services come from the <tt class="docutils literal"><span class="pre">http</span></tt> pack. If one or more http servers fail, a single notification would be sent, rather than one per failing service.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It would be very tempting in this situation to acknowledge the consolidated service if a notification is sent. Never do so, as any, as any new failure would not be reported. You still have to acknowledge each independent failure. Take care to explain this to people in charge of the operations.</p>
</div>
</div>
<div class="section" id="macro-expansion">
<h2>Macro expansion<a class="headerlink" href="#macro-expansion" title="Permalink to this headline">¶</a></h2>
<p>It is possible in a business rule expression to include macros, as you would do for normal check command definition. You may for instance define a custom macro on the host or service holding the business rule, and use it in the expression.</p>
<p>Combined with <a class="reference internal" href="../07_advanced/macro-modulations.html#advanced-macro-modulations"><em>macro modulation</em></a>, this allows to define consolidated services with variable fault tolerance thresholds depending on the timeperiod.</p>
<p>Imagine your web frontend cluster composed of dozens servers serving the web site. If one is failing, this would not impact the service so much. During the day, when the complete team is at work, a single failure should be notified and fixed immediately. But during the night, you may consider that losing let&#8217;s say up to 5% of the cluster has no impact on the QoS: thus waking up the on-call guy is not useful.</p>
<p>You may handle that with a consolidated service using macro modulation combined with an <tt class="docutils literal"><span class="pre">Xof:</span></tt> expression.</p>
<p>Example:</p>
<div class="highlight-python"><pre>define macromodulation{
       macromodulation_name web-xof
       modulation_period night
       _XOF_WEB -5% of:
       }

define host {
       use http
       host_name web-01
       hostgroups web
       ...
       }

define host {
       use http
       host_name web-02
       hostgroups web
       ...
       }

define host {
       host_name meta
       macromodulations web-xof
       ...
       }

define service {
       host_name meta
       service_description Web cluster
       check_command bp_rule!$_HOSTXOF_WEB$ g:web,g:HTTPS?
       business_rule_service_notification_options n
       ...
       }</pre>
</div>
<p>In the previous example, during the day, we&#8217;re outside the modulation period. The <tt class="docutils literal"><span class="pre">_XOF_WEB</span></tt> is not defined, so the resulting business rule is <tt class="docutils literal"><span class="pre">g:web,g:HTTPS?</span></tt>. During the night, the macro is set a value, then the resulting business rule is <tt class="docutils literal"><span class="pre">-5%</span> <span class="pre">of:</span> <span class="pre">g:web,g:HTTPS?</span></tt>, allowing to lose 5% of the cluster silently.</p>
</div>
<div class="section" id="business-rule-check-output">
<h2>Business rule check output<a class="headerlink" href="#business-rule-check-output" title="Permalink to this headline">¶</a></h2>
<p>By default, business rules checks have no output as there&#8217;s no real script or binary behind. But it is still possible to control their output using a templating system.</p>
<p>To do so, you may set the <tt class="docutils literal"><span class="pre">business_rule_output_template</span></tt> option on the host or service holding the business rule. This attribute may contain any macro. Macro expansion works as follows:</p>
<blockquote>
<div><ul class="simple">
<li>All macros <strong>outside</strong> the <tt class="docutils literal"><span class="pre">$(</span></tt> and <tt class="docutils literal"><span class="pre">)$</span></tt> sequences are expanded using attributes set on the host or service holding the business rule.</li>
<li>All macros <strong>between</strong> the <tt class="docutils literal"><span class="pre">$(</span></tt> and <tt class="docutils literal"><span class="pre">)$</span></tt> sequences are expanded for each underlying problem using its attributes.</li>
</ul>
</div></blockquote>
<p>All macros defined on hosts or services composing or holding the business rule may be used in the outer or inner part of the template respectively.</p>
<p>To ease writing output template for business rules made of both hosts and services, 3 convinience macros having the same meaning for each type may be used: <tt class="docutils literal"><span class="pre">STATUS</span></tt>, <tt class="docutils literal"><span class="pre">SHORTSTATUS</span></tt>, and <tt class="docutils literal"><span class="pre">FULLNAME</span></tt>, which expand respectively to the host or service status, its status abreviated form and its full name (<tt class="docutils literal"><span class="pre">host_name</span></tt> for hosts, or <tt class="docutils literal"><span class="pre">host_name/service_description</span></tt> for services).</p>
<p>Example:</p>
<p>Imagine you want to build a consolidated service which notifications contain links to the underlying problems in the WebUI, allowing to acknowledge them without having to search. You may use a template looking like:</p>
<div class="highlight-python"><pre>define service {
       host_name meta
       service_description            Web cluster
       check_command                  bp_rule!$_HOSTXOF_WEB$ g:web,g:HTTPS?
       business_rule_output_template  Down web services: $(&lt;a href='http://webui.url/service/$HOSTNAME$/$SERVICEDESC$'&gt;($SHORTSTATUS$) $HOSTNAME$&lt;/a&gt; )$
       ...
       }</pre>
</div>
<p>The resulting output would look like <tt class="docutils literal"><span class="pre">Down</span> <span class="pre">web</span> <span class="pre">services:</span> <span class="pre">link1</span> <span class="pre">link2</span> <span class="pre">link3</span> <span class="pre">...</span></tt> where <tt class="docutils literal"><span class="pre">linkN</span></tt> are urls leading to the problem in the WebUI.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="dmz-monitoring.html" class="btn btn-neutral float-right" title="Monitoring a DMZ"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Medium"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, Shinken Team.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>