


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Detection and Handling of State Flapping &mdash; Shinken Manual 2.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'2.2',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Shinken Manual 2.2 documentation" href="../index.html"/>
        <link rel="up" title="Advanced Topics" href="index.html"/>
        <link rel="next" title="Notification Escalations" href="escalations.html"/>
        <link rel="prev" title="Redundant and Failover Network Monitoring" href="redundancy.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Shinken Manual</a>
        <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_about/about.html">About Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/whatsnew.html">Feature comparison between Shinken and Nagios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/shinken-innovative-features.html">Shinken notable innovations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/the-project-vision.html">The project Vision</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_about/features-and-release-cycle.html">Feature selection and release cycle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02_gettingstarted/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/beginners.html">Advice for Beginners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/quickstart.html">Quickstart Installation Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/installations/index.html">Installations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_gettingstarted/upgrading-shinken.html">Upgrading Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03_configuration/index.html">Configuring Shinken</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/config.html">Configuration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configmain.html">Main Configuration File (shinken.cfg) Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configobject.html">Object Configuration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/objectdefinitions.html">Object Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/customobjectvars.html">Custom Object Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_configuration/configmain-advanced.html">Main advanced configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../04_runningshinken/index.html">Running Shinken</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_runningshinken/verifyconfig.html">Verifying Your Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_runningshinken/startstop.html">Starting and Stopping Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../05_thebasics/index.html">The Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/configure-shinken.html">Setting up a basic Shinken Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/plugins.html">Monitoring Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/macros.html">Understanding Macros and How They Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/macrolist.html">Standard Macros in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/hostchecks.html">Host Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/servicechecks.html">Service Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/activechecks.html">Active Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/passivechecks.html">Passive Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/statetypes.html">State Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/timeperiods.html">Time Periods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/networkreachability.html">Determining Status and Reachability of Network Hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/active-module-checks.html">Active data acquisition modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/dependencies-in-shinken.html">Setup Network and logical dependencies in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_thebasics/update.html">Update Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../06_medium/index.html">Medium</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/business-rules.html">Business rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/dmz-monitoring.html">Monitoring a DMZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/high-availability.html">Shinken High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/mix-windows-and-linux-polling.html">Mixed GNU/linux AND Windows pollers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/notification-escalations.html">Notifications and escalations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/notification-ways.html">The Notification Ways, AKA mail 24x7, SMS only the night for a same contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/passive-checks.html">Passive data acquisition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_medium/snapshots.html">Snapshots</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="extcommands.html">External Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventhandlers.html">Event Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="volatileservices.html">Volatile Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshness.html">Service and Host Freshness Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed.html">Distributed Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="redundancy.html">Redundant and Failover Network Monitoring</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Detection and Handling of State Flapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="escalations.html">Notification Escalations</a></li>
<li class="toctree-l2"><a class="reference internal" href="oncallrotation.html">On-Call Rotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="clusters.html">Monitoring Service and Host Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependencies.html">Host and Service Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="stalking.html">State Stalking</a></li>
<li class="toctree-l2"><a class="reference internal" href="perfdata.html">Performance Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="downtime.html">Scheduled Downtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="adaptative.html">Adaptive Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependencychecks.html">Predictive Dependency Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cachedchecks.html">Cached Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="passivestatetranslation.html">Passive Host State Translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkscheduling.html">Service and Host Check Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectinheritance.html">Object Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="objecttricks.html">Advanced tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="migratingfromnagios.html">Migrating from Nagios to Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-layer-discovery.html">Multi layer discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-urls.html">Multiple action urls</a></li>
<li class="toctree-l2"><a class="reference internal" href="rule-agregation.html">Aggregation rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="scaling-shinken.html">Scaling Shinken for large deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-dependencies.html">Defining advanced service dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed-shinken.html">Shinken&#8217;s distributed architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed-with-realm.html">Shinken&#8217;s distributed architecture with realms</a></li>
<li class="toctree-l2"><a class="reference internal" href="macro-modulations.html">Macro modulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="sms-with-android.html">Shinken and Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="sms-with-gateway.html">Send sms by gateway</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="unused-nagios-parameters.html">Unused nagios parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovery-with-shinken-advanced.html">Advanced discovery with Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovery-with-shinken.html">Discovery with Shinken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../08_configobjects/index.html">Config</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/host.html">Host Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostgroup.html">Host Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/service.html">Service Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/servicegroup.html">Service Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/contact.html">Contact Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/contactgroup.html">Contact Group Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/timeperiod.html">Time Period Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/command.html">Command Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/servicedependency.html">Service Dependency Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/serviceescalation.html">Service Escalation Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostdependency.html">Host Dependency Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostescalation.html">Host Escalation Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/hostextinfo.html">Extended Host Information Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/serviceextinfo.html">Extended Service Information Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/notificationway.html">Notification Way Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/realm.html">Realm Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/arbiter.html">Arbiter Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/scheduler.html">Scheduler Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/poller.html">Poller Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/reactionner.html">Reactionner Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_configobjects/broker.html">Broker Definition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../09_architecture/index.html">Shinken Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/about-the-high-availability.html">Arbiter supervision of Shinken processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/advanced-features.html">Advanced architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/how-dispatching-works.html">How are commands and configurations managed in Shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/problems-and-impacts.html">Problems and impacts correlation management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_architecture/the-shinken-architecture.html">Shinken Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../10_troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../10_troubleshooting/troubleshooting-shinken.html">FAQ - Shinken troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_integration/index.html">Integration With Other Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/integration.html">Integration Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/snmptrap.html">SNMP Trap Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/tcpwrappers.html">TCP Wrappers Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/thruk.html">Use Shinken with Thruk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/specific-cgi-parameters.html">Nagios CGI UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/thruk-screenshot.html">Thruk interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/use-shinken-with.html">Use Shinken with ...</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/centreon.html">Use Shinken with Centreon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/graphite.html">Use Shinken with Graphite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/multisite.html">Use Shinken with Multisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/nagvis.html">Use Shinken with Nagvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/old-cgi-and-vshell.html">Use Shinken with Old CGI and VShell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/pnp.html">Use Shinken with PNP4Nagios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_integration/webui.html">Use Shinken with WebUI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../12_tuning/index.html">Security and Performance Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/security.html">Security Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/tuning.html">Tuning Shinken For Maximum Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/largeinstalltweaks.html">Scaling a Shinken installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/statistics.html">Shinken performance statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12_tuning/mrtggraphs.html">Graphing Performance Info With MRTG and nagiostats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../13_monitoring/index.html">How to monitor ...</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/dc.html">Monitoring Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/asterisk.html">Monitoring Asterisk servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/dhcp.html">Monitoring DHCP servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/iis.html">Monitoring IIS servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/linux.html">Monitoring Linux devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux.html">Monitoring Linux devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux-via-local-agent.html">Monitoring Linux devices via a Local Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/monitoring-a-linux-via-snmp.html">Monitoring Linux devices via SNMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/exchange.html">Monitoring Microsoft Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/mssql.html">Monitoring Microsoft SQL databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/mysql.html">Monitoring MySQL databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/routers.html">Monitoring Routers and Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/router-or-switch.html">Monitoring Network devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/oracle.html">Monitoring Oracle databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/printer.html">Monitoring Printers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/network-service.html">Monitoring Publicly Available Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/vmware.html">Monitoring VMware hosts and machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/windows.html">Monitoring Windows devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/windows-monitoring-with-nsclient.html">Monitoring Windows devices via NSClient++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_monitoring/configure-check-wmi-plus-onwindows.html">Monitoring Windows devices via WMI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../14_contributing/index.html">How to contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/create-and-push-packs.html">Shinken packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/create-a-package.html">Shinken modules and Shinken packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/help-the-project.html">Help the Shinken project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/how-to-contribute.html">Getting Help and Ways to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14_contributing/spm.html">Shinken Package Manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../15_development/index.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../15_development/programming-rules.html">Shinken Programming Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/test-driven-development.html">Test Driven Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/pluginapi.html">Shinken Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/modules.html">Developing Shinken Daemon Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/hackingcode.html">Hacking the Shinken Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15_development/documentation.html">Shinken documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../98_deprecated/index.html">Deprecated</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/install-script.html">Review of script&#8217;s option and parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/install-script.html#review-of-variable-used-in-the-script">Review of variable used in the script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98_deprecated/redhat-thruk-pnp4nagios-howto.html">Shinken on RedHat 6 with Thruk and PNP4Nagios HOWTO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../89_packages/index.html">Shinken modules</a><ul class="simple">
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../99_references/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../99_references/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/modules.html">shinken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.html">shinken Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.clients.html">clients Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.daemons.html">daemons Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.discovery.html">discovery Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.misc.html">misc Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.objects.html">objects Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99_references/shinken.webui.html">webui Package</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../index.html">Shinken Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">Detection and Handling of State Flapping</a></li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="../_sources/07_advanced/flapping.txt" rel="nofollow"> View page source</a>
      
    </li>
</ul>
<hr/>

          
  <div class="section" id="detection-and-handling-of-state-flapping">
<span id="advanced-flapping"></span><h1>Detection and Handling of State Flapping<a class="headerlink" href="#detection-and-handling-of-state-flapping" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Shinken supports optional detection of hosts and services that are “flapping&#8221;. Flapping occurs when a service or host changes state too frequently, resulting in a storm of problem and recovery notifications. Flapping can be indicative of configuration problems (i.e. thresholds set too low), troublesome services, or real network problems.</p>
</div>
<div class="section" id="how-flap-detection-works">
<h2>How Flap Detection Works<a class="headerlink" href="#how-flap-detection-works" title="Permalink to this headline">¶</a></h2>
<p>Before I get into this, let me say that flapping detection has been a little difficult to implement. How exactly does one determine what &#8220;too frequently&#8221; means in regards to state changes for a particular host or service? When I first started thinking about implementing flap detection I tried to find some information on how flapping could/should be detected. I couldn&#8217;t find any information about what others were using (where they using any?), so I decided to settle with what seemed to me to be a reasonable solution...</p>
<p>Whenever Shinken checks the status of a host or service, it will check to see if it has started or stopped flapping. It does this by.</p>
<blockquote>
<div><ul class="simple">
<li>Storing the results of the last 21 checks of the host or service</li>
<li>Analyzing the historical check results and determine where state changes/transitions occur</li>
<li>Using the state transitions to determine a percent state change value (a measure of change) for the host or service</li>
<li>Comparing the percent state change value against low and high flapping thresholds</li>
</ul>
</div></blockquote>
<p>A host or service is determined to have started flapping when its percent state change first exceeds a high flapping threshold.</p>
<p>A host or service is determined to have stopped flapping when its percent state goes below a low flapping threshold (assuming that is was previously flapping).</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s describe in more detail how flap detection works with services...</p>
<p>The image below shows a chronological history of service states from the most recent 21 service checks. OK states are shown in green, WARNING states in yellow, CRITICAL states in red, and UNKNOWN states in orange.</p>
<a class="reference internal image-reference" href="../_images/statetransitions.png"><img alt="../_images/statetransitions.png" src="../_images/statetransitions.png" style="width: 389.7px; height: 162.9px;" /></a>
<p>The historical service check results are examined to determine where state changes/transitions occur. State changes occur when an archived state is different from the archived state that immediately precedes it chronologically. Since we keep the results of the last 21 service checks in the array, there is a possibility of having at most 20 state changes. The 20 value can be changed in the main configuration file, see <a class="reference internal" href="../03_configuration/configmain.html#configuration-configmain-flap-history"><em>flap_history</em></a>. In this example there are 7 state changes, indicated by blue arrows in the image above.</p>
<p>The flap detection logic uses the state changes to determine an overall percent state change for the service. This is a measure of volatility/change for the service. Services that never change state will have a 0% state change value, while services that change state each time they&#8217;re checked will have 100% state change. Most services will have a percent state change somewhere in between.</p>
<p>When calculating the percent state change for the service, the flap detection algorithm will give more weight to new state changes compare to older ones. Specifically, the flap detection routines are currently designed to make the newest possible state change carry 50% more weight than the oldest possible state change. The image below shows how recent state changes are given more weight than older state changes when calculating the overall or total percent state change for a particular service.</p>
<a class="reference internal image-reference" href="../_images/statetransitions2.png"><img alt="../_images/statetransitions2.png" src="../_images/statetransitions2.png" style="width: 413.1px; height: 160.2px;" /></a>
<p>Using the images above, lets do a calculation of percent state change for the service. You will notice that there are a total of 7 state changes (at t3, t4, t5, t9, t12, t16, and t19). Without any weighting of the state changes over time, this would give us a total state change of 35%:</p>
<p>(7 observed state changes / possible 20 state changes) * 100 = 35 %</p>
<p>Since the flap detection logic will give newer state changes a higher rate than older state changes, the actual calculated percent state change will be slightly less than 35% in this example. Let&#8217;s say that the weighted percent of state change turned out to be 31%...</p>
<p>The calculated percent state change for the service (31%) will then be compared against flapping thresholds to see what should happen:</p>
<blockquote>
<div><ul class="simple">
<li>If the service was not previously flapping and 31% is equal to or greater than the high flap threshold, Shinken considers the service to have just started flapping.</li>
<li>If the service was previously flapping and 31% is less than the low flap threshold, Shinken considers the service to have just stopped flapping.</li>
</ul>
</div></blockquote>
<p>If neither of those two conditions are met, the flap detection logic won&#8217;t do anything else with the service, since it is either not currently flapping or it is still flapping.</p>
</div>
<div class="section" id="flap-detection-for-services">
<h2>Flap Detection for Services<a class="headerlink" href="#flap-detection-for-services" title="Permalink to this headline">¶</a></h2>
<p>Shinken checks to see if a service is flapping whenever the service is checked (either actively or passively).</p>
<p>The flap detection logic for services works as described in the example above.</p>
</div>
<div class="section" id="flap-detection-for-hosts">
<h2>Flap Detection for Hosts<a class="headerlink" href="#flap-detection-for-hosts" title="Permalink to this headline">¶</a></h2>
<p>Host flap detection works in a similar manner to service flap detection, with one important difference: Shinken will attempt to check to see if a host is flapping whenever:</p>
<blockquote>
<div><ul class="simple">
<li>The host is checked (actively or passively)</li>
<li>Sometimes when a service associated with that host is checked. More specifically, when at least x amount of time has passed since the flap detection was last performed, where x is equal to the average check interval of all services associated with the host.</li>
</ul>
</div></blockquote>
<p>Why is this done? With services we know that the minimum amount of time between consecutive flap detection routines is going to be equal to the service check interval. However, you might not be monitoring hosts on a regular basis, so there might not be a host check interval that can be used in the flap detection logic. Also, it makes sense that checking a service should count towards the detection of host flapping. Services are attributes of or things associated with host after all... At any rate, that&#8217;s the best method I could come up with for determining how often flap detection could be performed on a host, so there you have it.</p>
</div>
<div class="section" id="flap-detection-thresholds">
<h2>Flap Detection Thresholds<a class="headerlink" href="#flap-detection-thresholds" title="Permalink to this headline">¶</a></h2>
<p>Shinken uses several variables to determine the percent state change thresholds is uses for flap detection. For both hosts and services, there are global high and low thresholds and host- or service-specific thresholds that you can configure. Shinken will use the global thresholds for flap detection if you to not specify host- or service- specific thresholds.</p>
<p>The table below shows the global and host- or service-specific variables that control the various thresholds used in flap detection.</p>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="62%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Object Type</td>
<td>Global Variables</td>
<td>Object-Specific Variables</td>
</tr>
<tr class="row-even"><td>Host</td>
<td><a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-low-host-flap-threshold"><em>low_host_flap_threshold</em></a> <a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-high-host-flap-threshold"><em>high_host_flap_threshold</em></a></td>
<td><a class="reference internal" href="../08_configobjects/host.html#configobjects-host"><em>low_flap_threshold</em></a> <a class="reference internal" href="../08_configobjects/host.html#configobjects-host"><em>high_flap_threshold</em></a></td>
</tr>
<tr class="row-odd"><td>Service</td>
<td><a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-low-service-flap-threshold"><em>low_service_flap_threshold</em></a> <a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-high-service-flap-threshold"><em>high_service_flap_threshold</em></a></td>
<td><a class="reference internal" href="../08_configobjects/service.html#configobjects-service"><em>low_flap_threshold</em></a> <a class="reference internal" href="../08_configobjects/service.html#configobjects-service"><em>high_flap_threshold</em></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="states-used-for-flap-detection">
<h2>States Used For Flap Detection<a class="headerlink" href="#states-used-for-flap-detection" title="Permalink to this headline">¶</a></h2>
<p>Normally Shinken will track the results of the last 21 checks of a host or service, regardless of the check result (host/service state), for use in the flap detection logic.</p>
<p>You can exclude certain host or service states from use in flap detection logic by using the &#8220;flap_detection_options&#8221; directive in your host or service definitions. This directive allows you to specify what host or service states (i.e. &#8220;UP, &#8220;DOWN&#8221;, &#8220;OK, &#8220;CRITICAL&#8221;) you want to use for flap detection. If you don&#8217;t use this directive, all host or service states are used in flap detection.</p>
</div>
<div class="section" id="flap-handling">
<h2>Flap Handling<a class="headerlink" href="#flap-handling" title="Permalink to this headline">¶</a></h2>
<p>When a service or host is first detected as flapping, Shinken will:</p>
<blockquote>
<div><ul class="simple">
<li>Log a message indicating that the service or host is flapping.</li>
<li>Add a non-persistent comment to the host or service indicating that it is flapping.</li>
<li>Send a &#8220;flapping start&#8221; notification for the host or service to appropriate contacts.</li>
<li>Suppress other notifications for the service or host (this is one of the filters in the <a class="reference internal" href="../05_thebasics/notifications.html#thebasics-notifications"><em>notification logic</em></a>).</li>
</ul>
</div></blockquote>
<p>When a service or host stops flapping, Shinken will:</p>
<blockquote>
<div><ul class="simple">
<li>Log a message indicating that the service or host has stopped flapping.</li>
<li>Delete the comment that was originally added to the service or host when it started flapping.</li>
<li>Send a &#8220;flapping stop&#8221; notification for the host or service to appropriate contacts.</li>
<li>Remove the block on notifications for the service or host (notifications will still be bound to the normal <a class="reference internal" href="../05_thebasics/notifications.html#thebasics-notifications"><em>notification logic</em></a>).</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="enabling-flap-detection">
<h2>Enabling Flap Detection<a class="headerlink" href="#enabling-flap-detection" title="Permalink to this headline">¶</a></h2>
<p>In order to enable the flap detection features in Shinken, you&#8217;ll need to:</p>
<blockquote>
<div><ul class="simple">
<li>Set <a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-enable-flap-detection"><em>enable_flap_detection</em></a> directive is set to 1.</li>
<li>Set the &#8220;flap_detection_enabled&#8221; directive in your host and service definitions is set to 1.</li>
</ul>
</div></blockquote>
<p>If you want to disable flap detection on a global basis, set the <a class="reference internal" href="../03_configuration/configmain-advanced.html#configuration-configmain-advanced-enable-flap-detection"><em>enable_flap_detection</em></a> directive to 0.</p>
<p>If you would like to disable flap detection for just a few hosts or services, use the &#8220;flap_detection_enabled&#8221; directive in the host and/or service definitions to do so.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="escalations.html" class="btn btn-neutral float-right" title="Notification Escalations"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="redundancy.html" class="btn btn-neutral" title="Redundant and Failover Network Monitoring"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, Shinken Team.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>