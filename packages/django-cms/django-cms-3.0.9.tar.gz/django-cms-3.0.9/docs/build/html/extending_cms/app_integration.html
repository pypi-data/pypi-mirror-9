<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>App Integration &mdash; django cms 3.0.4 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="django cms 3.0.4 documentation" href="../index.html" />
    <link rel="up" title="Extending the CMS" href="index.html" />
    <link rel="next" title="API References" href="api_references.html" />
    <link rel="prev" title="Custom Plugins" href="custom_plugins.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_references.html" title="API References"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="custom_plugins.html" title="Custom Plugins"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">django cms 3.0.4 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Extending the CMS</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="app-integration">
<h1>App Integration<a class="headerlink" href="#app-integration" title="Permalink to this headline">¶</a></h1>
<p>It is pretty easy to integrate your own Django applications with django CMS.
You have 7 ways of integrating your app:</p>
<ol class="arabic">
<li><p class="first"><a class="reference internal" href="#integration-menus"><em>Menus</em></a></p>
<blockquote>
<div><p>Statically extend the menu entries</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-attach-menus"><em>Attach Menus</em></a></p>
<blockquote>
<div><p>Attach your menu to a page.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-apphooks"><em>App-Hooks</em></a></p>
<blockquote>
<div><p>Attach whole apps with optional menu to a page.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-modifiers"><em>Navigation Modifiers</em></a></p>
<blockquote>
<div><p>Modify the whole menu tree</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-customplugins"><em>Custom Plugins</em></a></p>
<blockquote>
<div><p>Display your models / content in cms pages</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-toolbar"><em>Toolbar</em></a></p>
<blockquote>
<div><p>Add Entries to the toolbar to add/edit your models</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#integration-templates"><em>Working with templates</em></a></p>
<blockquote>
<div><p>Templatetags and other CMS-provided utilities</p>
</div></blockquote>
</li>
</ol>
<div class="section" id="menus">
<span id="integration-menus"></span><h2>Menus<a class="headerlink" href="#menus" title="Permalink to this headline">¶</a></h2>
<p>Create a <tt class="docutils literal"><span class="pre">menu.py</span></tt> in your application and write the following inside:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">TestMenu</span><span class="p">(</span><span class="n">Menu</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample root page&#39;</span><span class="p">),</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample settings page&#39;</span><span class="p">),</span> <span class="s">&quot;/bye/&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample account page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">n4</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample my profile page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/world/&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">TestMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you refresh a page you should now see the menu entries from above.
The get_nodes function should return a list of
<a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> instances. A
<tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt> takes the following arguments:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">title</span></tt></p>
<p>What the menu entry should read as</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">url</span></tt>,</p>
<p>Link if menu entry is clicked.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">id</span></tt></p>
<p>A unique id for this menu.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">parent_id=None</span></tt></p>
<p>If this is a child of another node supply the id of the parent here.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">parent_namespace=None</span></tt></p>
<p>If the parent node is not from this menu you can give it the parent
namespace. The namespace is the name of the class. In the above example that
would be: &#8220;TestMenu&#8221;</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">attr=None</span></tt></p>
<p>A dictionary of additional attributes you may want to use in a modifier or
in the template.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">visible=True</span></tt></p>
<p>Whether or not this menu item should be visible.</p>
</li>
</ul>
<p>Additionally, each <tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt> provides a number of methods which are
detailed in the <a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> API references.</p>
<div class="section" id="customize-menus-at-runtime">
<h3>Customize menus at runtime<a class="headerlink" href="#customize-menus-at-runtime" title="Permalink to this headline">¶</a></h3>
<p>To adapt your menus according to request dependent conditions (say: anonymous /
logged in user), you can use <a class="reference internal" href="#navigation-modifiers">Navigation Modifiers</a>  or you can leverage existing
ones.</p>
<p>For example it&#8217;s possible to add <tt class="docutils literal"><span class="pre">{'visible_for_anonymous':</span> <span class="pre">False}</span></tt> /
<tt class="docutils literal"><span class="pre">{'visible_for_authenticated':</span> <span class="pre">False}</span></tt> attributes recognized by the
django CMS core <tt class="docutils literal"><span class="pre">AuthVisibility</span></tt> modifier.</p>
<p>Complete example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserMenu</span><span class="p">(</span><span class="n">Menu</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Profile&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">profile</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;visible_for_anonymous&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
                <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Log in&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">login</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;visible_for_authenticated&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
                <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Sign up&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">logout</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;visible_for_authenticated&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
                <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Log out&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">logout</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;visible_for_anonymous&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
            <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="attach-menus">
<span id="integration-attach-menus"></span><h2>Attach Menus<a class="headerlink" href="#attach-menus" title="Permalink to this headline">¶</a></h2>
<p>Classes that extend from <tt class="xref py py-class docutils literal"><span class="pre">menus.base.Menu</span></tt> always get attached to the
root. But if you want the menu to be attached to a CMS Page you can do that as
well.</p>
<p>Instead of extending from <tt class="xref py py-class docutils literal"><span class="pre">Menu</span></tt> you need to extend from
<tt class="xref py py-class docutils literal"><span class="pre">cms.menu_bases.CMSAttachMenu</span></tt> and you need to define a name. We will do
that with the example from above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.menu_bases</span> <span class="kn">import</span> <span class="n">CMSAttachMenu</span>

<span class="k">class</span> <span class="nc">TestMenu</span><span class="p">(</span><span class="n">CMSAttachMenu</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;test menu&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample root page&#39;</span><span class="p">),</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample settings page&#39;</span><span class="p">),</span> <span class="s">&quot;/bye/&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample account page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">n4</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample my profile page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/world/&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">TestMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can link this Menu to a page in the &#8216;Advanced&#8217; tab of the page
settings under attached menu.</p>
</div>
<div class="section" id="app-hooks">
<span id="integration-apphooks"></span><h2>App-Hooks<a class="headerlink" href="#app-hooks" title="Permalink to this headline">¶</a></h2>
<p>With App-Hooks you can attach whole Django applications to pages. For example
you have a news app and you want it attached to your news page.</p>
<p>To create an apphook create a <tt class="docutils literal"><span class="pre">cms_app.py</span></tt> in your application. And in it
write the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.app_base</span> <span class="kn">import</span> <span class="n">CMSApp</span>
<span class="kn">from</span> <span class="nn">cms.apphook_pool</span> <span class="kn">import</span> <span class="n">apphook_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">myapp.urls</span></tt> with the path to your applications <tt class="docutils literal"><span class="pre">urls.py</span></tt>.</p>
<p>Now edit a page and open the advanced settings tab. Select your new apphook
under &#8220;Application&#8221;. Save the page.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Whenever you add or remove an apphook, change the slug of a page containing
an apphook or the slug if a page which has a descendant with an apphook,
you have to restart your server to re-load the URL caches.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If at some point you want to remove this apphook after deleting the cms_app.py
there is a cms management command called uninstall apphooks
that removes the specified apphook(s) from all pages by name.
eg. <tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span> <span class="pre">uninstall</span> <span class="pre">apphooks</span> <span class="pre">MyApphook</span></tt>.
To find all names for uninstallable apphooks there is a command for this as well
<tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span> <span class="pre">list</span> <span class="pre">apphooks</span></tt>.</p>
</div>
<p>If you attached the app to a page with the url <tt class="docutils literal"><span class="pre">/hello/world/</span></tt> and the app has
a urls.py that looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;sampleapp.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;main_view&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_main&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^sublevel/$&#39;</span><span class="p">,</span> <span class="s">&#39;sample_view&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_sublevel&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">main_view</span></tt> should now be available at <tt class="docutils literal"><span class="pre">/hello/world/</span></tt> and the
<tt class="docutils literal"><span class="pre">sample_view</span></tt> has the url <tt class="docutils literal"><span class="pre">/hello/world/sublevel/</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">CMS pages <strong>below</strong> the page to which the apphook is attached to, <strong>can</strong> be visible,
provided that the apphook urlconf regexps are not too greedy. From a URL resolution
perspective, attaching an apphook works in same way than inserting the apphook urlconf
in the root urlconf at the same path as the page is attached to.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All views that are attached like this must return a
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.RequestContext" title="(in Django v1.8)"><tt class="xref py py-class docutils literal"><span class="pre">RequestContext</span></tt></a> instance instead of the
default <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.Context" title="(in Django v1.8)"><tt class="xref py py-class docutils literal"><span class="pre">Context</span></tt></a> instance.</p>
</div>
<div class="section" id="apphook-menus">
<h3>Apphook Menus<a class="headerlink" href="#apphook-menus" title="Permalink to this headline">¶</a></h3>
<p>If you want to add a menu to that page as well that may represent some views
in your app add it to your apphook like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menu</span> <span class="kn">import</span> <span class="n">MyAppMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<p>For an example if your app has a <tt class="xref py py-class docutils literal"><span class="pre">Category</span></tt> model and you want this
category model to be displayed in the menu when you attach the app to a page.
We assume the following model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">import</span> <span class="nn">mptt</span>

<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;category_view&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mptt</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span>
<span class="k">except</span> <span class="n">mptt</span><span class="o">.</span><span class="n">AlreadyRegistered</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>We would now create a menu out of these categories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.menu_bases</span> <span class="kn">import</span> <span class="n">CMSAttachMenu</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Category</span>

<span class="k">class</span> <span class="nc">CategoryMenu</span><span class="p">(</span><span class="n">CMSAttachMenu</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;test menu&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;tree_id&quot;</span><span class="p">,</span> <span class="s">&quot;lft&quot;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span>
                <span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">(),</span>
                <span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">parent_id</span>
            <span class="p">)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">CategoryMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you add this menu now to your app-hook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menus</span> <span class="kn">import</span> <span class="n">CategoryMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">,</span> <span class="n">CategoryMenu</span><span class="p">]</span>
</pre></div>
</div>
<p>You get the static entries of <tt class="xref py py-class docutils literal"><span class="pre">MyAppMenu</span></tt> and the dynamic entries of
<tt class="xref py py-class docutils literal"><span class="pre">CategoryMenu</span></tt> both attached to the same page.</p>
</div>
<div class="section" id="attaching-an-application-multiple-times">
<span id="multi-apphook"></span><h3>Attaching an Application multiple times<a class="headerlink" href="#attaching-an-application-multiple-times" title="Permalink to this headline">¶</a></h3>
<p>If you want to attach an application multiple times to different pages you have 2 possibilities.</p>
<ol class="arabic simple">
<li>Give every application its own namespace in the advanced settings of a page.</li>
<li>Define an <tt class="docutils literal"><span class="pre">app_name</span></tt> attribute on the CMSApp class.</li>
</ol>
<p>The problem is that if you only define a namespace you need to have multiple templates per attached app.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>{% url &#39;my_view&#39; %}
</pre></div>
</div>
<p>Will not work anymore when you namespace an app. You will need to do something like:</p>
<div class="highlight-python"><div class="highlight"><pre>{% url &#39;my_namespace:my_view&#39; %}
</pre></div>
</div>
<p>The problem is now if you attach apps to multiple pages your namespace will change.
The solution for this problem are application namespaces.</p>
<p>If you&#8217;d like to use application namespaces to reverse the URLs related to
your app, you can assign a value to the <cite>app_name</cite> attribute of your app
hook like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyNamespacedApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Namespaced Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">app_name</span> <span class="o">=</span> <span class="s">&quot;myapp_namespace&quot;</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyNamespacedApphook</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do provide an <tt class="docutils literal"><span class="pre">app_label</span></tt>, then you will need to also give the app
a unique namespace in the advanced settings of the page. If you do not, and
no other instance of the app exists using it, then the &#8216;default instance
namespace&#8217; will be automatically set for you. You can then either reverse
for the namespace(to target different apps) or the app_name (to target
links inside the same app).</p>
</div>
<p>If you use app namespace you will need to give all your view <tt class="docutils literal"><span class="pre">context</span></tt> a <tt class="docutils literal"><span class="pre">current_app</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">current_app</span><span class="o">=</span><span class="n">current_app</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;my_templace.html&quot;</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You need to set the current_app explicitly in all your view contexts as django does not allow an other way of doing
this.</p>
</div>
<p>You can reverse namespaced apps similarly and it &#8220;knows&#8221; in which app instance it is:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">url</span> <span class="nv">myapp_namespace</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If you want to access the same url but in a different language use the language
template tag:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">language</span> <span class="s2">&quot;de&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">url</span> <span class="nv">myapp_namespace</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The official Django documentation has more details about application and
instance namespaces, the <cite>current_app</cite> scope and the reversing of such
URLs. You can look it up at <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/http/urls/#url-namespaces">https://docs.djangoproject.com/en/dev/topics/http/urls/#url-namespaces</a></p>
</div>
<p>When using the <cite>reverse</cite> function, the <cite>current_app</cite> has to be explicitly passed
as an argument. You can do so by looking up the <cite>current_app</cite> attribute of
the request instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myviews</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>

    <span class="n">reversed_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;myapp_namespace:app_main&#39;</span><span class="p">,</span>
            <span class="n">current_app</span><span class="o">=</span><span class="n">current_app</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Or, if you are rendering a plugin, of the context instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">CMSPluginBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">):</span>
        <span class="c"># ...</span>
        <span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>
        <span class="n">reversed_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;myapp_namespace:app_main&#39;</span><span class="p">,</span>
                <span class="n">current_app</span><span class="o">=</span><span class="n">current_app</span><span class="p">)</span>
        <span class="c"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="apphook-permissions">
<span id="id1"></span><h3>Apphook Permissions<a class="headerlink" href="#apphook-permissions" title="Permalink to this headline">¶</a></h3>
<p>By default all apphooks have the same permissions set as the page they are assigned to.
So if you set login required on page the attached apphook and all it&#8217;s urls have the same
requirements.</p>
<p>To disable this behavior set <tt class="docutils literal"><span class="pre">permissions</span> <span class="pre">=</span> <span class="pre">False</span></tt> on your apphook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SampleApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Sample App&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;project.sampleapp.urls&quot;</span><span class="p">]</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If you still want some of your views to have permission checks you can enable them via a decorator:</p>
<p><tt class="docutils literal"><span class="pre">cms.utils.decorators.cms_perms</span></tt></p>
<p>Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.utils.decorators</span> <span class="kn">import</span> <span class="n">cms_perms</span>

<span class="nd">@cms_perms</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you have your own permission check in your app, or just don&#8217;t want to wrap some nested apps
with CMS permission decorator, then use <tt class="docutils literal"><span class="pre">exclude_permissions</span></tt> property of apphook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SampleApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Sample App&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;project.sampleapp.urls&quot;</span><span class="p">]</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">exclude_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;some_nested_app&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>For example, <a class="reference external" href="https://github.com/tangentlabs/django-oscar">django-oscar</a> apphook integration needs to be used with exclude permissions of dashboard app,
because it use <a class="reference external" href="https://github.com/tangentlabs/django-oscar/blob/0.7.2/oscar/apps/dashboard/nav.py#L57">customizable access function</a>. So, your apphook in this case will looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OscarApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Oscar&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">application</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="n">exclude_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;dashboard&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="automatically-restart-server-on-apphook-changes">
<h3>Automatically restart server on apphook changes<a class="headerlink" href="#automatically-restart-server-on-apphook-changes" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, whenever you add or remove an apphook, change the slug of a
page containing an apphook or the slug if a page which has a descendant with an
apphook, you have to restart your server to re-load the URL caches. To allow
you to automate this process, the django CMS provides a signal
<tt class="xref py py-obj docutils literal"><span class="pre">cms.signals.urls_need_reloading</span></tt> which you can listen on to detect when
your server needs restarting. When you run <tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">runserver</span></tt> a restart
should not be needed.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This signal does not actually do anything. To get automated server
restarting you need to implement logic in your project that gets
executed whenever this signal is fired. Because there are many ways of
deploying Django applications, there is no way we can provide a generic
solution for this problem that will always work.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The signal is fired <strong>after</strong> a request. If you change something via API
you need a request for the signal to fire.</p>
</div>
</div>
</div>
<div class="section" id="navigation-modifiers">
<span id="integration-modifiers"></span><h2>Navigation Modifiers<a class="headerlink" href="#navigation-modifiers" title="Permalink to this headline">¶</a></h2>
<p>Navigation Modifiers give your application access to navigation menus.</p>
<p>A modifier can change the properties of existing nodes or rearrange entire
menus.</p>
<div class="section" id="an-example-use-case">
<h3>An example use-case<a class="headerlink" href="#an-example-use-case" title="Permalink to this headline">¶</a></h3>
<p>A simple example: you have a news application that publishes pages
independently of django CMS. However, you would like to integrate the
application into the menu structure of your site, so that at appropriate
places a <em>News</em> node appears in the navigation menu.</p>
<p>In such a case, a Navigation Modifier is the solution.</p>
</div>
<div class="section" id="how-it-works">
<h3>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>Normally, you&#8217;d want to place modifiers in your application&#8217;s
<tt class="docutils literal"><span class="pre">menu.py</span></tt>.</p>
<p>To make your modifier available, it then needs to be registered with
<tt class="docutils literal"><span class="pre">menus.menu_pool.menu_pool</span></tt>.</p>
<p>Now, when a page is loaded and the menu generated, your modifier will
be able to inspect and modify its nodes.</p>
<p>A simple modifier looks something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">Modifier</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>

<span class="k">class</span> <span class="nc">MyMode</span><span class="p">(</span><span class="n">Modifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">,</span> <span class="n">breadcrumb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">count</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_modifier</span><span class="p">(</span><span class="n">MyMode</span><span class="p">)</span>
</pre></div>
</div>
<p>It has a method <tt class="xref py py-meth docutils literal"><span class="pre">modify()</span></tt> that should return a list
of <a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> instances.
<tt class="xref py py-meth docutils literal"><span class="pre">modify()</span></tt> should take the following arguments:</p>
<ul>
<li><p class="first">request</p>
<p>A Django request instance. You want to modify based on sessions, or
user or permissions?</p>
</li>
<li><p class="first">nodes</p>
<p>All the nodes. Normally you want to return them again.</p>
</li>
<li><p class="first">namespace</p>
<p>A Menu Namespace. Only given if somebody requested a menu with only nodes
from this namespace.</p>
</li>
<li><p class="first">root_id</p>
<p>Was a menu request based on an ID?</p>
</li>
<li><p class="first">post_cut</p>
<p>Every modifier is called two times. First on the whole tree. After that the
tree gets cut to only show the nodes that are shown in the current menu.
After the cut the modifiers are called again with the final tree. If this is
the case <tt class="docutils literal"><span class="pre">post_cut</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>.</p>
</li>
<li><p class="first">breadcrumb</p>
<p>Is this not a menu call but a breadcrumb call?</p>
</li>
</ul>
<p>Here is an example of a built-in modifier that marks all node levels:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Level</span><span class="p">(</span><span class="n">Modifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    marks all node levels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">post_cut</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">,</span> <span class="n">breadcrumb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">breadcrumb</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mark_levels</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span> <span class="nf">mark_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_levels</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">)</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_modifier</span><span class="p">(</span><span class="n">Level</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-plugins">
<span id="integration-customplugins"></span><h2>Custom Plugins<a class="headerlink" href="#custom-plugins" title="Permalink to this headline">¶</a></h2>
<p>If you want to display content of your apps on other pages custom plugins are
a great way to accomplish that. For example, if you have a news app and you
want to display the top 10 news entries on your homepage, a custom plugin is
the way to go.</p>
<p>For a detailed explanation on how to write custom plugins please head over to
the <a class="reference internal" href="custom_plugins.html"><em>Custom Plugins</em></a> section.</p>
</div>
<div class="section" id="toolbar">
<span id="integration-toolbar"></span><h2>Toolbar<a class="headerlink" href="#toolbar" title="Permalink to this headline">¶</a></h2>
<p>Your app might also want to integrate in the <a class="reference internal" href="toolbar.html"><em>Extending the Toolbar</em></a> to
provide a more streamlined user experience for your admins.</p>
</div>
<div class="section" id="working-with-templates">
<span id="integration-templates"></span><h2>Working with templates<a class="headerlink" href="#working-with-templates" title="Permalink to this headline">¶</a></h2>
<p>Application can reuse cms templates by mixing cms templatetags and normal django
templating language.</p>
<div class="section" id="static-placeholder">
<h3>static_placeholder<a class="headerlink" href="#static-placeholder" title="Permalink to this headline">¶</a></h3>
<p>Plain <a class="reference internal" href="../advanced/templatetags.html#std:templatetag-placeholder"><tt class="xref std std-ttag docutils literal"><span class="pre">placeholder</span></tt></a> cannot be used in templates used by external applications,
use <a class="reference internal" href="../advanced/templatetags.html#std:templatetag-static_placeholder"><tt class="xref std std-ttag docutils literal"><span class="pre">static_placeholder</span></tt></a> instead.</p>
</div>
<div class="section" id="cms-template">
<span id="page-template"></span><h3>CMS_TEMPLATE<a class="headerlink" href="#cms-template" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p><tt class="docutils literal"><span class="pre">CMS_TEMPLATE</span></tt> is a context variable available in the context; it contains
the template path for CMS pages and application using apphooks, and the default
template (i.e.: the first template in <a class="reference internal" href="../basic_reference/configuration.html#std:setting-CMS_TEMPLATES"><tt class="xref std std-setting docutils literal"><span class="pre">CMS_TEMPLATES</span></tt></a>) for non-CMS
managed urls.</p>
<p>This is mostly useful to use it in the <tt class="docutils literal"><span class="pre">extends</span></tt> templatetag in the application
templates to get the current page template.</p>
<p>Example: cms template</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">cms_tags</span> <span class="cp">%}</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;body&gt;</span>
    <span class="cp">{%</span> <span class="k">cms_toolbar</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">main</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">placeholder</span> <span class="s2">&quot;main&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">main</span> <span class="cp">%}</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Example: application template</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">CMS_TEMPLATE</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">cms_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">main</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">object_list</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">static_placeholder</span> <span class="s2">&quot;sidebar&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">main</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">CMS_TEMPLATE</span></tt> memorizes the path of the cms template so the application
template can dynamically import it.</p>
</div>
<div class="section" id="render-model">
<h3>render_model<a class="headerlink" href="#render-model" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p><a class="reference internal" href="../advanced/templatetags.html#std:templatetag-render_model"><tt class="xref std std-ttag docutils literal"><span class="pre">render_model</span></tt></a> allows to edit the django models from the frontend by
reusing the django CMS frontend editor.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">App Integration</a><ul>
<li><a class="reference internal" href="#menus">Menus</a><ul>
<li><a class="reference internal" href="#customize-menus-at-runtime">Customize menus at runtime</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attach-menus">Attach Menus</a></li>
<li><a class="reference internal" href="#app-hooks">App-Hooks</a><ul>
<li><a class="reference internal" href="#apphook-menus">Apphook Menus</a></li>
<li><a class="reference internal" href="#attaching-an-application-multiple-times">Attaching an Application multiple times</a></li>
<li><a class="reference internal" href="#apphook-permissions">Apphook Permissions</a></li>
<li><a class="reference internal" href="#automatically-restart-server-on-apphook-changes">Automatically restart server on apphook changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#navigation-modifiers">Navigation Modifiers</a><ul>
<li><a class="reference internal" href="#an-example-use-case">An example use-case</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-plugins">Custom Plugins</a></li>
<li><a class="reference internal" href="#toolbar">Toolbar</a></li>
<li><a class="reference internal" href="#working-with-templates">Working with templates</a><ul>
<li><a class="reference internal" href="#static-placeholder">static_placeholder</a></li>
<li><a class="reference internal" href="#cms-template">CMS_TEMPLATE</a></li>
<li><a class="reference internal" href="#render-model">render_model</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="custom_plugins.html"
                        title="previous chapter">Custom Plugins</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api_references.html"
                        title="next chapter">API References</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/extending_cms/app_integration.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_references.html" title="API References"
             >next</a> |</li>
        <li class="right" >
          <a href="custom_plugins.html" title="Custom Plugins"
             >previous</a> |</li>
        <li><a href="../index.html">django cms 3.0.4 documentation</a> &raquo;</li>
          <li><a href="index.html" >Extending the CMS</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Patrick Lauber.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>