<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extending the Toolbar &mdash; django cms 3.1.0.b1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.0.b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="django cms 3.1.0.b1 documentation" href="../index.html" />
    <link rel="up" title="Tutorials" href="index.html" />
    <link rel="next" title="Extending the navigation menu" href="menu.html" />
    <link rel="prev" title="Integrating a third-party application" href="third_party.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="menu.html" title="Extending the navigation menu"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="third_party.html" title="Integrating a third-party application"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">django cms 3.1.0.b1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="extending-the-toolbar">
<h1>Extending the Toolbar<a class="headerlink" href="#extending-the-toolbar" title="Permalink to this headline">¶</a></h1>
<p>django CMS allows you to control what appears in the toolbar. This allows you
to integrate your application in the frontend editing mode of django CMS and
provide your users with a streamlined editing experience.</p>
<div class="section" id="registering-toolbar-items">
<h2>Registering Toolbar items<a class="headerlink" href="#registering-toolbar-items" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to control what gets shown in the toolbar.</p>
<p>One is the <tt class="docutils literal"><span class="pre">CMS_TOOLBARS</span></tt> setting. This gives you full control over which
classes are loaded, but requires that you specify them all manually.</p>
<p>The other is to provide <tt class="docutils literal"><span class="pre">cms_toolbar.py</span></tt> files in your apps, which will be
automatically loaded as long <tt class="docutils literal"><span class="pre">CMS_TOOLBARS</span></tt> is not set (or set to <cite>None</cite>).
We&#8217;ll work with this second method.</p>
<p>Create a new <tt class="docutils literal"><span class="pre">cms_toolbar.py</span></tt> file in your Polls application (NOTE: <em>not</em> in
the Polls Plugin application we were working with in the previous tutorial):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>


<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_current_app</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_changelist&#39;</span><span class="p">)</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll overview&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>What we&#8217;re doing above is this:</p>
<ul class="simple">
<li>defining a <tt class="docutils literal"><span class="pre">CMSToolbar</span></tt> subclass</li>
<li>registering the toolbar class with <tt class="docutils literal"><span class="pre">&#64;toolbar_pool.register</span></tt></li>
<li>defining a <tt class="docutils literal"><span class="pre">populate()</span></tt> method that adds an item to the menu</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">populate()</span></tt> method:</p>
<ul class="simple">
<li>checks whether we&#8217;re in a page belonging to this application</li>
<li>if so, it creates a menu item if one&#8217;s not already there</li>
<li>works out the URL for this menu item</li>
<li>tells it that it should open in the admin sideframe</li>
</ul>
<p>Your <tt class="docutils literal"><span class="pre">cms_toolbar.py</span></tt> file should contain classes that extend
<tt class="docutils literal"><span class="pre">cms.toolbar_base.CMSToolbar</span></tt> and are registered using
<tt class="docutils literal"><span class="pre">cms.toolbar_pool.toolbar_pool.register()</span></tt>. The register function can be used
as a decorator.</p>
<p>A <tt class="docutils literal"><span class="pre">CMSToolbar</span></tt> subclass needs four attributes:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">toolbar</span></tt>: the toolbar object</li>
<li><tt class="docutils literal"><span class="pre">request</span></tt> the current request</li>
<li><cite>is_current_app</cite> a flag indicating whether the current request is handled by the same app as the function is in</li>
<li><cite>app_path</cite> the name of the app used for the current request</li>
</ul>
<p><tt class="docutils literal"><span class="pre">CMSToolbar</span></tt> subclasses must implement a <tt class="docutils literal"><span class="pre">populate</span></tt> method. The <tt class="docutils literal"><span class="pre">populate</span></tt>
method will only be called if the current user is a staff user.</p>
<p>There&#8217;s a lot more to django CMS toolbar classes than this - see
<a class="reference internal" href="../how_to/toolbar.html"><em>Extending the Toolbar</em></a> for more.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending the Toolbar</a><ul>
<li><a class="reference internal" href="#registering-toolbar-items">Registering Toolbar items</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="third_party.html"
                        title="previous chapter">Integrating a third-party application</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="menu.html"
                        title="next chapter">Extending the navigation menu</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/introduction/toolbar.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="menu.html" title="Extending the navigation menu"
             >next</a> |</li>
        <li class="right" >
          <a href="third_party.html" title="Integrating a third-party application"
             >previous</a> |</li>
        <li><a href="../index.html">django cms 3.1.0.b1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Patrick Lauber.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>