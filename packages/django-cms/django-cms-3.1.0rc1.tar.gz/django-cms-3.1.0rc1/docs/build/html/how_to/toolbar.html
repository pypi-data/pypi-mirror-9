<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extending the Toolbar &mdash; django cms 3.1.0.b1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.0.b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="django cms 3.1.0.b1 documentation" href="../index.html" />
    <link rel="up" title="How-to guides" href="index.html" />
    <link rel="next" title="Using South with django CMS" href="using_south.html" />
    <link rel="prev" title="Extending the page &amp; title models" href="extending_page_title.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="using_south.html" title="Using South with django CMS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="extending_page_title.html" title="Extending the page &amp; title models"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">django cms 3.1.0.b1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">How-to guides</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="extending-the-toolbar">
<h1>Extending the Toolbar<a class="headerlink" href="#extending-the-toolbar" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p>You can add and remove items to the toolbar. This allows you to integrate your
application in the frontend editing mode of django CMS and provide your users
with a streamlined editing experience.</p>
<p>For the toolbar API reference, please refer to <a class="reference internal" href="../reference/api_references.html#toolbar-api-reference"><em>cms.toolbar</em></a>.</p>
<div class="section" id="registering">
<h2>Registering<a class="headerlink" href="#registering" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to control what gets shown in the toolbar.</p>
<p>One is the <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><tt class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></tt></a>. This gives you full control over which
classes are loaded, but requires that you specify them all manually.</p>
<p>The other is to provide <tt class="docutils literal"><span class="pre">cms_toolbar.py</span></tt> files in your apps, which will be
automatically loaded as long <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><tt class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></tt></a> is not set (or set to
<tt class="docutils literal"><span class="pre">None</span></tt>).</p>
<p>If you use the automated way, your <tt class="docutils literal"><span class="pre">cms_toolbar.py</span></tt> file should contain
classes that extend from <tt class="docutils literal"><span class="pre">cms.toolbar_base.CMSToolbar</span></tt> and are registered using <tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar_pool.toolbar_pool.register()</span></tt>.
The register function can be used as a decorator.</p>
<p>These have four attributes:
* toolbar (the toolbar object)
* request (the current request)
* is_current_app (a flag indicating whether the current request is handled by the same app as the function is in)
* app_path (the name of the app used for the current request)</p>
<p>These classes must implement a <tt class="docutils literal"><span class="pre">populate</span></tt> or <tt class="docutils literal"><span class="pre">post_template_populate</span></tt> function. An optional <tt class="docutils literal"><span class="pre">request_hook</span></tt> function
is available for overwrite as well.</p>
<ul class="simple">
<li>The populate functions will only be called if the current user is a staff user.</li>
<li>The <tt class="docutils literal"><span class="pre">populate</span></tt> function will be called before the template and plugins are rendered.</li>
<li>The <tt class="docutils literal"><span class="pre">post_template_populate</span></tt> function will be called after the template is rendered.</li>
<li>The <tt class="docutils literal"><span class="pre">request_hook</span></tt> function is called before the view and may return a response. This way you would be able to issue
redirects from a toolbar if needed</li>
</ul>
<p>These classes can define an optional <tt class="docutils literal"><span class="pre">supported_apps</span></tt> attribute, specifying which applications the toolbar will work
with.
This is useful when the toolbar is defined in a different application from the views it&#8217;s related to.
to define the toolbar is local to (i.e.: for which the
<tt class="docutils literal"><span class="pre">supported_apps</span></tt> is a tuple of application dotted paths (e.g: <tt class="docutils literal"><span class="pre">supported_apps</span> <span class="pre">=</span> <span class="pre">('whatever.path.app',</span> <span class="pre">'another.path.app')</span></tt>.</p>
<p>A simple example, registering a class that does nothing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">NoopModifier</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">post_template_populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As the toolbar passed to <tt class="docutils literal"><span class="pre">post_template_populate</span></tt> has been already populated with items from other applications,
it might contains different items that when processed by <tt class="docutils literal"><span class="pre">populate</span></tt>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can change the toolbar or add items inside a plugin render method (context[&#8216;request&#8217;].toolbar) or inside a view
(request.toolbar)</p>
</div>
</div>
<div class="section" id="adding-items">
<h2>Adding items<a class="headerlink" href="#adding-items" title="Permalink to this headline">¶</a></h2>
<p>Items can be added through the various <a class="reference internal" href="../reference/api_references.html#toolbar-api-reference"><em>APIs</em></a>
exposed by the toolbar and its items.</p>
<p>To add a <a class="reference internal" href="../reference/api_references.html#cms.toolbar.items.Menu" title="cms.toolbar.items.Menu"><tt class="xref py py-class docutils literal"><span class="pre">cms.toolbar.items.Menu</span></tt></a> to the toolbar, use
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.toolbar.CMSToolbar.get_or_create_menu" title="cms.toolbar.toolbar.CMSToolbar.get_or_create_menu"><tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_or_create_menu()</span></tt></a> which will either add a menu if
it doesn&#8217;t exist, or create it.</p>
<p>Then, to add a link to your changelist that will open in the sideframe, use the
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.items.ToolbarMixin.add_sideframe_item" title="cms.toolbar.items.ToolbarMixin.add_sideframe_item"><tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.items.ToolbarMixin.add_sideframe_item()</span></tt></a> method on the menu
object returned.</p>
<p>When adding items, all arguments other than the name or identifier should be
given as <strong>keyword arguments</strong>. This will help ensure that your custom toolbar
items survive upgrades.</p>
<p>Following our <a class="reference internal" href="../introduction/toolbar.html"><em>Extending the Toolbar</em></a>, let&#8217;s add the poll app
to the toolbar:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_current_app</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_changelist&#39;</span><span class="p">)</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll overview&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>However, there&#8217;s already a menu added by the CMS which provides access to
various admin views, so you might want to add your menu as a sub menu there.
To do this, you can use positional insertion coupled with the fact that
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.toolbar.CMSToolbar.get_or_create_menu" title="cms.toolbar.toolbar.CMSToolbar.get_or_create_menu"><tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_or_create_menu()</span></tt></a> will return already existing
menus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar.items</span> <span class="kn">import</span> <span class="n">Break</span>
<span class="kn">from</span> <span class="nn">cms.cms_toolbar</span> <span class="kn">import</span> <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">ADMINISTRATION_BREAK</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">admin_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Site&#39;</span><span class="p">))</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">find_first</span><span class="p">(</span><span class="n">Break</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">ADMINISTRATION_BREAK</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-menu&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_changelist&#39;</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll overview&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="n">admin_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">(</span><span class="s">&#39;poll-break&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you wish to simply detect the presence of a menu without actually creating
it, you can use <tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_menu()</span></tt>, which will
return the menu if it is present, or, if not, will return <cite>None</cite>.</p>
</div>
<div class="section" id="modifying-an-existing-toolbar">
<h2>Modifying an existing toolbar<a class="headerlink" href="#modifying-an-existing-toolbar" title="Permalink to this headline">¶</a></h2>
<p>If you need to modify an existing toolbar (say to change the <tt class="docutils literal"><span class="pre">supported_apps</span></tt> attribute) you can do this by
extending the original one, and modifying the appropriate attribute.</p>
<p>If <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><tt class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></tt></a> is used to register the toolbars, add your own toolbar instead of the original one, otherwise
unregister the original and register your own:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">third.party.app.cms.toolbar_base</span> <span class="kn">import</span> <span class="n">FooToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">BarToolbar</span><span class="p">(</span><span class="n">FooToolbar</span><span class="p">):</span>
    <span class="n">supported_apps</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;third.party.app&#39;</span><span class="p">,</span> <span class="s">&#39;your.app&#39;</span><span class="p">)</span>

<span class="n">toolbar_pool</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">FooToolbar</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="adding-items-alphabetically">
<h3>Adding Items Alphabetically<a class="headerlink" href="#adding-items-alphabetically" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is desirable to add sub-menus from different applications
alphabetically. This can be challenging due to the non-obvious manner in which
your apps will be loaded into Django and is further complicated when you add new
applications over time.</p>
<p>To aide developers, django-cms exposes a <tt class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.items.ToolbarMixin.get_alphabetical_insert_position()</span></tt>
method, which, if used consistently can produce alphabetized sub-menus, even
when they come from multiple applications.</p>
<p>An example is shown here for an &#8216;Offices&#8217; app, which allows handy access to
certain admin functions for managing office locations in a project:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar.items</span> <span class="kn">import</span> <span class="n">Break</span><span class="p">,</span> <span class="n">SubMenu</span>
<span class="kn">from</span> <span class="nn">cms.cms_toolbar</span> <span class="kn">import</span> <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">ADMINISTRATION_BREAK</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">OfficesToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#</span>
        <span class="c"># &#39;Apps&#39; is the spot on the existing djang-cms toolbar admin_menu</span>
        <span class="c"># &#39;where we&#39;ll insert all of our applications&#39; menus.</span>
        <span class="c">#</span>
        <span class="n">admin_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span>
            <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Apps&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># Let&#39;s check to see where we would insert an &#39;Offices&#39; menu in the</span>
        <span class="c"># admin_menu.</span>
        <span class="c">#</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_alphabetical_insert_position</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices&#39;</span><span class="p">),</span>
            <span class="n">SubMenu</span>
        <span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># If zero was returned, then we know we&#39;re the first of our</span>
        <span class="c"># applications&#39; menus to be inserted into the admin_menu, so, here</span>
        <span class="c"># we&#39;ll compute that we need to go after the first</span>
        <span class="c"># ADMINISTRATION_BREAK and, we&#39;ll insert our own break after our</span>
        <span class="c"># section.</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span><span class="p">:</span>
            <span class="c"># OK, use the ADMINISTRATION_BREAK location + 1</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">find_first</span><span class="p">(</span>
                <span class="n">Break</span><span class="p">,</span>
                <span class="n">identifier</span><span class="o">=</span><span class="n">ADMINISTRATION_BREAK</span>
            <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c"># Insert our own menu-break, at this new position. We&#39;ll insert</span>
            <span class="c"># all subsequent menus before this, so it will ultimately come</span>
            <span class="c"># after all of our applications&#39; menus.</span>
            <span class="n">admin_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">(</span><span class="s">&#39;custom-break&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>

        <span class="c"># OK, create our office menu here.</span>
        <span class="n">office_menu</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span>
            <span class="s">&#39;offices-menu&#39;</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices ...&#39;</span><span class="p">),</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span>
        <span class="p">)</span>

        <span class="c"># Let&#39;s add some sub-menus to our office menu that help our users</span>
        <span class="c"># manage office-related things.</span>

        <span class="c"># Take the user to the admin-listing for offices...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_office_changelist&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices List&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="c"># Display a modal dialogue for creating a new office...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_office_add&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add New Office&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="c"># Add a break in the submenus</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">()</span>

        <span class="c"># More submenus...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_state_changelist&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;States List&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_state_add&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add New State&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the resulting toolbar (with a few other menus sorted alphabetically
beside it)</p>
<p><img alt="alphabetized-toolbar-app-menus" src="../_images/alphabetized-toolbar-app-menus.png" /></p>
</div>
<div class="section" id="adding-items-through-views">
<h3>Adding items through views<a class="headerlink" href="#adding-items-through-views" title="Permalink to this headline">¶</a></h3>
<p>Another way to add items to the toolbar is through our own views (<tt class="docutils literal"><span class="pre">polls/views.py</span></tt>).
This method can be useful if you need to access certain variables, in our case e.g. the
selected poll and its sub-methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>


<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="n">menu</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;polls-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Change this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_change&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Show History of this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_history&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Delete this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_delete&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">poll</span><span class="p">})</span>
</pre></div>
</div>
<div class="section" id="detecting-url-changes">
<span id="url-changes"></span><h4>Detecting url changes<a class="headerlink" href="#detecting-url-changes" title="Permalink to this headline">¶</a></h4>
<p>Sometimes toolbar entries allow that you change the url of the current object displayed in the website. For example you are
inside a blog entry and the toolbar allows to edit the blog slug or url. The toolbar will watch the
<tt class="docutils literal"><span class="pre">django.contrib.admin.models.LogEntry</span></tt> model and detect if you create or edit an object in the admin via modal or sideframe view.
After the modal or sideframe closes it will redirect to the new url of the object.</p>
<p>To set this behavior manually you can set the <tt class="docutils literal"><span class="pre">request.toolbar.set_object()</span></tt> function on which you can set the current object.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;toolbar&#39;</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">set_object</span><span class="p">(</span><span class="n">poll</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">poll</span><span class="p">})</span>
</pre></div>
</div>
<p>If you want to watch for object creation or editing of models and redirect after they have been added or changed add a
<tt class="docutils literal"><span class="pre">watch_models</span></tt> attribute to your toolbar.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="n">watch_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">Poll</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>After you add this every change to an instance of <tt class="docutils literal"><span class="pre">Poll</span></tt> via sideframe or modal window will trigger a redirect to
the URL of the poll instance that was edited, according to the toolbar status: if in <em>draft</em> mode
the <tt class="docutils literal"><span class="pre">get_draft_url()</span></tt> is returned (or <tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> if the former does not exists),
if in <em>live</em> mode and the method exists <tt class="docutils literal"><span class="pre">get_public_url()</span></tt> is returned;</p>
</div>
</div>
</div>
<div class="section" id="frontend">
<h2>Frontend<a class="headerlink" href="#frontend" title="Permalink to this headline">¶</a></h2>
<p>The toolbar adds a class <tt class="docutils literal"><span class="pre">cms-ready</span></tt> to the <strong>html</strong> tag when ready. Additionally we add <tt class="docutils literal"><span class="pre">cms-toolbar-expanded</span></tt> when
the toolbar is visible (expanded).</p>
<p>The toolbar also fires a JavaScript event called <strong>cms-ready</strong> on the document.
You can listen to this event using jQuery:</p>
<p><tt class="docutils literal"><span class="pre">CMS.$(document).on('cms-ready',</span> <span class="pre">function</span> <span class="pre">()</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">});</span></tt></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending the Toolbar</a><ul>
<li><a class="reference internal" href="#registering">Registering</a></li>
<li><a class="reference internal" href="#adding-items">Adding items</a></li>
<li><a class="reference internal" href="#modifying-an-existing-toolbar">Modifying an existing toolbar</a><ul>
<li><a class="reference internal" href="#adding-items-alphabetically">Adding Items Alphabetically</a></li>
<li><a class="reference internal" href="#adding-items-through-views">Adding items through views</a><ul>
<li><a class="reference internal" href="#detecting-url-changes">Detecting url changes</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#frontend">Frontend</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="extending_page_title.html"
                        title="previous chapter">Extending the page &amp; title models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="using_south.html"
                        title="next chapter">Using South with django CMS</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/how_to/toolbar.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="using_south.html" title="Using South with django CMS"
             >next</a> |</li>
        <li class="right" >
          <a href="extending_page_title.html" title="Extending the page &amp; title models"
             >previous</a> |</li>
        <li><a href="../index.html">django cms 3.1.0.b1 documentation</a> &raquo;</li>
          <li><a href="index.html" >How-to guides</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Patrick Lauber.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>