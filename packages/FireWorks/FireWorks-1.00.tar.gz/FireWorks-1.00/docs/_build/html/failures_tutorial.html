<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dealing with Failures and Crashes &mdash; FireWorks 1.00 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.00',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 1.00 documentation" href="index.html" />
    <link rel="next" title="Database administration commands" href="maintain_tutorial.html" />
    <link rel="prev" title="Rerunning a Firework or Workflow" href="rerun_tutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="maintain_tutorial.html" title="Database administration commands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rerun_tutorial.html" title="Rerunning a Firework or Workflow"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 1.00 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dealing-with-failures-and-crashes">
<h1>Dealing with Failures and Crashes<a class="headerlink" href="#dealing-with-failures-and-crashes" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This documentation is written as a <strong>tutorial</strong> that starts from a clean FireWorks database. If you have an existing FireWorks database and need to deal with a failure or crash, do <strong>not</strong> reset your FireWorks database as the tutorial instructs. Instead, first read through this tutorial to get an idea on how failures work in FireWorks. Then, refer to the <a class="reference internal" href="maintain_tutorial.html"><em>database maintenance instructions</em></a>.</p>
</div>
<p>Job exceptions, node failures, and system outages are all unfortunate realities of executing workflows. You&#8217;ll likely encounter some of these events when running FireWorks. This tutorial will simulate some of these events, so you can see how FireWorks detects job failures and what you can do about it.</p>
<div class="section" id="normal-operation">
<h2>Normal operation<a class="headerlink" href="#normal-operation" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s first introduce normal operation of a Firework that prints <tt class="docutils literal"><span class="pre">starting</span></tt>, sleeps for 10 seconds, and then prints <tt class="docutils literal"><span class="pre">ending</span></tt>. The Firework is completed successfully only if <tt class="docutils literal"><span class="pre">ending</span></tt> gets printed.</p>
<ol class="arabic">
<li><p class="first">Move to the <tt class="docutils literal"><span class="pre">failures</span></tt> tutorial directory on your FireServer:</p>
<div class="highlight-python"><div class="highlight"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/failures
</pre></div>
</div>
</li>
<li><p class="first">Look inside <tt class="docutils literal"><span class="pre">fw_sleep.yaml</span></tt>. It should be pretty straightforward - we are printing text, sleeping, and printing text again.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can increase or decrease the sleep time, depending on your patience level and reaction time later on in the tutorial.</p>
</div>
</li>
<li><p class="first">Let&#8217;s add and run this Firework. You&#8217;ll have to wait 10 seconds for it to complete:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
lpad add fw_sleep.yaml
rlaunch singleshot
</pre></div>
</div>
</li>
<li><p class="first">Hopefully, your patience was rewarded with <tt class="docutils literal"><span class="pre">ending</span></tt> printed to your terminal. If so, let&#8217;s keep going!</p>
</li>
</ol>
</div>
<div class="section" id="error-during-run-a-fizzled-firework">
<h2>Error during run - a <em>FIZZLED</em> Firework!<a class="headerlink" href="#error-during-run-a-fizzled-firework" title="Permalink to this headline">¶</a></h2>
<p>If your job throws an exception (error), FireWorks will automatically mark your job as <em>FIZZLED</em>. Any jobs that depend on this job will not run until you fix things. Let&#8217;s simulate this situation.</p>
<ol class="arabic">
<li><p class="first">Reset your database and add back the sleeping Firework:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
lpad add fw_sleep.yaml
</pre></div>
</div>
</li>
<li><p class="first">We&#8217;ll run the Firework again, but this time you should interrupt its operation using the keyboard shortcut to stop execution(Ctrl+C). Make sure you hit that keyboard combo immediately after running the job, before you see the text <tt class="docutils literal"><span class="pre">ending</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>rlaunch singleshot
(Ctrl+C)
</pre></div>
</div>
</li>
<li><p class="first">If you did this correctly, you&#8217;ll have seen the text <tt class="docutils literal"><span class="pre">starting</span></tt> but not the text <tt class="docutils literal"><span class="pre">ending</span></tt>. You might also see some error text printed to your terminal.</p>
</li>
<li><p class="first">This behavior is what happens when your job throws an error (such as the <em>KeyboardInterrupt</em> error we just simulated). Let&#8217;s see what became of this ill-fated Firework:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad get_fws -i 1 -d all
</pre></div>
</div>
</li>
<li><p class="first">You should notice the state of this Firework is automatically marked as <em>FIZZLED</em>. In addition, if you look at the <strong>stored_data</strong> key, you&#8217;ll see that there&#8217;s information about the error that was encountered during the run. If you&#8217;re thorough, you&#8217;ll see something about a <em>KeyboardInterruptError</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the exception thrown by the job implements the <tt class="docutils literal"><span class="pre">to_dict()</span></tt> method, this will be called to serialize customized information about the exception and add them to the <tt class="docutils literal"><span class="pre">stored_data</span></tt>.</p>
</div>
</li>
<li><p class="first">If at any point you want to review what FireWorks have <em>FIZZLED</em>, you can use the following query:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad get_fws -s FIZZLED -d ids
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="catastrophic-failure">
<h2>Catastrophic Failure<a class="headerlink" href="#catastrophic-failure" title="Permalink to this headline">¶</a></h2>
<p>The previous failure was easy to detect; the job threw an error, and the Rocket was able to catch that error and tell the LaunchPad to mark the job as <em>FIZZLED</em>. However, more catastrophic failures are possible. For example, you might have a power failure in your computer center. In that case, there is no time for the Rocket to report to FireWorks that there is a failure. Let&#8217;s see how to handle this case.</p>
<ol class="arabic">
<li><p class="first">Reset your database and add back the sleeping Firework:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
lpad add fw_sleep.yaml
</pre></div>
</div>
</li>
<li><p class="first">We&#8217;ll run the Firework again, but this time you should interrupt its operation by <strong>forcibly closing your terminal window</strong> (immediately after running the job, before you see the text <tt class="docutils literal"><span class="pre">ending</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre>rlaunch singleshot
----(forcibly close your terminal window)
</pre></div>
</div>
</li>
<li><p class="first">Now let&#8217;s re-open a terminal window and see what FireWorks thinks is happening with this job:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad get_fws -i 1 -d more
</pre></div>
</div>
</li>
<li><p class="first">You should notice that FireWorks still thinks this job is <em>RUNNING</em>! We can fix this using the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad detect_lostruns --time 1 --fizzle
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Instead of using <tt class="docutils literal"><span class="pre">--fizzle</span></tt>, you could instead use <tt class="docutils literal"><span class="pre">--rerun</span></tt>. This would mark the Launch as being FIZZLED and then rerun the Firework.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An additional constraint, <tt class="docutils literal"><span class="pre">--max_runtime</span></tt>, can be used if you are looking for jobs that ran only a short time before failing. This can be useful to track down if a job was killed because it did not have walltime to run (if it was started in the middle of the queue job). Note that you should set this parameter to be in slightly larger intervals of the ping_time, since runtime is determined using pings.</p>
</div>
</li>
<li><p class="first">This command will mark all jobs that have been running for more than 1 second as <em>FIZZLED</em>. We&#8217;ll improve this in a bit, but for now let&#8217;s check to make sure the command worked:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad get_fws -i 1 -d more
</pre></div>
</div>
</li>
<li><p class="first">The Firework should now be correctly listed as <em>FIZZLED</em>!</p>
</li>
<li><p class="first">Of course, in production you&#8217;ll never want to mark all jobs running for 1 second as being <em>FIZZLED</em>; this will mark jobs that are running properly as <em>FIZZLED</em>!</p>
</li>
<li><p class="first">In production, you need not specify the <tt class="docutils literal"><span class="pre">--time</span></tt> parameter at all. FireWorks will automatically detect a job as <em>FIZZLED</em> after 4 hours of idle time when you run <tt class="docutils literal"><span class="pre">lpad</span> <span class="pre">detect_lostruns</span></tt>. Jobs that are running properly, even if they take longer than 4 hours, will not be marked as <em>FIZZLED</em>. This is because the Rocket will automatically ping the LaunchPad that it&#8217;s <em>alive</em> every hour. FireWorks will only mark jobs as <em>FIZZLED</em> when it does not receive this ping from the Rocket for 4 hours. You can test this feature with the following sequence of commands:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
lpad add fw_sleep.yaml
rlaunch singleshot
---(forcibly close your terminal window)
---(wait 4 or more hours!! or temporarily set your System Clock ahead by 5 hours)
lpad detect_lostruns --fizzle
lpad get_fws -i 1 -d all
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can shorten the ping times and detection times by editing the settings in your <a class="reference internal" href="config_tutorial.html"><em>FW configuration</em></a>, but we suggest you leave them alone unless really needed.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In production, you can use the <a class="reference internal" href="maintain_tutorial.html"><em>database maintenance instructions</em></a> instead of calling <tt class="docutils literal"><span class="pre">lpad_detect_lostruns</span> <span class="pre">--fizzle</span></tt>.</p>
</div>
</div>
<div class="section" id="life-after-fizzled">
<h2>Life after <em>FIZZLED</em><a class="headerlink" href="#life-after-fizzled" title="Permalink to this headline">¶</a></h2>
<p>Once FireWorks has identified a job as <em>FIZZLED</em>, you might wonder what comes next. One option is to resubmit your workflow, perhaps with modifications to prevent any problems that might have caused job failure. If you&#8217;ve correctly enabled <a class="reference internal" href="duplicates_tutorial.html"><em>duplicate checking</em></a>, your new workflow will automatically pick up where you left off, and you won&#8217;t do any extra calculations. This is the preferred way of dealing with failures. If you haven&#8217;t enabled duplicate checking, then you can also <a class="reference internal" href="rerun_tutorial.html"><em>rerun your workflow</em></a>, starting from the failed job. If the <tt class="docutils literal"><span class="pre">EXCEPT_DETAILS_ON_RERUN</span></tt> option is enabled in your <a class="reference internal" href="config_tutorial.html"><em>FW configuration</em></a>, the exception details serialized during the last launch will be copied in the spec under the key <tt class="docutils literal"><span class="pre">_exception_details</span></tt>. Customized exceptions can then be implemented to store information that help properly restart the job. The only caveat to this latter method is that dynamic actions already taken by your workflow will <strong>not</strong> be reset to their initial state.</p>
<p>You can also continue on with the Workflow even after <em>FIZZLED</em> by setting the <tt class="docutils literal"><span class="pre">_allow_fizzled_parents</span></tt> parameter in your <strong>spec</strong>. This will allow you to algorithmically fix errors using FireWorks&#8217; dynamic workflow features. This is a fairly advanced use case and will be covered in a future tutorial.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dealing with Failures and Crashes</a><ul>
<li><a class="reference internal" href="#normal-operation">Normal operation</a></li>
<li><a class="reference internal" href="#error-during-run-a-fizzled-firework">Error during run - a <em>FIZZLED</em> Firework!</a></li>
<li><a class="reference internal" href="#catastrophic-failure">Catastrophic Failure</a></li>
<li><a class="reference internal" href="#life-after-fizzled">Life after <em>FIZZLED</em></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="rerun_tutorial.html"
                        title="previous chapter">Rerunning a Firework or Workflow</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="maintain_tutorial.html"
                        title="next chapter">Database administration commands</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/failures_tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="maintain_tutorial.html" title="Database administration commands"
             >next</a> |</li>
        <li class="right" >
          <a href="rerun_tutorial.html" title="Rerunning a Firework or Workflow"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 1.00 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53488807-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>