<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using the TemplateWriterTask to write files &mdash; FireWorks 0.98 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 0.98 documentation" href="index.html" />
    <link rel="next" title="Using the built-in FileIO Tasks" href="fileiotasks.html" />
    <link rel="prev" title="Using the ScriptTask to execute commands" href="scripttask.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fileiotasks.html" title="Using the built-in FileIO Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="scripttask.html" title="Using the ScriptTask to execute commands"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 0.98 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-the-templatewritertask-to-write-files">
<h1>Using the TemplateWriterTask to write files<a class="headerlink" href="#using-the-templatewritertask-to-write-files" title="Permalink to this headline">¶</a></h1>
<p>A common task in scientific workflows is to write an input file in a format that can be read by a program, and then execute that program. When automating the same program for different inputs (like different molecules or sections of a galaxy), slight modifications to the input file are needed. This tutorial introduces the built-in <em>TemplateWriterTask</em> as a method for writing input files (or any other type of templated file).</p>
<p>We presented an example of using the <em>TemplateWriterTask</em> and subsequently running a program in the <a class="reference internal" href="firetask_tutorial.html"><em>FireTask tutorial</em></a>. If you didn&#8217;t already complete the first part of that tutorial, we suggest you do that first. This tutorial contains more details on how the <em>TemplateWriterTask</em> works.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <em>TemplateWriterTask</em> is uses the Jinja2 templating engine, which provides a simple, extensible templating language.</p>
</div>
<div class="section" id="a-simple-template-variable-substitutions">
<h2>A simple template - variable substitutions<a class="headerlink" href="#a-simple-template-variable-substitutions" title="Permalink to this headline">¶</a></h2>
<p>We introduced a simple template in the <a class="reference internal" href="firetask_tutorial.html"><em>FireTask tutorial</em></a>. Let&#8217;s explore this template in more detail.</p>
<ol class="arabic">
<li><p class="first">Navigate to the template writer tutorial directory on your FireServer:</p>
<div class="highlight-python"><div class="highlight"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/templatewritertask
</pre></div>
</div>
</li>
<li><p class="first">Look inside the file <tt class="docutils literal"><span class="pre">simple_template_copy.txt</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">option1</span> <span class="o">=</span> <span class="p">{{</span><span class="n">opt1</span><span class="p">}}</span>
<span class="n">option2</span> <span class="o">=</span> <span class="p">{{</span><span class="n">opt2</span><span class="p">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The template file can be any text file, with any extension (or no extension at all). The actual template file is stored within the FireWorks code, so modifying this copy of a file won&#8217;t have any effect (more on this later in the tutorial).</p>
</div>
</li>
<li><p class="first">Most of the template file is interpreted literally and is static. However, the text inside double curly braces <tt class="docutils literal"><span class="pre">{{</span></tt> and <tt class="docutils literal"><span class="pre">}}</span></tt> are <strong>variables</strong> that will be replaced later on by other text.</p>
</li>
<li><p class="first">We set the variables <strong>opt1</strong> and <strong>opt2</strong> using a <em>Context</em>. This is a dictionary that contains specific values for these parameters. Let&#8217;s see how this is defined by looking inside <tt class="docutils literal"><span class="pre">fw_template.yaml</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>spec:
  _tasks:
  - _fw_name: TemplateWriterTask
    template_file: simple_template.txt
    context:
      opt1: 5.0
      opt2: fast method
    output_file: inputs.txt
</pre></div>
</div>
<p>Note that we have specified a <tt class="docutils literal"><span class="pre">template_file</span></tt>, a <tt class="docutils literal"><span class="pre">context</span></tt>, and an <tt class="docutils literal"><span class="pre">output_file</span></tt>. All three of these parameters are needed to use the <em>TemplateWriterTask</em>.</p>
</li>
<li><p class="first">In the Firework above, we are setting <strong>opt1</strong> to 5.0 and <strong>opt2</strong> to &#8220;fast method&#8221;. If we wanted to change these parameters, we can create a file like <tt class="docutils literal"><span class="pre">fw_template2.yaml</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>spec:
  _tasks:
  - _fw_name: TemplateWriterTask
    template_file: simple_template.txt
    context:
      opt1: 10.0
      opt2: stable method
    output_file: inputs.txt
</pre></div>
</div>
</li>
<li><p class="first">This second Firework is identical to the first, except that we have changed the value of variables <strong>opt1</strong> and <strong>opt2</strong>. Thus, we have only changed the parameter values we care about when creating a new Firework. In addition, one could easily perform searches based on <strong>opt1</strong> and <strong>opt2</strong> values using MongoDB&#8217;s built-in search capabilities.</p>
</li>
<li><p class="first">Let&#8217;s reset the database, add these FireWorks to the LaunchPad, and then execute them:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
lpad add fw_template.yaml
lpad add fw_template2.yaml
rlaunch --silencer rapidfire
</pre></div>
</div>
</li>
<li><p class="first">If all went well, you should have two <tt class="docutils literal"><span class="pre">launcher_</span></tt> subdirectories. Each directory contains a file called <tt class="docutils literal"><span class="pre">inputs.txt</span></tt> that uses the same template file but different Contexts to create unique input files. Recall from the <a class="reference internal" href="firetask_tutorial.html"><em>FireTask tutorial</em></a> that you could use a multi-task Firework to subsequently run a code that processes the input file to produce useful outputs.</p>
</li>
</ol>
</div>
<div class="section" id="a-more-advanced-template-if-then-and-for">
<h2>A more advanced template - <em>if/then</em> and <em>for</em><a class="headerlink" href="#a-more-advanced-template-if-then-and-for" title="Permalink to this headline">¶</a></h2>
<p>Template files are not restricted to simple variable substitutions with curly braces. You can also define <em>if/then</em> statements and <em>for loops</em> that process array-like items. This can make your templates more flexible, for example writing an input tag only if a certain variable is present in the Context.</p>
<ol class="arabic">
<li><p class="first">Staying in the template writer tutorial directory, look inside the file <tt class="docutils literal"><span class="pre">advanced_template_copy.txt</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>option1 = {{opt1}}
option2 = {{opt2}}

{% if optparam %}OPTIONAL PARAMETER
{{ optparam }}{% endif %}

LOOP PARAMETERS
{% for param in param_list %}{{ param }}
{% endfor %}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The actual template file is stored within the FireWorks code, so modifying this copy of a file won&#8217;t have any effect (more on this later in the tutorial).</p>
</div>
</li>
<li><p class="first">Note that this template contains some additional tags. In particular, in between <tt class="docutils literal"><span class="pre">{%</span></tt> and <tt class="docutils literal"><span class="pre">%}</span></tt> we have some code that contains <em>if/then</em> statements and a <em>for</em> loop.</p>
</li>
<li><p class="first">A Context for this template is in <tt class="docutils literal"><span class="pre">fw_advanced.yaml</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>spec:
  _tasks:
  - _fw_name: TemplateWriterTask
    context:
      opt1: 5.0
      opt2: fast method
      optparam: true
      param_list:
      - 1
      - 2
      - 3
      - 4
    output_file: inputs_advanced.txt
    template_file: advanced_template.txt
</pre></div>
</div>
</li>
<li><p class="first">Let&#8217;s run this Firework and examine what happens:</p>
<div class="highlight-python"><div class="highlight"><pre>lpad reset
    lpad add fw_advanced.yaml
    rlaunch --silencer singleshot
</pre></div>
</div>
</li>
<li><p class="first">You&#8217;ll notice that we&#8217;ve iterated over our loop, and the optional parameter is indeed written to <tt class="docutils literal"><span class="pre">inputs_advanced.txt</span></tt>.</p>
</li>
<li><p class="first">Now, try deleting the line containing the <tt class="docutils literal"><span class="pre">optparam</span></tt> and repeating the launch process. You&#8217;ll see that the lines pertaining to the <tt class="docutils literal"><span class="pre">OPTIONAL</span> <span class="pre">PARAMETER</span></tt> are no longer written!</p>
</li>
</ol>
<p>Therefore, with Jinja2&#8217;s templating language we can write fairly general templates. While variable substitutions, <em>if/then</em> statements, and <em>for loops</em> should cover the majority of cases, you can see even more features in the <a class="reference external" href="http://jinja.pocoo.org">official Jinja2 documentation</a>. For example, you can use template inheritance or insert templates into other templates.</p>
</div>
<div class="section" id="writing-your-own-templates">
<h2>Writing your own templates<a class="headerlink" href="#writing-your-own-templates" title="Permalink to this headline">¶</a></h2>
<p>When writing your own templates, you have a few options on where to store the templates so they can be read by FireWorks. Note that all the worker computers using the templates must have the most recent templates installed locally.</p>
<div class="section" id="option-1-the-user-objects-directory-of-the-fireworks-code">
<h3>Option 1: The user_objects directory of the FireWorks code<a class="headerlink" href="#option-1-the-user-objects-directory-of-the-fireworks-code" title="Permalink to this headline">¶</a></h3>
<p>The default place that FireWorks looks for templates is in the <tt class="docutils literal"><span class="pre">user_objects/firetasks/templates</span></tt> directory of your FireWorks installation. Indeed, the <tt class="docutils literal"><span class="pre">simple_template.txt</span></tt> and <tt class="docutils literal"><span class="pre">advanced_template.txt</span></tt> files used in this tutorial are stored there (that&#8217;s why modifying the tutorial files has no effect on the result). Any templates you put in this directory (or its subdirectories) will be read by FireWorks; just put the relative path of your template as the <tt class="docutils literal"><span class="pre">template_file</span></tt> parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not know how to find the correct directory, type <tt class="docutils literal"><span class="pre">lpad</span> <span class="pre">version</span></tt>. Then navigate to the install directory, then <tt class="docutils literal"><span class="pre">cd</span> <span class="pre">fireworks/user_objects/firetasks/templates</span></tt>.</p>
</div>
</div>
<div class="section" id="option-2-set-the-template-directory-in-fwconfig">
<h3>Option 2: Set the template directory in FWConfig<a class="headerlink" href="#option-2-set-the-template-directory-in-fwconfig" title="Permalink to this headline">¶</a></h3>
<p>If you do not want to store your templates within the FireWorks code, you can set a template directory in the <a class="reference internal" href="config_tutorial.html"><em>FWConfig</em></a>. Just set the parameter <tt class="docutils literal"><span class="pre">TEMPLATE_DIR</span></tt> to point to the location of your templates. Then the <tt class="docutils literal"><span class="pre">template_file</span></tt> parameter you pass to your FireWorks will be relative to this path. Remember to do this for all your workers!</p>
</div>
</div>
<div class="section" id="additional-options">
<h2>Additional options<a class="headerlink" href="#additional-options" title="Permalink to this headline">¶</a></h2>
<p>In addition to <tt class="docutils literal"><span class="pre">template_file</span></tt>, <tt class="docutils literal"><span class="pre">context</span></tt>, and <tt class="docutils literal"><span class="pre">output_file</span></tt>, the following options can be passed into <tt class="docutils literal"><span class="pre">TemplateWriterTask</span></tt>:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">append</span></tt> - append to the output file, rather than overwriting it</li>
<li><tt class="docutils literal"><span class="pre">template_dir</span></tt> - this is actually a third option for setting your template dir</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="the-use-global-spec-option">
<h2>The _use_global_spec option<a class="headerlink" href="#the-use-global-spec-option" title="Permalink to this headline">¶</a></h2>
<p>By default, the parameters for the TemplateWriterTask should be defined within the <tt class="docutils literal"><span class="pre">_task</span></tt> section of the <strong>spec</strong> corresponding to the TemplateWriterTask, not as a root key of the <strong>spec</strong>. If you&#8217;d like to instead specify the parameters in the root of the <strong>spec</strong>, you can set <tt class="docutils literal"><span class="pre">_use_global_spec</span></tt> to True within the <tt class="docutils literal"><span class="pre">_task</span></tt> section. Note that <tt class="docutils literal"><span class="pre">_use_global_spec</span></tt> can simplify querying and communication of parameters between FireWorks but can cause problems if you have multiple TemplateWriterTasks within the same Firework.</p>
</div>
<div class="section" id="python-example">
<h2>Python example<a class="headerlink" href="#python-example" title="Permalink to this headline">¶</a></h2>
<p>A runnable Python example illustrating the use of templates was given in the <a class="reference internal" href="firetask_tutorial.html"><em>FireTask tutorial</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using the TemplateWriterTask to write files</a><ul>
<li><a class="reference internal" href="#a-simple-template-variable-substitutions">A simple template - variable substitutions</a></li>
<li><a class="reference internal" href="#a-more-advanced-template-if-then-and-for">A more advanced template - <em>if/then</em> and <em>for</em></a></li>
<li><a class="reference internal" href="#writing-your-own-templates">Writing your own templates</a><ul>
<li><a class="reference internal" href="#option-1-the-user-objects-directory-of-the-fireworks-code">Option 1: The user_objects directory of the FireWorks code</a></li>
<li><a class="reference internal" href="#option-2-set-the-template-directory-in-fwconfig">Option 2: Set the template directory in FWConfig</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-options">Additional options</a></li>
<li><a class="reference internal" href="#the-use-global-spec-option">The _use_global_spec option</a></li>
<li><a class="reference internal" href="#python-example">Python example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="scripttask.html"
                        title="previous chapter">Using the ScriptTask to execute commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fileiotasks.html"
                        title="next chapter">Using the built-in FileIO Tasks</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/templatewritertask.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fileiotasks.html" title="Using the built-in FileIO Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="scripttask.html" title="Using the ScriptTask to execute commands"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 0.98 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53488807-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>