<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>“Packing” small jobs into larger ones with multi job launcher &mdash; FireWorks 0.99 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.99',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 0.99 documentation" href="index.html" />
    <link rel="next" title="Handling Duplicates Automatically" href="duplicates_tutorial.html" />
    <link rel="prev" title="Controlling the directory and Worker of execution" href="controlworker.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="duplicates_tutorial.html" title="Handling Duplicates Automatically"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controlworker.html" title="Controlling the directory and Worker of execution"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 0.99 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="packing-small-jobs-into-larger-ones-with-multi-job-launcher">
<h1>&#8220;Packing&#8221; small jobs into larger ones with multi job launcher<a class="headerlink" href="#packing-small-jobs-into-larger-ones-with-multi-job-launcher" title="Permalink to this headline">¶</a></h1>
<p>With today&#8217;s multiprocessor and multi-node machines, it&#8217;s possible to get a lot of computing done quickly by exploiting parallelism. If you have many independent workflows to run, FireWorks makes this process simple and automatic with the <strong>multi-job launcher</strong>. For example, you might want to simultaneously run 4 workflows over 4 cores, or 4 16-core parallel job workflows over 64 cores.</p>
<div class="section" id="parallelizing-serial-jobs-on-a-single-multicore-machine">
<h2>Parallelizing serial jobs on a single multicore machine<a class="headerlink" href="#parallelizing-serial-jobs-on-a-single-multicore-machine" title="Permalink to this headline">¶</a></h2>
<p>If you have a single machine (e.g. workstation or laptop) with multiple cores, it&#8217;s easy to use all your cores to execute your workflows in parallel. Simply add your workflows to the LaunchPad, and then type:</p>
<div class="highlight-python"><div class="highlight"><pre>mlaunch &lt;NP&gt;
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;NP&gt;</span></tt> is the number of processing cores. For example, <tt class="docutils literal"><span class="pre">mlaunch</span> <span class="pre">4</span></tt> would execute 4 workflows in parallel so that each core handles one workflow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">mlaunch</span></tt> command has several useful options. Type <tt class="docutils literal"><span class="pre">mlaunch</span> <span class="pre">-h</span></tt> to see them listed. In particular, the <tt class="docutils literal"><span class="pre">--nlaunches</span></tt> option configures how many jobs are run consecutively in serial per core.</p>
</div>
</div>
<div class="section" id="parallelizing-serial-jobs-over-several-interconnected-multicore-machines">
<h2>Parallelizing serial jobs over several (interconnected) multicore machines<a class="headerlink" href="#parallelizing-serial-jobs-over-several-interconnected-multicore-machines" title="Permalink to this headline">¶</a></h2>
<p>If you have several interconnected machines, you will need to install MPI to run jobs in parallel. Fortunately, the command to run serial jobs, one per processor, is simple after MPI installation:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;MPIEXEC&gt; -n &lt;NP&gt; rlaunch rapidfire
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;MPIEXEC&gt;</span></tt> is your MPI executable and <tt class="docutils literal"><span class="pre">&lt;NP&gt;</span></tt> is the <em>total</em> number of processors over all machines. Examples might be <tt class="docutils literal"><span class="pre">mpirun</span> <span class="pre">-n</span> <span class="pre">128</span> <span class="pre">rlaunch</span> <span class="pre">rapidfire</span></tt>, or <tt class="docutils literal"><span class="pre">mpiexec</span> <span class="pre">-n</span> <span class="pre">8</span> <span class="pre">rlaunch</span> <span class="pre">rapidfire</span></tt>, depending on your flavor of MPI.</p>
<p>If you are familiar with MPI and FireWorks, you will recognize that this mode of operation is nothing special; we are just submitting the <tt class="docutils literal"><span class="pre">rlaunch</span> <span class="pre">rapidfire</span></tt> command over all cores using MPI. The <tt class="docutils literal"><span class="pre">rlaunch</span> <span class="pre">rapidfire</span></tt> doesn&#8217;t do anything different when run through MPI (it is not parallelized). It is the same <tt class="docutils literal"><span class="pre">rlaunch</span> <span class="pre">rapidfire</span></tt> from the introductory tutorials, and you can give it any of the same options as normal.</p>
<p>One note about this method is that unlike the special <tt class="docutils literal"><span class="pre">mlaunch</span></tt> command, no attempt is made to minimize database connections or improve database performance by sharing data between processes. So, there may be a fundamental limit to how much you can scale, depending on the performance and settings of your MongoDB server.</p>
</div>
<div class="section" id="parallelizing-parallel-jobs-over-several-interconnected-multicore-machines">
<h2>Parallelizing parallel jobs over several (interconnected) multicore machines<a class="headerlink" href="#parallelizing-parallel-jobs-over-several-interconnected-multicore-machines" title="Permalink to this headline">¶</a></h2>
<p>Your workflow itself might involve executing a parallel code. This means that <em>somewhere</em> in your FireTask, an MPI executable like <tt class="docutils literal"><span class="pre">mpirun</span></tt>, <tt class="docutils literal"><span class="pre">mpi_exec</span></tt>, or <tt class="docutils literal"><span class="pre">aprun</span></tt> is being called. In this case, the basic command to type is:</p>
<div class="highlight-python"><div class="highlight"><pre>mlaunch &lt;NP/PPJOB&gt;
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;NP/PPJOB&gt;</span></tt> is the total number of processors <em>divided by</em> the number of processors per job. For example, if you have 64 total processors available and each of your workflows involves an <tt class="docutils literal"><span class="pre">mpiexec</span> <span class="pre">-n</span> <span class="pre">16</span></tt> command, you would type <tt class="docutils literal"><span class="pre">mlaunch</span> <span class="pre">4</span></tt> to set in motion 4 jobs that each will use 16 cores.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">mlaunch</span></tt> command has several useful options. Type <tt class="docutils literal"><span class="pre">mlaunch</span> <span class="pre">-h</span></tt> to see them listed. In particular, the <tt class="docutils literal"><span class="pre">--nlaunches</span></tt> option configures how many jobs are run consecutively in serial per parallel process.</p>
</div>
<div class="section" id="access-to-nodefile">
<h3>Access to nodefile<a class="headerlink" href="#access-to-nodefile" title="Permalink to this headline">¶</a></h3>
<p>If you need to access the NODEFILE from within your FireTask, you should modify the command to be:</p>
<div class="highlight-python"><div class="highlight"><pre>mlaunch &lt;NP/PPJOB&gt; --ppn &lt;PPN&gt; --nodefile &lt;NODEFILE&gt;
</pre></div>
</div>
<p>Here, <tt class="docutils literal"><span class="pre">NODEFILE</span></tt> is the location of your NODEFILE (or alternatively the name of an environment variable that points to your NODEFILE), and <tt class="docutils literal"><span class="pre">PPN</span></tt> is the number of processors per node. Then, inside your FireTask you will be able to access the parameters <tt class="docutils literal"><span class="pre">FWData().NODE_LIST</span></tt> and <tt class="docutils literal"><span class="pre">FWData().SUB_NPROCS</span></tt> to design your parallel run.</p>
</div>
</div>
<div class="section" id="using-multi-job-launching-with-a-queue">
<h2>Using multi job launching with a queue<a class="headerlink" href="#using-multi-job-launching-with-a-queue" title="Permalink to this headline">¶</a></h2>
<p>It is easy to configure your queue script so that each queued job runs multiple FireWorks in parallel. In your <tt class="docutils literal"><span class="pre">my_qadapter.yaml</span></tt> file, you should modify the <tt class="docutils literal"><span class="pre">rocket_launch</span></tt> key to be one of the <em>mlaunch</em> scripts described above (remember to add the number of jobs, e.g. <tt class="docutils literal"><span class="pre">mlaunch</span> <span class="pre">4</span></tt>, as well as config file paths). Then, when the queued job &#8220;wakes up&#8221; and starts running, it will execute multiple jobs using <tt class="docutils literal"><span class="pre">mlaunch</span></tt> instead of single job using the basic <tt class="docutils literal"><span class="pre">rlaunch</span></tt>.</p>
</div>
<div class="section" id="a-note-on-packing-and-heterogeneous-jobs">
<h2>A note on &#8220;packing&#8221; and heterogeneous jobs<a class="headerlink" href="#a-note-on-packing-and-heterogeneous-jobs" title="Permalink to this headline">¶</a></h2>
<p>The multi job launcher does not actually &#8220;pack&#8221; jobs the way a queue scheduler does. Rather, it just runs a fixed number of workflows in parallel. In particular,  the multi-job launcher is designed to simultaneously run workflows <em>with homogeneous computing requirements</em>. If your workflows are not homogeneous (e.g., some workflows require more processors than others), we suggest you set up your FireWorker for <tt class="docutils literal"><span class="pre">mlaunch</span></tt> so that it only pulls jobs with a fixed computing requirement. The FireWorker can be set using the <tt class="docutils literal"><span class="pre">-w</span></tt> or <tt class="docutils literal"><span class="pre">-c</span></tt> option of the <tt class="docutils literal"><span class="pre">mlaunch</span></tt> command, and the configuration for only pulling certain jobs is described in the <a class="reference internal" href="controlworker.html"><em>control tutorial</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">&#8220;Packing&#8221; small jobs into larger ones with multi job launcher</a><ul>
<li><a class="reference internal" href="#parallelizing-serial-jobs-on-a-single-multicore-machine">Parallelizing serial jobs on a single multicore machine</a></li>
<li><a class="reference internal" href="#parallelizing-serial-jobs-over-several-interconnected-multicore-machines">Parallelizing serial jobs over several (interconnected) multicore machines</a></li>
<li><a class="reference internal" href="#parallelizing-parallel-jobs-over-several-interconnected-multicore-machines">Parallelizing parallel jobs over several (interconnected) multicore machines</a><ul>
<li><a class="reference internal" href="#access-to-nodefile">Access to nodefile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-multi-job-launching-with-a-queue">Using multi job launching with a queue</a></li>
<li><a class="reference internal" href="#a-note-on-packing-and-heterogeneous-jobs">A note on &#8220;packing&#8221; and heterogeneous jobs</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="controlworker.html"
                        title="previous chapter">Controlling the directory and Worker of execution</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="duplicates_tutorial.html"
                        title="next chapter">Handling Duplicates Automatically</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/multi_job.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="duplicates_tutorial.html" title="Handling Duplicates Automatically"
             >next</a> |</li>
        <li class="right" >
          <a href="controlworker.html" title="Controlling the directory and Worker of execution"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 0.99 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53488807-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>