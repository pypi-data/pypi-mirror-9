# -*- mode: ruby -*-
# vi: set ft=ruby :
#@TODO
# sudo ln -s /opt/VBoxGuestAdditions-4.3.10/lib/VBoxGuestAdditions /usr/lib/VBoxGuestAdditions
# currently broken vbox guest additions on debian-wheezy64

$script = <<SCRIPT
echo Installing depedencies...
sudo apt-get install -y unzip git python-pip
echo Fetching Serf...
cd /tmp/
wget https://dl.bintray.com/mitchellh/serf/0.6.3_linux_amd64.zip -O serf.zip
echo Installing Serf...
unzip serf.zip
sudo chmod +x serf
sudo mv serf /usr/bin/serf
SCRIPT

Vagrant.configure(2) do |config|
    (1..3).each do |i|
        config.vm.define "node-#{i}" do |node|
            node.vm.box = "hashicorp/precise64"
            node.vm.provision "shell",
            inline: "echo hello from node #{i}"
            node.vm.network "private_network", ip: "172.20.20.1#{i}"
            node.vm.hostname = "node-#{i}"
            node.vm.provision "shell", inline: $script
            node.vm.synced_folder "./", "/opt/aboutyou/sph", create: true
            node.vm.synced_folder "./config/", "/etc/sph/", create: true
            # node.vm.synced_folder "./examples/", "/opt/aboutyou/sph/sph", create: true
            node.vm.provision "shell", inline: "cd /opt/aboutyou/sph && yes | pip install ."
        end

    end
end
