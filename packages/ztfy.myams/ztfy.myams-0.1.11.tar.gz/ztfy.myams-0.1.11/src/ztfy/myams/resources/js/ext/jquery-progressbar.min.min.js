(function(b){b.extend({progressBar:new function(){this.defaults={steps:20,step_duration:20,max:100,showText:true,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"/--static--/ztfy.jqueryui/img/progressbar.gif",barImage:{0:"/--static--/ztfy.jqueryui/img/progressbg_red.gif",30:"/--static--/ztfy.jqueryui/img/progressbg_orange.gif",70:"/--static--/ztfy.jqueryui/img/progressbg_green.gif"},running_value:0,value:0,image:null};this.construct=function(h,a){var g=null;var f=null;if(h!=null){if(!isNaN(h)){g=h;if(a!=null){f=a}}else{f=h}}return this.each(function(z){var r=this;var x=this.config;if(g!=null&&this.bar!=null&&this.config!=null){this.config.value=g;if(f!=null){r.config=b.extend(this.config,f)}x=r.config}else{var t=b(this);var x=b.extend({},b.progressBar.defaults,f);x.id=t.attr("id")?t.attr("id"):Math.ceil(Math.random()*100000);if(g==null){g=t.html().replace("%","")}x.value=g;x.running_value=0;x.image=u(x);t.html("");var v=document.createElement("img");var d=document.createElement("span");var y=b(v);var s=b(d);r.bar=y;y.attr("id",x.id+"_pbImage");s.attr("id",x.id+"_pbText");s.html(e(x));y.attr("title",e(x));y.attr("alt",e(x));y.attr("src",x.boxImage);y.attr("width",x.width);y.css("width",x.width+"px");y.css("height",x.height+"px");y.css("background-image","url("+x.image+")");y.css("background-position",((x.width*-1))+"px 50%");y.css("padding","0");y.css("margin","0");t.append(y);t.append(s)}function w(i){return i.running_value*100/i.max}function u(k){var i=k.barImage;if(typeof(k.barImage)=="object"){for(var j in k.barImage){if(w(k)>=parseInt(j)){i=k.barImage[j]}else{break}}}return i}function e(i){if(i.showText){if(i.textFormat=="percentage"){return" "+Math.round(i.running_value)+"%"}else{if(i.textFormat=="fraction"){return" "+i.running_value+"/"+i.max}}}}x.increment=Math.round((x.value-x.running_value)/x.steps);if(x.increment<0){x.increment*=-1}if(x.increment<1){x.increment=1}var c=setInterval(function(){var i=x.width/100;var m=false;if(x.running_value>x.value){if(x.running_value-x.increment<x.value){x.running_value=x.value}else{x.running_value-=x.increment}}else{if(x.running_value<x.value){if(x.running_value+x.increment>x.value){x.running_value=x.value}else{x.running_value+=x.increment}}}if(x.running_value==x.value){clearInterval(c)}var j=b("#"+x.id+"_pbImage");var l=b("#"+x.id+"_pbText");var k=u(x);if(k!=x.image){j.css("background-image","url("+k+")");x.image=k}j.css("background-position",(((x.width*-1))+(w(x)*i))+"px 50%");j.attr("title",e(x));l.html(e(x));if(x.callback!=null&&typeof(x.callback)=="function"){x.callback(x)}r.config=x},x.step_duration)})};this.submit=function(k){var l=b("input:file",k);if(l.length>0){var i=b("iframe[name=progress]",k);if(i.length>0){var m="";for(var n=0;n<32;n++){m+=Math.floor(Math.random()*16).toString(16)}var j=b(k).attr("action");if(old_id=/X-Progress-ID=([^&]+)/.exec(j)){j=j.replace(old_id[1],m)}else{j=j+"?X-Progress-ID="+m}b(k).attr("action",j);var a=b(i).get(0).contentWindow.updateUploadProgress;if(a){a(m);return m}}}}}});b.fn.extend({progressBar:b.progressBar.construct})})(jQuery);