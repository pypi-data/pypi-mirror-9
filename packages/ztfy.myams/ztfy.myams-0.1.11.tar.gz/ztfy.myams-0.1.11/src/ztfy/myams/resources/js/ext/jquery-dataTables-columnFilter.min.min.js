(function(b){b.fn.columnFilter=function(T){var V,C,N,P;var a="From {from} to {to}";var U=new Array();var Q=new Array();var B=null;var D=function(){};function K(e,q,n,h,m){if(typeof q=="undefined"){return new Array()}if(typeof n=="undefined"){n=true}if(typeof h=="undefined"){h=true}if(typeof m=="undefined"){m=true}var f;if(h==true){f=e.aiDisplay}else{f=e.aiDisplayMaster}var g=new Array();for(var c=0,o=f.length;c<o;c++){var p=f[c];var d=F.fnGetData(p);var l=d[q];if(m==true&&l.length==0){continue}else{if(n==true&&jQuery.inArray(l,g)>-1){continue}else{g.push(l)}}}return g.sort()}function E(c){if(O.bUseColVis){return c}else{return F.fnSettings().oApi._fnVisibleToColumnIndex(F.fnSettings(),c)}}function L(l,m,h,e,p,g){var d="text_filter";if(e){d="number_filter"}N=N.replace(/(^\s*)|(\s*$)/g,"");var c=l.fnSettings().aoPreSearchCols[C].sSearch;var f="search_init ";var q=N;if(c!=""&&c!="^"){if(e&&c.charAt(0)=="^"){q=c.substr(1)}else{q=c}f=""}var n=b('<input type="text" class="'+f+d+'" value="'+q+'" rel="'+C+'"/>');if(g!=undefined&&g!=-1){n.attr("maxlength",g)}P.html(n);if(e){P.wrapInner('<span class="filter_column filter_number" />')}else{P.wrapInner('<span class="filter_column filter_text" />')}V[C]=N;var o=C;if(e&&!l.fnSettings().oFeatures.bServerSide){n.keyup(function(){l.fnFilter("^"+this.value,E(o),true,false);D()})}else{n.keyup(function(){if(l.fnSettings().oFeatures.bServerSide&&p!=0){var t=l.fnSettings().aoPreSearchCols[o].sSearch;var s=b(this).data("dt-iLastFilterLength");if(typeof s=="undefined"){s=0}var r=this.value.length;if(Math.abs(r-s)<p){return}else{b(this).data("dt-iLastFilterLength",r)}}l.fnFilter(this.value,E(o),m,h);D()})}n.focus(function(){if(b(this).hasClass("search_init")){b(this).removeClass("search_init");this.value=""}});n.blur(function(){if(this.value==""){b(this).addClass("search_init");this.value=V[o]}})}function R(c){P.html(J(0));var f=c.attr("id")+"_range_from_"+C;var d=b('<input type="text" class="number_range_filter" id="'+f+'" rel="'+C+'"/>');P.append(d);P.append(J(1));var g=c.attr("id")+"_range_to_"+C;var e=b('<input type="text" class="number_range_filter" id="'+g+'" rel="'+C+'"/>');P.append(e);P.append(J(2));P.wrapInner('<span class="filter_column filter_number_range" />');var h=C;Q.push(C);c.dataTableExt.afnFiltering.push(function(m,o,p){if(c.attr("id")!=m.sTableId){return true}if(document.getElementById(f)==null){return true}var n=document.getElementById(f).value*1;var q=document.getElementById(g).value*1;var l=o[E(h)]=="-"?0:o[E(h)]*1;if(n==""&&q==""){return true}else{if(n==""&&l<=q){return true}else{if(n<=l&&""==q){return true}else{if(n<=l&&l<=q){return true}}}}return false});b("#"+f+",#"+g,P).keyup(function(){var l=document.getElementById(f).value*1;var m=document.getElementById(g).value*1;if(l!=0&&m!=0&&l>m){return}c.fnDraw();D()})}function I(c){var h=a.split(/[}{]/);P.html("");var f=c.attr("id")+"_range_from_"+C;var d=b('<input type="text" class="date_range_filter" id="'+f+'" rel="'+C+'"/>');d.datepicker();var g=c.attr("id")+"_range_to_"+C;var e=b('<input type="text" class="date_range_filter" id="'+g+'" rel="'+C+'"/>');for(ti=0;ti<h.length;ti++){if(h[ti]==O.sDateFromToken){P.append(d)}else{if(h[ti]==O.sDateToToken){P.append(e)}else{P.append(h[ti])}}}P.wrapInner('<span class="filter_column filter_date_range" />');e.datepicker();var l=C;Q.push(C);c.dataTableExt.afnFiltering.push(function(r,n,o){if(c.attr("id")!=r.sTableId){return true}var p=d.datepicker("getDate");var q=e.datepicker("getDate");if(p==null&&q==null){return true}var s=null;try{if(n[E(l)]==null||n[E(l)]==""){return false}s=b.datepicker.parseDate(b.datepicker.regional[""].dateFormat,n[E(l)])}catch(m){return false}if(s==null){return false}if(p==null&&s<=q){return true}else{if(p<=s&&q==null){return true}else{if(p<=s&&s<=q){return true}}}return false});b("#"+f+",#"+g,P).change(function(){c.fnDraw();D()})}function H(h,s,o,e,g,m,c){if(s==null){s=K(h.fnSettings(),o,true,false,true)}var n=o;var p=h.fnSettings().aoPreSearchCols[C].sSearch;if(p==null||p==""){p=c}var f='<select class="search_init select_filter" rel="'+C+'"><option value="" class="search_init">'+g+"</option>";var q=0;var d=s.length;for(q=0;q<d;q++){if(typeof(s[q])!="object"){var r="";if(escape(s[q])==p||escape(s[q])==escape(p)){r="selected "}f+="<option "+r+' value="'+escape(s[q])+'">'+s[q]+"</option>"}else{var r="";if(m){if(s[q].value==p){r="selected "}f+="<option "+r+'value="'+s[q].value+'">'+s[q].label+"</option>"}else{if(escape(s[q].value)==p){r="selected "}f+="<option "+r+'value="'+escape(s[q].value)+'">'+s[q].label+"</option>"}}}var l=b(f+"</select>");e.html(l);e.wrapInner('<span class="filter_column filter_select" />');l.change(function(){if(b(this).val()!=""){b(this).removeClass("search_init")}else{b(this).addClass("search_init")}if(m){h.fnFilter(b(this).val(),o,m)}else{h.fnFilter(unescape(b(this).val()),o)}D()});if(p!=null&&p!=""){h.fnFilter(unescape(p),o)}}function S(c,g,f,d){var e=c.fnSettings();if(g==null&&e.sAjaxSource!=""&&!e.oFeatures.bServerSide){e.aoDrawCallback.push({fn:(function(m,h,l){return function(){if(e.iDraw==2&&e.sAjaxSource!=null&&e.sAjaxSource!=""&&!e.oFeatures.bServerSide){return H(c,null,E(m),h,l,f,d)}}})(C,P,N),sName:"column_filter_"+C})}H(c,g,E(C),P,N,f,d)}function i(e){var f=C;var d='<div class="dropdown select_filter"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+N+'<b class="caret"></b></a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All</a></li>',g,h=e.length;for(g=0;g<h;g++){d+='<li data-value="'+e[g]+'"><a>'+e[g]+"</a></li>"}var c=b(d+"</ul></div>");P.html(c);P.wrapInner('<span class="filterColumn filter_select" />');c.find("li").click(function(){F.fnFilter(b(this).data("value"),f)})}function G(l,z){if(z==null){z=K(l.fnSettings(),C,true,true,true)}var u=C;var o="",g,h=z.length;var x=N.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("Â£","STERL").replace("@","AT").replace(/\s/g,"_");x=x.replace(/[^a-zA-Z 0-9]+/g,"");var n=N;if(O.sFilterButtonText!=null||O.sFilterButtonText!=undefined){n=O.sFilterButtonText}var e=10;var q=12;var r=Math.floor(h/q);if(h%q>0){r=r+1}var y=100/r-2;var t=e*r;if(r==1){y=20}var d='<div style="float:left; min-width: '+y+'%; " >';var c="</div>";var s=l.attr("id")+x;var v="chkBtnOpen"+s;var w=s+"-flt-toggle";o+='<button id="'+v+'" class="checkbox_filter" > '+n+"</button>";o+='<div id="'+w+'" title="'+N+'" rel="'+C+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+(t)+'%; " >';o+=d;for(g=0;g<h;g++){if(g%q==0&&g!=0){o+=c+d}var f=z[g];var A=z[g];if(typeof(z[g])=="object"){f=z[g].label;A=z[g].value}o+='<input class="search_init checkbox_filter" type="checkbox" id= "'+s+"_cb_"+A+'" name= "'+x+'" value="'+A+'" >'+f+"<br/>";var p=b(o);P.html(p);P.wrapInner('<span class="filter_column filter_checkbox" />');p.change(function(){var ab="";var aa="|";var Z=b('input:checkbox[name="'+x+'"]:checked').size();b('input:checkbox[name="'+x+'"]:checked').each(function(W){if((W==0&&Z==1)||(W!=0&&W==Z-1)){aa=""}ab=ab.replace(/^\s+|\s+$/g,"");ab=ab+b(this).val()+aa;aa="|"});if(ab!=""){b('input:checkbox[name="'+x+'"]').removeClass("search_init")}else{b('input:checkbox[name="'+x+'"]').addClass("search_init")}l.fnFilter(ab,u,true,false);D()})}b("#"+v).button();b("#"+w).dialog({autoOpen:false,hide:"blind",buttons:[{text:"Reset",click:function(){b('input:checkbox[name="'+x+'"]:checked').each(function(X){b(this).attr("checked",false);b(this).addClass("search_init")});l.fnFilter("",u,true,false);D();return false}},{text:"Close",click:function(){b(this).dialog("close")}}]});b("#"+v).click(function(){b("#"+w).dialog("open");var X=b(this);b("#"+w).dialog("widget").position({my:"top",at:"bottom",of:X});return false});var m=D;D=function(){var X=b("#"+v);b("#"+w).dialog("widget").position({my:"top",at:"bottom",of:X});m()}}function J(c){switch(c){case 0:return a.substring(0,a.indexOf("{from}"));case 1:return a.substring(a.indexOf("{from}")+6,a.indexOf("{to}"));default:return a.substring(a.indexOf("{to}")+4)}}var F=this;var M={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"};var O=b.extend(M,T);return this.each(function(){if(!F.fnSettings().oFeatures.bFilter){return}V=new Array();var e=F.fnSettings().aoFooter[0];var d=F.fnSettings().nTFoot;var g="tr";if(O.sPlaceHolder=="head:after"){var f=b("tr:first",F.fnSettings().nTHead).detach();if(F.fnSettings().bSortCellsTop){f.prependTo(b(F.fnSettings().nTHead));e=F.fnSettings().aoHeader[1]}else{f.appendTo(b(F.fnSettings().nTHead));e=F.fnSettings().aoHeader[0]}g="tr:last";d=F.fnSettings().nTHead}else{if(O.sPlaceHolder=="head:before"){if(F.fnSettings().bSortCellsTop){var f=b("tr:first",F.fnSettings().nTHead).detach();f.appendTo(b(F.fnSettings().nTHead));e=F.fnSettings().aoHeader[1]}else{e=F.fnSettings().aoHeader[0]}g="tr:first";d=F.fnSettings().nTHead}}b(e).each(function(m){C=m;var l={type:"text",bRegex:false,bSmart:true,iMaxLenght:-1,iFilterLength:0};if(O.aoColumns!=null){if(O.aoColumns.length<C||O.aoColumns[C]==null){return}l=O.aoColumns[C]}N=b(b(this)[0].cell).text();if(l.sSelector==null){P=b(b(this)[0].cell)}else{P=b(l.sSelector);if(P.length==0){P=b(b(this)[0].cell)}}if(l!=null){if(l.sRangeFormat!=null){a=l.sRangeFormat}else{a=O.sRangeFormat}switch(l.type){case"null":break;case"number":L(F,true,false,true,l.iFilterLength,l.iMaxLenght);break;case"select":if(l.bRegex!=true){l.bRegex=false}S(F,l.values,l.bRegex,l.selected);break;case"number-range":R(F);break;case"date-range":I(F);break;case"checkbox":G(F,l.values);break;case"twitter-dropdown":case"dropdown":i(l.values);break;case"text":default:bRegex=(l.bRegex==null?false:l.bRegex);bSmart=(l.bSmart==null?false:l.bSmart);L(F,bRegex,bSmart,false,l.iFilterLength,l.iMaxLenght);break}}});for(j=0;j<Q.length;j++){var h=function(){var l=F.attr("id");return b("#"+l+"_range_from_"+Q[j]).val()+O.sRangeSeparator+b("#"+l+"_range_to_"+Q[j]).val()};U.push(h)}if(F.fnSettings().oFeatures.bServerSide){var c=F.fnSettings().fnServerData;F.fnSettings().fnServerData=function(p,n,l){for(j=0;j<Q.length;j++){var o=Q[j];for(k=0;k<n.length;k++){if(n[k].name=="sSearch_"+o){n[k].value=U[j]()}}}n.push({name:"sRangeSeparator",value:O.sRangeSeparator});if(c!=null){try{c(p,n,l,F.fnSettings())}catch(m){c(p,n,l)}}else{b.getJSON(p,n,function(q){l(q)})}}}})}})(jQuery);