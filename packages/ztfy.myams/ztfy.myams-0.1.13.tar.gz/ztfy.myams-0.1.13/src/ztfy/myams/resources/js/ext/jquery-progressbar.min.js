(function(a){a.extend({progressBar:new function(){this.defaults={steps:20,step_duration:20,max:100,showText:true,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"/--static--/ztfy.jqueryui/img/progressbar.gif",barImage:{0:"/--static--/ztfy.jqueryui/img/progressbg_red.gif",30:"/--static--/ztfy.jqueryui/img/progressbg_orange.gif",70:"/--static--/ztfy.jqueryui/img/progressbg_green.gif"},running_value:0,value:0,image:null};this.construct=function(c,b){var d=null;var e=null;if(c!=null){if(!isNaN(c)){d=c;if(b!=null){e=b}}else{e=c}}return this.each(function(f){var n=this;var h=this.config;if(d!=null&&this.bar!=null&&this.config!=null){this.config.value=d;if(e!=null){n.config=a.extend(this.config,e)}h=n.config}else{var l=a(this);var h=a.extend({},a.progressBar.defaults,e);h.id=l.attr("id")?l.attr("id"):Math.ceil(Math.random()*100000);if(d==null){d=l.html().replace("%","")}h.value=d;h.running_value=0;h.image=k(h);l.html("");var j=document.createElement("img");var p=document.createElement("span");var g=a(j);var m=a(p);n.bar=g;g.attr("id",h.id+"_pbImage");m.attr("id",h.id+"_pbText");m.html(o(h));g.attr("title",o(h));g.attr("alt",o(h));g.attr("src",h.boxImage);g.attr("width",h.width);g.css("width",h.width+"px");g.css("height",h.height+"px");g.css("background-image","url("+h.image+")");g.css("background-position",((h.width*-1))+"px 50%");g.css("padding","0");g.css("margin","0");l.append(g);l.append(m)}function i(r){return r.running_value*100/r.max}function k(r){var t=r.barImage;if(typeof(r.barImage)=="object"){for(var s in r.barImage){if(i(r)>=parseInt(s)){t=r.barImage[s]}else{break}}}return t}function o(r){if(r.showText){if(r.textFormat=="percentage"){return" "+Math.round(r.running_value)+"%"}else{if(r.textFormat=="fraction"){return" "+r.running_value+"/"+r.max}}}}h.increment=Math.round((h.value-h.running_value)/h.steps);if(h.increment<0){h.increment*=-1}if(h.increment<1){h.increment=1}var q=setInterval(function(){var v=h.width/100;var r=false;if(h.running_value>h.value){if(h.running_value-h.increment<h.value){h.running_value=h.value}else{h.running_value-=h.increment}}else{if(h.running_value<h.value){if(h.running_value+h.increment>h.value){h.running_value=h.value}else{h.running_value+=h.increment}}}if(h.running_value==h.value){clearInterval(q)}var u=a("#"+h.id+"_pbImage");var s=a("#"+h.id+"_pbText");var t=k(h);if(t!=h.image){u.css("background-image","url("+t+")");h.image=t}u.css("background-position",(((h.width*-1))+(i(h)*v))+"px 50%");u.attr("title",o(h));s.html(o(h));if(h.callback!=null&&typeof(h.callback)=="function"){h.callback(h)}n.config=h},h.step_duration)})};this.submit=function(f){var e=a("input:file",f);if(e.length>0){var h=a("iframe[name=progress]",f);if(h.length>0){var d="";for(var c=0;c<32;c++){d+=Math.floor(Math.random()*16).toString(16)}var g=a(f).attr("action");if(old_id=/X-Progress-ID=([^&]+)/.exec(g)){g=g.replace(old_id[1],d)}else{g=g+"?X-Progress-ID="+d}a(f).attr("action",g);var b=a(h).get(0).contentWindow.updateUploadProgress;if(b){b(d);return d}}}}}});a.fn.extend({progressBar:a.progressBar.construct})})(jQuery);