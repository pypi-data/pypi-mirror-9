/* ColReorder 1.1.0
 * Â©2010-2014 SpryMedia Ltd - datatables.net/license
 */
(function(e,a,g){function f(l){var k=[];for(var j=0,h=l.length;j<h;j++){k[l[j]]=j}return k}function d(i,k,j){var h=i.splice(k,1)[0];i.splice(j,0,h)}function b(l,o,n){var k=[];for(var j=0,h=l.childNodes.length;j<h;j++){if(l.childNodes[j].nodeType==1){k.push(l.childNodes[j])}}var m=k[o];if(n!==null){l.insertBefore(m,k[n])}else{l.appendChild(m)}}$.fn.dataTableExt.oApi.fnColReorder=function(l,h,u){var t=$.fn.dataTable.Api?true:false;var p,m,o,y,x=l.aoColumns.length,w,n;if(h==u){return}if(h<0||h>=x){this.oApi._fnLog(l,1,"ColReorder 'from' index is out of bounds: "+h);return}if(u<0||u>=x){this.oApi._fnLog(l,1,"ColReorder 'to' index is out of bounds: "+u);return}var s=[];for(p=0,m=x;p<m;p++){s[p]=p}d(s,h,u);var v=f(s);for(p=0,m=l.aaSorting.length;p<m;p++){l.aaSorting[p][0]=v[l.aaSorting[p][0]]}if(l.aaSortingFixed!==null){for(p=0,m=l.aaSortingFixed.length;p<m;p++){l.aaSortingFixed[p][0]=v[l.aaSortingFixed[p][0]]}}for(p=0,m=x;p<m;p++){n=l.aoColumns[p];for(o=0,y=n.aDataSort.length;o<y;o++){n.aDataSort[o]=v[n.aDataSort[o]]}if(t){n.idx=v[n.idx]}}if(t){$.each(l.aLastSort,function(j,z){l.aLastSort[j].src=v[z.src]})}for(p=0,m=x;p<m;p++){n=l.aoColumns[p];if(typeof n.mData=="number"){n.mData=v[n.mData];l.oApi._fnColumnOptions(l,p,{})}}if(l.aoColumns[h].bVisible){var k=this.oApi._fnColumnIndexToVisible(l,h);var q=null;p=u<h?u:u+1;while(q===null&&p<x){q=this.oApi._fnColumnIndexToVisible(l,p);p++}w=l.nTHead.getElementsByTagName("tr");for(p=0,m=w.length;p<m;p++){b(w[p],k,q)}if(l.nTFoot!==null){w=l.nTFoot.getElementsByTagName("tr");for(p=0,m=w.length;p<m;p++){b(w[p],k,q)}}for(p=0,m=l.aoData.length;p<m;p++){if(l.aoData[p].nTr!==null){b(l.aoData[p].nTr,k,q)}}}d(l.aoColumns,h,u);d(l.aoPreSearchCols,h,u);for(p=0,m=l.aoData.length;p<m;p++){if(t){d(l.aoData[p].anCells,h,u)}else{if($.isArray(l.aoData[p]._aData)){d(l.aoData[p]._aData,h,u)}d(l.aoData[p]._anHidden,h,u)}}for(p=0,m=l.aoHeader.length;p<m;p++){d(l.aoHeader[p],h,u)}if(l.aoFooter!==null){for(p=0,m=l.aoFooter.length;p<m;p++){d(l.aoFooter[p],h,u)}}if(t){var r=new $.fn.dataTable.Api(l);r.rows().invalidate()}for(p=0,m=x;p<m;p++){$(l.aoColumns[p].nTh).off("click.DT");this.oApi._fnSortAttachListener(l,l.aoColumns[p].nTh,p)}$(l.oInstance).trigger("column-reorder",[l,{iFrom:h,iTo:u,aiInvertMapping:v}])};var c=function(j,i){var h=function(l,k){var m;if(j.fn.dataTable.Api){m=new j.fn.dataTable.Api(l).settings()[0]}else{if(l.fnSettings){m=l.fnSettings()}else{if(typeof l==="string"){if(j.fn.dataTable.fnIsDataTable(j(l)[0])){m=j(l).eq(0).dataTable().fnSettings()}}else{if(l.nodeName&&l.nodeName.toLowerCase()==="table"){if(j.fn.dataTable.fnIsDataTable(l.nodeName)){m=j(l.nodeName).dataTable().fnSettings()}}else{if(l instanceof jQuery){if(j.fn.dataTable.fnIsDataTable(l[0])){m=l.eq(0).dataTable().fnSettings()}}else{m=l}}}}}if(j.fn.dataTable.camelToHungarian){j.fn.dataTable.camelToHungarian(h.defaults,k||{})}this.s={dt:null,init:j.extend(true,{},h.defaults,k),fixed:0,fixedRight:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=m.oInstance.fnSettings();this.s.dt._colReorder=this;this._fnConstruct();m.oApi._fnCallbackReg(m,"aoDestroyCallback",j.proxy(this._fnDestroy,this),"ColReorder");return this};h.prototype={fnReset:function(){var l=[];for(var m=0,k=this.s.dt.aoColumns.length;m<k;m++){l.push(this.s.dt.aoColumns[m]._ColReorder_iOrigCol)}this._fnOrderColumns(l);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(n){if(n===g){var l=[];for(var m=0,k=this.s.dt.aoColumns.length;m<k;m++){l.push(this.s.dt.aoColumns[m]._ColReorder_iOrigCol)}return l}this._fnOrderColumns(f(n));return this},_fnConstruct:function(){var p=this;var k=this.s.dt.aoColumns.length;var o;if(this.s.init.iFixedColumns){this.s.fixed=this.s.init.iFixedColumns}this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0;if(this.s.init.fnReorderCallback){this.s.dropCallback=this.s.init.fnReorderCallback}for(o=0;o<k;o++){if(o>this.s.fixed-1&&o<k-this.s.fixedRight){this._fnMouseListener(o,this.s.dt.aoColumns[o].nTh)}this.s.dt.aoColumns[o]._ColReorder_iOrigCol=o}this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(q,r){p._fnStateSave.call(p,r)},"ColReorder_State");var l=null;if(this.s.init.aiOrder){l=this.s.init.aiOrder.slice()}if(this.s.dt.oLoadedState&&typeof this.s.dt.oLoadedState.ColReorder!="undefined"&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length){l=this.s.dt.oLoadedState.ColReorder}if(l){if(!p.s.dt._bInitComplete){var n=false;this.s.dt.aoDrawCallback.push({fn:function(){if(!p.s.dt._bInitComplete&&!n){n=true;var q=f(l);p._fnOrderColumns.call(p,q)}},sName:"ColReorder_Pre"})}else{var m=f(l);p._fnOrderColumns.call(p,m)}}else{this._fnSetColumnIndexes()}},_fnOrderColumns:function(l){if(l.length!=this.s.dt.aoColumns.length){this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.");return}for(var m=0,k=l.length;m<k;m++){var n=j.inArray(m,l);if(m!=n){d(l,n,m);this.s.dt.oInstance.fnColReorder(n,m)}}if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!==""){this.s.dt.oInstance.fnAdjustColumnSizing()}this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);this._fnSetColumnIndexes()},_fnStateSave:function(l){var m,k,n,o;var q=this.s.dt;for(m=0;m<l.aaSorting.length;m++){l.aaSorting[m][0]=q.aoColumns[l.aaSorting[m][0]]._ColReorder_iOrigCol}var p=j.extend(true,[],l.aoSearchCols);l.ColReorder=[];for(m=0,k=q.aoColumns.length;m<k;m++){o=q.aoColumns[m]._ColReorder_iOrigCol;l.aoSearchCols[o]=p[m];l.abVisCols[o]=q.aoColumns[m].bVisible;l.ColReorder.push(o)}},_fnMouseListener:function(k,m){var l=this;j(m).on("mousedown.ColReorder",function(n){n.preventDefault();l._fnMouseDown.call(l,n,m)})},_fnMouseDown:function(o,n){var l=this;var m=j(o.target).closest("th, td");var p=m.offset();var k=parseInt(j(n).attr("data-column-index"),10);if(k===g){return}this.s.mouse.startX=o.pageX;this.s.mouse.startY=o.pageY;this.s.mouse.offsetX=o.pageX-p.left;this.s.mouse.offsetY=o.pageY-p.top;this.s.mouse.target=this.s.dt.aoColumns[k].nTh;this.s.mouse.targetIndex=k;this.s.mouse.fromIndex=k;this._fnRegions();j(a).on("mousemove.ColReorder",function(q){l._fnMouseMove.call(l,q)}).on("mouseup.ColReorder",function(q){l._fnMouseUp.call(l,q)})},_fnMouseMove:function(o){var n=this;if(this.dom.drag===null){if(Math.pow(Math.pow(o.pageX-this.s.mouse.startX,2)+Math.pow(o.pageY-this.s.mouse.startY,2),0.5)<5){return}this._fnCreateDragNode()}this.dom.drag.css({left:o.pageX-this.s.mouse.offsetX,top:o.pageY-this.s.mouse.offsetY});var p=false;var l=this.s.mouse.toIndex;for(var m=1,k=this.s.aoTargets.length;m<k;m++){if(o.pageX<this.s.aoTargets[m-1].x+((this.s.aoTargets[m].x-this.s.aoTargets[m-1].x)/2)){this.dom.pointer.css("left",this.s.aoTargets[m-1].x);this.s.mouse.toIndex=this.s.aoTargets[m-1].to;p=true;break}}if(!p){this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x);this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to}if(this.s.init.bRealtime&&l!==this.s.mouse.toIndex){this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);this.s.mouse.fromIndex=this.s.mouse.toIndex;this._fnRegions()}},_fnMouseUp:function(l){var k=this;j(a).off("mousemove.ColReorder mouseup.ColReorder");if(this.dom.drag!==null){this.dom.drag.remove();this.dom.pointer.remove();this.dom.drag=null;this.dom.pointer=null;this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);this._fnSetColumnIndexes();if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!==""){this.s.dt.oInstance.fnAdjustColumnSizing()}if(this.s.dropCallback!==null){this.s.dropCallback.call(this)}this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)}},_fnRegions:function(){var l=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:j(this.s.dt.nTable).offset().left,to:0});var n=0;for(var m=0,k=l.length;m<k;m++){if(m!=this.s.mouse.fromIndex){n++}if(l[m].bVisible){this.s.aoTargets.push({x:j(l[m].nTh).offset().left+j(l[m].nTh).outerWidth(),to:n})}}if(this.s.fixedRight!==0){this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight)}if(this.s.fixed!==0){this.s.aoTargets.splice(0,this.s.fixed)}},_fnCreateDragNode:function(){var p=this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!=="";var m=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh;var l=m.parentNode;var n=l.parentNode;var k=n.parentNode;var o=j(m).clone();this.dom.drag=j(k.cloneNode(false)).addClass("DTCR_clonedTable").append(n.cloneNode(false).appendChild(l.cloneNode(false).appendChild(o[0]))).css({position:"absolute",top:0,left:0,width:j(m).outerWidth(),height:j(m).outerHeight()}).appendTo("body");this.dom.pointer=j("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:p?j("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:j(this.s.dt.nTable).offset().top,height:p?j("div.dataTables_scroll",this.s.dt.nTableWrapper).height():j(this.s.dt.nTable).height()}).appendTo("body")},_fnDestroy:function(){var l,k;for(l=0,k=this.s.dt.aoDrawCallback.length;l<k;l++){if(this.s.dt.aoDrawCallback[l].sName==="ColReorder_Pre"){this.s.dt.aoDrawCallback.splice(l,1);break}}j(this.s.dt.nTHead).find("*").off(".ColReorder");j.each(this.s.dt.aoColumns,function(m,n){j(n.nTh).removeAttr("data-column-index")});this.s.dt._colReorder=null;this.s=null},_fnSetColumnIndexes:function(){j.each(this.s.dt.aoColumns,function(k,l){j(l.nTh).attr("data-column-index",k)})}};h.defaults={aiOrder:null,bRealtime:false,iFixedColumns:0,iFixedColumnsRight:0,fnReorderCallback:null};h.version="1.1.0";j.fn.dataTable.ColReorder=h;j.fn.DataTable.ColReorder=h;if(typeof j.fn.dataTable=="function"&&typeof j.fn.dataTableExt.fnVersionCheck=="function"&&j.fn.dataTableExt.fnVersionCheck("1.9.3")){j.fn.dataTableExt.aoFeatures.push({fnInit:function(k){var m=k.oInstance;if(!k._colReorder){var n=k.oInit;var l=n.colReorder||n.oColReorder||{};new h(k,l)}else{m.oApi._fnLog(k,1,"ColReorder attempted to initialise twice. Ignoring second")}return null},cFeature:"R",sFeature:"ColReorder"})}else{alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download")}if(j.fn.dataTable.Api){j.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(k){k._colReorder.fnReset()})});j.fn.dataTable.Api.register("colReorder.order()",function(k){if(k){return this.iterator("table",function(l){l._colReorder.fnOrder(k)})}return this.context.length?this.context[0]._colReorder.fnOrder():null})}return h};c(jQuery,jQuery.fn.dataTable)})(window,document);