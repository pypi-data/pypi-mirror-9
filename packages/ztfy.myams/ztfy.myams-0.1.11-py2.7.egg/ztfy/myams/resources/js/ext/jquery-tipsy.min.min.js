(function(f){function e(a){if(a.attr("title")||typeof(a.attr("original-title"))!="string"){a.attr("original-title",a.attr("title")||"").removeAttr("title")}}function d(a,b){this.$element=f(a);this.options=b;this.enabled=true;e(this.$element)}d.prototype={show:function(){var l=this.getTitle();if(l&&this.enabled){var m=this.tip();m.find(".tipsy-inner")[this.options.html?"html":"text"](l);m[0].className="tipsy";m.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var a=f.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var p=m[0].offsetWidth,b=m[0].offsetHeight;var c=(typeof this.options.gravity=="function")?this.options.gravity.call(this.$element[0]):this.options.gravity;var n=(typeof this.options.offset=="function")?this.options.offset.call(this.$element[0]):this.options.offset;var o;switch(c.charAt(0)){case"n":o={top:a.top+a.height+n,left:a.left+a.width/2-p/2};break;case"s":o={top:a.top-b-n,left:a.left+a.width/2-p/2};break;case"e":o={top:a.top+a.height/2-b/2,left:a.left-p-n};break;case"w":o={top:a.top+a.height/2-b/2,left:a.left+a.width+n};break}if(c.length==2){if(c.charAt(1)=="w"){o.left=a.width<15?a.left+(a.width/2)-14:a.left-5}else{o.left=a.width<15?a.left+a.width-p+(a.width/2)+4:a.left+a.width-p+5}}o.left=Math.min(o.left,f("html").width()-p-10);m.css(o).addClass("tipsy-"+c);if(this.options.fade){m.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{m.css({visibility:"visible",opacity:this.options.opacity})}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){f(this).remove()})}else{this.tip().remove()}},getTitle:function(){var a,c=this.$element,b=this.options;e(c);var a,b=this.options;if(typeof b.title=="string"){a=c.attr(b.title=="title"?"original-title":b.title)}else{if(typeof b.title=="function"){a=b.title.call(c[0])}}a=(""+a).replace(/(^\s*|\s*$)/,"");return a||b.fallback},tip:function(){if(!this.$tip){this.$tip=f('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};f.fn.tipsy=function(c){if(c===true){return this.data("tipsy")}else{if(typeof c=="string"){return this.data("tipsy")[c]()}}c=f.extend({},f.fn.tipsy.defaults,c);function k(h){var g=f.data(h,"tipsy");if(!g){g=new d(h,f.fn.tipsy.elementOptions(h,c));f.data(h,"tipsy",g)}return g}function a(){var g=k(this);g.hoverState="in";if(c.delayIn==0){g.show()}else{setTimeout(function(){if(g.hoverState=="in"){g.show()}},c.delayIn)}}function l(){var g=k(this);g.hoverState="out";if(c.delayOut==0){g.hide()}else{setTimeout(function(){if(g.hoverState=="out"){g.hide()}},c.delayOut)}}if(!c.live){this.each(function(){k(this)})}if(c.trigger!="manual"){var n=c.live?"live":"bind",b=c.trigger=="hover"?"mouseenter":"focus",m=c.trigger=="hover"?"mouseleave":"blur";this[n](b,a)[n](m,l)}return this};f.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};f.fn.tipsy.elementOptions=function(a,b){return f.metadata?f.extend({},b,f(a).metadata()):b};f.fn.tipsy.autoNS=function(){return f(this).offset().top>(f(document).scrollTop()+f(window).height()/2)?"s":"n"};f.fn.tipsy.autoWE=function(){return f(this).offset().left>(f(document).scrollLeft()+f(window).width()/2)?"e":"w"}})(jQuery);