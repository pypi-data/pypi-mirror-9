!function(h){var f=function(a,b){this.init(a,b)};f.prototype={constructor:f,init:function(c,d){this.$element=h(c);this.options=h.extend({},h.fn.modalmanager.defaults,this.$element.data(),typeof d=="object"&&d);this.stack=[];this.backdropCount=0;if(this.options.resize){var a,b=this;h(window).on("resize.modal",function(){a&&clearTimeout(a);a=setTimeout(function(){for(var i=0;i<b.stack.length;i++){b.stack[i].isShown&&b.stack[i].layout()}},10)})}},createModal:function(a,b){h(a).modal(h.extend({manager:this},b))},appendModal:function(a){this.stack.push(a);var b=this;a.$element.on("show.modalmanager",e(function(c){var d=function(){a.isShown=true;var j=h.support.transition&&a.$element.hasClass("fade");b.$element.toggleClass("modal-open",b.hasOpenModal()).toggleClass("page-overflow",h(window).height()<b.$element.height());a.$parent=a.$element.parent();a.$container=b.createContainer(a);a.$element.appendTo(a.$container);b.backdrop(a,function(){a.$element.show();if(j){a.$element[0].offsetWidth}a.layout();a.$element.addClass("in").attr("aria-hidden",false);var i=function(){b.setFocus();a.$element.trigger("shown")};j?a.$element.one(h.support.transition.end,i):i()})};a.options.replace?b.replace(d):d()}));a.$element.on("hidden.modalmanager",e(function(d){b.backdrop(a);if(!a.$element.parent().length){b.destroyModal(a)}else{if(a.$backdrop){var c=h.support.transition&&a.$element.hasClass("fade");if(c){a.$element[0].offsetWidth}h.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(h.support.transition.end,function(){a.destroy()}):a.destroy()}else{a.destroy()}}b.removeContainer(a)}));a.$element.on("destroyed.modalmanager",e(function(c){b.destroyModal(a)}))},getOpenModals:function(){var a=[];for(var b=0;b<this.stack.length;b++){if(this.stack[b].isShown){a.push(this.stack[b])}}return a},hasOpenModal:function(){return this.getOpenModals().length>0},setFocus:function(){var a;for(var b=0;b<this.stack.length;b++){if(this.stack[b].isShown){a=this.stack[b]}}if(!a){return}a.focus()},destroyModal:function(a){a.$element.off(".modalmanager");if(a.$backdrop){this.removeBackdrop(a)}this.stack.splice(this.getIndexOfModal(a),1);var b=this.hasOpenModal();this.$element.toggleClass("modal-open",b);if(!b){this.$element.removeClass("page-overflow")}this.removeContainer(a);this.setFocus()},getModalAt:function(a){return this.stack[a]},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++){if(a===this.stack[b]){return b}}},replace:function(a){var b;for(var c=0;c<this.stack.length;c++){if(this.stack[c].isShown){b=this.stack[c]}}if(b){this.$backdropHandle=b.$backdrop;b.$backdrop=null;a&&b.$element.one("hidden",e(h.proxy(a,this)));b.hide()}else{if(a){a()}}},removeBackdrop:function(a){a.$backdrop.remove();a.$backdrop=null},createBackdrop:function(a,b){var c;if(!this.$backdropHandle){c=h(b).addClass(a).appendTo(this.$element)}else{c=this.$backdropHandle;c.off(".modalmanager");this.$backdropHandle=null;this.isLoading&&this.removeSpinner()}return c},removeContainer:function(a){a.$container.remove();a.$container=null},createContainer:function(b){var a;a=h('<div class="modal-scrollable">').css("z-index",g("modal",this.getOpenModals().length)).appendTo(this.$element);if(b&&b.options.backdrop!="static"){a.on("click.modal",e(function(c){b.hide()}))}else{if(b){a.on("click.modal",e(function(c){b.attention()}))}}return a},backdrop:function(c,a){var k=c.$element.hasClass("fade")?"fade":"",b=c.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(c.isShown&&b){var l=h.support.transition&&k&&!this.$backdropHandle;c.$backdrop=this.createBackdrop(k,c.options.backdropTemplate);c.$backdrop.css("z-index",g("backdrop",this.getOpenModals().length));if(l){c.$backdrop[0].offsetWidth}c.$backdrop.addClass("in");this.backdropCount+=1;l?c.$backdrop.one(h.support.transition.end,a):a()}else{if(!c.isShown&&c.$backdrop){c.$backdrop.removeClass("in");this.backdropCount-=1;var d=this;h.support.transition&&c.$element.hasClass("fade")?c.$backdrop.one(h.support.transition.end,function(){d.removeBackdrop(c)}):d.removeBackdrop(c)}else{if(a){a()}}}},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=false},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(a){a=a||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",h(window).height()<this.$element.height());if(!this.isLoading){this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate);this.$backdropHandle[0].offsetWidth;var d=this.getOpenModals();this.$backdropHandle.css("z-index",g("backdrop",d.length+1)).addClass("in");var b=h(this.options.spinner).css("z-index",g("modal",d.length+1)).appendTo(this.$element).addClass("in");this.$spinner=h(this.createContainer()).append(b).on("click.modalmanager",h.proxy(this.loading,this));this.isLoading=true;h.support.transition?this.$backdropHandle.one(h.support.transition.end,a):a()}else{if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var c=this;h.support.transition?this.$backdropHandle.one(h.support.transition.end,function(){c.removeLoading()}):c.removeLoading()}else{if(a){a(this.isLoading)}}}}};var g=(function(){var a,b={};return function(l,c){if(typeof a==="undefined"){var d=h('<div class="modal hide" />').appendTo("body"),k=h('<div class="modal-backdrop hide" />').appendTo("body");b.modal=+d.css("z-index");b.backdrop=+k.css("z-index");a=b.modal-b.backdrop;d.remove();k.remove();k=d=null}return b[l]+(a*c)}}());function e(a){return function(b){if(this===b.target){return a.apply(this,arguments)}}}h.fn.modalmanager=function(a,b){return this.each(function(){var c=h(this),d=c.data("modalmanager");if(!d){c.data("modalmanager",(d=new f(this,a)))}if(typeof a==="string"){d[a].apply(d,[].concat(b))}})};h.fn.modalmanager.defaults={backdropLimit:999,resize:true,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'};h.fn.modalmanager.Constructor=f;h(function(){h(document).off("show.bs.modal").off("hidden.bs.modal")})}(jQuery);