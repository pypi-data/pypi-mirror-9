(function(g){function e(a){if(a<10){a="0"+a}return a}function f(b,a){var r=new Date(b);var p=e(r.getMonth()+1);var n=e(r.getDate());var o=e(r.getFullYear());var d=e(r.getHours());var q=e(r.getMinutes());var c=e(r.getSeconds());return a.timestampFormat.replace(/%d%/g,n).replace(/%m%/g,p).replace(/%y%/g,o).replace(/%h%/g,hour).replace(/%i%/g,q).replace(/%s%/g,c)}function h(a,b){this.widget=a;this.options=g.extend({},MyAMSWidget.defaults,b);this.grid=this.widget.parents(this.options.grid);this.hasGrid=this.grid.exists();this.gridId=this.grid.attr("id");this.controls=this.options.controls;this.toggleClass=this.options.toggleClass.split("|");this.editClass=this.options.editClass.split("|");this.fullscreenClass=this.options.fullscreenClass.split("|");this.customClass=this.options.customClass.split("|");this.init()}h.prototype={init:function(){var P=this;if(P.options.rtl===true){g("body").addClass("rtl")}P.grid.each(function(){g(this).addClass("sortable-grid")});P._getSettings();if(P.hasGrid&&P.storage){if(P.position){var a=JSON.parse(P.position);for(var K in a.grid){var c=P.grid.find(P.options.subgrid+".sortable-grid").eq(K);for(var b in a.grid[K].section){c.append(g("#"+a.grid[K].section[b].id))}}}if(P.settings){var d=JSON.parse(P.settings);for(var K in d.widget){var V=d.widget[K];var D=g("#"+V.id);if(V.style){D.removeClassPrefix("ams-widget-color-").addClass(V.style).attr("data-widget-attstyle",V.style)}if(V.hidden==1){D.hide(1)}else{D.show(1).removeAttr("data-widget-hidden")}if(V.collapsed==1){D.addClass("ams-widget-collapsed").children("div").hide(1)}var H=D.children("header").children("h2");if(H.text()!=V.title){H.text(V.title)}}}}var V=P.widget;var M=V.data();var O={grid:M.amsWidgetGrid,subgrid:M.amsWudgetSubgrid,widgets:M.amsWidgetWidgets,controls:M.amsWidgetControls,storage:M.amsWidgetStorage,deleteSettingsKey:M.amsWidgetDeleteSettingsKey,deletePositionKey:M.amsWidgetDeletePositionKey,sortable:M.amsWidgetSortable,hiddenButtons:M.amsWidgetHiddenButtons,toggleButton:M.amsWidgetToggleButton,toggleClass:M.amsWidgetToggleClass,onToggle:MyAMS.getFunctionByName(M.amsWidgetToggleCallback),deleteButton:M.amsWidgetDeleteButton,deleteClass:M.amsWidgetDeleteClass,onDelete:MyAMS.getFunctionByName(M.amsWidgetDeleteCallback),editButton:M.amsWidgetEditButton,editPlaceholder:M.amsWidgetEditPlaceholder,editClass:M.amsWidgetEditClass,onEdit:MyAMS.getFunctionByName(M.amsWidgetEditCallback),fullscreenButton:M.amsWidgetFullscreenButton,fullscreenClass:M.amsWidgetFullscreenClass,fullscreenDiff:M.amsWidgetFullscreenDiff,onFullscreen:MyAMS.getFunctionByName(M.amsWidgetFullscreenCallback),customButton:M.amsWidgetCustomButton,customClass:M.amsWidgetCustomClass,customStart:MyAMS.getFunctionByName(M.amsWidgetCustomStartCallback),customEnd:MyAMS.getFunctionByName(M.amsWidgetCustomEndCallback),buttonsOrder:M.amsWidgetButtonsOrder,opacity:M.amsWidgetOpacity,dragHandle:M.amsWidgetDragHandle,placeholderClass:M.amsWidgetPlaceholderClass,indicator:M.amsWidgetIndicator,indicatorTime:M.amsWidgetIndicatorTime,ajax:M.amsWidgetAjax,timestampPlaceholder:M.amsWidgetTimestampPlaceholder,timestampFormat:M.amsWidgetTimestampFormat,refreshButton:M.amsWidgetRefreshButton,refreshClass:M.amsWidgetRefreshClass,errorLabel:M.amsWidgetErrorLabel,updatedLabel:M.amsWidgetUpdatedLabel,refreshLabel:M.amsWidgetRefreshLabel,deleteLabel:M.amsWidgetDeleteLabel,afterLoad:MyAMS.getFunctionByName(M.amsWidgetAfterLoadCallback),rtl:M.amsWidgetRtl,onChange:MyAMS.getFunctionByName(M.amsWidgetChangeCallback),onSave:MyAMS.getFunctionByName(M.amsWidgetSaveCallback),ajax_nav:MyAMS.ajax_nav};var E=g.extend({},P.options,O);var G=V.children("header");if(!G.parent().attr("role")){if(M.widgetHidden===true){V.hide()}if(M.widgetCollapsed===true){V.addClass("ams-widget-collapsed").children("div").hide()}if(E.customButton&&(M.widgetCustombutton===undefined)&&(P.customClass[0].length!=0)){var I='<a href="#" class="button-icon ams-widget-custom-btn"><i class="'+P.customClass[0]+'"></i></a>'}else{I=""}if(E.deleteButton&&(M.widgetDeleteButton===undefined)){var N='<a href="#" class="button-icon ams-widget-delete-btn hint" title="'+MyAMSWidget.i18n.DELETE_BTN+'" data-ams-hint-gravity="s"><i class="'+E.deleteClass+'"></i></a>'}else{N=""}if(E.editButton&&(M.widgetEditButton===undefined)){var U=E.editClass.split("|")[0];var S='<a href="#" class="button-icon ams-widget-edit-btn hint" title="'+MyAMSWidget.i18n.EDIT_BTN+'" data-ams-hint-gravity="s"><i class="'+U+'"></i></a>'}else{S=""}if(E.fullscreenButton&&(M.widgetFullscreenButton===undefined)){var R=E.fullscreenClass.split("|")[0];var W='<a href="#" class="button-icon ams-widget-fullscreen-btn hint" title="'+MyAMSWidget.i18n.FULLSCREEN_BTN+'" data-ams-hint-gravity="s"><i class="'+R+'"></i></a>'}else{W=""}if(E.toggleButton&&(M.widgetToggleButton===undefined)){var J=E.toggleClass.split("|");if((V.dataWidgetCollapsed===true)||V.hasClass("ams-widget-collapsed")){var X=J[1]}else{X=J[0]}var Q='<a href="#" class="button-icon ams-widget-toggle-btn hint" title="'+MyAMSWidget.i18n.COLLAPSE_BTN+'" data-ams-hint-gravity="s"><i class="'+X+'"></i></a>'}else{Q=""}if(E.refreshButton&&(M.widgetRefreshButton===undefined)&&M.widgetLoad){var L='<a href="#" class="button-icon ams-widget-refresh-btn hint" title="'+MyAMSWidget.i18n.REFRESH_BTN+'" data-loading-text="&nbsp;&nbsp;'+MyAMSWidget.i18n.LOADING_MSG+'&nbsp;" data-ams-hint-gravity="s"><i class="'+E.refreshClass+'"></i></a>'}else{L=""}var F=E.buttonsOrder.replace(/%refresh%/,L).replace(/%custom%/,I).replace(/%edit%/,S).replace(/%toggle%/,Q).replace(/%fullscreen%/,W).replace(/%delete%/,N);if(L||I||S||Q||W||N){G.prepend('<div class="ams-widget-ctrls">'+F+"</div>")}if(E.sortable&&(M.widgetSortable===undefined)){V.addClass("ams-widget-sortable")}var T=V.find(E.editPlaceholder);if(T.length>0){T.find("input").val(g.trim(G.children("h2").text()))}G.append('<span class="ams-widget-loader"><i class="fa fa-refresh fa-spin"></i></span>');V.attr("role","widget").children("div").attr("role","content").prev("header").attr("role","heading").children("div").attr("role","menu");MyAMS.plugins.enabled.hint(G)}V.data("widget-options",E);if(P.options.hiddenButtons){g(P.controls).hide()}V.find("[data-widget-load]").each(function(){var k=g(this),i=k.children(),j=k.data("widget-load"),l=k.data("widget-refresh")*1000,m=i;if(k.find(".ams-widget-ajax-placeholder").length<=0){k.children("widget-body").append('<div class="ams-widget-ajax-placeholder">'+P.options.loadingLabel+"</div>");if(l>0){P.loadAjaxFile(k,j,i);setInterval(function(){P._loadAjaxFile(k,j,i)},l)}else{P._loadAjaxFile(k,j,i)}}});if(P.options.hiddenButtons){P.widget.children("header").hover(function(){g(this).children(P.controls).stop(true,true).fadeTo(100,1)},function(){g(this).children(P.controls).stop(true,true).fadeTo(100,0)})}P._setClickEvents();g(P.options.deleteSettingsKey).on(P.clickEvent,this,function(i){if(P.storage){var j=confirm(P.options.settingsKeyLabel);if(j){P.storage.removeItem(P.settingsKey)}}i.preventDefault()});g(P.options.deletePositionKey).on(P.clickEvent,this,function(i){if(P.storage){var j=confirm(P.options.positionKeyLabel);if(j){P.storage.removeItem(P.positionKey)}}i.preventDefault()});if(P.storage){if(P.settingsKey===null||P.settingsKey.length<1){P._saveWidgetSettings()}if(P.positionKey===null||P.positionKey.length<1){P._saveWidgetPosition()}}P.grid.data("ams-widgets-loaded",true)},destroy:function(){var a=this;a.widgets.off("click",a._setClickEvents());a.element.removeData("AMSWidget")},_getSettings:function(){var a=this;if(!a.hasGrid||!a.gridId){a.storage=null}else{switch(a.options.storage){case"local":a.storage=localStorage;break;case"session":a.storage=sessionStorage;break;default:a.storage=null}}var b=(a.storage!=null)&&function(){var j,d=+new Date;try{a.storage.setItem(d,d);j=a.storage.getItem(d)==d;a.storage.removeItem(d);return j}catch(c){}}();if(b){a.settingsKey="AMS_settings_"+location.pathname+location.hash+"_"+a.gridId;a.settings=a.storage.getItem(a.settingsKey);a.positionKey="AMS_position_"+location.pathname+location.hash+"_"+a.gridId;a.position=a.storage.getItem(a.positionKey)}if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){a.clickEvent="touchstart"}else{a.clickEvent="click"}},_runLoaderWidget:function(a){var b=this;if(b.options.indicator){a.find(".ams-widget-loader").stop(true,true).fadeIn(100).delay(b.options.indicatorTime).fadeOut(100)}},_loadAjaxFile:function(b,a,c){MyAMS.skin.loadURL(b,a.find(".widget-body"))},_saveWidgetSettings:function(){var b=this;b._getSettings();if(b.storage){var c=[];b.grid.find(b.options.widgets).each(function(){var d=g(this);var j={};j.id=d.attr("id");j.style=d.attr("data-widget-attstyle");j.title=d.children("header").children("h2").text();j.hidden=d.is(":hidden")?1:0;j.collapsed=d.hasClass("ams-widget-collapsed")?1:0;c.push(j)});var a=JSON.stringify({widget:c});if(b.settings!=a){b.storage.setItem(b.settingsKey,a)}if(typeof(b.options.onSave)=="function"){b.options.onSave.call(this,null,c)}}},_saveWidgetPosition:function(){var b=this;b._getSettings();if(b.storage){var a=[];b.grid.find(b.options.subgrid+".sortable-grid").each(function(){var j=[];g(this).children(b.options.widgets).each(function(){var i={};i.id=g(this).attr("id");j.push(i)});var d={section:j};a.push(d)});var c=JSON.stringify({grid:a});if(b.position!=c){b.storage.setItem(b.positionKey,c)}if(typeof(b.options.onSave)=="function"){b.options.onSave.call(this,null,a)}}},_setClickEvents:function(){function a(){if(g("#ams-widget-fullscreen-mode").length>0){var d=g("#ams-widget-fullscreen-mode").find(b.options.widgets);var c=g(window).height();var j=d.children("header").height();d.children("div").height(c-j-15)}}var b=this;b._getSettings();b.widget.on(b.clickEvent,".ams-widget-toggle-btn",function(d){d.preventDefault();var o=g(this);var n=o.parents(b.options.widgets);var c=n.data("widget-options");var p=c.toggleClass.split("|");b._runLoaderWidget(n);var m=true;if(n.hasClass("ams-widget-collapsed")){if(c.onToggle){m=c.onToggle.call(this,n,"expand")}if(m!==false){o.children().removeClass(p[1]).addClass(p[0]);n.removeClass("ams-widget-collapsed").children("[role=content]").slideDown(c.toggleSpeed,function(){b._saveWidgetSettings()})}}else{if(c.onToggle){m=c.onToggle.call(this,n,"collapse")}if(m!==false){o.children().removeClass(p[0]).addClass(p[1]);n.addClass("ams-widget-collapsed").children("[role=content]").slideUp(c.toggleSpeed,function(){b._saveWidgetSettings()})}}});b.widget.on("dblclick","header",function(c){g(".ams-widget-toggle-btn",this).click()});b.widget.on(b.clickEvent,".ams-widget-fullscreen-btn",function(d){d.preventDefault();var o=g(this);var m=o.parents(b.options.widgets);var c=m.data("widget-options");var p=c.fullscreenClass.split("|");var n=m.children("div");b._runLoaderWidget(m);if(g("#ams-widget-fullscreen-mode").length>0){g(".nooverflow").removeClass("nooverflow");m.unwrap("<div>").children("div").removeAttr("style").end().find(".ams-widget-fullscreen-btn").children().removeClass(p[1]).addClass(p[0]).parents(b.controls).children("a").show();if(n.hasClass("ams-widget-visible")){n.hide().removeClass("ams-widget-visible")}}else{g("body").addClass("nooverflow");m.wrap('<div id="ams-widget-fullscreen-mode"></div>').parent().find(".ams-widget-fullscreen-btn").children().removeClass(p[0]).addClass(p[1]).parents(b.controls).children("a:not(.ams-widget-fullscreen-btn)").hide();if(n.is(":hidden")){n.show().addClass("ams-widget-visible")}}a();if(typeof(c.onFullscreen)=="function"){c.onFullscreen.call(this,m)}});g(window).resize(function(){a()});b.widget.on(b.clickEvent,".ams-widget-edit-btn",function(m){m.preventDefault();var o=g(this);var n=o.parents(b.options.widgets);var c=n.data("widget-options");var p=c.editClass.split("|");b._runLoaderWidget(n);var d=n.find(c.editPlaceholder);if(d.is(":visible")){o.children().removeClass(p[1]).addClass(p[0]);d.slideUp(c.editSpeed,function(){b._saveWidgetSettings()})}else{o.children().removeClass(p[0]).addClass(p[1]);d.slideDown(c.editSpeed)}if(typeof(c.onEdit)=="function"){c.onEdit.call(this,n)}});g(b.options.editPlaceholder).find("input").keyup(function(){g(this).parents(b.options.widgets).children("header").children("h2").text(g(this).val())});b.widget.on(b.clickEvent,".ams-widget-custom-btn",function(d){d.preventDefault();var n=g(this);var l=n.parents(b.options.widgets);var c=l.data("widget-options");var m=c.customClass.split("|");b._runLoaderWidget(l);if(n.children("."+m[0]).length>0){n.children().removeClass(m[0]).addClass(m[1]);if(typeof(c.customStart)=="function"){c.customStart.call(this,l)}}else{n.children("."+m[1]).addClass(m[0]);if(typeof(c.customEnd)=="function"){c.customEnd.call(this,l)}}b._saveWidgetSettings()});b.widget.on(b.clickEvent,".ams-widget-delete-btn",function(n){n.preventDefault();var p=g(this);var o=p.parents(b.options.widgets);var c=o.data("widget-options");var d=o.attr("id");var m=o.children("header").children("h2").text();MyAMS.ajax.check(MyAMS.notify,MyAMS.baseURL+"myams-notify"+(MyAMS.devmode?".js":".min.js"),function(){MyAMS.notify.messageBox({title:'<i class="fa fa-times" style="color: #ed1c24;"></i> '+c.deleteLabel+' "'+m+'"',content:MyAMSWidget.i18n.DELETE_MSG,buttons:"["+MyAMS.i18n.BTN_OK+"]["+MyAMS.i18n.BTN_CANCEL+"]"},function(i){if(i==MyAMS.i18n.BTN_OK){b._runLoaderWidget(o);g("#"+d).fadeOut(c.deleteSpeed,function(){p.remove();if(typeof(c.onDelete)=="function"){c.onDelete.call(this,o)}})}})})});b.widget.on(b.clickEvent,".ams-widget-refresh-btn",function(c){c.preventDefault();var m=g(this);var l=m.parents(b.options.widgets);var d=l.data("widget-load");var n=l.children();m.button("loading");n.addClass("widget-body-ajax-loading");setTimeout(function(){m.button("reset");n.removeClass("widget-body-ajax-loading");b._loadAjaxFile(l,d,n)},1000)})}};MyAMSWidget={i18n:g.extend({SETTINGS_KEY_LABEL:"Reset settings?",POSITION_KEY_LABEL:"Reset position?",TIMESTAMP_FORMAT:"Last update: %d%/%m%/%y% %h%:%i%:%s",ERROR_LABEL:"An error occured: ",UPDATED_LABEL:"Last update: ",REFRESH_LABEL:"Refresh",EDIT_BTN:"Edit title",DELETE_BTN:"Delete",DELETE_LABEL:"Remove component: ",DELETE_MSG:"WARNING: this action can't be undone!",FULLSCREEN_BTN:"Fullscreen",COLLAPSE_BTN:"Collapse",REFRESH_BTN:"Reload content",LOADING_MSG:"Loading..."},MyAMS.plugins.i18n.widgets),initWidgetsGrid:function(b){if(!b.exists()){return}var c=g(".ams-widget:first",b).data("AMSWidget").options;if(c.sortable&&g.ui){var a=b.find(".sortable-grid").not("[data-widget-excludegrid]");a.sortable({items:a.find(".ams-widget-sortable"),connectWith:a,placeholder:c.placeholderClass,cursor:"move",revert:true,opacity:c.opacity,delay:200,cancel:".button-icon, #ams-widget-fullscreen-mode >div",zIndex:10000,handle:c.dragHandle,forcePlaceholderSize:true,forceHelperSize:true,update:function(l,d){var k=d.item.data("AMSWidget");k._runLoaderWidget(k.widget);k._saveWidgetPosition();if(typeof(c.onChange)=="function"){c.onChange.call(this,d.item)}}})}}};MyAMSWidget.defaults={grid:".ams-widget-grid",subgrid:"section",widgets:".ams-widget",controls:".ams-widget-ctrls",storage:"local",deleteSettingsKey:"",settingsKeyLabel:MyAMSWidget.i18n.SETTINGS_KEY_LABEL,deletePositionKey:"",positionKeyLabel:MyAMSWidget.i18n.POSITION_KEY_LABEL,sortable:true,hiddenButtons:false,toggleButton:true,toggleClass:"fa fa-minus|fa fa-plus",toggleSpeed:200,onToggle:null,deleteButton:false,deleteClass:"fa fa-times",deleteSpeed:200,onDelete:null,editButton:false,editPlaceholder:".ams-widget-editbox",editClass:"fa fa-cog|fa fa-save",editSpeed:200,onEdit:null,fullscreenButton:false,fullscreenClass:"fa fa-expand|fa fa-compress",fullscreenDiff:3,onFullscreen:null,customButton:false,customClass:"folder-10|next-10",customStart:null,customEnd:null,buttonsOrder:"%refresh% %custom% %edit% %toggle% %fullscreen% %delete%",opacity:1,dragHandle:"> header",placeholderClass:"ams-widget-placeholder",indicator:true,indicatorTime:600,ajax:true,timestampPlaceholder:".ams-widget-timestamp",timestampFormat:MyAMSWidget.i18n.TIMESTAMP_FORMAT,refreshButton:true,refreshButtonClass:"fa fa-refresh",errorLabel:MyAMSWidget.i18n.ERROR_LABEL,updatedLabel:MyAMSWidget.i18n.UPDATED_LABEL,refreshLabel:MyAMSWidget.i18n.REFRESH_LABEL,deleteLabel:MyAMSWidget.i18n.DELETE_LABEL,afterLoad:null,rtl:false,onChange:null,onSave:null,ajax_nav:MyAMS.ajax_nav};g.fn.extend({MyAMSWidget:function(a){return this.each(function(){var b=g(this);var c=b.data("AMSWidget");if(!c){var m=b.parents(a.grid||MyAMSWidget.defaults.grid);var d={};if(m.exists()){var n=m.data();d={grid:n.amsWidgetGrid,subgrid:n.amsWidgetSubgrid,controls:n.amsWidgetControls,storage:n.amsWidgetStorage,deleteSettingsKey:n.amsWidgetDeleteSettingsKey,deletePositionKey:n.amsWidgetDeletePositionKey,sortable:n.amsWidgetSortable,hiddenButtons:n.amsWidgetHiddenButtons,toggleButton:n.amsWidgetToggleButton,toggleClass:n.amsWidgetToggleClass,onToggle:MyAMS.getFunctionByName(n.amsWidgetToggleCallback),deleteButton:n.amsWidgetDeleteButton,deleteClass:n.amsWidgetDeleteClass,onDelete:MyAMS.getFunctionByName(n.amsWidgetDeleteCallback),editButton:n.amsWidgetEditButton,editPlaceholder:n.amsWidgetEditPlaceholder,editClass:n.amsWidgetEditClass,onEdit:MyAMS.getFunctionByName(n.amsWidgetEditCallback),fullscreenButton:n.amsWidgetFullscreenButton,fullscreenClass:n.amsWidgetFullscreenClass,fullscreenDiff:n.amsWidgetFullscreenDiff,onFullscreen:MyAMS.getFunctionByName(n.amsWidgetFullscreenCallback),customButton:n.amsWidgetCustomButton,customClass:n.amsWidgetCustomClass,customStart:MyAMS.getFunctionByName(n.amsWidgetCustomStartCallback),customEnd:MyAMS.getFunctionByName(n.amsWidgetCustomStartCallback),buttonsOrder:n.amsWidgetButtonsOrder,opacity:n.amsWidgetOpacity,dragHandle:n.amsWidgetDragHandle,placeholderClass:n.amsWidgetPlaceholderClass,indicator:n.amsWidgetIndicator,indicatorTime:n.amsWidgetIndicatorTime,ajax:n.amsWidgetAjax,timestampPlaceholder:n.amsWidgetTimestampPlaceholder,timestampFormat:n.amsWidgetTimestampFormat,refreshButton:n.amsWidgetRefreshButton,refreshClass:n.amsWidgetRefreshClass,errorLabel:n.amsWidgetErrorLabel,updatedLabel:n.amsWidgetUpdatedLabel,refreshLabel:n.amsWidgetRefreshLabel,deleteLabel:n.amsWidgetDeleteLabel,afterLoad:MyAMS.getFunctionByName(n.amsWidgetAfterLoadCallback),rtl:n.amsWidgetRtl,onChange:MyAMS.getFunctionByName(n.amsWidgetChangeCallback),onSave:MyAMS.getFunctionByName(n.amsWidgetSaveCallback),ajax_nav:MyAMS.ajax_nav}}var l=g.fn.extend({},d,b.data("ams-widget-options")||{},a);b.data("AMSWidget",new h(b,l))}})}})})(jQuery);