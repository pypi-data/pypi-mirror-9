'\" t
.\"     Title: cdist-troubleshooting
.\"    Author: Nico Schottelius <nico-cdist--@--schottelius.org>
.\" Generator: DocBook XSL Stylesheets v1.78.1 <http://docbook.sf.net/>
.\"      Date: 02/10/2015
.\"    Manual: \ \&
.\"    Source: \ \&
.\"  Language: English
.\"
.TH "CDIST\-TROUBLESHOOTI" "7" "02/10/2015" "\ \&" "\ \&"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
cdist-troubleshooting \- common problems and their solutions
.SH "ERROR IN MANIFEST IS NOT CONSIDERED AN ERROR BY CDIST"
.sp
Situation: You are executing other scripts from a manifest\&. This script fails, but cdist does not recognise the error\&. An example script would be something like this:
.sp
.if n \{\
.RS 4
.\}
.nf
% cat ~/\&.cdist/manifest/init
"$__manifest/special"
% cat ~/\&.cdist/manifest/special
#!/bin/sh
echo "Here is an unclean exiting script"
somecommandthatdoesnotexist
echo "I continue here although previous command failed"
.fi
.if n \{\
.RE
.\}
.sp
We can clearly see that \fBsomecommandthatdoesnotexist\fR will fail in ~/\&.cdist/manifest/special\&. But as the custom script is not called with the \-e flag (exit on failure) of shell, it does not lead to an error\&. And thus cdist sees the exit 0 code of the last echo line instead of the failing command\&.
.sp
All scripts executed by cdist carry the \-e flag\&. To prevent the above from happening, there are three solutions available, two of which can be used in the calling script:
.sp
.if n \{\
.RS 4
.\}
.nf
# Execute as before, but abort on failure
sh \-e "$__manifest/special"

# Source the script in our namespace, runs in a set \-e environment:
\&. "$__manifest/special"
.fi
.if n \{\
.RE
.\}
.sp
The third solution is to include a shebang header in every script you write to use the \-e flag:
.sp
.if n \{\
.RS 4
.\}
.nf
% cat ~/\&.cdist/manifest/special
#!/bin/sh \-e
\&.\&.\&.
.fi
.if n \{\
.RE
.\}
.SH "SEE ALSO"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist(1)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist\-tutorial(7)
.RE
.SH "COPYING"
.sp
Copyright (C) 2013 Nico Schottelius\&. Free use of this software is granted under the terms of the GNU General Public License version 3 (GPLv3)\&.
.SH "AUTHOR"
.PP
\fBNico Schottelius\fR <\&nico\-cdist\-\-@\-\-schottelius\&.org\&>
.RS 4
Author.
.RE
