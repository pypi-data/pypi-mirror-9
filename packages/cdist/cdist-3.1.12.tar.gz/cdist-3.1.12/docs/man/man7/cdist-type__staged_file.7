'\" t
.\"     Title: cdist-type__staged_file
.\"    Author: Steven Armstrong <steven-cdist--@--armstrong.cc>
.\" Generator: DocBook XSL Stylesheets v1.78.1 <http://docbook.sf.net/>
.\"      Date: 03/19/2015
.\"    Manual: \ \&
.\"    Source: \ \&
.\"  Language: English
.\"
.TH "CDIST\-TYPE__STAGED_" "7" "03/19/2015" "\ \&" "\ \&"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
cdist-type__staged_file \- manage staged files
.SH "DESCRIPTION"
.sp
Manages a staged file that is downloaded on the server (the machine running cdist) and then deployed to the target host using the __file type\&.
.SH "REQUIRED PARAMETERS"
.PP
source
.RS 4
the URL from which to retreive the source file\&. e\&.g\&.
https://dl\&.bintray\&.com/mitchellh/consul/0\&.4\&.1_linux_amd64\&.zipfile:///path/to/local/file
.RE
.PP
cksum
.RS 4
the output of running the command:
cksum $source\-file
e\&.g\&. $ echo foobar > /tmp/foobar $ cksum /tmp/foobar 857691210 7 /tmp/foobar If either checksum or file size has changed the file will be (re)fetched from the \-\-source\&. The file name can be omitted and is ignored if given\&.
.RE
.SH "OPTIONAL PARAMETERS"
.PP
fetch\-command
.RS 4
the command used to fetch the staged file using printf formatting\&. Where a single %s will be replaced with the value of the given \-\-source parameter\&. The \-\-fetch\-command is expected to output the fetched file to stdout\&. Defaults to
\fIcurl \-s \-L "%s"\fR\&.
.RE
.PP
group
.RS 4
see cdist\-type__file
.RE
.PP
owner
.RS 4
see cdist\-type__file
.RE
.PP
mode
.RS 4
see cdist\-type__file
.RE
.PP
prepare\-command
.RS 4
the optional command used to prepare or preprocess the staged file for later use by the file type\&. If given, it must be a string in printf formatting where a single %s will be replaced with the last segment (filename) of the value of the given \-\-source parameter\&. It is executed in the same directory into which the fetched file has been saved\&. The \-\-prepare\-command is expected to output the final file to stdout\&.
.sp
.if n \{\
.RS 4
.\}
.nf
   So for example given a \-\-source of https://example\&.com/my\-zip\&.zip, and a
   \-\-prepare\-command of \*(Aqunzip \-p "%s"\*(Aq, the code `unzip \-p "my\-zip\&.zip"` will
   be executed in the folder containing the downloaded file my\-zip\&.zip\&.
   A more complex example might be \-\-prepare\-command \*(Aqtar \-xz "%s"; cat path/from/archive\*(Aq
stage\-dir::
   the directory in which to store downloaded and prepared files\&.
   Defaults to \*(Aq/var/tmp/cdist/__staged_file\*(Aq
state::
   see cdist\-type__file
.fi
.if n \{\
.RE
.\}
.RE
.SH "EXAMPLES"
.sp
.if n \{\
.RS 4
.\}
.nf
__staged_file /usr/local/bin/consul \e
   \-\-source file:///path/to/local/copy/consul \e
   \-\-cksum \*(Aq428915666 15738724\*(Aq \e
   \-\-state present \e
   \-\-group root \e
   \-\-owner root \e
   \-\-mode 755

__staged_file /usr/local/bin/consul \e
   \-\-source https://dl\&.bintray\&.com/mitchellh/consul/0\&.4\&.1_linux_amd64\&.zip \e
   \-\-cksum \*(Aq428915666 15738724\*(Aq \e
   \-\-fetch\-command \*(Aqcurl \-s \-L "%s"\*(Aq \e
   \-\-prepare\-command \*(Aqunzip \-p "%s"\*(Aq \e
   \-\-state present \e
   \-\-group root \e
   \-\-owner root \e
   \-\-mode 755
.fi
.if n \{\
.RE
.\}
.SH "SEE ALSO"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist\-type(7)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist\-type__file(7)
.RE
.SH "COPYING"
.sp
Copyright (C) 2015 Steven Armstrong\&. Free use of this software is granted under the terms of the GNU General Public License version 3 (GPLv3)\&.
.SH "AUTHOR"
.PP
\fBSteven Armstrong\fR <\&steven\-cdist\-\-@\-\-armstrong\&.cc\&>
.RS 4
Author.
.RE
