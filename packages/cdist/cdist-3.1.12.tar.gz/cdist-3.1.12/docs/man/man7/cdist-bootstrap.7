'\" t
.\"     Title: cdist-bootstrap
.\"    Author: Nico Schottelius <nico-cdist--@--schottelius.org>
.\" Generator: DocBook XSL Stylesheets v1.78.1 <http://docbook.sf.net/>
.\"      Date: 02/10/2015
.\"    Manual: \ \&
.\"    Source: \ \&
.\"  Language: English
.\"
.TH "CDIST\-BOOTSTRAP" "7" "02/10/2015" "\ \&" "\ \&"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
cdist-bootstrap \- setup cdist environment
.SH "INTRODUCTION"
.sp
This document describes the usual steps recommended for a new cdist setup\&. It is recommended that you have read and understood cdist\-quickstart(7) before digging into this\&.
.SH "LOCATION"
.sp
First of all, you should think about where to store your configuration database and who will be accessing or changing it\&. Secondly you have to think about where to configure your hosts from, which may be a different location\&.
.sp
For starters, having cdist (which includes the configuration database) on your notebook should be fine\&. Additionally an external copy of the git repository the configuration relies on is recommended, for use as backup as well as to allow easy collaboration with others\&.
.sp
For more sophisticated setups developing cdist configurations with multiple people, have a look at cdist\-best\-practice(7)\&.
.SH "SETUP WORKING DIRECTORY AND BRANCH"
.sp
I assume you have a fresh copy of the cdist tree in ~/cdist, cloned from one of the official urls (see cdist\-quickstart(7) if you don\(cqt)\&. Entering the command "git branch" should show you "* master", which indicates you are on the \fBmaster\fR branch\&.
.sp
The master branch reflects the latest development of cdist\&. As this is the development branch, it may or may not work\&. There are also version branches available, which are kept in a stable state\&. Let\(cqs use \fBgit branch \-r\fR to list all branches:
.sp
.if n \{\
.RS 4
.\}
.nf
cdist% git branch \-r
  origin/1\&.0
  origin/1\&.1
  origin/1\&.2
  origin/1\&.3
  origin/1\&.4
  origin/1\&.5
  origin/1\&.6
  origin/1\&.7
  origin/2\&.0
  origin/HEAD \-> origin/master
  origin/archive_shell_function_approach
  origin/master
.fi
.if n \{\
.RE
.\}
.sp
So \fB2\&.0\fR is the latest version branch in this example\&. All versions (2\&.0\&.x) within one version branch (2\&.0) are compatible to each other and won\(cqt break your configuration when updating\&.
.sp
It\(cqs up to you to decide which branch you want to base your own work on: master contains more recent changes, newer types, but may also break\&. The version branches are stable, but may lack the latest features\&. Your decision can be changed later on, but may result in merge conflicts, which you will need to solve\&.
.sp
Let\(cqs assume you want latest stuff and select the master branch as base for your own work\&. Now it\(cqs time to create your branch, which contains your local changes\&. I usually name it by the company/area I am working for: ethz\-systems, localch, customerX, \&... But this is pretty much up to you\&.
.sp
In this tutorial I use the branch \fBmycompany\fR:
.sp
.if n \{\
.RS 4
.\}
.nf
cdist% git checkout \-b mycompany origin/master
Branch mycompany set up to track remote branch master from origin\&.
Switched to a new branch \*(Aqmycompany\*(Aq
cdist\-user% git branch
  master
* mycompany
.fi
.if n \{\
.RE
.\}
.sp
From now on, you can use git as usual to commit your changes in your own branch\&.
.SH "PUBLISHING THE CONFIGURATION"
.sp
Usually a development machine like a notebook should be considered temporary only\&. For this reason and to enable shareability, the configuration should be published to another device as early as possible\&. The following example shows how to publish the configuration to another host that is reachable via ssh and has git installed:
.sp
.if n \{\
.RS 4
.\}
.nf
# Create bare git repository on the host named "loch"
cdist% ssh loch "GIT_DIR=/home/nutzer/cdist git init"
Initialized empty Git repository in /home/nutzer/cdist/

# Add remote git repo to git config
cdist% git remote add loch loch:/home/nutzer/cdist

# Configure the mycompany branch to push to loch
cdist% git config branch\&.mycompany\&.remote loch

# Configure mycompany branch to push into remote master branch
cdist% git config branch\&.mycompany\&.merge refs/heads/master

# Push mycompany branch to remote branch master initially
cdist% git push loch mycompany:refs/heads/master
.fi
.if n \{\
.RE
.\}
.sp
Now you have setup the git repository to synchronise the \fBmycompany\fR branch with the \fBmaster\fR branch on the host \fBloch\fR\&. Thus you can commit as usual in your branch and push out changes by entering \fB\fBgit push\fR\fR\&.
.SH "UPDATING FROM ORIGIN"
.sp
Whenever you want to update your cdist installation, you can use git to do so:
.sp
.if n \{\
.RS 4
.\}
.nf
# Update git repository with latest changes from origin
cdist% git fetch origin

# Update current branch with master branch from origin
cdist% git merge origin/master

# Alternative: Update current branch with 2\&.0 branch from origin
cdist% git merge origin/2\&.0
.fi
.if n \{\
.RE
.\}
.SH "SEE ALSO"
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist(1)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
cdist\-tutorial(7)
.RE
.SH "COPYING"
.sp
Copyright (C) 2012 Nico Schottelius\&. Free use of this software is granted under the terms of the GNU General Public License version 3 (GPLv3)\&.
.SH "AUTHOR"
.PP
\fBNico Schottelius\fR <\&nico\-cdist\-\-@\-\-schottelius\&.org\&>
.RS 4
Author.
.RE
