(function(a){a.fn.mesh=function(c){var f=a.extend({validatingMsg:"Validating metadata ...",validMetadataMsg:"The metadata is valid!",invalidMetadataMsg:"The metadata s not valid!",submitButtonLabel:"Submit changes",closeButtonLabel:"Cancel",noMessageAlert:"Please write a commit message",noTOUAcceptedAlert:"You must accept the terms of use"},c),b=1,e=function(h,g){var i="dialog-"+b+"-commit-msg",j=['<div title="Commit dialog">',"<div><h2>"+f.validatingMsg+"</h2>",'<p class="spinner"></p>','<div class="requestResults">','<label for="'+i+'">'+f.noMessageAlert+":</label>",'<input type="text" id="'+i+'" name="'+i+'" style="width: 90%" />',"<p>and review your changes</p>",'<div style="overflow: auto;"></div>',"</div>","</div>","</div>"];b+=1;return a(j.join("")).appendTo(h).dialog({autoOpen:false,modal:true,width:600,height:400,open:g})},d=new Spinner({lines:12,length:7,width:4,radius:10,color:"#000",speed:1,trail:60,shadow:false});return this.each(function(){var p=this,r=a(p),g=null,o=null,m=null,i=null,n=null,k=null,l=null,j=null,q=null,h=null;n=function(){var s=g.height()-m.position().top;m.height(s)};l=function(t,u,s){d.stop();g.find("h2").text(f.validMetadataMsg);g.find("#dialog-commit-msg").val("");m.html(t);o.find("label,input,p").show();o.show();n();g.dialog("option","buttons",[{text:f.submitButtonLabel,click:q},{text:f.closeButtonLabel,click:h}])};j=function(s,u,t){d.stop();g.find("h2").text(f.invalidMetadataMsg);m.html(s.responseText);o.find(">label,>input,>p").hide();o.show();n();g.dialog("option","buttons",[{text:f.closeButtonLabel,click:h}])};q=function(){var s=g.find("input[type=text]").val();s=a.trim(s);if(s===""){window.alert(f.noMessageAlert);a("#dialog-commit-msg").focus();return}i.val(s);r.submit();g.dialog("close")};h=function(){g.find(".errorlist").each(function(s,t){var u=a(t).attr("id").replace("-errors","");r.find("#id_"+u).parent().prepend(t)});g.find(".ui-state-error").parent().insertAfter("#header");g.dialog("close")};k=function(s,t){a(".ui-state-error").parent().remove();a(".errorlist").remove();g.dialog("option","buttons",[{text:f.closeButtonLabel,click:h}]);o.hide();g.find("h2").text(f.validatingMsg);d.spin(g.find(".spinner").get(0));g.find(".spinner > div").width(0);i.val("commit message");if(r.find("input[type=file]").size()>0){r.ajaxSubmit({dataType:"html",success:l,error:j})}else{a.ajax({url:r.attr("action"),type:"POST",data:r.serialize(),dataType:"html",success:l,error:j})}};g=e(r,k);o=g.find(".requestResults");m=o.find("div");i=r.find(".commitMessage");i.parent().hide();r.find("input[type=submit]").click(function(s){s.preventDefault();g.dialog("open")})})}}(jQuery));