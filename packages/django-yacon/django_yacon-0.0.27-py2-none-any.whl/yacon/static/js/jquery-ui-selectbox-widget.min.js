(function(a,b){a.widget("ui.selectbox",{options:{appendTo:"body",height:1.4,position:{my:"left top",at:"left bottom",collision:"none"}},_create:function(){var e=this;var c=this.element.hide();var d=this.input=a("<input/>").insertAfter(c).addClass("ui-autocomplete-input ui-widget ui-widget-content ui-corner-left").attr({readonly:true,autocomplete:"off",role:"textbox","aria-selectbox":"list","aria-haspopup":"true"}).css({height:""+this.options.height+"em",lineHeight:""+this.options.height+"em"}).bind("keydown.selectbox",function(g){if(e.options.disabled){return}var h=a.ui.keyCode;switch(g.keyCode){case h.PAGE_UP:e._move("previousPage",g);break;case h.PAGE_DOWN:e._move("nextPage",g);break;case h.UP:e._move("previous",g);g.preventDefault();break;case h.DOWN:e._move("next",g);g.preventDefault();break;case h.ENTER:case h.NUMPAD_ENTER:if(e.menu.element.is(":visible")){g.preventDefault()}case h.TAB:if(!e.menu.active){return}e.menu.select(g);break;case h.ESCAPE:e.close(g);break;default:break}}).bind("focus.selectbox",function(g){if(e.options.disabled){return}e.selectedItem=null;e.previous=e.element.val();d.addClass("ui-corner-tl").removeClass("ui-corner-left");f.addClass("ui-state-focus ui-corner-tr").removeClass("ui-corner-right");e.open(g)}).bind("blur.selectbox",function(g){if(e.options.disabled){return}f.removeClass("ui-state-focus");d.addClass("ui-corner-left").removeClass("ui-corner-tl");f.addClass("ui-corner-right").removeClass("ui-state-focus ui-corner-tr");e.closing=setTimeout(function(){e.close(g);e._change(g)},150)});var f=this.button=a("<button>&nbsp;</button>").insertAfter(d).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").height(d.outerHeight()).children(".ui-button-text").css({height:""+this.options.height+"em",lineHeight:""+this.options.height+"em"}).parent().css({overflow:"hidden"}).position({my:"left center",at:"right center",of:d,offset:"-1 0"}).click(function(g){if(e.menu.element.is(":visible")){e.close(g)}else{d.focus()}return false});this.refresh()},refresh:function(){var c=this;var d=this.element[0].ownerDocument;if(this.menu!==b){this.menu.element.remove()}this.menu=a("<ul></ul>").css({opacity:0}).appendTo(a(this.options.appendTo||"body",d)[0]).mousedown(function(e){var f=c.menu.element[0];if(e.target===f){setTimeout(function(){a(document).one("mousedown",function(g){if(g.target!==c.element[0]&&g.target!==f&&!a.ui.contains(f,g.target)){c.close()}})},1)}setTimeout(function(){clearTimeout(c.closing)},13)}).menu({focus:function(f,g){var e=g.item.data("item.selectbox");if(false!==c._trigger("focus",null,{item:e})){if(/^key/.test(f.originalEvent.type)){c.element.val(e.value)}}},selected:function(g,h){var f=h.item.data("item.selectbox"),e=c.previous;if(c.element[0]!==d.activeElement){c.element.focus();c.previous=e}if(false!==c._trigger("select",g,{item:f})){c.input.val(f.innerHTML);c.element.val(f.value).change()}c.close(g);c.selectedItem=f},blur:function(e,f){}}).removeClass("ui-corner-all").addClass("ui-corner-bottom ui-autocomplete").zIndex(this.element.zIndex()+1).css({top:0,left:0}).data("menu");this._renderMenu(this.element.get(0).options);this.menu.element.outerWidth(Math.max(this.menu.element.width("").outerWidth(),this.input.outerWidth()+this.button.outerWidth()-1)).position(a.extend({of:this.input},this.options.position)).hide().css({opacity:1});if(a.fn.bgiframe){this.menu.element.bgiframe()}},destroy:function(){this.input.remove();this.button.remove();this.element.removeClass("ui-autocomplete-input ui-widget ui-widget-content ui-corner-left").removeAttr("autocomplete").removeAttr("readonly").removeAttr("role").removeAttr("aria-selectbox").removeAttr("aria-haspopup").show();this.menu.element.remove();a.Widget.prototype.destroy.call(this)},_setOption:function(c,d){a.Widget.prototype._setOption.apply(this,arguments);if(c==="source"){this._initSource()}if(c==="appendTo"){this.menu.element.appendTo(a(d||"body",this.element[0].ownerDocument)[0])}},open:function(c){clearTimeout(this.closing);if(!this.menu.element.is(":visible")){this._trigger("open",c);this.menu.deactivate();this.menu.refresh();this.menu.element.show()}},close:function(c){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this._trigger("close",c);this.menu.element.hide();this.menu.deactivate();this.input.blur()}},_change:function(c){if(this.previous!==this.element.val()){this._trigger("change",c,{item:this.selectedItem})}},_renderMenu:function(d){var e=this.menu.element.empty().zIndex(this.element.zIndex()+1),f,g;var c=this;a.each(d,function(h,i){if(i.selected){c.input.val(i.innerHTML)}c._renderItem(e,i)});this.menu.deactivate();this.menu.refresh()},_renderItem:function(c,d){return a("<li></li>").data("item.selectbox",d).append(a("<a></a>").text(d.innerHTML)).appendTo(c)},_move:function(d,c){if(!this.menu.element.is(":visible")){this.search(null,c);return}if(this.menu.first()&&/^previous/.test(d)||this.menu.last()&&/^next/.test(d)){this.menu.deactivate();return}this.menu[d](c)},widget:function(){return this.menu.element}})}(jQuery));