{% extends "djmicrosip_cotizador\base.html" %}
{% block title %}Cotizacion{% endblock %}

<!-- CSS Code -->
{% block style_css %}
<link rel="stylesheet" href="{{ STATIC_URL}}djmicrosip_cotizador/css/cotizar.css">
<link rel="stylesheet" href="{{STATIC_URL}}djmicrosip_organizador/css/style.min.css" />
{% endblock %}

<!-- JavaScript Code -->
{% block js_code %}
{% include 'autocomplete_light/static.html' %}
<script src='{{STATIC_URL}}js/jquery.formset.js'></script>
<script>
$(function() {
  $('#id_detalles_data tbody tr').formset({
    prefix: '{{ formset.prefix }}',
    addCssClass:'btn btn-success',
    addText:'Nuevo detalle',
    deleteText:'',
    added: foco_detalle,
    removed: get_total,
  });
});
</script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.checkbox.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.contextmenu.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.dnd.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.search.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.sort.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.state.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.types.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.unique.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/jstree/jstree.wholerow.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/manage_tree.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/manage_tags.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/cotizar/custom.jstree.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/cotizar/custom.articles.js"></script>
<script src="{{STATIC_URL}}djmicrosip_cotizador/js/cotizar/cotizador.js"></script>
{% endblock %}

{% block breadcrumb %}{{ block.super }} {% endblock %}
{% block content %}


<form  name="formulario" method="post" class="form-horizontal" action="" width="300px"  enctype='multipart/form-data'>{% csrf_token %}
  {{ form.errors }}

  
  <div class="page-header row">
    <div class="row">
      <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"></div>
      <div class="col-lg-3 col-md-11 col-sm-11 col-xs-11"><h1>Cotizacion </h1></div>
      <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12">
        <div class="row">
          <div class="col-lg-3 col-md-3 col-sm-3">
            <!-- Large modal --> <br>
          </div>
          <div class="col-lg-3 col-md-3 col-sm-3">
            <strong>Tipo de Cambio:</strong><br>
            <input type="text" id="id_tipo_cambio_d" value="{{tipo_cambio_dls}}" size="10" class="form-control">
          </div>
          <div class="col-lg-3 col-md-3 col-sm-3">
            <strong>Lista de Precio:</strong> <br>
            <select id="select_lista_precios" class="form-control">
              <option value="-">-----</option>
              {% for lista_precio in listas_precios %}
              <option value="{{lista_precio.id}}">{{lista_precio.nombre}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-lg-3 col-md-3 col-sm-3">
            <strong>Moneda:</strong> <br>
            <select id="select_monedas" class="form-control">
              <option value="-">-----</option>
              {% for moneda in monedas %}
              <option value="{{moneda.id}}">{{moneda.nombre}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  <input type="hidden" value="{{ estructura_id }}" name="folders" id="estructuraId" />
  <div id="cotiza">
    <table class="table tableCell table-hover table-bordered" id="id_detalles_data">
      <thead>
        <tr>
          <th class="col-xs-4">Articulo</th>
          <th class="col-xs-1">Cant</th>
          <th class="col-xs-2">Precio</th>
          <th class="col-xs-1">Dscto</th>
          <th class="col-xs-2">Importe</th>
          <th class="col-xs-1"></th>
        </tr>
      </thead>
      <tbody>
        {% for form in formset.forms%}
         <tr id="{{ form.prefix }}-row row" class="form-container">
             <td class="col-xs-4">
              <div class="row">
               <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3"><input type="text" name="{{ form.prefix }}-clave" class="form-control" placeholder="Clave"></div>
               <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 articuloContainer">
                <div class="row">
                  {{form.articulo}}    
                </div>
              </div>
              </div>
             </td>
             <td class="col-xs-1">{{form.unidades}}</td>
             <td class="col-xs-2">{{form.precio_unitario}}</td>
             <td class="col-xs-1">{{form.descuento_porcentaje}}</td>
             <td class="col-xs-2">{{form.precio_total_neto}}{% for fld in form.hidden_fields %}{{ fld }}{% endfor %}</td>
             <td class="col-xs-1" >{% if form.instance.pk %}{{ form.DELETE }}{% endif %}</td>
           </td>
         </tr>
         {% endfor %}
      </tbody>
    </table>
    {{ formset.management_form }}    

    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
        <strong> <div class="desp">Descuento Global (%):  <input type="text" id="descuentop" class="text-right" size="5"></strong> <br></div>
      </div>
      <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8" style="padding-left: 45px; color:darkcyan; font-size: 1.5em;">
        <div class="row">
          <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
            <strong> <div class="sub">Subtotal: $</div> </strong> <br> <br>
            <strong> <div class="des">Descuento: -$</div> </strong> <br> <br>
            <strong> <div class="tot">Total: $</div> </strong> <br> <br>
            <strong> <div class="descuento_tp">Descuento Extra: $</div> <br> <br> </strong>
            <strong> <div class="total_con_descuento">Total con descuento: $</div> </strong>
          </div>          
          <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-right">
            <strong><div class="sub" id="subtotal"></div></strong> <br> <br>
            <strong><div class="des" id="descuento"></div></strong> <br> <br>
            <strong><div class="tot" id="total"></div></strong> <br> <br> 
            <strong><div class="descuento_tp" id="descuento_tp"></div></strong> <br> <br>
            <strong><div class="total_con_descuento" id="total_con_descuento"></div></strong>
          </div>
        </div>        
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right"> 
        </div>
      </div>
      <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 text-right">
      </div>
    </div>
  </div>
</form>
<div class="modal fade" id="modal_arbol" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div class="row">
          <input type="hidden" value="" name="folders" id="selectedFolderId" />
          <div class="col-md-8"><input type="text" class="form-control" id="id_modal_nombre" placeholder="Busca articulos aqui..."></div>
          <div class="col-md-3"><button class="btn btn-default" id="buscar-modal">Buscar</button></div>
          <div class="col-md-1"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>
        </div>
        <br>
        <!-- <div class="row">
          <div class="col-md-12 col-xs-12 col-sm-12">
            <input type="checkbox" id="busquedaAnidadaId" value="" checked>
            Busqueda anidada
          </div>
        </div> -->
      </div>
      <div class="modal-body">
        <div id="id_tree_container" class="col-md-3 col-xs-6 col-sm-6"></div>
        <div class="row" style="clear: both;">
          <br>
        </div>
        <table class="table table-striped table-hover table-bordered" id="articles_table2">
          <thead>
            <tr>
              <th>Clave</th>
              <th>Nombre</th>
              <th>Existencia</th>
              <th>Precio</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>

<br style="clear:both">
  
{% endblock %}