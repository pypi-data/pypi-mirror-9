[tox]
envlist = py27, py33, py34
[testenv]
whitelist_externals = cp
install_command = pip install {opts} --upgrade {packages}
changedir = {envsitepackagesdir}
setenv =
	PYTHONPATH = {envsitepackagesdir}
deps =
	pytest
	mock
	coverage>3.9
commands =
	cp "{toxinidir}/.coveragerc" "{envsitepackagesdir}"
	coverage run -m py.test {posargs:snakeoil/test}
	coverage report
	coverage html -d "{envdir}/coverage"

[testenv:lint]
whitelist_externals =
	bash
	cp
install_command = pip install {opts} --upgrade {packages}
changedir = {envsitepackagesdir}
setenv =
	PYTHONPATH = {envsitepackagesdir}
deps = pylint
commands =
	cp -r "{toxinidir}"/lintplugin ./
	cp "{toxinidir}"/pylint ./snakeoil-pylint
	bash -c "[[ $({envpython} -c 'import sys; print(sys.version[0])') == "3" ]] && 2to3 -wn lintplugin"
	./snakeoil-pylint -f colorized --reports y snakeoil
