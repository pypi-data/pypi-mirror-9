<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>6. Views, function ed altro</title>
<META NAME="description" CONTENT="6. Views, function ed altro">
<META NAME="keywords" CONTENT="tut">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="STYLESHEET" href="tut.css" type='text/css'>
<link rel="first" href="tut.html">
<link rel="contents" href="contents.html" title="Contents">

<LINK REL="next" HREF="node9.html">
<LINK REL="previous" HREF="node7.html">
<LINK REL="up" HREF="tut.html">
<LINK REL="next" HREF="node9.html">
<meta name='aesop' content='information'>
</head>
<body>
<DIV CLASS="navigation">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node7.html"><img src="../icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="tut.html"><img src="../icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node9.html"><img src="../icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">CherryPy Tutorial</td>
<td><A HREF="node2.html"><img src="../icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node7.html">5. I linguaggi di</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="tut.html">CherryPy Tutorial</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node9.html">7. Classi, istanze, metodi</A>
<br><hr>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></a>

<UL CLASS="ChildLinks">
<LI><A href="node8.html#SECTION008100000000000000000">6.1 Differenti architetture per il codice sorgente di un sito web</a>
<UL>
<LI><A href="node8.html#SECTION008110000000000000000">6.1.1 Primo esempio: architettura semplice</a>
<LI><A href="node8.html#SECTION008120000000000000000">6.1.2 Secondo esempio: un'architettura più elegante per siti più complessi</a>
</ul>
<LI><A href="node8.html#SECTION008200000000000000000">6.2 Altri esempi usando function, mask e view insieme</a>
</ul>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION008000000000000000000">
6. Views, function ed altro</A>
</H1>

<P>
Fino ad ora abbiamo usato solo metodi di tipo mask: Impareremo ora come usare view e function.

<P>

<H1><A NAME="SECTION008100000000000000000">
6.1 Differenti architetture per il codice sorgente di un sito web</A>
</H1>
Prenderemo in esame due esempi per mostrare i due differenti modi di disegnare l'architettura del vostro codice.

<P>

<H2><A NAME="SECTION008110000000000000000">
6.1.1 Primo esempio: architettura semplice</A>
</H2>
Assumiamo vogliate costruire un sito web veramente semplice dove persone possono ricercare tra una serie
di libri e vedere i dettagli di uno in particolare.
Il sito web &#232; costituito da un paio di pagine:

<UL>
<LI>La pagina principale mostra una lista di libri. Ogni libro &#232; un link.
</LI>
<LI>Una pagina mostra le informazioni relative ad un particolare libro. Questa pagina &#232; visualizzata quando
un utente clicca sul nome del libro
</LI>
</UL>
Per implementare questo sito web, abbiamo bisogno di usare 2 funzioni  e 2 maschere.

<UL>
<LI>Una funzione chiamata <b>getBookListData</b> ritorner&#224; la lista dei nomi dei libri
</LI>
<LI>Una funzione chiamata <b>getBookData</b> ritorner&#224; le informazioni dettagliate di un particolare libro
</LI>
<LI>Una maschera chiamata <b>index</b> che visualizzer&#224; la lista dei libri
</LI>
<LI>Una maschera chiamata <b>displayBook</b> che mostrer&#224; in dettaglio le informazioni di un particolare libro
</LI>
</UL>
Il codice per il sito web &#232; il seguente:
<div class="verbatim"><pre>
CherryClass Root:
variable:
    # Sample book list data. In real life, this would probably come from a database
    # (title, author, price)
    bookListData=[
        ('Harry Potter and the Goblet of Fire', 'J. K. Rowling', '9$'),
        ('The flying cherry', 'Remi Delon', '5$'),
        ('I love cherry pie', 'Eric Williams', '6$'),
        ('CherryPy rules', 'David stults', '7$')
    ]

function:
    def getBookListData(self):
        return self.bookListData
    def getBookData(self, id):
        return self.bookListData[id]
mask:
    def index(self):
        &lt;html&gt;&lt;body&gt;
            Hi, choose a book from the list below:&lt;br&gt;
            &lt;py-for="title, dummy, dummy in self.getBookListData()"&gt;
                &lt;a py-attr="'displayBook?id=%s'%_index" href="" py-eval="title"&gt;&lt;/a&gt;&lt;br&gt;
            &lt;/py-for&gt;
        &lt;/body&gt;&lt;/html&gt;
    def displayBook(self, id):
        &lt;html&gt;&lt;body&gt;
            &lt;py-exec="title, author, price=self.getBookData(int(id))"&gt;
            Details about the book:&lt;br&gt;
            Title: &lt;py-eval="title"&gt;&lt;br&gt;
            Author: &lt;py-eval="author"&gt;&lt;br&gt;
            Price: &lt;py-eval="price"&gt;&lt;br&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>
Come avete potuto vedere, il codice per questo "mini" sito &#232; veramente semplice: ogni maschera corrisponde
ad un tipo di pagina. Dato che avevamo 2 tipi di pagine abbiamo usato 2 maschere.

<P>
Andiamo a vedere un esempio leggermente pi&#249; complicato...

<H2><A NAME="SECTION008120000000000000000">
6.1.2 Secondo esempio: un'architettura pi&#249; elegante per siti pi&#249; complessi</A>
</H2>

<P>
In questo esempio aggiungeremo alcune caratteristiche al nostro sito web:

<UL>
<LI>Questa volta vogliamo che il nostro sito web sia bilingue: Inglese e Francese
</LI>
<LI>Oltre a scorrere i libri per titolo, vogliamo che siano anche selezionabili per autore
</LI>
</UL>

<P>
Questo significa che avremo bisogno di 6 tipi di pagine:

<UL>
<LI>1. Una per visualizzare una lista di titoli in Inglese
</LI>
<LI>2. Una per visualizzare una lista di titoli in Francese
</LI>
<LI>3. Una per visualizzare una lista di libri per autore in Inglese
</LI>
<LI>4. Una per visualizzare una lista di libri per autore in Francese
</LI>
<LI>5. Una per visualizzare i dettagli dei libri in Inglese
</LI>
<LI>6. Una per visualizzare i dettagli dei libri in Francese
</LI>
</UL>

<P>
Se volessimo mantenere la stessa architettura del primo esempio, dovremmo scrivere 6 maschere (pi&#249; 
le funzioni). Proviamo a fare qualcosa di meglio ...

<P>
Non c'&#232; molto da fare per le ultime 2 pagine (la 5 e la 6). Ma per le prime quattro, possiamo in effetti
usare 2 funzioni e 2 maschere. Combinando ogni funzione con ogni maschera, abbiamo le nostre 4 combinazioni
(2 per 2). Useremo ci&#242; che segue:

<P>

<UL>
<LI>Una funzione chiamata <b>getBookListByTitleData</b> che ritorner&#224; la lista dei libri per titolo
</LI>
<LI>Una funzione chiamata <b>getBookListByAuthorData</b> che ritorner&#224; una lista di libri per autore
</LI>
<LI>Una maschera chiamata <b>bookListInEnglishMask</b> che visualizzer&#224; una lista di libri in Inglese (senza
preoccuparsi se i libri sono ordinati per titolo o autore).
</LI>
<LI>Una maschera chiamata <b>bookListInFrenchMask</b> che visualizzer&#224; una lista di libri in Francese.
</LI>
</UL>

<P>
Per permettere l'unione tra maschera e funzione, useremo una view. Questo significa che avremo 4 view, una
per ogni combinazione. Ogni view avr&#224; un codice veramente semplice: <b>applica questa maschera al
risultato di questa funzione</b>

<P>
Il codice per il nostro sito web &#232; il seguente:
<div class="verbatim"><pre>
CherryClass Root:
variable:
    # Sample book list data. In real life, this would probably come from a database
    # (title, author, price)
    bookListData=[
        ('Harry Potter and the Goblet of Fire', 'J. K. Rowling', '9$'),
        ('The flying cherry', 'Remi Delon', '5$'),
        ('I love cherry pie', 'Eric Williams', '6$'),
        ('CherryPy rules', 'David Stults', '7$')
    ]

function:
    def getBookListByTitleData(self):
        titleList=[]
        for title, dummy, dummy in self.bookListData: titleList.append(title)
        return titleList
    def getBookListByAuthorData(self):
        authorList=[]
        for dummy, author, dummy in self.bookListData: authorList.append(author)
        return authorList
    def getBookData(self, id):
        return self.bookListData[id]
mask:
    def bookListInEnglishMask(self, myBookListData):
            Hi, choose a book from the list below:&lt;br&gt;
            &lt;py-for="data in myBookListData"&gt;
                &lt;a py-attr="'displayBookInEnglish?id=%s'%_index" href="" 
                    py-eval="data"&gt;&lt;/a&gt;&lt;br&gt;
            &lt;/py-for&gt;
            &lt;br&gt;
    def bookListInFrenchMask(self, myBookListData):
            Bonjour, choisissez un livre de la liste:&lt;br&gt;
            &lt;py-for="data in myBookListData"&gt;
                &lt;a py-attr="'displayBookInFrench?id=%s'%_index" href=""
                        py-eval="data"&gt;&lt;/a&gt;&lt;br&gt;
            &lt;/py-for&gt;
            &lt;br&gt;
    def displayBookInEnglish(self, id):
        &lt;html&gt;&lt;body&gt;
            &lt;py-exec="title, author, price=self.getBookData(int(id))"&gt;
            Details about the book:&lt;br&gt;
            Title: &lt;py-eval="title"&gt;&lt;br&gt;
            Author: &lt;py-eval="author"&gt;&lt;br&gt;
            Price: &lt;py-eval="price"&gt;&lt;br&gt;
            &lt;br&gt;
            &lt;a py-attr="'displayBookInFrench?id=%s'%id" href=""&gt;Version francaise&lt;/a&gt;
        &lt;/body&gt;&lt;/html&gt;
    def displayBookInFrench(self, id):
        &lt;html&gt;&lt;body&gt;
            &lt;py-exec="title, author, price=self.getBookData(int(id))"&gt;
            Details du livre:&lt;br&gt;
            Titre: &lt;py-eval="title"&gt;&lt;br&gt;
            Auteur: &lt;py-eval="author"&gt;&lt;br&gt;
            Prix: &lt;py-eval="price"&gt;&lt;br&gt;
            &lt;br&gt;
            &lt;a py-attr="'displayBookInEnglish?id=%s'%id" href=""&gt;English version&lt;/a&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>
<div class="verbatim"><pre>
view:
    def englishByTitle(self):
        page="&lt;html&gt;&lt;body&gt;"
        byTitleData=self.getBookListByTitleData()
        page+=self.bookListInEnglishMask(byTitleData)
        page+='&lt;a href="englishByAuthor"&gt;View books by author&lt;/a&gt;&lt;br&gt;'
        page+='&lt;a href="frenchByTitle"&gt;Version francaise&lt;/a&gt;'
        page+="&lt;/body&gt;&lt;/html&gt;"
        return page
    def frenchByTitle(self):
        page="&lt;html&gt;&lt;body&gt;"
        byTitleData=self.getBookListByTitleData()
        page+=self.bookListInFrenchMask(byTitleData)
        page+='&lt;a href="frenchByAuthor"&gt;Voir les livres par auteur&lt;/a&gt;&lt;br&gt;'
        page+='&lt;a href="englishByTitle"&gt;English version&lt;/a&gt;'
        page+="&lt;/body&gt;&lt;/html&gt;"
        return page
    def englishByAuthor(self):
        page="&lt;html&gt;&lt;body&gt;"
        byTitleData=self.getBookListByAuthorData()
        page+=self.bookListInEnglishMask(byTitleData)
        page+='&lt;a href="englishByTitle"&gt;View books by title&lt;/a&gt;&lt;br&gt;'
        page+='&lt;a href="frenchByAuthor"&gt;Version francaise&lt;/a&gt;'
        page+="&lt;/body&gt;&lt;/html&gt;"
        return page
    def frenchByAuthor(self):
        page="&lt;html&gt;&lt;body&gt;"
        byTitleData=self.getBookListByAuthorData()
        page+=self.bookListInFrenchMask(byTitleData)
        page+='&lt;a href="frenchByTitle"&gt;Voir les livres par titre&lt;/a&gt;&lt;br&gt;'
        page+='&lt;a href="englishByAuthor"&gt;English version&lt;/a&gt;'
        page+="&lt;/body&gt;&lt;/html&gt;"
        return page
    def index(self):
        # By default, display books by title in English
        return self.englishByTitle()
</pre></div>

<P>
Alternativamente, avremmo potuto risparmiare alcune lnee di codice passando la lingua (Francese o Inglese)
e il tipo di lista (titolo o autore) come parametri. In questo modo, non avremmo avuto bisogno di usare view,
e le maschere avrebbero potuto essere chiamata direttamente...

<P>

<H1><A NAME="SECTION008200000000000000000">
6.2 Altri esempi usando function, mask e view insieme</A>
</H1>
In questa sezione, costruiremo un piccolo sito web che richiede all'utente un numero intero tra 20 e 50
e un numero di colonne C tra 2 e 20. Quindi visualizzer&#224; i numeri interi da 1 a N in una tabella di C colonne.

<P>
Editate <span class="file">Hello.cpy</span> ed inserite le seguenti righe di codice:
<div class="verbatim"><pre>
CherryClass Root:
function:
    def prepareTableData(self, N, C):
        # Prepare data that will be rendered in the table
        # Example, for N=10 and C=3, it will return:
        # [[1,2,3],
        #  [4,5,6],
        #  [7,8,9],
        #  [10]]
        N=int(N)
        C=int(C)
        tableData=[]
        i=1
        while 1:
            rowData=[]
            for c in range(C):
                rowData.append(i)
                i+=1
                if i&gt;N: break
            tableData.append(rowData)
            if i&gt;N: break
        return tableData
            
view:
    def viewResult(self, N, C):
        tableData=self.prepareTableData(N,C)
        return self.renderTableData(tableData)
mask:
    def renderTableData(self, tableData):
        # Renders tableData in a table
        &lt;html&gt;&lt;body&gt;
        &lt;table border=1&gt;
            &lt;div py-for="rowData in tableData"&gt;
                &lt;tr&gt;
                    &lt;div py-for="columnValue in rowData"&gt;
                        &lt;td py-eval="columnValue"&gt;&lt;/td&gt;
                    &lt;/div&gt;
                &lt;/tr&gt;
            &lt;/div&gt;
        &lt;/table&gt;
        &lt;/body&gt;&lt;/html&gt;

    def index(self):
        &lt;html&gt;&lt;body&gt;
            &lt;form py-attr="request.base+'/viewResult'" action=""&gt;
                Integer between 20 and 50: &lt;input type=text name=N&gt;&lt;br&gt;
                Number of columns between 2 and 10: &lt;input type=text name=C&gt;&lt;br&gt;
                &lt;input type=submit&gt;
            &lt;/form&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>

<P>
Come funziona?

<P>
La maschera <var>index</var> &#232; facile da capire ed &#232; usata solo per inserire N e C.

<P>
La funzione <var>prepareTableData</var> &#232; usata per processare N e C e per calcolare una lista di liste
che sar&#224; pronta per la visualizzazione. La maschera <var>renderTableData</var> prende in ingresso
il ritorno di <var>prepareTableData</var> e lo visualizza. La view <var>viewResult</var> &#232; un 
collegamento tra i due. Basilarmente diciamo di calcolare il risulato di una funzione e
applicarvi una maschera.

<P>
Ora cosa possiamo fare se volessimo visualizzare gli interi per colonna invece che per riga?

<P>
Dobbiamo creare una nuova maschera e aggiornare la view in modo da applicare la nuova maschera
ai dati.

<P>
Modifichiamo <span class="file">Hello.cpy</span> come segue:
<div class="verbatim"><pre>
CherryClass Root:
function:
    def prepareTableData(self, N, C):
        N=int(N)
        C=int(C)
        tableData=[]
        i=1
        while 1:
            rowData=[]
            for c in range(C):
                rowData.append(i)
                i+=1
                if i&gt;N: break
            tableData.append(rowData)
            if i&gt;N: break
        return tableData
            
view:
    def viewResult(self, N, C, displayBy):
        tableData=self.prepareTableData(N,C)
        if displayBy=="line": mask=self.renderTableDataByLine
        else: mask=self.renderTableDataByColumn
        return mask(tableData)
mask:
    def renderTableDataByLine(self, tableData):
        &lt;html&gt;&lt;body&gt;
        &lt;table border=1&gt;
            &lt;div py-for="rowData in tableData"&gt;
                &lt;tr&gt;
                    &lt;div py-for="columnValue in rowData"&gt;
                        &lt;td py-eval="columnValue"&gt;&lt;/td&gt;
                    &lt;/div&gt;
                &lt;/tr&gt;
            &lt;/div&gt;
        &lt;/table&gt;
        &lt;/body&gt;&lt;/html&gt;
    def renderTableDataByColumn(self, tableData):
        &lt;html&gt;&lt;body&gt;
        &lt;table border=1&gt;
            &lt;tr&gt;
                &lt;div py-for="rowData in tableData"&gt;
                    &lt;td valign=top&gt;
                        &lt;div py-for="columnValue in rowData"&gt;
                            &lt;div py-eval="columnValue"&gt;&lt;/div&gt;&lt;br&gt;
                        &lt;/div&gt;
                    &lt;/td&gt;
                &lt;/div&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>
<div class="verbatim"><pre>
    def index(self):
        &lt;html&gt;&lt;body&gt;
            &lt;form py-attr="request.base+'/viewResult'" action=""&gt;
                Integer between 20 and 50: &lt;input type=text name=N&gt;&lt;br&gt;
                Number of columns (or lines) between 2 and 10: 
                    &lt;input type=text name=C&gt;&lt;br&gt;
                Display result by: &lt;select name=displayBy&gt;
                    &lt;option&gt;line&lt;/option&gt;
                    &lt;option&gt;column&lt;/option&gt;
                &lt;/select&gt;&lt;br&gt;
                &lt;input type=submit&gt;
            &lt;/form&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>

<P>
Abbiamo rinominato la maschera <var>renderTableData</var> in <var>renderTableDataByLine</var>,
abbiamo quindi chiamato 
<var>renderTableDataByColumn</var>. <var>viewResult</var> ha adesso il parametro <var>displayBy</var>
che &#232; immesso dall'utente. Basandosi su questo, <var>viewResult</var> seleziona la maschera da applicare 
al risultato della funzione <var>prepareTableData</var> (che non &#232; cambiata).

<P>
Facciamo ora alcuni test: nel nostro browser digitiamo l'URL: <a class="url" href="http://localhost:8000/prepareTableData?N=30&amp;C=5">http://localhost:8000/prepareTableData?N=30&amp;C=5</a>
<P>
Dovreste ricevere il seguente errore:
<div class="verbatim"><pre>
CherryError: CherryClass "root" doesn't have any view or
            mask function called "prepareTableData"
</pre></div>
Questo significa che una funzione non pu&#242; essere "chiamata" direttamente da un browser.
Solo funzioni view e mask, che ritornano dati visualizzabili, possono essere "chiamate" direttamente.

<P>
Cosa abbiamo imparato:

<UL>
<LI>CherryPy permette la separazione tra contenuto e presentazione usando 'sezioni' chiamate function, mask e view
</LI>
<LI>Le funzioni in function processano dati e ritornano dati. Una funzione che implementa un algoritmo pu&#242; essere
riutilizzata per ogni tipo di dato.
</LI>
<LI>Le funzioni in mask ricevono dati e li renderizzano. Una maschera pu&#242; essere riutilizzata per ogni tipo di dato.
</LI>
<LI>Le funzioni in view sono collegamenti tra funzioni e maschere.
</LI>
</UL>

<P>
Nota: all'interno di una dichiarazione di una CherryClass, le sezioni differenti (function, mask o view)
possono apparire in qualsiasi ordine, il numero di volte che vogliamo.

<P>
Nel prossimo capitolo vedremo come CherryPy determina che metodo chiamare in base all'URL...

<P>

<DIV CLASS="navigation">
<p><hr>
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node7.html"><img src="../icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="tut.html"><img src="../icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node9.html"><img src="../icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">CherryPy Tutorial</td>
<td><A HREF="node2.html"><img src="../icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node7.html">5. I linguaggi di</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="tut.html">CherryPy Tutorial</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node9.html">7. Classi, istanze, metodi</A>
<hr>
<span class="release-info">Release 0.10-beta, documentation updated on 14. gennaio 2004.</span>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
See <i><a href="about.html">About this document...</a></i> for information on suggesting changes.
</ADDRESS>
</BODY>
</HTML>
