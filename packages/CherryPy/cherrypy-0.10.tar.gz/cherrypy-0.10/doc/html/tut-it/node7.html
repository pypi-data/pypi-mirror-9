<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>5. I linguaggi di template: CHTL e CGTL</title>
<META NAME="description" CONTENT="5. I linguaggi di template: CHTL e CGTL">
<META NAME="keywords" CONTENT="tut">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="STYLESHEET" href="tut.css" type='text/css'>
<link rel="first" href="tut.html">
<link rel="contents" href="contents.html" title="Contents">

<LINK REL="next" HREF="node8.html">
<LINK REL="previous" HREF="node6.html">
<LINK REL="up" HREF="tut.html">
<LINK REL="next" HREF="node8.html">
<meta name='aesop' content='information'>
</head>
<body>
<DIV CLASS="navigation">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node6.html"><img src="../icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="tut.html"><img src="../icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node8.html"><img src="../icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">CherryPy Tutorial</td>
<td><A HREF="node2.html"><img src="../icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node6.html">4. Creazione del primo</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="tut.html">CherryPy Tutorial</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node8.html">6. Views, function ed</A>
<br><hr>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></a>

<UL CLASS="ChildLinks">
<LI><A href="node7.html#SECTION007100000000000000000">5.1 Tag</a>
<UL>
<LI><A href="node7.html#SECTION007110000000000000000">5.1.1 py-eval</a>
<LI><A href="node7.html#SECTION007120000000000000000">5.1.2 py-attr</a>
<LI><A href="node7.html#SECTION007130000000000000000">5.1.3 py-exec e py-code</a>
<LI><A href="node7.html#SECTION007140000000000000000">5.1.4 py-if e py-else</a>
<LI><A href="node7.html#SECTION007150000000000000000">5.1.5 py-for</a>
</ul>
<LI><A href="node7.html#SECTION007200000000000000000">5.2 Mettiamo tutto insieme</a>
</ul>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION007000000000000000000">
5. I linguaggi di template: CHTL e CGTL</A>
</H1>

<P>
CherryPy possiede DUE linguaggi di template. Sono molto simili, ma sono usati in situazioni differenti.
Sono stati pensati per essere facili da usare ma nello stesso tempo, molto potenti.

<UL>
<LI><b>CherryPy HTML Templating Language (CHTL)</b>: &#232; usato per produrre output in HTML.
E' stato disegnato in modo che editor HTML prendano le informazioni dinamiche dalla pagina.
In questo modo, webdesigner possono editare le pagine usando il proprio editor HTML preferito senza
perdere le informazioni che gli sviluppatori vi hanno messo. Il trucco sta nel nascondere il codice
negli attributi dei tag HTML.
</LI>
<LI><b>CherryPy Generic Templating Language (CGTL)</b>: &#232; usato per produrre output non-HTML  (per esempio
Javascript, CSS, XML, ...). E' molto simile al CHTL, eccetto che non possiamo usare tag HTML per nascondere
il codice e la sintassi &#232; leggermente pi&#249; semplice.
<b>Se non usate nessun editor HTML per creare le vostre pagine, probabilmente potreste usare solo il
CGTL che &#232; pi&#249; semplice rispetto al CHTL</b>.
</LI>
</UL>

<P>

<H1><A NAME="SECTION007100000000000000000">
5.1 Tag</A>
</H1>
Entrambi i linguaggi usano solo 6 tag: <code>py-eval</code>, <code>py-attr</code>, <code>py-exec</code>, <code>py-code</code>, <code>py-if</code> (con <code>py-else</code>)
e <code>py-for</code>.

<P>
Tutti i tag sono usati nello stesso modo: <code>CherryPyTag="Codice Python"</code>. Per esempio:
<div class="verbatim"><pre>
py-eval="2*2"
py-exec="a=1"
py-if="2==0"
py-for="i in range(10)"
...
</pre></div>

<P>
Se volete usare le virgolette all'interno del codice python, avrete bisogno di usare il carattere di escape
(backslash), in questo modo:
<div class="verbatim"><pre>
py-eval="'I love \"cherry pies\"'"
</pre></div>

<P>
Vediamo cosa da ognuno di questi tag:

<P>

<H2><A NAME="SECTION007110000000000000000">
5.1.1 py-eval</A>
</H2>
Questo tag &#232; usato per valutare un espressione Python, come in questo caso:
<div class="verbatim"><pre>
Hello, the sum is &lt;py-eval="1+2+3"&gt;
</pre></div>

<P>
Questa linea verr&#224; visualizzata come:
<div class="verbatim"><pre>
Hello, the sum is 6
</pre></div>

<P>
Quello che succede &#232; che CherryPy prima valuta l'espressione (usando <var>eval</var>) e quindi usa
<var>str</var> per convertire il risultato in una stringa.

<P>
Tutti i tag CGTL possono essere racchiusi tra <var>/&gt;</var> o / &gt;, come in questo caso:
<div class="verbatim"><pre>
&lt;py-eval="'abcd' * 2" /&gt;
&lt;py-eval="'Hello, %s' % name"/&gt;
</pre></div>

<P>
Nel formato CHTL, il tag <var>py-eval</var> pu&#242; essere usato all'interno di qualsiasi coppia di tag (sia di apertura che di chiusura), come in questo caso:

<P>
<div class="verbatim"><pre>
&lt;span class=myClass py-eval="2*3"&gt;&lt;/span&gt;
&lt;a href="myHref" py-eval="'Click here'"&gt;&lt;/a&gt;
&lt;u py-eval="'I\'m with an underline'"&gt;&lt;/u&gt;
...
</pre></div>

<P>
Se non volete che nessun tag HTML preceda o segua l'espressione, il trucco &#232; di usare 
il tag HTML <code>&lt;div&gt;</code>:
<div class="verbatim"><pre>
This is a long string with a &lt;div py-eval="'variable'"&gt;&lt;/div&gt; in it
</pre></div>

<P>

<H2><A NAME="SECTION007120000000000000000">
5.1.2 py-attr</A>
</H2>
Questo tag e' simile a <code>py-eval</code>, eccetto che &#232; usato come attributo a tag HTML. Ecco il suo uso:
<div class="verbatim"><pre>
&lt;td py-attr="'red'" bgColor=""&gt;
</pre></div>
E che dar&#224; come risultato:
<div class="verbatim"><pre>
&lt;td bgColor="red"&gt;
</pre></div>
Notate che questo &#232; equivalente a:
<div class="verbatim"><pre>
&lt;td bgColor="&lt;py-eval="'red'"&gt;"&gt;
</pre></div>
Ma la prima sintassi &#232; preferibile.

<P>

<H2><A NAME="SECTION007130000000000000000">
5.1.3 py-exec e py-code</A>
</H2>
Questi tag sono usati per eseguire codice Python.
<code>py-exec</code> &#232; usato per eseguire una linea di codice Python mentre
<code>py-code</code> &#232; usato per eseguire blocchi di codice Python.
Per esempio, il codice che segue:
<div class="verbatim"><pre>
&lt;py-exec="a=2"&gt;
&lt;py-code="
    if a==2:
        b=1
    else:
        b==2
"&gt;
b equals &lt;py-eval="b"&gt;
</pre></div>
Sar&#224; visualizzato come:
<div class="verbatim"><pre>
b equals 1
</pre></div>

<P>
Usando la sintassi CHTL, entrambi i tag dovranno essere racchiusi tra i tag &lt;div&gt; e &lt;/div&gt; come segue:
<div class="verbatim"><pre>
&lt;div py-exec="a=2"&gt;&lt;/div&gt;
&lt;div py-code="
    if a==2:
        b=1
    else:
        b=2
"&gt;&lt;/div&gt;
</pre></div>

<P>
Se volete visualizzare dei dati all'interno del codice Python, dovrete appenderli alla variabile
<var>_page</var>:
<div class="verbatim"><pre>
&lt;html&gt;&lt;body&gt;
    Integers from 0 to 9:
    &lt;py-code="
        for i in range(10):
            _page.append("%s "%i)
    "&gt;
&lt;/body&gt;&lt;/html&gt;
</pre></div>

<P>
Che sar&#224; visualizzato come:
<div class="verbatim"><pre>
&lt;html&gt;&lt;body&gt;
    Integers from 0 to 9:
    0 1 2 3 4 5 6 7 8 9
&lt;/body&gt;&lt;/html&gt;
</pre></div>

<P>

<H2><A NAME="SECTION007140000000000000000">
5.1.4 py-if e py-else</A>
</H2>
Questi tag sono usati come <code>if</code> ed <code>else</code> in Python. La sintassi &#232; la seguente:
<div class="verbatim"><pre>
&lt;py-if="1==1"&gt;
    OK
&lt;/py-if&gt;&lt;py-else&gt;
    Not OK
&lt;/py-else&gt;
</pre></div>

<P>
Che sar&#224; visualizzato come
<div class="verbatim"><pre>
OK
</pre></div>

<P>
Notate che se c'&#232; una clausola <code>else</code>, il tag <code>&lt;div py-else&gt;</code> deve seguire il tag <code>&lt;/div&gt;</code> 
che chiude il tag <code>&lt;div py-if&gt;</code>, con nessun carattere significativo tra di loro (sono permessi solo
separatori).

<P>
Il CHTL equivalente &#232;:
<div class="verbatim"><pre>
&lt;div py-if="1==1"&gt;
    OK
&lt;/div&gt;
&lt;div py-else&gt;
    Not OK
&lt;/div&gt;
</pre></div>

<P>

<H2><A NAME="SECTION007150000000000000000">
5.1.5 py-for</A>
</H2>
Anche questo tag &#232; uguale al <code>for</code> in Python. La sintassi &#232; la seguente:
<div class="verbatim"><pre>
&lt;py-for="i in range(10)"&gt;
    &lt;py-eval="i"&gt;
&lt;/py-for&gt;
</pre></div>
Che sar&#224; visualizzato come
<div class="verbatim"><pre>
0 1 2 3 4 5 6 7 8 9
</pre></div>

<P>
Notate che potete ciclare su liste di tuple:
<div class="verbatim"><pre>
&lt;py-for="i,j in [(0,0), (0,1), (1,0), (1,1)]"&gt;
    &lt;py-eval="i+j"&gt;
&lt;/py-for&gt;
</pre></div>
La cui visualizzazione sar&#224;
<div class="verbatim"><pre>
0 1 1 2
</pre></div>

<P>
Il CGTL equivalente &#232;:
<div class="verbatim"><pre>
&lt;div py-for="i,j in [(0,0), (0,1), (1,0), (1,1)]"&gt;
    &lt;div py-eval="i+j"&gt;&lt;/div&gt;
&lt;/div&gt;
</pre></div>

<P>
In un ciclo <var>py-for</var>, CherryPy crea due variabili speciali: <var>_index</var> and <var>_end</var>.
La prima &#232; un intero contenente il numero corrente di iterazioni (da 0 a n-1). La seconda contiene il
numero totale di iterazioni meno 1.

<P>
Per esempio, se vogliamo visualizzare una lista con la prima occorrenza in grassetto e l'ultima sottolineata
possiamo usare il seguente codice:
<div class="verbatim"><pre>
&lt;py-exec="myList=[1,5,3,2,5,4,5]"&gt;
&lt;py-for="item in myList"&gt;
    &lt;py-if="_index==0"&gt;&lt;b py-eval="item"&gt;&lt;/b&gt;
    &lt;/py-if&gt;&lt;py-else&gt;
        &lt;py-if="_index==_end"&gt;&lt;u py-eval="item"&gt;&lt;/u&gt;
        &lt;/py-if&gt;&lt;py-else&gt;&lt;py-eval="item"&gt;&lt;/py-else&gt;
        &lt;/div&gt;
    &lt;/py-else&gt;
&lt;/py-for&gt;
</pre></div>
Questo sar&#224; il risultato:
<div class="verbatim"><pre>
&lt;b&gt;1&lt;/b&gt; 5 3 2 5 4 &lt;u&gt;5&lt;/u&gt;
</pre></div>

<P>
Nella prossima sezione vedremo come usare tutti questi tag insieme...

<P>

<H1><A NAME="SECTION007200000000000000000">
5.2 Mettiamo tutto insieme</A>
</H1>

<P>
Ora andremo a creare una pagina web che visualizza una tabella con tutti i colori HTML. 
Editate il file Hello.cpy e modificatelo nel seguente modo:

<P>
<div class="verbatim"><pre>
CherryClass Root:
mask:
    def index(self):
        &lt;html&gt;&lt;body&gt;
            &lt;a py-attr="request.base+'/webColors'" href=""&gt;
                Click here to see a nice table with all web colors
            &lt;/a&gt;
        &lt;/body&gt;&lt;/html&gt;
    def webColors(self):
        &lt;html&gt;&lt;body&gt;
            &lt;py-exec="codeList=['00', '33', '66', '99', 'CC', 'FF']"&gt;
            &lt;table border=1&gt;
            &lt;py-for="r in codeList"&gt;
                &lt;py-for="g in codeList"&gt;
                    &lt;tr&gt;
                        &lt;py-for="b in codeList"&gt;
                            &lt;py-exec="color='#%s%s%s'%(r,g,b)"&gt;
                            &lt;td py-attr="color" bgColor="" py-eval="'&amp;nbsp;&amp;nbsp;
                                                '+color+'&amp;nbsp;'"&gt;&lt;/td&gt;
                        &lt;/py-for&gt;
                    &lt;/tr&gt;
                &lt;/py-for&gt;
            &lt;/py-for&gt;
        &lt;/body&gt;&lt;/html&gt;
</pre></div>

<P>
Ricompilate il file, fate ripartire il server e ricaricate la pagina nel vostro browser. Cliccate sul link
e dovreste vedere una simpatica tabella con tutti i colori del web.

<P>
Come funziona?

<P>
Il metodo <code>webColors</code> &#232; un esempio di un uso diretto e semplice dei tag CHTL.
La riga pi&#249; interessante &#232;:
<div class="verbatim"><pre>
&lt;a py-attr="request.base+'/webColors'" href=""&gt;
</pre></div>

<P>
<var>request</var> &#232; una variabile globale usata da CherryPy per ogni richiesta di un client.
E' un'instanza di una classe con diverse variabili. Una di queste &#232; chiamata <code>base</code> e contiene
l'URL di base del sito web (nel nostro caso: <a class="url" href="http://localhost:8000">http://localhost:8000</a>).
Cos&#236;, la linea
<div class="verbatim"><pre>
&lt;a py-attr="request.base+'/webColors'" href=""&gt;
</pre></div>
sar&#224; resa come:
<div class="verbatim"><pre>
&lt;a href="http://localhost:8000/webColors"&gt;
</pre></div>
Questo ci dice anche che quando il browser richiede l'URL  <a class="url" href="http://localhost:8000/webColors">http://localhost:8000/webColors</a>, 
verr&#224; chiamato il metodo <var>webColors</var> della classe  <var>Root</var>.

<P>
Nel prossimo capitolo, impareremo come e dove usare view e function ...

<P>

<DIV CLASS="navigation">
<p><hr>
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node6.html"><img src="../icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="tut.html"><img src="../icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node8.html"><img src="../icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">CherryPy Tutorial</td>
<td><A HREF="node2.html"><img src="../icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="../icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node6.html">4. Creazione del primo</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="tut.html">CherryPy Tutorial</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node8.html">6. Views, function ed</A>
<hr>
<span class="release-info">Release 0.10-beta, documentation updated on 14. gennaio 2004.</span>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
See <i><a href="about.html">About this document...</a></i> for information on suggesting changes.
</ADDRESS>
</BODY>
</HTML>
