%!PS-Adobe-2.0
%%Creator: dvips(k) 5.86 Copyright 1999 Radical Eye Software
%%Title: howto.dvi
%%Pages: 69
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Helvetica Helvetica-Oblique Times-Roman Times-Bold
%%+ Helvetica-Bold Times-Italic Courier
%%DocumentPaperSizes: a4
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -N0 -t a4 howto.dvi -o howto.ps
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 2004.03.19:0735
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "22 June 1996",
%   filename = "8r.enc",
%   email = "kb@@mail.tug.org",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "119     662    4424",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type/integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics/Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{
dup sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1
roll mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def
dup[exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}
if}forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}
def end

%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600 (howto.dvi)
@start /Fa 134[33 1[48 1[33 18 26 22 33 33 33 1[52 18
33 1[18 33 2[29 33 29 1[29 12[41 3[37 12[44 11[33 6[33
1[17 22 45[{TeXBase1Encoding ReEncodeFont}25 66.4176
/Times-Roman rf /Fb 206[25 49[{TeXBase1Encoding ReEncodeFont}1
49.8132 /Times-Roman rf /Fc 206[29 49[{TeXBase1Encoding ReEncodeFont}1
58.1154 /Times-Roman rf /Fd 139[50 1[50 1[50 1[50 4[50
105[{TeXBase1Encoding ReEncodeFont}5 83.022 /Courier
rf
%DVIPSBitmapFont: Fe cmsy10 10 1
/Fe 1 16 df<EB1FF0EBFFFE487F000714C04814E04814F04814F8A24814FCA3B612FEA9
6C14FCA36C14F8A26C14F06C14E06C14C0000114006C5BEB1FF01F1F7BA42A>15
D E
%EndDVIPSBitmapFont
/Ff 134[50 50 72 1[55 28 50 33 1[55 55 55 83 22 50 1[22
55 55 28 55 55 50 1[55 9[94 13[28 72 2[66 5[55 7[55 2[55
55 55 55 2[28 46[{TeXBase1Encoding ReEncodeFont}32 99.6264
/Helvetica rf /Fg 134[60 60 86 60 66 33 60 40 66 66 66
66 100 27 60 1[27 66 66 33 66 66 60 66 66 1[66 6[80 2[86
1[80 86 1[80 2[100 66 2[33 86 93 73 80 86 86 80 80 1[66
5[66 66 66 66 66 66 66 66 66 66 33 33 40 33 2[40 40 37[60
2[{TeXBase1Encoding ReEncodeFont}59 119.552 /Helvetica
rf /Fh 130[45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 1[45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 1[45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 33[{TeXBase1Encoding ReEncodeFont}91
74.7198 /Courier rf /Fi 134[37 37 55 37 42 23 32 32 42
42 42 42 60 23 37 1[23 42 42 23 37 42 37 42 42 1[42 1[32
1[32 2[51 2[60 46 42 51 1[51 60 55 69 46 55 1[28 60 1[51
51 60 55 51 51 2[56 56 56 13[21 28 21 56 1[28 28 5[35
30[42 42 2[{TeXBase1Encoding ReEncodeFont}58 83.022 /Times-Italic
rf /Fj 166[80 80 113 80 86 73 80 86 2[93 86 1[73 2[33
86 93 73 80 69[{TeXBase1Encoding ReEncodeFont}16 119.552
/Helvetica-Bold rf /Fk 134[42 42 60 42 46 23 42 28 1[46
46 46 69 18 42 18 18 46 46 23 46 46 42 46 46 1[46 6[55
2[60 51 55 60 1[55 65 1[69 46 3[60 2[55 60 60 55 55 7[46
46 46 46 46 46 46 46 46 46 23 23 28 23 2[28 28 37[42
2[{TeXBase1Encoding ReEncodeFont}57 83.022 /Helvetica
rf /Fl 133[37 42 42 60 42 42 23 32 28 42 42 42 42 65
23 42 23 23 42 42 28 37 42 37 42 37 28 42 4[51 60 60
78 60 60 51 46 55 60 46 60 60 74 51 60 32 28 60 60 46
51 60 55 55 60 1[37 47 47 47 23 23 42 42 42 42 42 42
42 42 42 42 23 21 28 21 2[28 28 28 65 2[42 34 28 29[46
46 2[{TeXBase1Encoding ReEncodeFont}83 83.022 /Times-Roman
rf /Fm 105[42 27[37 42 42 60 42 46 28 32 37 1[46 42 46
69 23 46 28 23 46 42 28 37 46 37 46 42 3[28 1[28 2[60
3[55 46 60 1[51 65 60 78 55 2[32 65 1[51 1[60 60 1[60
3[47 2[28 42 42 42 42 42 42 42 42 42 42 23 21 28 21 2[28
28 37[46 2[{TeXBase1Encoding ReEncodeFont}62 83.022 /Times-Bold
rf /Fn 134[37 1[54 37 42 21 37 25 42 42 42 42 62 17 37
17 17 42 42 21 42 42 37 42 42 13[50 54 1[50 2[62 42 2[21
54 1[46 1[54 54 2[76 42 1[44 2[21 42 42 42 2[42 2[42
42 21 21 25 45[{TeXBase1Encoding ReEncodeFont}47 74.7198
/Helvetica rf /Fo 141[33 4[78 28 2[28 50 4[44 1[44 19[89
7[61 10[28 50 4[50 1[50 50 50 3[25 44[{TeXBase1Encoding ReEncodeFont}16
99.6264 /Times-Roman rf /Fp 144[80 80 120 32 2[32 3[80
18[104 13[104 68[{TeXBase1Encoding ReEncodeFont}8 143.462
/Helvetica rf /Fq 140[72 6[32 6[80 3[80 14[104 32[80
80 1[40 46[{TeXBase1Encoding ReEncodeFont}8 143.462 /Helvetica-Oblique
rf /Fr 133[103 103 1[149 103 115 57 103 69 1[115 115
115 172 46 103 46 46 115 115 57 115 115 103 115 115 8[138
3[126 138 149 1[138 161 149 172 115 3[149 2[138 1[149
1[138 17[57 1[69 3[69 69 37[103 2[{TeXBase1Encoding ReEncodeFont}42
206.559 /Helvetica rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%BeginPaperSize: a4
a4
%%EndPaperSize

%%EndSetup
%%Page: 1 1
1 0 bop 0 83 3901 9 v 2349 446 a Fr(Cherr)6 b(yPy)58
b(Ho)m(wT)-25 b(o)3055 676 y Fq(Release)38 b(0.10)3151
1927 y Fp(Remi)g(Delon)3266 4132 y Fo(March)25 b(19,)g(2004)2975
5317 y(Email:)k Fn(remi@cherr)r(yp)n(y)-7 b(.org)p eop
%%Page: 1 2
1 1 bop 2764 747 a Fr(CONTENTS)0 1594 y Fm(1)83 b(Ho)o(w)20
b(to)f(ser)o(v)o(e)i(gzip-compr)o(essed)e(pages)i(with)f(CherryPy)1896
b(1)0 1777 y(2)83 b(Ho)o(w)20 b(to)f(run)i(a)g(CherryPy)e(ser)o(v)o(er)
h(behind)h(A)n(pache)2103 b(3)125 1876 y Fl(2.1)110 b(Introduction)76
b(.)41 b(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)143
b(3)125 1976 y(2.2)110 b(Using)20 b(persistent)g(CGI)38
b(.)k(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)143 b(3)125 2076 y(2.3)110
b(Using)20 b(F)o(astCGI)53 b(.)42 b(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)143 b(4)125 2175 y(2.4)110 b(Using)20 b(mod_re)n(write)33
b(.)41 b(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)143 b(5)0 2358
y Fm(3)83 b(Ho)o(w)20 b(to)f(connect)h(a)g(CherryPy)g(ser)o(v)o(er)g
(to)g(a)g(database)2024 b(7)0 2540 y(4)83 b(Ho)o(w)20
b(to)f(use)i(load-balancing)e(f)n(or)h(y)n(our)g(web)g(site)2182
b(9)125 2640 y Fl(4.1)110 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)143 b(9)125 2740 y(4.2)110 b(Generic)20
b(load-balancing)d(method)64 b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)143 b(9)125 2839
y(4.3)110 b(Multi-processor)m(,)18 b(unix-based)g(machine)63
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(10)0 3022 y Fm(5)83 b(Ho)o(w)20 b(to)f(compile)i(y)n(our)f(code)g(in)
h(deb)n(ug)g(mode)2232 b(13)0 3205 y(6)83 b(Ho)o(w)20
b(to)f(use)i(the)g(hotReload)e(featur)o(e)g(of)h(CherryPy)2049
b(15)125 3304 y Fl(6.1)110 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(15)125 3404 y(6.2)110
b(Ho)n(w)20 b(does)g(it)h(w)o(ork)f(?)29 b(.)41 b(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)g(.)102 b(15)125 3504 y(6.3)110 b(Ho)n(w)20 b(to)h(use)f(it)h(?)
51 b(.)42 b(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(15)0
3686 y Fm(7)83 b(Ho)o(w)20 b(to)f(use)i(caching)3008
b(17)125 3786 y Fl(7.1)110 b(Introduction)18 b(to)i(caching)25
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(17)125 3885 y(7.2)110
b(Caching)20 b(with)g(CherryPy)78 b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(17)0 4068 y Fm(8)83 b(Ho)o(w)20 b(can)g(webdesigners)h(and)f(webde)o
(v)o(elopers)g(collaborate)e(on)j(a)f(CherryPy)f(pr)o(oject)958
b(21)125 4168 y Fl(8.1)110 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(21)125 4267 y(8.2)110
b(Ho)n(w)20 b(can)g(the)o(y)g(collaborate)f(?)82 b(.)42
b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)102 b(21)125 4367 y(8.3)110 b(Example)69
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(22)0 4550 y Fm(9)83 b(Ho)o(w)20 b(to)f(use)i(SSL)h(with)f(CherryPy)
2582 b(25)125 4649 y Fl(9.1)110 b(Introduction)76 b(.)41
b(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(25)125
4749 y(9.2)110 b(Prerequisite)30 b(.)41 b(.)g(.)h(.)f(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)102 b(25)125 4848 y(9.3)110 b(Con\002guring)18
b(the)j(CherryPy)e(serv)o(er)26 b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(25)0
5031 y Fm(10)41 b(Ho)o(w)20 b(to)f(use)i(XML/XSL)h(with)f(CherryPy)2352
b(27)125 5131 y Fl(10.1)68 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(27)125 5230 y(10.2)68
b(Prerequisite)30 b(.)41 b(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)102 b(27)125 5330 y(10.3)68 b(Using)20 b(the)h(XML/XSL)f(package)f
(from)g(CherryPy)27 b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)102 b(27)p 0 5549 3901 4 v 3882 5649 a Fk(i)p eop
%%Page: 2 3
2 2 bop 0 83 a Fm(11)41 b(Ho)o(w)20 b(to)f(use)i(A)l(OP)g(\(Aspect)f
(Oriented)g(Pr)o(ograming\))e(with)i(CherryPy)1456 b(31)125
183 y Fl(11.1)68 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)102 b(31)125 282 y(11.2)68 b(Basic)22
b(e)o(xample)64 b(.)42 b(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(31)125 382 y(11.3)68 b(Ho)n(w)20 b(is)i(it)f(used)e(in)i
(CookieAuthenticate)d(and)h(HttpAuthenticate)66 b(.)41
b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)102 b(34)0 565 y Fm(12)41 b(Ho)o(w)20
b(to)f(cr)o(eate)g(a)i(spinning)g(ser)o(v)o(er)f(and)h(then)f(deb)n(ug)
h(it)1934 b(35)125 664 y Fl(12.1)68 b(Creating)20 b(a)h(spinning)d
(serv)o(er)52 b(.)41 b(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(35)125 764
y(12.2)68 b(Deb)n(ugging)18 b(a)j(spinning)e(serv)o(er)32
b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)102 b(36)0 946 y Fm(13)41 b(Ho)o(w)20
b(to)f(cr)o(eate)g(an)i(XML-RPC)f(ser)o(v)o(er)h(with)f(CherryPy)1890
b(39)125 1046 y Fl(13.1)68 b(Basic)22 b(Example)49 b(.)42
b(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(39)125
1146 y(13.2)68 b(Multiple)20 b(Serv)o(ers)59 b(.)41 b(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)102 b(40)0 1328 y Fm(14)41 b(Ho)o(w)20
b(to)f(mak)o(e)i(hidden)g(masks)h(or)e(views)2402 b(43)125
1428 y Fl(14.1)68 b(Introduction)76 b(.)41 b(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)102 b(43)125 1528 y(14.2)68 b(Ho)n(w)20
b(it)h(w)o(orks)40 b(.)h(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(43)0 1710 y Fm(15)41 b(Ho)o(w)20 b(to)f(contr)o(ol)g(logs)3005
b(45)0 1893 y(16)41 b(Ho)o(w)20 b(to)f(use)i(sessions)3005
b(47)125 1993 y Fl(16.1)68 b(Introduction)18 b(to)i(sessions)75
b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(47)125 2092 y(16.2)68
b(Possible)21 b(implementations)d(for)i(sessions)38 b(.)j(.)g(.)g(.)h
(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(48)125
2192 y(16.3)68 b(Sessions)21 b(implementation)d(in)i(CherryPy)46
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(49)125 2291 y(16.4)68 b(Con\002guration)18 b(v)n(ariables)i(used)g
(to)g(control)f(sessions)24 b(.)41 b(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)102 b(49)125 2391 y(16.5)68 b(Cleaning)20 b(up)g(old)g(sessions)
40 b(.)h(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(49)125 2491 y(16.6)68
b(Using)20 b(sessions)h(in)g(your)e(code)59 b(.)42 b(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(49)125 2590 y(16.7)68 b(Example)h(.)41 b(.)g(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)102 b(50)125 2690 y(16.8)68 b(Storing)20
b(session)g(data)g(in)h(a)f(database)g(\(or)f(an)o(ywhere)g(else\))46
b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(50)0 2873 y
Fm(17)41 b(Ho)o(w)20 b(to)f(use)i(Psyco)f(with)h(CherryPy)2527
b(53)0 3055 y(18)41 b(Ho)o(w)20 b(to)f(use)i(cookies)g(with)f(CherryPy)
2472 b(55)125 3155 y Fl(18.1)68 b(Setting)20 b(cookies)41
b(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(55)125
3254 y(18.2)68 b(Reading)20 b(cookies)62 b(.)41 b(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)102 b(55)0 3437 y Fm(19)41 b(Ho)o(w)20
b(to)f(use)i(Cheetah)f(templates)g(with)h(CherryPy)2073
b(57)0 3620 y(20)41 b(Ho)o(w)20 b(to)f(use)i(str)o(eaming)f(with)g
(CherryPy)2377 b(59)0 3802 y(21)41 b(Sample)20 b(deployment)g
(con\002guration)f(f)n(or)h(a)g(r)o(eal-w)o(orld)f(website)1635
b(61)125 3902 y Fl(21.1)68 b(Hardw)o(are)38 b(.)j(.)g(.)g(.)h(.)f(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(61)125 4002 y(21.2)68
b(Softw)o(are)20 b(en)m(vironment)62 b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(61)125 4101 y(21.3)68 b(CherryPy)19 b(v)o(ersion)31
b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(61)125
4201 y(21.4)68 b(CherryPy)19 b(serv)o(er)h(con\002guration)43
b(.)e(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g
(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)
f(.)g(.)g(.)102 b(61)125 4301 y(21.5)68 b(CherryPy)19
b(serv)o(er)h(deplo)o(yment)32 b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)
g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(62)125
4400 y(21.6)68 b(Database)20 b(con\002guration)31 b(.)41
b(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)102 b(62)125 4500 y(21.7)68 b(Sessions)80
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102
b(63)125 4599 y(21.8)68 b(Results)59 b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g
(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)102 b(63)0 4782 y Fm(22)41
b(Ho)o(w)20 b(to)f(str)o(eam)h(uploaded)g(\002les)i(dir)o(ectly)d(to)h
(disk)2117 b(65)p 0 5549 3901 4 v 0 5649 a Fk(ii)p eop
%%Page: 1 4
1 3 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3641 427
y Fj(ONE)p 0 515 V 22 978 a Fr(Ho)m(w)58 b(to)f(ser)6
b(v)-5 b(e)58 b(gzip-compressed)f(pages)g(with)3033 1227
y(Cherr)6 b(yPy)0 1714 y Fl(Most)20 b(bro)n(wser)f(support)f
(gzip-compression.)k(If)e(you)f(ha)n(v)o(e)g(lar)o(ge)g(HTML)h(pages)f
(\(40K)g(or)h(more\),)f(compressing)f(them)h(can)h(really)0
1814 y(mak)o(e)g(a)g(big)g(dif)n(ference)e(\(a)j(50K)e(page)h(might)f
(only)h(be)g(5-6K)f(when)h(it')-5 b(s)21 b(compressed\).)0
1961 y(Doing)g(that)h(with)g(CherryPy)f(is)i(really)f(easy)-5
b(.)30 b(It)22 b(only)g(tak)o(es)g(a)g(fe)n(w)g(lines)h(of)f(code)f
(and)g(uses)i(the)f Fi(initNonStaticResponse)d Fl(special)0
2060 y(function:)236 2298 y Fh(import)44 b(gzip,)g(cStringIO)236
2481 y(def)h(initNonStaticResponse\(\):)416 2572 y(#)f(Only)g(compress)
g(the)g(page)g(if)h(the)f(client)g(said)g(it)h(accepted)e(it)416
2664 y(if)h(request.headerMap.get\('accept-encoding')o(,)39
b(''\).find\('gzip'\)!=-1:)595 2755 y(#)45 b(Compress)e(page)595
2846 y(zbuf=cStringIO.StringIO\(\))595 2938 y
(zfile=gzip.GzipFile\(mode='wb',)d(fileobj=zbuf,)i(compresslevel=9\))
595 3029 y(zfile.write\(response.body\))595 3120 y(zfile.close\(\))595
3212 y(response.body=zbuf.getvalue\(\))595 3303 y
(response.headerMap['content-encoding'])o(='gzip)o(')p
0 5549 3901 4 v 3854 5649 a Fk(1)p eop
%%Page: 2 5
2 4 bop 0 5549 3901 4 v 0 5649 a Fk(2)p eop
%%Page: 3 6
3 5 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3623 427
y Fj(TW)n(O)p 0 515 V 495 978 a Fr(Ho)m(w)57 b(to)h(r)s(un)f(a)g(Cherr)
6 b(yPy)58 b(ser)6 b(v)-5 b(er)57 b(behind)3200 1227
y(Apache)0 1756 y Fg(2.1)121 b(Introduction)0 1988 y
Fl(CherryPy')-5 b(s)31 b(b)n(uilt-in)h(HTTP)g(serv)o(er)f(is)i(no)n(w)f
(pretty)f(rob)n(ust,)k(b)n(ut)d(some)g(people)f(might)g(still)i(w)o
(ant)g(to)f(run)f(CherryPy)g(behind)0 2088 y(Apache.)0
2235 y(Whether)22 b(to)h(run)e(CherryPy)h(e)o(xposed)f(or)h(behind)f
(Apache)h(depends)f(on)h(man)o(y)f(criteria)i(so)g(this)g(question)e
(is)j(out)e(of)g(the)h(scope)f(of)0 2334 y(this)f(Ho)n(wT)-7
b(o.)0 2481 y(This)16 b(Ho)n(wT)-7 b(o)16 b(will)h(sho)n(w)f(you)g(ho)n
(w)g(to)g(run)g(CherryPy)f(behind)g(Apache,)h(b)n(ut)g(you)f(can)h
(probably)e(adapt)i(it)h(for)f(an)o(y)f(other)h(webserv)o(er)-5
b(.)0 2628 y(There)19 b(are)h(se)n(v)o(eral)g(w)o(ays)h(to)f(run)f
(CherryPy)g(behind)g(Apache:)0 2956 y Fg(2.2)121 b(Using)34
b(persistent)g(CGI)0 3188 y Fl(The)c(w)o(ay)h(it)g(w)o(orks)g(is)g(v)o
(ery)f(easy)g(to)h(understand.)54 b(W)-7 b(e)32 b(use)f(a)g(small)g
(cgi)f(script)h(called)g Fm(cherrypcgi.cgi)e Fl(as)i(a)g(link)f
(between)0 3288 y(Apache)18 b(and)h(CherryPy)-5 b(.)23
b(When)c(someone)f(requests)h(a)g(page,)g(Apache)f(in)m(v)n(ok)o(es)g
(this)i(cgi)f(script.)25 b(The)19 b(script)g(then)g(connects)f(to)i
(the)0 3388 y(CherryPy)f(serv)o(er)m(,)g(gets)h(the)g(page)g(and)g
(returns)f(it)i(to)f(Apache.)0 3535 y(Of)h(course,)e(it)j(tak)o(es)f(a)
f(little)i(e)o(xtra)e(time)g(because)g(a)h(ne)n(w)g(process)f(is)h
(created)f(e)n(v)o(erytime)f(the)h(script)h(is)g(called.)26
b(And)20 b(also)h(because)0 3634 y(the)f(request)g(and)f(the)i
(response)e(go)h(through)e(the)i(script)g(instead)g(of)g(going)f
(directly)g(from)g(Apache)h(to)g(CherryPy)f(and)h(back.)0
3781 y(But)h(that)f(e)o(xtra)g(time)g(is)h(really)f(small,)h(so)f(it')
-5 b(s)22 b(not)e(a)g(big)g(problem.)k(\(and)19 b(if)i(you)e(ha)n(v)o
(e)h(a)g(really)g(high)g(traf)n(\002c)g(website,)g(you)f(can)h(use)0
3881 y(load)g(balancing)e(an)o(yw)o(ay)h(:-\))0 4166
y Ff(2.2.1)100 b(Example)0 4368 y Fl(The)25 b(cgi)f(script)h(uses)h
(the)f(HTTP)g(protocol)e(to)i(talk)g(to)g(the)g(CherryPy)f(serv)o(er)-5
b(.)38 b(Therefore,)24 b(the)h(CherryPy)f(serv)o(er)g(doesn')o(t)f(mak)
o(e)0 4468 y(an)o(y)c(dif)n(ference)g(between)g(talking)g(to)i(a)f(bro)
n(wser)f(or)h(talking)g(to)g(the)g(cgi)g(script.)0 4615
y(This)g(means)g(that)h(you)e(can)h(just)h(start)f(it)h(normally)-5
b(.)0 4762 y(If)21 b(you')l(re)f(on)h(Unix,)g(it')-5
b(s)23 b(probably)c(better)i(to)h(run)f(the)g(CherryPy)f(serv)o(er)h
(on)g(an)h(AF_UNIX)f(sock)o(et.)29 b(This)21 b(is)i(what)e(we)h(will)g
(do)f(in)0 4861 y(this)g(e)o(xample.)0 5008 y(T)-7 b(o)20
b(do)g(so,)g(edit)h(the)f(con\002guration)d(\002le)k(of)f(the)g
(CherryPyServ)o(er)e(and)h(enter)h(the)g(follo)n(wing)f(lines:)p
0 5549 3901 4 v 3854 5649 a Fk(3)p eop
%%Page: 4 7
4 6 bop 236 174 a Fh([server])236 266 y(socketFile=socketFile.soc)0
505 y Fl(This)20 b(means)g(that)h(the)f(CherryPy)f(serv)o(er)g(will)i
(listen)g(on)e(that)i(AF_UNIX)f(sock)o(et)g(instead)g(of)f(a)i(re)o
(gular)e(sock)o(et)h(port.)0 651 y(No)n(w)-5 b(,)19 b(just)i(edit)f
(the)h(`)p Fn(cherr)r(ypcgi.cgi)p Fl(')d(\002le)j(pro)o(vided)c(with)k
(the)f(distrib)n(ution)f(and)h(modify)e(the)i(line)h(that)f(says:)236
890 y Fh(socketFile='put)43 b(your)h(socket)g(file)g(here')0
1129 y Fl(Put)21 b(the)f(name)f(of)h(the)g(AF_UNIX)g(sock)o(et)g(where)
g(the)g(CherryPy)f(serv)o(er)g(is)j(listening.)0 1275
y(The)e(last)g(thing)f(to)i(do)e(is)i(to)f(con\002gure)e(Apache)h(so)h
(it)h(will)f(call)h(the)f(cgi)g(script)f(for)h(each)f(request:)25
b(In)19 b(Apache')-5 b(s)20 b(con\002guration)d(\002le)0
1375 y(\(`)p Fn(commonhttpd.conf)p Fl(')f(for)k(instance\),)f(add)h
(the)g(follo)n(wing)e(lines)j(\(of)f(course,)f(you)g(ha)n(v)o(e)h(to)g
(adapt)g(the)g(path)g(of)f(cherrypcgi.cgi\):)236 1613
y Fh(RewriteEngine)43 b(on)236 1705 y(RewriteRule)g(^\(.*\))h
(/home/cherrypy/cherrypcgi.cgi$1)c
([e=HTTP_CGI_AUTHORIZATION:\0451,t=applica)o(tion/x)o(-httpd)o(-cgi,l)o
(])0 1944 y Fl(And)20 b(that')-5 b(s)20 b(it)h(!)26 b(Start)20
b(Apache,)f(start)i(the)f(CherryPy)f(serv)o(er)h(and)f(it)i(should)e(w)
o(ork.)0 2090 y(It)j(is)g(also)g(possible)g(to)g(tweak)f
(cherrypcgi.cgi)d(so)k(it)h(automatically)d(restarts)i(the)g(CherryPy)e
(serv)o(er)h(if)h(it)g(e)n(v)o(er)f(goes)g(do)n(wn.)28
b(There)0 2190 y(will)21 b(be)f(another)f(Ho)n(wT)-7
b(o)19 b(on)h(this.)0 2518 y Fg(2.3)121 b(Using)34 b(F)-6
b(astCGI)0 2750 y Fl(F)o(astCgi)22 b(w)o(orks)g(v)o(ery)e(much)h(lik)o
(e)h(persistent)g(CGI,)g(e)o(xcept)e(the)i(cgi)g(script)g(is)g
(constantly)f(running.)28 b(This)21 b(means)h(that)g(no)f(process)0
2850 y(has)f(to)h(be)f(created)f(for)h(each)g(request,)f(which)h(sa)n
(v)o(es)g(a)h(lot)f(of)g(time)h(!)0 2997 y(The)d(current)g
(implementation)e(of)j(F)o(astCGI)g(in)g(CherryPy)f(is)h(not)g
(optimized)e(because)h(the)h(F)o(astCGI)g(script)g(is)h(a)f(standalone)
f(script)0 3096 y(that)23 b(connects)f(to)i(the)f(CherryPy)f(back)o
(end,)g(instead)h(of)g(being)f(directly)g(inte)o(grated)g(in)h(the)g
(back)o(end.)33 b(But)23 b(this)h(method)e(is)i(still)g(a)0
3196 y(lot)c(f)o(aster)h(than)e(persistent)h(CGI.)0 3343
y(The)g(F)o(astCGI)h(script)f(is)h(called)f Fm(cherryfcgi.cgi)0
3628 y Ff(2.3.1)100 b(Example)0 3831 y Fl(The)26 b(F)o(astCGI)h(script)
f(uses)h(the)f(HTTP)g(protocol)f(to)h(talk)h(to)f(the)g(CherryPy)f
(serv)o(er)-5 b(.)43 b(Therefore,)25 b(the)i(CherryPy)e(serv)o(er)g
(doesn')o(t)0 3930 y(mak)o(e)20 b(an)o(y)f(dif)n(ference)f(between)i
(talking)f(to)h(a)h(bro)n(wser)e(or)h(talking)f(to)i(the)f(F)o(astCGI)h
(script.)0 4077 y(This)f(means)g(that)h(you)e(can)h(just)h(start)f(it)h
(normally)-5 b(.)0 4224 y(If)21 b(you')l(re)f(on)h(Unix,)g(it')-5
b(s)23 b(probably)c(better)i(to)h(run)f(the)g(CherryPy)f(serv)o(er)h
(on)g(an)h(AF_UNIX)f(sock)o(et.)29 b(This)21 b(is)i(what)e(we)h(will)g
(do)f(in)0 4324 y(this)g(e)o(xample.)0 4471 y(T)-7 b(o)20
b(do)g(so,)g(edit)h(the)f(con\002guration)d(\002le)k(of)f(the)g
(CherryPyServ)o(er)e(and)h(enter)h(the)g(follo)n(wing)f(lines:)236
4709 y Fh([server])236 4800 y(socketFile=socketFile.soc)0
5039 y Fl(This)h(means)g(that)h(the)f(CherryPy)f(serv)o(er)g(will)i
(listen)g(on)e(that)i(AF_UNIX)f(sock)o(et)g(instead)g(of)f(a)i(re)o
(gular)e(sock)o(et)h(port.)0 5186 y(No)n(w)-5 b(,)19
b(just)i(edit)f(the)h(`)p Fn(cherr)r(yfcgi.cgi)p Fl(')d(\002le)j(pro)o
(vided)d(with)i(the)g(distrib)n(ution)f(and)h(modify)e(the)j(line)f
(that)g(says:)p 0 5549 3901 4 v 0 5649 a Fk(4)1742 b(Chapter)23
b(2.)52 b(Ho)o(w)23 b(to)g(r)q(un)g(a)h(Cherr)r(yPy)e(ser)r(v)n(er)g
(behind)i(Apache)p eop
%%Page: 5 8
5 7 bop 236 174 a Fh(socketFile='put)43 b(your)h(socket)g(file)g(here')
0 413 y Fl(Put)21 b(the)f(name)f(of)h(the)g(AF_UNIX)g(sock)o(et)g
(where)g(the)g(CherryPy)f(serv)o(er)g(is)j(listening.)0
560 y(The)28 b(last)h(thing)f(to)h(do)f(is)h(to)g(con\002gure)d(Apache)
i(so)h(it)g(will)g(connect)e(to)i(the)f(F)o(astCGI)h(script)g(for)f
(each)g(request:)41 b(In)28 b(Apache')-5 b(s)0 660 y(con\002guration)18
b(\002le)k(\(`)p Fn(commonhttpd.conf)p Fl(')17 b(for)j(instance\),)h
(add)f(the)h(follo)n(wing)e(lines)j(\(of)e(course,)g(you)g(ha)n(v)o(e)h
(to)g(adapt)f(the)h(path)g(of)0 759 y(cherrypcgi.cgi\):)236
998 y Fh(SetHandler)43 b(fastcgi-script)236 1089 y(RewriteEngine)g(on)
236 1180 y(RewriteRule)g(^\(.*\))h(/home/cherrypy/cherryfcgi.cgi/$1)c
([L])0 1419 y Fl(Y)-9 b(ou)19 b(also)h(need)f(to)h(mak)o(e)f(sure)h
(that)f(Apache)g(loads)h(the)f(F)o(astCGI)i(module.)i(The)c(follo)n
(wing)f(lines)j(should)d(be)i(some)n(where)e(in)i(your)0
1519 y(Apache)f(con\002guration)f(\002les:)236 1757 y
Fh(LoadModule)43 b(fastcgi_module)177 b(modules/mod_fastcgi.so)236
1848 y(AddModule)44 b(mod_fastcgi.c)0 2135 y Fl(And)20
b(that')-5 b(s)20 b(it)h(!)26 b(Start)20 b(Apache,)f(start)i(the)f
(CherryPy)f(serv)o(er)h(and)f(it)i(should)e(w)o(ork.)0
2281 y Fm(See)i(Also:)0 2428 y Fn(http://www)l(.f)n(astcgi.com)208
2528 y Fl(F)o(or)e(more)h(information)e(on)h(F)o(astCGI)0
2855 y Fg(2.4)121 b(Using)34 b(mod_re)n(wr)r(ite)0 3088
y Fl(It')-5 b(s)25 b(easy)g(to)g(con\002gure)d(Apache)i(so)h(it)g(just)
g(passes)h(all)f(requests)f(to)h(the)f(CherryPy)g(serv)o(er)m(,)g
(reads)g(the)h(response)e(and)h(passes)i(the)0 3188 y(response)19
b(to)i(the)f(client.)0 3335 y(This)g(method)f(is)i(a)g(bit)f(f)o(aster)
h(than)e(persistent)h(CGI)h(because)f(no)f(CGI)i(process)f(needs)g(to)g
(be)g(created)g(for)f(each)h(request.)0 3620 y Ff(2.4.1)100
b(Example)0 3822 y Fl(In)25 b(this)g(e)o(xample,)f(we')o(ll)h(assume)g
(that)g(the)g(web)g(site)g(is)h(www)-5 b(.cherryp)o(y)g(.or)o(g)19
b(and)25 b(that)f(the)h(CherryPy)f(serv)o(er)g(is)i(running)c(on)j(the)
0 3922 y(same)20 b(machine)f(as)i(Apache,)e(on)h(the)g(port)g(8000.)j
(Of)e(course,)e(you')o(ll)g(ha)n(v)o(e)h(to)g(adapt)g(it)h(for)e(your)g
(o)n(wn)h(con\002guration.)0 4069 y(Con\002guring)e(Apache)h(is)j(v)o
(ery)d(easy:)236 4307 y Fh(RewriteEngine)43 b(on)236
4398 y(RewriteRule)g(^\(.*\))h(http://localhost:8000$1)d([p])0
4685 y Fl(The)23 b(last)h(thing)e(we)h(ha)n(v)o(e)g(to)g(do)g(is)h
(tell)f(CherryPy)f(that)h(it')-5 b(s)24 b(serving)e(pages)h(for)f(www)
-5 b(.cherryp)o(y)g(.or)o(g)18 b(\(and)k(not)h(localhost\).)32
b(All)24 b(it)0 4784 y(tak)o(es)d(is)g(3)f(lines)h(of)e(code)h(in)g
(the)g Fi(initRequest)h Fl(special)g(function:)p 0 5549
3901 4 v 0 5649 a Fk(2.4.)52 b(Using)23 b(mod_re)n(wr)q(ite)2974
b(5)p eop
%%Page: 6 9
6 8 bop 236 174 a Fh(def)45 b(initRequest\(\):)416 266
y(request.headerMap['host']='www.cherr)o(ypy.or)o(g')416
357 y(request.base='http://www.cherrypy.or)o(g')416 448
y(request.browserUrl=request.browserUr)o(l.repl)o(ace\('h)o(ttp://)o
(localh)o(ost:80)o(00',)39 b('http://www.cherrypy.org'\))0
734 y Fl(And)20 b(v)n(oila)g(!)0 881 y(Note,)g(this)h(can)f(also)g(be)g
(done)f(with)i(mod_proxy)16 b(instead)k(of)g(mod_re)n(write.)0
1028 y(Man)o(y)f(thanks)h(to)g(Andreas)f(K)m(ostyrka)h(for)f(this)i
(tip.)p 0 5549 3901 4 v 0 5649 a Fk(6)1742 b(Chapter)23
b(2.)52 b(Ho)o(w)23 b(to)g(r)q(un)g(a)h(Cherr)r(yPy)e(ser)r(v)n(er)g
(behind)i(Apache)p eop
%%Page: 7 10
7 9 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3495 427
y Fj(THREE)p 0 515 V 349 978 a Fr(Ho)m(w)57 b(to)h(connect)g(a)f(Cherr)
6 b(yPy)57 b(ser)6 b(v)-5 b(er)57 b(to)h(a)3050 1227
y(database)0 1706 y Fl(Man)o(y)19 b(databases)h(already)f(ha)n(v)o(e)h
(a)g(corresponding)d(Python)i(module:)24 b(Oracle,)c(Sybase,)g(MySql,)f
(PostgreSql,)g(...)0 1853 y(Accessing)j(these)h(databases)g(from)e(a)i
(CherryPy)f(serv)o(er)g(is)h(really)f(easy)-5 b(.)33
b(All)23 b(you)f(ha)n(v)o(e)g(to)g(do)h(is)g(use)g(the)g
Fi(initServer)h Fl(function)d(to)0 1952 y(connect)e(to)h(the)h
(database.)0 2099 y(F)o(or)f(instance,)f(you)h(can)g(connect)f(to)h(a)h
(MySql)e(database)h(using)g(the)g(follo)n(wing)e(code)i(\(it)g(uses)h
(the)f(MySQLdb)f(Python)g(module\):)236 2337 y Fh(import)44
b(MySQLdb)236 2429 y(def)h(initServer\(\):)416 2520 y(global)e
(dbConnection)416 2611 y(dbConnection=MySQLdb.connect\(host,)c(user,)44
b(passwd,)f(schema\))0 2850 y Fl(The)20 b(follo)n(wing)e(code)i(is)h
(an)f(e)o(xample)f(of)h(running)e(a)j(query)d(and)i(using)g(the)g
(result)g(to)g(b)n(uild)g(a)h(page:)236 3088 y Fh(CherryClass)43
b(Root:)236 3180 y(view:)416 3271 y(def)h(index\(self\):)595
3362 y(#)h(Run)f(the)g(MySql)g(query)595 3454 y
(cursor=dbConnection.cursor\(\))595 3545 y(cursor.execute\("select)d
(count\(*\))i(from)i(user"\))595 3636 y(result=cursor.fetchall\(\))595
3728 y(cursor.close\(\))595 3910 y(page="<html><body>")595
4002 y(nbUser=result[0][0])595 4093 y(page+="There)e(are)h(\045s)h
(users)f(in)g(the)g(database"\045nbUser)595 4184 y
(page+="</body></html>)595 4276 y(return)g(page)0 4562
y Fl(This)19 b(e)o(xample)f(can)h(easily)h(be)f(adapted)f(for)g(an)o(y)
h(kind)f(of)h(database.)24 b(Just)c(\002nd)f(the)h(appropriate)c
(Python)i(module)g(for)h(the)g(database)0 4661 y(and)h(read)f(its)i
(documentation.)p 0 5549 3901 4 v 3854 5649 a Fk(7)p
eop
%%Page: 8 11
8 10 bop 0 5549 3901 4 v 0 5649 a Fk(8)p eop
%%Page: 9 12
9 11 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3561 427
y Fj(FOUR)p 0 515 V 288 978 a Fr(Ho)m(w)57 b(to)h(use)f(load-balancing)
f(f)-6 b(or)57 b(y)l(our)g(w)n(eb)3579 1227 y(site)0
1756 y Fg(4.1)121 b(Introduction)0 1988 y Fl(Ha)n(ving)20
b(a)g(lot)h(of)e(traf)n(\002c)h(on)g(their)g(web)g(site)h(is)g(what)g
(most)f(webmasters)f(dream)h(about)f(...)0 2135 y(Unfortunately)-5
b(,)27 b(it)h(also)h(comes)f(with)g(its)h(share)f(of)f(problems.)47
b(Basically)-5 b(,)30 b(if)f(requests)e(come)h(in)g(f)o(aster)g(than)g
(your)f(serv)o(er)g(can)0 2235 y(handle)19 b(them,)h(you')l(re)e(scre)n
(wed)i(:-\))0 2382 y(One)f(w)o(ay)f(to)h(deal)g(with)g(that)g(is)h(to)e
(use)h(load-balancing.)j(This)d(basically)f(means)h(that)g(se)n(v)o
(eral)f(threads)g(or)g(processes)h(will)g(be)g(serv-)0
2481 y(ing)j(the)g(pages.)30 b(It)22 b(is)h(only)e(ef)n(\002cient)h(if)
g(you)f(ha)n(v)o(e)h(se)n(v)o(eral)f(machines)g(or)h(if)g(your)f
(machine)g(has)h(se)n(v)o(eral)f(processors.)30 b(\(otherwise,)0
2581 y(the)20 b(same)h(processor)d(will)j(just)g(run)f(se)n(v)o(eral)f
(threads)h(or)g(processes,)f(b)n(ut)h(the)h(o)o(v)o(erall)d(speed)i
(will)h(be)f(the)g(same\).)0 2728 y(Of)f(course,)g(this)g(means)g(that)
g(you)f(ha)n(v)o(e)h(to)g(tak)o(e)g(care)g(of)g(the)g(data)g(sharing)f
(between)g(the)h(threads/processes.)k(One)c(w)o(ay)h(to)f(do)f(that)0
2827 y(is)j(to)f(use)g(a)g(database)f(where)g(you)g(store)h(all)g(the)g
(data)g(that)g(needs)f(to)h(be)g(shared)f(amongst)g(the)g(processes.)25
b(All)20 b(processes)g(read)f(and)0 2927 y(write)h(to)h(the)f(same)g
(database,)g(insuring)f(that)h(the)o(y)f(all)i(ha)n(v)o(e)f(the)g(same)
g(informations.)0 3074 y(There)k(are)h(tw)o(o)g(w)o(ays)h(to)f(do)f
(load-balancing)e(with)j(CherryPy)-5 b(.)38 b(One)25
b(of)f(them)h(is)h(easier)f(to)g(set)h(up,)f(b)n(ut)g(only)f(applies)h
(to)g(multi-)0 3174 y(processor)19 b(machines)g(running)f(a)j
(Unix-based)d(OS.)0 3501 y Fg(4.2)121 b(Gener)r(ic)33
b(load-balancing)j(method)0 3734 y Fl(Since)24 b(a)h(CherryPy)d(serv)o
(er)i(is)g(a)h(self-contained)d(process)h(that)i(includes)e(e)n(v)o
(erything)e(to)j(run)g(the)g(web)g(site,)h(it)g(is)g(easy)f(to)g(start)
h(as)0 3833 y(man)o(y)g(processes)h(as)h(you)e(w)o(ant)h(\(on)g(the)g
(same)g(machine)f(or)h(on)g(dif)n(ferent)f(machines\).)41
b(If)26 b(you)g(start)g(se)n(v)o(eral)g(processes)g(on)g(the)0
3933 y(same)20 b(machine,)e(you)g(just)i(ha)n(v)o(e)f(to)h(use)g(a)g
(dif)n(ferent)d(con\002guration)g(\002le)j(for)f(each)g(of)g(them)h(to)
f(specify)g(a)h(dif)n(ferent)e(port)g(each)i(time.)0
4080 y(Then)k(all)i(you)e(ha)n(v)o(e)h(to)g(do)g(is)h(use)f(a)h(simple)
f(load-balancer)e(\(there)h(are)h(man)o(y)f(of)h(those)g(out)g(there\))
f(to)h(redirect)f(the)i(requests)e(to)0 4180 y(your)19
b(CherryPy)g(serv)o(ers.)0 4326 y(Let')-5 b(s)21 b(tak)o(e)f(an)g(e)o
(xample:)125 4540 y Fe(\017)41 b Fl(Y)-9 b(ou)19 b(ha)n(v)o(e)h(3)g
(machines,)f(called)h(host1,)g(host2)f(and)h(host3)125
4706 y Fe(\017)41 b Fl(host2)19 b(and)h(host3)g(are)g(single-proc,)e
(and)h(host1)h(is)h(dual-proc.)125 4872 y Fe(\017)41
b Fl(F)o(or)21 b(the)g(load-balancer)m(,)e(we')o(ll)j(use)f
Fm(balance)p Fl(,)h(an)f(easy)g(to)h(use,)g(lightweight,)e(open)h
(source)f(load)h(balancer)g(a)n(v)n(ailable)g(from)208
4971 y Fn(http://balance)o(.sourcef)n(o)o(rge)n(.n)o(et)-6
b Fl(.)125 5137 y Fe(\017)41 b Fl(On)20 b(host1,)f(we')o(ll)i(run)e(2)h
(CherryPy)f(serv)o(ers)h(\(since)g(it')-5 b(s)21 b(dual-proc\))d(plus)i
(the)g(load-balancer)125 5304 y Fe(\017)41 b Fl(On)20
b(host2)f(and)h(host3,)f(we')o(ll)i(only)e(run)h(one)f(CherryPy)g(serv)
o(er)-5 b(.)p 0 5549 3901 4 v 3854 5649 a Fk(9)p eop
%%Page: 10 13
10 12 bop 125 83 a Fe(\017)41 b Fm(balance)17 b Fl(will)i(listen)g(on)f
(port)f(80.)24 b(The)18 b(CherryPy)f(serv)o(ers)g(on)h(host1)g(will)h
(listen)f(on)g(ports)g(8080)e(and)i(8081.)23 b(The)18
b(CherryPy)208 183 y(serv)o(ers)h(on)h(host2)g(and)f(host3)h(will)h
(listen)g(on)e(port)h(8080.)125 349 y Fe(\017)41 b Fl(Let')-5
b(s)20 b(assume)h(that)f(your)f(CherryPy)g(serv)o(er)g(\002le)i(is)g
(called)f(`)p Fn(MySer)r(v)n(er)l(.p)n(y)p Fl(')0 562
y(Here)g(is)h(what)f(we)h(ha)n(v)o(e)e(to)i(do:)125 775
y Fe(\017)41 b Fl(Cop)o(y)20 b(`)p Fn(MySer)r(v)n(er)l(.p)n(y)p
Fl(')h(on)g(host1,)f(host2)h(and)f(host3.)28 b(\(alternati)n(v)o(ely)-5
b(,)18 b(you)i(can)h(e)o(xport)f(the)h(\002le)h(system)f(from)f(one)h
(machine)208 875 y(to)f(the)g(others,)g(to)g(deal)g(with)g(only)g(one)f
(cop)o(y)h(of)g(the)g(\002le\))125 1041 y Fe(\017)41
b Fl(On)20 b(host1,)f(host2)h(and)f(host3,)h(create)g(a)g
(con\002guration)e(\002le)j(called)f(`)p Fn(MySer)r(v)n(er8080.cfg)p
Fl(')e(containing)g(the)i(follo)n(wing:)444 1265 y Fh([server])444
1356 y(socketPort=8080)208 1595 y Fl(On)g(host1,)f(create)h(another)f
(con\002guration)e(\002le)k(called)f(`)p Fn(MySer)r(v)n(er8081.cfg)p
Fl(')e(containing)g(the)i(follo)n(wing:)444 1820 y Fh([server])444
1911 y(socketPort=8081)125 2216 y Fe(\017)41 b Fl(On)20
b(host1,)f(host2)h(and)f(host3,)h(start)h(the)f(serv)o(ers)f(that)i
(listen)f(on)g(port)g(8080:)444 2440 y Fh([host1])43
b(\045)90 b(python)44 b(MyServer.py)f(-C)h(MyServer8080.cfg)444
2532 y([host2])f(\045)90 b(python)44 b(MyServer.py)f(-C)h
(MyServer8080.cfg)444 2623 y([host3])f(\045)90 b(python)44
b(MyServer.py)f(-C)h(MyServer8080.cfg)125 2928 y Fe(\017)d
Fl(On)20 b(host1,)f(start)i(the)f(second)f(serv)o(er)h(that)g(listens)h
(on)f(port)f(8081:)444 3153 y Fh([host1])43 b(\045)90
b(python)44 b(MyServer.py)f(-C)h(MyServer8081.cfg)125
3458 y Fe(\017)d Fl(No)n(w)20 b(all)g(you)g(ha)n(v)o(e)f(to)i(do)e(is)j
(start)e(the)g(load)g(balancer)f(and)h(indicate)f(what)i(the)f(a)n(v)n
(ailable)f(CherryPy)g(serv)o(ers)h(are:)444 3682 y Fh([host1])43
b(\045)i(/usr/sbin/balance)d(80)j(host1:8080)e(host1:8081)g(host2:8080)
g(host3:8080)0 4035 y Fl(And)20 b(v)n(oila)g(!)0 4362
y Fg(4.3)121 b(Multi-processor)-6 b(,)33 b(unix-based)i(machine)0
4595 y Fl(The)22 b(method)f(described)g(in)h(the)g(pre)n(vious)f
(section)h(w)o(orks)f(in)i(all)g(cases,)g(b)n(ut)f(if)g(you)g(ha)n(v)o
(e)f(a)i(unix-based)d(machine)h(with)h(multiple)0 4694
y(processors,)d(there)h(is)h(another)e(method)f(for)i(load-balancing)d
(with)j(CherryPy)-5 b(.)0 4841 y(The)27 b(trick)f(is)i(to)g(create)e
(the)h(sock)o(et)g(where)g(the)g(CherryPy)e(serv)o(er)h(will)i(listen,)
h(and)e(then)f(do)h(a)g Fm(f)n(ork\(\))p Fl(.)45 b(This)27
b(w)o(ay)-5 b(,)28 b(we')o(ll)f(ha)n(v)o(e)0 4941 y(multiple)i
(processes)g(listening)g(on)g(the)g(same)h(sock)o(et.)52
b(When)29 b(one)g(process)g(is)h(b)n(usy)f(b)n(uilding)f(a)i(page,)h
(the)e(ne)o(xt)g(one)g(will)h(be)0 5041 y(listening)20
b(on)g(the)g(sock)o(et)g(and)f(thus)i(serving)e(a)h(request)g(that)g
(might)g(come)f(in.)0 5187 y(This)h(feature)f(is)h(b)n(uilt)g(in.)25
b(All)20 b(you)f(ha)n(v)o(e)g(to)h(do)f(to)h(use)g(it)h(is)f(to)g(use)g
(the)g Fm(\002xedNumberOfPr)o(ocesses)e Fl(option)h(in)h(the)f
(con\002guration)0 5287 y(\002le)i(\(in)f(the)g Fi([server])i
Fl(section\):)p 0 5549 3901 4 v 0 5649 a Fk(10)1765 b(Chapter)23
b(4.)52 b(Ho)o(w)23 b(to)g(use)g(load-balancing)i(f)n(or)d(y)n(our)h(w)
o(eb)h(site)p eop
%%Page: 11 14
11 13 bop 236 174 a Fh([server])236 266 y(socketPort=80)236
357 y(fixedNumberOfProcesses=3)0 596 y Fl(And)20 b(that')-5
b(s)20 b(it.)0 743 y(Note:)30 b(This)22 b(method)f(is)j(only)d(useful)h
(if)h(your)e(machine)g(has)i(se)n(v)o(eral)f(processors.)30
b(If)23 b(not,)f(then)g(the)g(processor)f(will)j(run)d(multiple)0
842 y(CherryPy)e(processes,)h(b)n(ut)g(the)g(o)o(v)o(erall)f(speed)h(w)
o(on')o(t)f(be)h(impro)o(v)o(ed.)p 0 5549 3901 4 v 0
5649 a Fk(4.3.)52 b(Multi-processor)l(,)22 b(unix-based)i(machine)2266
b(11)p eop
%%Page: 12 15
12 14 bop 0 5549 3901 4 v 0 5649 a Fk(12)p eop
%%Page: 13 16
13 15 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3634 427
y Fj(FIVE)p 0 515 V 111 978 a Fr(Ho)m(w)58 b(to)f(compile)g(y)l(our)h
(code)f(in)g(deb)l(ug)f(mode)0 1468 y Fl(One)20 b(w)o(ay)g(to)g(deb)n
(ug)e(your)h(code)g(is)i(to)f(add)f Fd(print)h Fl(statements)g(in)g
(your)e(code.)25 b(The)19 b(output)g(will)h(sho)n(w)g(up)f(in)h(the)g
(windo)n(w)f(where)0 1567 y(the)29 b(CherryPy)f(serv)o(er)g(runs.)52
b(Ho)n(we)n(v)o(er)m(,)29 b(this)g(method)f(may)h(not)g(al)o(w)o(ays)g
(w)o(ork)g(\(for)f(instance,)i(if)g(the)f(serv)o(er)f(is)i(running)d
(as)j(a)0 1667 y(daemon)19 b(on)i(a)g(production)e(machine)g(and)i(you)
f(don')o(t)f(ha)n(v)o(e)i(access)g(to)g(its)h(standard)e(output\).)26
b(Plus)21 b(switching)g(from)f(deb)n(ug)g(mode)0 1766
y(to)g(non-deb)n(ug)e(mode)h(is)i(not)f(easy)g(\(you)f(ha)n(v)o(e)h(to)
g(comment)f(out)h(all)g(the)g Fd(print)g Fl(statements)h(...\).)0
1913 y(Another)f(w)o(ay)g(is)i(to)f(sa)n(v)o(e)g(this)h(output)e(in)h
(a)g(log)g(\002le.)27 b(Y)-9 b(ou)21 b(can)f(redirect)g(the)h(standard)
f(output)g(from)f(the)i(serv)o(er)m(,)f(or)h(you)f(can)g(write)0
2013 y(in)i(the)h(log)f(\002le)g(directly)g(from)f(your)g(code.)30
b(CherryPy)21 b(pro)o(vides)g(one)h(special)g(function,)f(one)g(CGTL)i
(tag)f(and)g(one)g(CHTL)g(tag)g(to)0 2113 y(do)e(that.)0
2259 y(The)g(special)g(function)f(is)i(called)f Fi(deb)n(ug)f
Fl(and)g(the)i(tag)f(is)h(called)f Fi(py-deb)n(ug)p Fl(.)j(The)o(y)c
(are)h(used)g(lik)o(e)g(this:)236 2498 y Fh(debug\('i=\045s'\045i\))236
2589 y(<py-debug="'i=\045s'\045i">)236 2680 y(<div)44
b(py-debug="'i=\045s'\045i"></div>)0 2919 y Fl(All)21
b(these)f(statements)g(ha)n(v)o(e)g(the)g(same)h(ef)n(fect:)j(add)c(a)h
(line)f(in)g(the)g(log)g(\002le.)0 3066 y(If)g(the)g(name)g(of)g(the)g
(CherryPy)f(serv)o(er)g(is)i(`)p Fn(RootSer)r(v)n(er)l(.p)n(y)p
Fl(',)d(the)i(name)g(of)g(the)g(log)g(\002le)h(is)g(`)p
Fn(RootSer)r(v)n(er)l(.log)p Fl('.)0 3213 y(Deb)n(ugging)d(can)j(be)f
(easily)h(turned)e(on)h(or)h(of)n(f)f(at)h(compile)e(time,)i(using)f
(the)g Fm(-D)h Fl(option)e(of)i(the)f(compiler)-5 b(.)25
b(If)c Fm(-D)f Fl(is)i(speci\002ed,)e(then)0 3313 y(deb)n(ugging)e(is)j
(turned)e(on:)236 3551 y Fh(python)44 b(../cherrypy.py)f(-D)h(Root.cpy)
0 3791 y Fl(If)20 b Fm(-D)g Fl(is)i(omitted,)d(deb)n(ugging)e(is)k
(turned)e(of)n(f.)0 3938 y(CherryPy)g(uses)i(a)f(special)g(global)g(v)n
(ariable)f(called)h Fi(_deb)n(ug)e Fl(that)i(can)g(be)g(accessed)g
(from)f(an)o(ywhere)g(in)h(your)f(code.)24 b(The)c(v)n(ariable)0
4037 y(is)h(1)f(if)h(deb)n(ugging)c(is)22 b(on,)d(0)h(otherwise.)p
0 5549 3901 4 v 3808 5649 a Fk(13)p eop
%%Page: 14 17
14 16 bop 0 5549 3901 4 v 0 5649 a Fk(14)p eop
%%Page: 15 18
15 17 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3707 427
y Fj(SIX)p 0 515 V 603 978 a Fr(Ho)m(w)57 b(to)h(use)f(the)h(hotReload)
e(f)-6 b(eature)58 b(of)3033 1227 y(Cherr)6 b(yPy)0 1756
y Fg(6.1)121 b(Introduction)0 1988 y Fl(The)20 b(de)n(v)o(elopment)d(c)
o(ycle)j(of)g(a)g(CherryPy)f(web)h(site)i(is)f(the)f(same)g(as)h(the)f
(de)n(v)o(elopment)e(c)o(ycle)h(of)h(a)h(re)o(gular)d(softw)o(are:)125
2183 y Fe(\017)41 b Fl(Write)20 b(source)g(\002les)125
2339 y Fe(\017)41 b Fl(Compile)19 b(them)125 2496 y Fe(\017)41
b Fl(If)20 b(compiler)e(generated)h(some)h(errors,)f(\002x)i(source)e
(\002les)i(and)f(try)g(to)g(compile)f(again)125 2652
y Fe(\017)41 b Fl(Once)19 b(compilation)g(w)o(as)i(OK,)f(stop)g
(running)f(e)o(x)o(ecutable)f(and)h(restart)i(the)f(ne)n(wly)f
(generated)g(e)o(x)o(ecutable)125 2809 y Fe(\017)41 b
Fl(If)26 b(we)h(\002nd)f(some)g(b)n(ugs)g(or)g(we)h(w)o(ant)f(some)h
(ne)n(w)f(features,)h(modify)e(the)h(source)g(\002les)h(and)f(go)g
(back)f(to)i(the)f(compilation)208 2908 y(stage)0 3103
y(The)20 b(compilation)e(process)i(is)h(usually)f(pretty)f(f)o(ast)i
(\(if)f(you)f(ha)n(v)o(e)h(a)h("decent")e(computer\).)0
3250 y(But)h(what)g(if)h(the)e(CherryPy)g(serv)o(er)g(has)h(a)h(long)e
(initialization)g(process)h(\(maybe)e(it)j(needs)e(to)h(connect)f(to)h
(se)n(v)o(eral)f(ressources,)g(lik)o(e)0 3349 y(databases,)25
b(or)g(it)g(needs)f(to)h(precompute)d(some)i(data\).)38
b(All)25 b(this)h(w)o(ork)d(is)j(usually)e(done)g(in)g(the)h
Fi(initServer)i Fl(special)d(function.)37 b(If)0 3449
y(this)21 b(initialization)e(tak)o(es)i(a)f(lot)h(of)f(time,)g(ha)n
(ving)f(to)h(stop)g(and)g(restart)g(the)g(serv)o(er)f(e)n(v)o(erytime)g
(you)g(mak)o(e)h(a)g(change)f(is)i(really)f(a)h(loss)0
3549 y(of)f(time)g(while)h(de)n(v)o(eloping)c(your)i(web)h(site.)0
3695 y(This)g(is)h(where)f(the)g Fi(hotReload)h Fl(feature)e(comes)h
(in.)25 b(It)20 b(allo)n(ws)h(you)e(to)h(refresh)g(your)e(code)i
(without)f(ha)n(ving)h(to)g(stop)g(the)g(serv)o(er)-5
b(.)0 4019 y Fg(6.2)121 b(Ho)n(w)34 b(does)h(it)e(w)o(or)r(k)g(?)0
4251 y Fl(When)24 b(it)h(recei)n(v)o(es)e(a)h Fi(hotReload)g
Fl(request,)g(the)g(serv)o(er)g(will)g(just)h(read)e(its)i(source)f
(code)f(again,)h(updating)e(all)i(the)g(CherryClasses)0
4351 y(code)f(and)g(recreating)f(ne)n(w)h(CherryClasses)h(instances)g
(with)f(the)h(ne)n(w)g(code.)34 b(It)24 b(will)g(not)f(e)o(x)o(ecute)g
Fi(initServer)i Fl(again.)34 b(Instead,)24 b(it)0 4451
y(will)d(e)o(x)o(ecute)e Fi(hotReloadInitServer)g Fl(if)h(an)o(y)-5
b(.)0 4774 y Fg(6.3)121 b(Ho)n(w)34 b(to)g(use)g(it)f(?)0
5007 y Fl(The)20 b Fi(hotReload)g Fl(feature)f(is)j(enabled)c(in)j(the)
f(e)o(x)o(ecutable)e(when)i(the)g(\002le)h(is)g(compiled)e(with)h(the)g
Fi(-D)h Fl(\003ag)f(\(deb)n(ug)f(mode\).)0 5154 y(T)-7
b(o)18 b(send)f(a)h Fi(hotReload)g Fl(request)f(to)h(a)g(running)d
(CherryPy)i(serv)o(er)m(,)g(just)h(use)g(the)f(little)i(script)e
(called)h(`)p Fn(cherr)r(yhotreload.p)n(y)p Fl(')13 b(pro)o(vided)0
5253 y(with)20 b(the)h(distrib)n(ution.)0 5400 y(Let')-5
b(s)21 b(tak)o(e)f(a)h(practical)e(e)o(xample)g(that)h(sho)n(ws)h(ho)n
(w)e(to)i(use)f(the)g Fi(hotReload)g Fl(feature:)p 0
5549 3901 4 v 3808 5649 a Fk(15)p eop
%%Page: 16 19
16 18 bop 125 83 a Fe(\017)41 b Fl(Y)-9 b(ou)19 b(write)i(a)f(\002rst)h
(v)o(ersion)e(of)h(your)f(source)g(\002le)i(called)f(`)p
Fn(Root.cp)n(y)p Fl(')125 249 y Fe(\017)41 b Fl(Y)-9
b(ou)19 b(compile)g(your)g(source)h(\002le)h(in)f(deb)n(ug)f(mode:)444
473 y Fh(python)44 b(../cherrypy.py)e(-D)j(Root.cpy)125
779 y Fe(\017)c Fl(In)19 b(a)i(windo)n(w)-5 b(,)19 b(you)g(start)i(the)
f(CherryPy)f(serv)o(er:)444 1003 y Fh(python)44 b(RootServer.py)125
1308 y Fe(\017)d Fl(No)n(w)20 b(you)f(ha)n(v)o(e)h(a)g(running)e
(CherryPy)h(serv)o(er)125 1474 y Fe(\017)41 b Fl(Y)-9
b(ou)19 b(realize)h(that)g(you)g(w)o(ant)g(to)g(change)f(something)g
(in)h(your)f(code)125 1640 y Fe(\017)41 b Fl(Just)28
b(update)f(your)f(source)h(\002le)i(and)e(recompile)f(it)j(\(in)e
(another)f(windo)n(w)-5 b(,)28 b(since)g(the)g(serv)o(er)f(is)i(still)g
(running)c(in)j(the)g(\002rst)208 1740 y(windo)n(w\))125
1906 y Fe(\017)41 b Fl(Send)19 b(the)i Fi(hotReload)f
Fl(request)f(to)i(the)f(running)e(serv)o(er)h(to)i(tell)f(it)h(to)g
(refresh)e(its)i(code:)444 2130 y Fh(python)44 b(cherryhotreload.py)d
(localhost:8080)208 2369 y Fl(\(This)32 b(assumes)g(that)g(the)h(serv)o
(er)e(is)i(running)d(on)i(localhost:8080.)59 b(Of)32
b(course,)i(you)e(ha)n(v)o(e)f(to)i(adapt)f(it)h(for)e(your)g(o)n(wn)
208 2469 y(con\002guration\))125 2635 y Fe(\017)41 b
Fl(In)19 b(the)i(windo)n(w)e(where)g(the)i(serv)o(er)e(is)i(running,)d
(you)h(see)i(a)g(message)f(saying)f(that)h(it)h(has)g(performed)c(the)j
Fi(hotReload)0 2848 y Fl(W)-7 b(arning:)30 b(After)23
b(a)g Fi(hotReload)r Fl(,)f(the)h(line)g(numbers)f(that)h(the)g(p)o
(ython)e(interpreter)h(might)g(gi)n(v)o(e)g(you)g(in)h(case)h(of)f(an)f
(error)g(may)h(not)0 2948 y(match)d(your)f(source)g(\002le.)26
b(This)20 b(happens)f(if)h(you)g(add)f(or)h(remo)o(v)o(e)e(lines)j(of)f
(code)f(before)g(the)h Fi(hotReload)p 0 5549 3901 4 v
0 5649 a Fk(16)1672 b(Chapter)23 b(6.)52 b(Ho)o(w)23
b(to)g(use)g(the)h(hotReload)g(f)n(eature)f(of)h(Cherr)r(yPy)p
eop
%%Page: 17 20
17 19 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3495 427
y Fj(SEVEN)p 0 515 V 2101 978 a Fr(Ho)m(w)57 b(to)h(use)f(caching)0
1506 y Fg(7.1)121 b(Introduction)36 b(to)e(caching)0
1739 y Fl(If)23 b(you)f(ha)n(v)o(e)g(a)h(web)g(site)h(where)e(pages)g
(tak)o(e)h(a)h(long)e(time)h(to)g(b)n(uild)f(b)n(ut)h(don')o(t)e
(change)h(too)g(often,)h(then)f(caching)g(is)i(just)f(the)g(tool)0
1839 y(you)c(need)h(to)g(speed)g(up)g(your)f(web)h(site.)0
1986 y(Here)g(is)h(ho)n(w)f(caching)f(w)o(orks:)125 2199
y Fe(\017)41 b Fl(The)19 b(\002rst)i(time)g(someone)e(requests)g(a)i
(page,)e(the)h(serv)o(er)g(b)n(uilds)g(the)g(page)g(normally)e(and)i
(returns)f(the)h(page)g(to)g(the)g(client)125 2365 y
Fe(\017)41 b Fl(The)23 b(serv)o(er)f(also)i(sa)n(v)o(es)g(a)f(cop)o(y)g
(of)g(the)g(page)g("some)n(where")f(for)h(later)g(retrie)n(v)n(al.)34
b(It)23 b(also)h(sets)g(a)g(delay)f(for)g(ho)n(w)f(long)h(this)208
2465 y(cop)o(y)c(can)h(be)g(used.)125 2631 y Fe(\017)41
b Fl(The)19 b(ne)o(xt)h(time)g(someone)f(requests)h(the)g(same)h(page,)
e(the)h(serv)o(er)f(uses)i(the)f(cop)o(y)g(it)g(made)g(instead)g(of)g
(reb)n(uilding)e(the)j(page.)125 2797 y Fe(\017)41 b
Fl(When)20 b(the)g(cop)o(y)f(e)o(xpires,)g(the)h(serv)o(er)g(b)n(uilds)
g(a)g(ne)n(w)g(v)o(ersion)f(of)h(the)g(page.)0 3124 y
Fg(7.2)121 b(Caching)34 b(with)g(Cherr)t(yPy)0 3374 y
Ff(7.2.1)100 b(Where)29 b(are)g(pages)g(stored)g(?)0
3577 y Fl(W)m(ith)19 b(CherryPy)-5 b(,)17 b(all)i(pages)f(are)h(sa)n(v)
o(ed)f(in)h(memory)-5 b(.)22 b(This)d(allo)n(ws)g(for)f(maximum)f
(speed,)h(b)n(ut)g(it)i(also)f(means)f(that)h(the)f(size)i(of)e(your)0
3676 y(process)25 b(will)h(gro)n(w)e(really)h(f)o(ast)h(if)g(you)e
(cache)h(lots)h(of)f(big)g(pages.)40 b(T)-7 b(o)26 b(a)n(v)n(oid)f
(that,)h(CherryPy)e(pro)o(vides)g(a)i(w)o(ay)f(to)h("pur)o(ge")d(old)0
3776 y(pages)d(that)g(are)g(in)h(the)f(cache.)0 4061
y Ff(7.2.2)100 b(Ho)o(w)28 b(does)g(it)g(kno)o(w)g(if)f(a)h(page)h(is)f
(already)h(in)g(the)f(cache)g(?)0 4264 y Fl(The)20 b(page)f(that)i(a)f
(serv)o(er)g(returns)f(to)h(a)h(client)f(usually)g(depends)f(on)g(3)i
(parameters:)125 4477 y Fe(\017)41 b Fl(The)19 b(URL)i(that)f(the)h
(client)f(requested)125 4643 y Fe(\017)41 b Fl(The)19
b(parameters)g(that)i(the)f(client)g(sent)h(\(via)e(a)i(GET)f(or)g(a)h
(POST\))125 4809 y Fe(\017)41 b Fl(The)19 b(cookies)h(that)g(the)g
(client)h(sent)0 5022 y(CherryPy)h(lets)i(you)e(de\002ne)g(what)h(your)
f(cache)g("k)o(e)o(y")g(will)i(be.)33 b(T)-7 b(w)o(o)24
b(requests)e(that)h(ha)n(v)o(e)g(the)g(same)g(cache)g(k)o(e)o(y)f(will)
i(recei)n(v)o(e)e(the)0 5122 y(same)e(response)g(from)f(the)h(serv)o
(er)-5 b(.)0 5269 y(F)o(or)26 b(instance,)h(if)f(your)f(pages)g(don')o
(t)g(depend)f(on)i(cookies,)g(your)f(cache)h(k)o(e)o(y)f(could)g(just)i
(be)f Fi(r)m(equest.br)l(owserUrl)p Fl(.)43 b(But)26
b(if)h(your)0 5368 y(pages)20 b(depend)e(on)i(cookies,)f(your)g(cache)h
(k)o(e)o(y)f(can)h(be)h Fi(r)m(equest.br)l(owserUrl+str\(r)m
(equest.simpleCookie\))p Fl(.)p 0 5549 3901 4 v 3808
5649 a Fk(17)p eop
%%Page: 18 21
18 20 bop 0 83 a Ff(7.2.3)100 b(Ho)o(w)28 b(do)g(I)g(control)g(which)h
(pages)g(I)e(w)o(ant)h(to)f(cache)i(or)f(not)g(?)0 286
y Fl(It)20 b(is)h(v)o(ery)d(easy)-5 b(.)25 b(All)20 b(you)f(ha)n(v)o(e)
g(to)h(do)f(is)i(use)f Fi(initRequest)h Fl(or)e Fi
(initNonStaticRequest)g Fl(to)h(set)g(a)h(couple)d(of)i(special)f(v)n
(ariables)g(if)h(you)0 386 y(w)o(ant)g(to)h(use)f(caching:)125
588 y Fe(\017)41 b Fi(r)m(equest.cac)o(heK)m(e)n(y)p
Fl(:)23 b(this)d(is)h(the)g(cache)e(k)o(e)o(y)h(as)h(described)e(in)h
(the)g(pre)n(vious)f(section)125 749 y Fe(\017)41 b Fi(r)m(equest.cac)o
(heExpir)m(e)p Fl(:)22 b(This)e(is)i(the)e(time)g(the)g(cached)g(v)o
(ersion)f(of)g(the)i(page)e(will)i(e)o(xpire)0 952 y(Let')-5
b(s)21 b(tak)o(e)f(an)g(e)o(xample:)125 1155 y Fe(\017)41
b Fl(Y)-9 b(ou)19 b(ha)n(v)o(e)h(a)g(web)g(site)h(with)g(3)f(main)g
(parts:)25 b(/part1,)19 b(/part2)h(and)f(/part3)125 1315
y Fe(\017)41 b Fl(P)o(ages)24 b(under)e(/part1)h(are)h(complicated)f
(to)h(b)n(uild,)g(and)g(the)g(pages)f(might)h(change)f(e)n(v)o(ery)f
(30)i(minutes:)32 b(we')o(ll)25 b(use)f(caching)208 1415
y(on)19 b(this)i(part)f(and)g(the)g(caching)f(delay)g(will)i(be)f(set)h
(to)g(10)e(minutes.)125 1576 y Fe(\017)41 b Fl(P)o(ages)24
b(under)e(/part2)h(are)h(complicated)e(to)j(b)n(uild,)f(and)f(the)h
(pages)g(might)f(change)g(e)n(v)o(ery)f(day:)32 b(we')o(ll)25
b(use)f(caching)f(on)g(this)208 1675 y(part)c(and)h(the)g(caching)f
(delay)h(will)h(be)f(set)h(to)f(12)g(hours.)125 1836
y Fe(\017)41 b Fl(P)o(ages)20 b(under)f(/part3)g(are)h(v)o(ery)f(f)o
(ast)i(to)f(b)n(uild,)g(and)f(not)h(man)o(y)f(people)g(visit)i(this)g
(area:)k(we)c(w)o(on')o(t)e(use)h(caching)f(on)h(this)h(part)125
1997 y Fe(\017)41 b Fl(P)o(ages)20 b(only)f(depend)g(on)g(the)i(URL,)f
(not)g(on)g(cookies:)k(we')o(ll)d(use)f(the)g(URL)h(as)g(the)f(cache)g
(k)o(e)o(y)0 2200 y(Here)g(is)h(what)f(the)h Fi(initNonStaticRequest)e
Fl(special)h(function)f(will)i(look)e(lik)o(e:)236 2438
y Fh(import)44 b(time)236 2620 y(def)h(initNonStaticRequest\(\):)416
2712 y(if)f(request.path.find\('part1'\)==0:)595 2803
y(request.cacheKey=request.browserUrl)595 2894 y
(request.cacheExpire=time.time\(\)+30*60)38 b(#)45 b(30)g(minutes)416
2986 y(elif)f(request.path.find\('part2'\)==0:)595 3077
y(request.cacheKey=request.browserUrl)595 3168 y
(request.cacheExpire=time.time\(\)+12*60*)o(60)39 b(#)45
b(12)f(hours)0 3407 y Fl(That')-5 b(s)20 b(all)h(!)k(Just)c(restart)g
(your)e(serv)o(er)g(and)h(the)g(pages)g(will)g(be)h(cached)0
3690 y Ff(7.2.4)100 b(Ho)o(w)28 b(do)g(I)g(control)g(when)h(the)f
(cache)h(is)e(purged)j(?)0 3893 y Fl(Since)18 b(all)g(cached)f(pages)h
(are)g(stored)f(in)h(memory)-5 b(,)16 b(the)i(memory)e(usage)i(of)g
(the)g(serv)o(er)f(will)h(gro)n(w)f(really)h(f)o(ast)g(if)h(it)f(has)h
(to)f(cache)f(lots)0 3992 y(of)24 b(dif)n(ferent)f(pages)h(\(or)m(,)h
(to)f(be)h(more)e(precise,)i("dif)n(ferent)e(cache)h(k)o(e)o(ys"\),)h
(especially)f(if)h(these)f(pages)g(are)h(big.)37 b(F)o(or)25
b(this)g(reason,)0 4092 y(you)j(should)g(only)h(cache)f(pages)h(for)g
(which)f(it)i(will)g(really)f(mak)o(e)g(a)g(speed)g(dif)n(ference)e
(\(good)g(candidates)i(are)g(pages)f(that)i(are)0 4192
y(complicated)19 b(to)h(b)n(uild)g(b)n(ut)g(that)g(don')o(t)f(change)g
(too)g(often\).)0 4339 y(If)h(all)h(your)e(pages)h(in)g(the)g(cache)g
(are)g(requested)f(v)o(ery)g(often,)g(there)h(isn')o(t)g(much)f(you)g
(can)h(do)g(to)g(lo)n(wer)g(the)g(memory)f(usage.)0 4485
y(But)h(if)g(some)f(of)g(them)g(are)g(only)g(requested)f(once)h(in)g(a)
h(while,)f(then)g(it)h(might)f(be)h(w)o(orth)e(it)i(to)g(remo)o(v)o(e)d
(them)i(from)g(the)g(cache)g(when)0 4585 y(the)o(y)g(ha)n(v)o(en')o(t)g
(been)g(requested)g(for)h(a)g(long)g(time.)25 b(This)20
b(will)h(free)f(up)g(some)g(memory)-5 b(.)0 4732 y(T)e(o)23
b(control)e(ho)n(w)h(often)f(CherryPy)h(will)h(pur)o(ge)d(the)j(cache,)
f(use)h(a)g(parameter)e(called)h Fi(\003ushCac)o(heDelay)e
Fl(in)j(the)f(section)g Fi(cac)o(he)g Fl(of)0 4832 y(the)e(con\002g)g
(\002le:)236 5070 y Fh([cache])236 5161 y(flushCacheDelay=10)42
b(#)j(In)f(minutes)0 5400 y Fl(The)20 b(def)o(ault)f(v)n(alue)h(for)f
(the)i Fi(\003ushCac)o(hDelay)c Fl(is)22 b(zero,)d(which)h(means)g
(that)g(the)g(cache)g(will)h(ne)n(v)o(er)d(be)j(\003ushed.)p
0 5549 3901 4 v 0 5649 a Fk(18)2646 b(Chapter)23 b(7.)52
b(Ho)o(w)23 b(to)g(use)g(caching)p eop
%%Page: 19 22
19 21 bop 0 83 a Fl(Note:)25 b(This)c(parameter)d(is)j(only)f(useful)f
(in)i(v)o(ery)e(speci\002c)h(cases,)h(so)f(you)g(probably)e(don')o(t)g
(need)i(to)g(use)g(it)h(...)p 0 5549 3901 4 v 0 5649
a Fk(7.2.)52 b(Caching)24 b(with)f(Cherr)r(yPy)2771 b(19)p
eop
%%Page: 20 23
20 22 bop 0 5549 3901 4 v 0 5649 a Fk(20)p eop
%%Page: 21 24
21 23 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3535 427
y Fj(EIGHT)p 0 515 V 1368 978 a Fr(Ho)m(w)57 b(can)h(w)n(ebdesigners)e
(and)75 1227 y(w)n(ebde)-6 b(v)h(elopers)56 b(collabor)n(ate)h(on)g(a)g
(Cherr)6 b(yPy)3280 1476 y(project)0 2005 y Fg(8.1)121
b(Introduction)0 2237 y Fl(The)17 b(tw)o(o)g(common)e(kinds)h(of)h
(people)f(in)m(v)n(olv)o(ed)e(in)k(a)f(website)g(de)n(v)o(elopment)d
(are)j(designers)f(and)g(de)n(v)o(elopers.)22 b(Designers)16
b(typically)0 2337 y(tak)o(e)k(care)g(of)g(the)g(presentation)f(of)h
(the)g(pages,)g(and)f(de)n(v)o(elopers)f(tak)o(e)j(care)f(of)f(the)i
(content)e(and)g(the)i(logic)e(behind)g(the)h(web)g(site.)0
2484 y(Designers)d(and)g(de)n(v)o(elopers)f(don')o(t)g(use)i(the)g
(same)g(tools:)24 b(designers)17 b(usually)g(use)h(an)f(HTML)h(editor)f
(\(for)g(instance,)g(Dreamwea)n(v)o(er)0 2584 y(or)j(Amaya\))f(and)h
(de)n(v)o(elopers)e(use)i(a)h(te)o(xt)f(editor)f(and)h(CherryPy)-5
b(.)0 2911 y Fg(8.2)121 b(Ho)n(w)34 b(can)g(the)n(y)g(collabor)o(ate)h
(?)0 3144 y Fl(It')-5 b(s)21 b(v)o(ery)e(easy:)125 3357
y Fe(\017)41 b Fl(Designers)19 b(create)h(template)g(\002les)h(with)f
(their)g(HTML)g(editor)125 3523 y Fe(\017)41 b Fl(De)n(v)o(elopers)18
b(edit)i(the)h(template)e(\002les)i(and)f(add)g(some)g(dynamic)e(data)i
(if)h(needed)e(\(using)g(CHTL\))125 3689 y Fe(\017)41
b Fl(Since)25 b(CGTL)g(is)h(HTML-editor)n(-safe,)d(designers)h(can)h
(re-edit)f(the)h(template)g(\002les)h(and)e(add)h(ne)n(w)f(HTML)h
(code,)g(without)208 3789 y(losing)19 b(the)i(dynamic)d(information.)
125 3955 y Fe(\017)41 b Fl(De)n(v)o(elopers)18 b(include)h(the)h
(template)g(\002les)h(in)g(their)f(CherryPy)f(source)g(code)g(using)h
(the)g(<p)o(y-include>)e(tag)i(in)h(their)e(masks:)444
4179 y Fh(<div)44 b(py-include="header.html">header</div>)128
b(\(CHTL)44 b(form\))444 4270 y(or)444 4362 y
(<py-include="header.html">)c(\(CGTL)k(form\))0 4714
y Fl(The)23 b(template)g(\002le)i(will)f(be)f(included)f(in)i(the)g
(code)f(by)g(the)g(CherryPy)g(preprocessor)e(\(v)o(ery)h(much)h(lik)o
(e)h(an)f("#include")f(directi)n(v)o(e)0 4814 y(in)h(C\).)g(T)-7
b(o)23 b(\002nd)f(the)h(template)f(\002les,)i(the)f(preprocessor)d
(will)j(look)f(in)h(the)g(same)g(directories)e(as)j(for)e(the)g(other)g
(source)g(\002les)i(\(`)p Fn(/lib)p Fl(',)0 4913 y(`)p
Fn(/src)p Fl(',)c(directories)f(speci\002ed)h(with)h(the)f(-I)g
(\003ag,)g(etc.\))p 0 5549 3901 4 v 3808 5649 a Fk(21)p
eop
%%Page: 22 25
22 24 bop 0 85 a Fg(8.3)121 b(Example)0 318 y Fl(In)26
b(this)h(e)o(xample,)f(we')o(ll)h(b)n(uild)f(a)h(small)g(website)f
(with)h(only)e(2)i(pages.)43 b(Each)26 b(page)f(will)i(be)g(made)e(of)i
(a)f(header)m(,)h(a)f(body)f(and)h(a)0 418 y(footer)-5
b(.)24 b(The)c(header)f(and)h(the)g(footer)f(will)i(be)f(the)g(same)h
(on)e(both)h(pages,)f(e)o(xcept)g(the)o(y)h(will)h(ha)n(v)o(e)e(a)i
("you)e(are)h(here")g(label.)0 564 y(Let')-5 b(s)21 b(go)f(step)g(by)g
(step)125 778 y Fe(\017)41 b Fl(The)19 b(webdesigners)g(create)h(4)g
(\002les)h(with)g(their)f(f)o(a)n(v)n(orite)f(HTML)h(editor:)444
1002 y Fh(*******************)444 1093 y(*)44 b(File)h(header.html)444
1185 y(*******************)444 1276 y(<html><body>)444
1367 y(Welcome)e(to)i(the)f(CherryPy)g(py-include)f(demo.<br>)444
1459 y(You)h(are)g(here:)g(home<br><br>)444 1641 y(*******************)
444 1733 y(*)g(File)h(footer.html)444 1824 y(*******************)444
1915 y(<br><br><small>Don't)c(forget)j(to)h(eat)f(cherry)g(pie)g(every)
g(day</small>)444 2006 y(</body></html>)444 2189 y(*******************)
444 2280 y(*)g(File)h(page1.html)444 2372 y(*******************)444
2463 y(Header)444 2646 y(Welcome)e(to)i(page1.<br>)444
2737 y(Click)f(<a)g(href="page2">here</a>)e(to)i(go)h(to)f(page)g(2.)
444 2920 y(Footer)444 3102 y(*******************)444
3194 y(*)g(File)h(page2.html)444 3285 y(*******************)444
3376 y(Header)444 3559 y(Welcome)e(to)i(page2.<br>)444
3650 y(Click)f(<a)g(href="page1">here</a>)e(to)i(go)h(to)f(page)g(1)444
3833 y(Footer)208 4072 y Fl(Nothing)18 b(too)i(f)o(anc)o(y)f(so)i(f)o
(ar)-5 b(.)25 b(W)-7 b(e)22 b(just)e(ha)n(v)o(e)g(a)g(header)m(,)f(a)i
(footer)m(,)d(and)i(tw)o(o)g(bodies.)k(Ev)o(erything)18
b(is)j(static.)125 4238 y Fe(\017)41 b Fl(At)20 b(this)h(point,)e(the)h
(webde)n(v)o(elopers)e(will)j(edit)f(the)g(html)g(\002les)h(and)f(add)g
(some)g(dynamic)e(information:)307 4404 y Fm(\226)41
b Fl(In)20 b(header)-5 b(.html,)18 b(change)h('home')g(into)h('<di)n(v)
f(p)o(y-e)n(v)n(al="youAreHereLabel">h)o(om)o(e</di)n(v)o(>')307
4537 y Fm(\226)41 b Fl(In)22 b(page1.html)e(and)i(page2.html,)f(change)
g('Header')f(into)i('<di)n(v)g(p)o(y-include="header)-5
b(.html">Head)o(er</d)o(i)n(v>')16 b(and)390 4636 y('F)o(ooter')j(into)
h('<di)n(v)f(p)o(y-include="footer)-5 b(.html">F)o(oo)o(ter</d)o(i)n
(v>')125 4803 y Fe(\017)41 b Fl(No)n(w)20 b(the)g(templates)g(are)g
(ready)-5 b(,)18 b(and)i(the)g(webde)n(v)o(elopers)e(can)i(write)g
(their)g(CherryPy)f(source)g(code:)p 0 5549 3901 4 v
0 5649 a Fk(22)518 b(Chapter)24 b(8.)52 b(Ho)o(w)23 b(can)f(w)o
(ebdesigners)i(and)f(w)o(ebde)n(v)n(elopers)g(collabor)o(ate)i(on)e(a)g
(Cherr)r(yPy)g(project)p eop
%%Page: 23 26
23 25 bop 444 174 a Fh(CherryClass)43 b(Root:)444 266
y(mask:)623 357 y(def)h(page1\(self,)f(youAreHereLabel='page1'\):)802
448 y(<py-include="page1.html">)623 540 y(def)h(page2\(self,)f
(youAreHereLabel='page2'\):)802 631 y(<py-include="page2.html">)208
903 y Fl(W)-7 b(e)20 b(no)n(w)e(ha)n(v)o(e)h(a)h(w)o(orking)d(v)o
(ersion)h(of)h(the)g(web)g(site:)26 b(just)19 b(compile)f(the)i
(CherryPy)e(source)g(\002le,)i(run)e(the)h(serv)o(er)f(and)h(test)h
(it.)125 1069 y Fe(\017)41 b Fl(No)n(w)-5 b(,)16 b(let')-5
b(s)18 b(assume)f(that)f(the)h(designers)f(w)o(ant)h(to)g(change)e
(something)g(in)i(the)g(look)f(of)g(the)h(page:)23 b(the)o(y)15
b(w)o(ant)i(the)g("CherryPy")208 1169 y(w)o(ord)22 b(in)h(the)h(header)
e(to)h(be)g(displayed)f(in)h(bold)g(.)34 b(T)-7 b(o)23
b(do)g(so,)h(all)g(the)o(y)e(ha)n(v)o(e)h(to)g(do)g(is)h(edit)f(the)g
("header)-5 b(.html")21 b(\002le)j(and)f(put)208 1268
y(the)k("CherryPy")e(w)o(ord)i(in)g(bold.)44 b(The)27
b(HTML)g(editor)f(should)g(lea)n(v)o(e)h(the)g('<di)n(v)f(p)o(y-e)n(v)n
(al="youAreHere">hom)o(e</di)n(v)o(>)208 1368 y(untouched.)c(\(it)e(k)o
(eeps)g(the)h(dynamic)d(information\).)p 0 5549 3901
4 v 0 5649 a Fk(8.3.)52 b(Example)3296 b(23)p eop
%%Page: 24 27
24 26 bop 0 5549 3901 4 v 0 5649 a Fk(24)p eop
%%Page: 25 28
25 27 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3614 427
y Fj(NINE)p 0 515 V 1073 978 a Fr(Ho)m(w)58 b(to)f(use)h(SSL)e(with)i
(Cherr)6 b(yPy)0 1506 y Fg(9.1)121 b(Introduction)0 1739
y Fl(There)19 b(are)h(se)n(v)o(eral)g(w)o(ays)h(to)f(mak)o(e)g(an)g
(SSL)h(CherryPy)e(website:)125 1953 y Fe(\017)41 b Fl(Either)19
b(by)h(running)e(the)i(CherryPy)f(serv)o(er)h(behind)e(Apache)i(and)f
(by)h(con\002guring)e(Apache)h(to)h(handle)f(SSL)125
2119 y Fe(\017)41 b Fl(Or)20 b(by)g(running)e(the)i(CherryPy)f(serv)o
(er)g(directly)h(and)f(by)h(con\002guring)e(CherryPy)h(to)h(handle)f
(SSL)0 2332 y(Only)h(the)g(second)f(option)g(is)i(co)o(v)o(ered)d(in)j
(this)f(Ho)n(wT)-7 b(o.)0 2659 y Fg(9.2)121 b(Prerequisite)0
2892 y Fl(CherryPy')-5 b(s)26 b(SSL)h(support)e(is)i(based)f(on)g(the)h
(PyOpenSSL)f(package.)42 b(Y)-9 b(ou)26 b(can)g(get)h(it)g(at)g
Fn(http://p)n(y)o(openssl.sourcef)n(o)o(rge)n(.ne)o(t)-6
b Fl(.)44 b(I)0 2992 y(recommend)18 b(using)j(v)o(ersion)e(0.5.1)h(or)g
(higher)g(of)h(PyOpenSSL.)e(Problems)h(ha)n(v)o(e)h(been)f(reported)f
(with)i(earlier)f(v)o(ersions)g(on)h(some)0 3091 y(platforms.)0
3238 y(Y)-9 b(ou)20 b(can)g(test)h(your)e(installation)g(by)h(\002ring)
g(up)g(the)g(Python)f(interpreter)f(and)i(typing:)236
3476 y Fh(>>>)45 b(import)e(OpenSSL)236 3568 y(>>>)0
3807 y Fl(If)20 b(this)h(doesn')o(t)d(w)o(ork)i(for)g(you,)f(then)g
(PyOpenSSL)h(is)h(not)f(correctly)e(installed)j(on)e(your)g(system.)0
4134 y Fg(9.3)121 b(Con\002gur)r(ing)35 b(the)f(Cherr)t(yPy)f(ser)t(v)m
(er)0 4367 y Fl(Once)28 b(you)f(ha)n(v)o(e)h(PyOpenSSL)f(installed,)j
(all)f(you)e(ha)n(v)o(e)h(to)g(do)g(is)h(add)f(2)g(lines)h(in)f(your)f
(CherryPy)g(con\002g)g(\002le,)k(in)d(the)h Fi(server)0
4467 y Fl(section:)236 4705 y Fh(sslKeyFile=/path/to/ssl/key/file)236
4796 y(sslCertificateFile=/path/to/ssl/certific)o(ate/fi)o(le)0
5082 y Fl(And)20 b(that')-5 b(s)20 b(it)h(!)0 5229 y(A)g("real-w)o
(orld")d(sample)i(con\002g)f(\002le)i(for)f(an)g(SSL)h(site)g(might)e
(be:)p 0 5549 3901 4 v 3808 5649 a Fk(25)p eop
%%Page: 26 29
26 28 bop 236 174 a Fh([server])236 266 y(socketPort=443)236
357 y(sslKeyFile=server.pkey)236 448 y(sslCertificateFile=server.cert)p
0 5549 3901 4 v 0 5649 a Fk(26)2233 b(Chapter)23 b(9.)52
b(Ho)o(w)23 b(to)g(use)g(SSL)h(with)g(Cherr)r(yPy)p eop
%%Page: 27 30
27 29 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3661 427
y Fj(TEN)p 0 515 V 591 978 a Fr(Ho)m(w)57 b(to)h(use)f(XML/XSL)g(with)h
(Cherr)6 b(yPy)0 1506 y Fg(10.1)121 b(Introduction)0
1739 y Fl(W)m(ith)20 b(CherryPy)-5 b(,)19 b(you)g(can)h(use)g(p)o
(ython)f(standard)g(datatypes)g(\(lists,)i(dictionaries,)d(...\))25
b(to)20 b(store)g(your)f(data,)h(and)g(then)f(you)g(can)h(use)0
1839 y(masks)g(\(written)g(in)g(CHTL\))g(to)h(con)m(v)o(ert)d(that)i
(data)g(into)g(HTML.)0 1986 y(Ho)n(we)n(v)o(er)m(,)29
b(this)g(can)f(also)h(be)g(done)f(with)g(XML)h(and)f(XSL.)h(I)g
(personally)e(think)h(that)h(using)f(p)o(ython)f(types)i(directly)-5
b(,)29 b(and)f(then)0 2085 y(writing)h(CHTL)g(masks)h(is)g(much)e
(easier)i(and)e(straightforw)o(ard)f(than)i(XML/XSL,)g(b)n(ut)g(there)g
(might)g(be)g(se)n(v)o(eral)g(reasons)f(why)0 2185 y(you')l(d)18
b(w)o(ant)j(to)f(use)g(XML/XSL:)125 2398 y Fe(\017)41
b Fl(Y)-9 b(ou')l(re)21 b(getting)i(your)f(data)h(from)f(some)i(other)e
(application)g(and)h(that)g(data)g(comes)g(in)h(XML)f(\(which)g(is)h
(lik)o(ely)f(to)g(happen,)208 2498 y(since)d(XML/XSL)g(is)h(no)n(w)f(a)
g(standard\).)125 2664 y Fe(\017)41 b Fl(Y)-9 b(our)16
b(website)i(is)g(a)g(multi-million)e(contract)h(with)g(a)h(big)f
(compan)o(y)-5 b(,)15 b(and)i(the)o(y)g(w)o(ant)h(to)f(hear)g(w)o(ords)
g(lik)o(e)h("XML")f(or)h("XSL",)208 2764 y(because)h(it)i(mak)o(es)f
(them)g(feel)g(safe)g(...)125 2930 y Fe(\017)41 b Fl(Y)-9
b(our)19 b(boss)h(will)h(let)g(you)e(use)i(CherryPy)-5
b(,)18 b(b)n(ut)i(only)f(if)i(you)e(use)i(XML/XSL,)f(because)f(it)i
(mak)o(es)f(him)g(feel)g(safe)h(...)0 3257 y Fg(10.2)121
b(Prerequisite)0 3490 y Fl(This)25 b(Ho)n(wT)-7 b(o)25
b(uses)h(the)f(4Suite)g(module)e(de)n(v)o(eloped)g(by)i(F)o
(ourthought,)e(Inc.)39 b(I)25 b(tested)h(it)g(with)f(v)o(ersion)f
(0.12.0a1)e(of)j(4Suite)g(and)0 3589 y(v)o(ersion)19
b(2.1)g(of)h(p)o(ython,)f(b)n(ut)h(other)f(combinations)f(w)o(ould)i
(also)g(probably)e(w)o(ork.)0 3736 y(Also,)i(se)n(v)o(eral)g(other)f
(XML/XSL)h(modules)g(are)g(a)n(v)n(ailable)f(for)h(Python,)f(and)g
(using)h(them)g(is)h(also)f(probably)e(v)o(ery)h(easy)-5
b(.)0 3883 y(Start)21 b(by)e(do)n(wnloading)f(4Suite)i(from)f
Fn(http://4suite)o(.org)c Fl(and)20 b(installing)g(it)h(on)f(your)e
(machine.)0 4030 y(Y)-9 b(ou)20 b(can)g(test)h(your)e(installation)g
(by)h(\002ring)g(up)g(the)g(Python)f(interpreter)f(and)i(typing:)236
4268 y Fh(>>>)45 b(from)f(Ft.Xml.Xslt.Processor)d(import)j(Processor)
236 4360 y(:::)h(Using)f(pDomlette)236 4451 y(>>>)0 4690
y Fl(If)20 b(this)h(doesn')o(t)d(w)o(ork)i(for)g(you,)f(then)g(4Suite)h
(is)h(not)f(correctly)f(installed)h(on)g(your)f(system.)0
5017 y Fg(10.3)121 b(Using)34 b(the)g(XML/XSL)g(pac)n(kage)g(from)g
(Cherr)t(yPy)0 5250 y Fl(Once)20 b(you)g(ha)n(v)o(e)f(4Suite)h
(installed,)h(is)g(is)g(v)o(ery)e(easy)i(to)f(use)h(it)g(from)e
(CherryPy)-5 b(.)24 b(Y)-9 b(ou)20 b(can)g(use)h(re)o(gular)e(masks)h
(to)h(write)f(your)f(XSL)0 5350 y(stylesheets,)h(and)g(you)f(ha)n(v)o
(e)h(se)n(v)o(eral)f(w)o(ays)i(to)f(generate)f(your)g(XML)h(\(using)g
(a)g(function,)e(a)j(vie)n(w)f(or)g(e)n(v)o(en)f(a)i(mask\).)p
0 5549 3901 4 v 3808 5649 a Fk(27)p eop
%%Page: 28 31
28 30 bop 0 83 a Fl(The)20 b(follo)n(wing)e(e)o(xample)h(is)i(a)g
(simple)f(e)o(xample)f(that)h(demonstrates)f(a)i(basic)f(XML/XSL)g
(transformation:)236 321 y Fh(from)44 b(Ft.Xml.Xslt.Processor)e(import)
i(Processor)236 504 y(CherryClass)f(XslTransform:)236
595 y(function:)416 687 y(def)h(transform\(self,)e(xslStylesheet,)h
(xmlInput\):)595 778 y(processor)g(=)i(Processor\(\))595
869 y(processor.appendStylesheetString\(xslSt)o(yleshe)o(et\))595
960 y(return)f(processor.runString\(xmlInput,)c(0,)k({}\))236
1143 y(CherryClass)f(Root:)236 1234 y(view:)416 1326
y(def)h(index\(self\):)595 1417 y(return)g
(xslTransform.transform\(self.xslStyles)o(heet\(\))o(,)39
b(self.xmlInput\(\)\))236 1508 y(mask:)416 1600 y(def)44
b(xslStylesheet\(self\):)595 1691 y(<?xml)g(version="1.0")f
(encoding="ISO-8859-1"?>)595 1874 y(<xsl:stylesheet)f(version="1.0")774
1965 y(xmlns:xsl="http://www.w3.org/1999/XSL/Tr)o(ansfor)o(m">)595
2148 y(<xsl:template)h(match="/">)774 2239 y(<html><body>)954
2330 y(<h2>My)g(CD)i(Collection</h2>)954 2422 y(<table)e(border="1">)
1133 2513 y(<tr)h(bgcolor="#9acd32">)1312 2604 y(<th)h
(align="left">Title</th>)1312 2696 y(<th)g(align="left">Artist</th>)
1133 2787 y(</tr>)1133 2878 y(<xsl:for-each)e(select="catalog/cd">)1312
2970 y(<tr>)1492 3061 y(<td><xsl:value-of)e(select="title"/></td>)1492
3152 y(<td><xsl:value-of)g(select="artist"/></td>)1312
3244 y(</tr>)1133 3335 y(</xsl:for-each>)954 3426 y(</table>)774
3518 y(</body></html>)595 3609 y(</xsl:template>)595
3792 y(</xsl:stylesheet>)416 3883 y(def)j(xmlInput\(self\):)595
3974 y(<?xml)g(version="1.0")f(encoding="ISO-8859-1"?>)595
4066 y(<catalog>)774 4157 y(<cd>)954 4248 y(<title>Empire)f
(Burlesque</title>)954 4339 y(<artist>Bob)h(Dylan</artist>)774
4431 y(</cd>)774 4522 y(<cd>)954 4613 y(<title>Hide)g(your)h
(heart</title>)954 4705 y(<artist>Bonnie)e(Tyler</artist>)774
4796 y(</cd>)595 4887 y(</catalog>)0 5174 y Fl(Ho)n(w)20
b(does)g(it)h(w)o(ork)e(?)125 5387 y Fe(\017)41 b Fi(xslStylesheet)21
b Fl(is)g(a)g(mask)f(containing)e(the)i(XSL)h(stylesheet)p
0 5549 3901 4 v 0 5649 a Fk(28)1993 b(Chapter)23 b(10.)52
b(Ho)o(w)23 b(to)g(use)g(XML/XSL)i(with)f(Cherr)r(yPy)p
eop
%%Page: 29 32
29 31 bop 125 83 a Fe(\017)41 b Fi(xmlInput)29 b Fl(is)i(a)f(mask)f
(containing)f(the)i(XML)f(input.)53 b(In)29 b(real)h(life,)i(this)e
(XML)g(w)o(ould)f(probably)e(be)j(generated)e(from)g(a)208
183 y(function,)18 b(based)i(on)f(data)h(coming)f(from)g(a)i(database)f
(or)g(some)g(other)f(ressource.)125 349 y Fe(\017)41
b Fl(The)19 b Fi(inde)n(x)i Fl(vie)n(w)f(just)g(says)h(to)f(apply)g
(this)g(XSL)h(stylesheet)f(to)g(that)h(XML)f(input.)125
515 y Fe(\017)41 b Fl(The)19 b Fi(XslT)-5 b(r)o(ansform)20
b Fl(CherryClass)f(is)i(just)f(used)f(to)h(implement)e(the)h
Fi(tr)o(ansform)h Fl(function,)e(to)h(a)n(v)n(oid)g(ha)n(ving)g(to)g
(repeat)g(these)208 614 y(3)h(lines)g(of)g(code)g(for)f(each)h
(transformation.)0 828 y(Here)g(is)h(the)f(HTML)g(document)f(generated)
f(in)i(this)h(e)o(xample:)236 1066 y Fh(<html>)326 1157
y(<body>)416 1248 y(<h2>My)43 b(CD)i(Collection</h2>)416
1340 y(<table)e(border='1'>)505 1431 y(<tr)i(bgcolor='#9acd32'>)595
1522 y(<th)f(align='left'>Title</th>)595 1614 y(<th)g
(align='left'>Artist</th>)505 1705 y(</tr>)505 1796 y(<tr>)595
1888 y(<td>Empire)f(Burlesque</td>)595 1979 y(<td>Bob)h(Dylan</td>)505
2070 y(</tr>)505 2162 y(<tr>)595 2253 y(<td>Hide)f(your)i(heart</td>)
595 2344 y(<td>Bonnie)e(Tyler</td>)505 2436 y(</tr>)416
2527 y(</table>)326 2618 y(</body>)236 2710 y(</html>)0
2996 y Fl(PS:)27 b(Note)e(that)h(it)g(seems)g(that)g(the)f(4Suite)h
(API)f(has)h(changed)e(again)g(in)i(the)g(latest)g(releases,)h(so)f
(you)f(might)g(ha)n(v)o(e)f(to)i(tweak)g(the)0 3095 y(abo)o(v)o(e)19
b(code)g(if)i(you')l(re)d(using)h(a)i(recent)f(release.)p
0 5549 3901 4 v 0 5649 a Fk(10.3.)52 b(Using)24 b(the)f(XML/XSL)i(pac)n
(kage)e(from)g(Cherr)r(yPy)1951 b(29)p eop
%%Page: 30 33
30 32 bop 0 5549 3901 4 v 0 5649 a Fk(30)p eop
%%Page: 31 34
31 33 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3422 427
y Fj(ELEVEN)p 0 515 V 772 978 a Fr(Ho)m(w)58 b(to)f(use)h(A)-6
b(OP)56 b(\(Aspect)i(Or)s(iented)1419 1227 y(Prog)n(r)n(aming\))d(with)
j(Cherr)6 b(yPy)0 1756 y Fg(11.1)121 b(Introduction)0
1988 y Fl(This)21 b(Ho)n(wT)-7 b(o)19 b(is)j(intended)d(to)h(people)f
(who)h(are)h(already)e(f)o(amiliar)h(with)g(OOP)-9 b(,)21
b(b)n(ut)f(who)g(are)h(not)f(necessarily)f(f)o(amiliar)h(with)h(A)-5
b(OP)c(.)0 2088 y(If)20 b(this)h(is)g(your)e(case,)h(check)g(out)f
Fn(http://aosd.net)e Fl(for)i(an)h(introduction)e(to)i(A)-5
b(OP)c(.)0 2235 y(CherryPy)16 b(only)h(implements)g(a)h(fe)n(w)f(of)g
(A)-5 b(OP)19 b(concepts.)k(I)18 b(don')o(t)e(ha)n(v)o(e)g(a)i(PHD)h
(in)e(A)-5 b(OP)19 b(and)e(it)h(is)h(not)e(my)g(goal)g(to)h(mak)o(e)f
(CherryPy)0 2334 y(an)j(A)-5 b(OP)21 b(reference)e(:-\))0
2481 y(Instead,)e(I)h(implemented)e(a)i(fe)n(w)g(features)f(that)h(I)f
(thought)f(might)h(be)h(useful)f(\(and)g(the)o(y)g(already)g(are,)g
(since)h(both)f(HttpAuthenticate)0 2581 y(and)j(CookieAuthenticate)d
(modules)j(use)g(A)-5 b(OP)21 b(features\).)0 2908 y
Fg(11.2)121 b(Basic)33 b(e)l(xample)0 3141 y Fl(On)21
b(most)g(websites)g(a)h(common)d(header)g(and)i(footer)e(is)j(used)f
(for)f(all)i(\(or)e(most\))h(pages)f(of)h(the)g(site.)28
b(In)20 b(CherryPy)-5 b(,)20 b(you)g(can)g(easily)0 3241
y(implement)26 b(that)h(using)g(a)h("classic")f(object)g(oriented)f
(approach:)37 b(\002rst)28 b(you)e(de\002ne)h(a)h(class)g(that)f
(contains)g(the)g(header)f(and)h(the)0 3340 y(footer)19
b(that)h(you)g(w)o(ant)g(to)g(use)h(for)e(all)i(your)e(pages.)236
3579 y Fh(CherryClass)43 b(NormalHeaderAndFooter:)236
3670 y(mask:)416 3761 y(def)h(header\(self\):)595 3853
y(<html><body>I'm)e(the)j(header<br><br>)416 3944 y(def)f
(footer\(self\):)595 4035 y(<br><br>I'm)f(the)h(footer</body></html>)0
4321 y Fl(Then,)25 b(all)h(you)e(ha)n(v)o(e)g(to)h(do)f(is)i(deri)n(v)o
(e)e(your)g(CherryClasses)h(from)f Fi(NormalHeaderAndF)-9
b(ooter)24 b Fl(and)g(call)h Fi(header)h Fl(and)f Fi(footer)h
Fl(in)0 4421 y(each)20 b(of)g(your)f(masks)h(or)g(vie)n(ws:)p
0 5549 3901 4 v 3808 5649 a Fk(31)p eop
%%Page: 32 35
32 34 bop 236 174 a Fh(CherryClass)43 b(Root\(NormalHeaderAndFooter\):)
236 266 y(mask:)416 357 y(def)h(index\(self\):)595 448
y(<py-eval="self.header\(\)">)774 540 y(Hello,)g(world)g(!)595
631 y(<py-eval="self.footer\(\)">)416 722 y(def)g(otherPage\(self\):)
595 814 y(<py-eval="self.header\(\)">)774 905 y(I)h(love)f(cherry)g
(pie)g(!)595 996 y(<py-eval="self.footer\(\)">)0 1282
y Fl(That')-5 b(s)21 b(the)g("classic")g(object)f(oriented)g(approach.)
25 b(It')-5 b(s)21 b(pretty)f(good,)f(b)n(ut)i(if)g(we)g(look)f(at)i
(it,)f(we')o(ll)g(realize)g(that)g(we)g(ha)n(v)o(e)f(to)h(repeat)0
1382 y Fi(<py-e)o(val="self)o(.header\(\)">)16 b Fl(and)k
Fi(<py-e)o(val="self)o(.footer\(\)">)d Fl(for)j(each)g(mask)g(and)f
(vie)n(w)-5 b(,)20 b(and)f(this)i(has)f(se)n(v)o(eral)g(dra)o(wbacks:)
125 1597 y Fe(\017)41 b Fl(First)23 b(of)e(all,)j(I)e
Fm(ne)o(v)o(er)g Fl(lik)o(e)g(to)h(repeat)e(code.)31
b(Whene)n(v)o(er)20 b(I)j(do)e(it,)i(I)g(feel)f(lik)o(e)h(there)e(must)
i(be)f(something)e(I'm)i(doing)f(wrong)208 1696 y(and)e(my)h(code)g
(could)f(certainly)g(be)h(impro)o(v)o(ed)e(!)125 1856
y Fe(\017)41 b Fl(F)o(or)16 b(a)g(real)h(life)f(website,)h(we)g
(probably)d(w)o(ould)i(ha)n(v)o(e)g(man)o(y)f(CherryClasses)h(that)h
(inherit)e(from)h Fi(NormalHeaderAndF)-9 b(ooter)r Fl(,)208
1956 y(and)21 b(all)i(these)f(CherryClasses)h(w)o(ould)e(ha)n(v)o(e)h
(man)o(y)f(masks)h(that)g(all)h(mak)o(e)f(the)g(same)g(call)h(to)f
Fi(header)h Fl(and)f Fi(footer)r Fl(.)31 b(What)22 b(if)208
2056 y(we)e(w)o(ant)h(to)f(change)f(the)h(name)g(of)g(the)g
Fi(header)h Fl(method)e(?)26 b(In)20 b(that)g(case,)g(we)h(w)o(ould)f
(ha)n(v)o(e)f(to)i(go)e(through)f(all)j(the)f(masks)h(of)208
2155 y(all)f(the)h(CherryClasses)f(to)g(change)f(the)h(line)h(!)125
2315 y Fe(\017)41 b Fl(In)24 b(this)i(tri)n(vial)f(e)o(xample,)g(we)g
(only)f(ha)n(v)o(e)h(2)g(lines)g(of)g(code)g(to)g(repeat,)g(b)n(ut)g
(what)g(if)h(we)f(had)g(other)f(things)h(to)g(do)f(for)h(each)208
2415 y(page)18 b(\(lik)o(e)h(log)g(the)g(request)g(in)g(a)h(database)f
(or)g(check)f(that)h(the)h(user)f(is)h(authenticated\))d(?)25
b(W)-7 b(e)21 b(could)d(end)h(up)g(repeating)e(tens)208
2515 y(of)i(lines)i(of)f(code)f(for)h(each)g(method)f(!)0
2729 y(That')-5 b(s)23 b(where)f(A)-5 b(OP)24 b(comes)f(in)g(...)33
b(Instead)22 b(of)g(just)i(declaring)d("normal")g Fi(header)j
Fl(and)f Fi(footer)h Fl(methods,)e(we')o(ll)i(declare)e("aspect")0
2829 y(methods.)i(This)19 b(basically)g(adds)g(another)e(information)g
(which)i(is:)26 b("include)18 b(my)h(code)f(at)i(the)f(be)o(ginning)e
(or)h(at)i(the)f(end)g(of)g(each)g(of)0 2929 y(the)h(methods)f(of)h
(all)h(deri)n(v)o(ed)d(classes".)0 3075 y(Therefore,)g(the)i
(implementation)e(of)i(our)f(simple)h(e)o(xample)f(using)h(A)-5
b(OP)21 b(w)o(ould)f(be:)236 3314 y Fh(CherryClass)43
b(NormalHeaderAndFooter:)236 3405 y(aspect:)416 3496
y(\(1\))h(start:)595 3588 y(_page.append\("<html><body>I'm)c(the)k
(header<br><br>"\))416 3679 y(\(1\))g(end:)595 3770 y
(_page.append\("<br><br>I'm)d(the)j(footer</body></html>"\))236
3953 y(CherryClass)f(Root\(NormalHeaderAndFooter\):)236
4044 y(mask:)416 4135 y(def)h(index\(self\):)774 4227
y(Hello,)g(world)g(!)416 4318 y(def)g(otherPage\(self\):)774
4409 y(I)h(love)f(cherry)g(pie)g(!)0 4632 y Fc(1)0 4809
y Fl(See)21 b(...)k(we)20 b(got)g(rid)g(of)g(the)g Fi(<py-e)o
(val="self)o(.header\(\)">)d Fl(and)i Fi(<py-e)o(val="self)o
(.footer\(\)">)e Fl(lines)k(...)0 4955 y(Let')-5 b(s)21
b(see)g(what)f(we)g(can)g(notice)g(from)f(looking)g(at)h(the)g(code:)
125 5157 y Fe(\017)41 b Fl(In)22 b(CherryClass)h Fi(NormalHeaderAndF)-9
b(ooter)r Fl(,)20 b(the)i("mask")g(section)h(has)g(disappeared)d(and)i
(has)h(been)f(replaced)g(by)g(a)h(ne)n(w)208 5256 y("aspect")d
(section.)p 0 5321 1560 4 v 90 5377 a Fb(1)120 5400 y
Fa(This)c(sample)i(code)g(requires)h(CherryPy-0.7)f(or)f(later)h(to)g
(w)o(ork)p 0 5549 3901 4 v 0 5649 a Fk(32)1045 b(Chapter)23
b(11.)52 b(Ho)o(w)23 b(to)h(use)f(A)n(OP)g(\(Aspect)f(Or)q(iented)i
(Prog)o(r)o(aming\))g(with)g(Cherr)r(yPy)p eop
%%Page: 33 36
33 35 bop 125 83 a Fe(\017)41 b Fl(In)15 b(this)h("aspect")g(section,)g
(the)g(line)g(where)f(we)h(normally)e(declare)h(methods)g(\(using)g
(the)h("def")f(k)o(e)o(yw)o(ord\))f(has)i(been)f(replaced)208
183 y(by)k(a)i(special)f(line)h(that)f(contains)f("start")i(or)f("end")
f(\(we')o(ll)h(e)o(xplain)f(the)h(syntax)g(later\).)125
349 y Fe(\017)41 b Fl(The)18 b(lines)i(that)f(normally)f(contain)g(the)
h(body)f(of)h(the)g(function)f(are)h(still)h(there,)f(and)f(the)o(y')l
(re)g(written)h(using)f(re)o(gular)g(Python.)125 515
y Fe(\017)41 b Fi(<py-e)o(val="self)o(.header\(\)">)17
b Fl(and)j Fi(<py-e)o(val="self)o(.footer\(\)">)e Fl(ha)n(v)o(e)j
(disappeared)e(from)h(the)h(methods)f(of)h Fi(Root)q
Fl(.)28 b Fi(Root)22 b Fl(is)208 614 y(still)f(deri)n(v)o(ed)d(from)h
Fi(NormalHeaderAndF)-9 b(ooter)r Fl(.)0 828 y(Here)20
b(is)h(ho)n(w)f(it)h(w)o(orks:)0 975 y(The)f(header)f(for)g(an)i
(aspect)f(method)f(has)h(tw)o(o)g(parts:)236 1213 y Fh(\(condition\))43
b(startOrEnd:)0 1452 y Fi(startOrEnd)23 b Fl(can)d(be)h(either)f(the)h
("start")g(or)f(the)h("end")f(k)o(e)o(yw)o(ord.)25 b(This)c(indicates)f
(whether)g(the)h(code)f(should)f(be)i(appended)d(at)k(the)0
1551 y(start)f(or)f(at)g(the)h(end)e(of)h(the)g(methods.)0
1698 y Fi(condition)d Fl(is)k(a)e(p)o(ython)f(e)o(xpression)g(used)h
(to)g(indicated)f(which)h(method)f(the)h(aspect)h(should)e(apply)g(to.)
25 b(If)19 b(the)g(condition)f(is)i(al)o(w)o(ays)0 1798
y(true)28 b(\(as)g(in)h("1"\),)g(then)f(it)h(means)f(that)g(the)h
(aspect)f(will)h(apply)e(to)h(all)h(methods)e(of)h(the)h(deri)n(v)o(ed)
d(CherryClasses.)49 b(The)28 b(p)o(ython)0 1897 y(e)o(xpression)19
b(can)h(use)g(a)h(special)f(v)n(ariable)f(called)h Fi(method)h
Fl(that)g(contains)e(the)h(follo)n(wing)f(member)g(v)n(ariables:)125
2111 y Fe(\017)41 b Fi(name)p Fl(:)24 b(contains)c(the)g(name)f(of)h
(the)h(method)125 2277 y Fe(\017)41 b Fi(type)p Fl(:)25
b(contains)19 b(the)h(type)g(of)g(the)g(method)f(\("mask",)g("vie)n
(w",)h("v)n(ariable",)e(...\))125 2443 y Fe(\017)41 b
Fi(isHidden)p Fl(:)24 b(is)d(true)f(if)h(the)f(mask)g(or)g(vie)n(w)g
(is)h(hidden)e(\(f)o(alse)h(otherwise\))125 2609 y Fe(\017)41
b Fi(className)p Fl(:)25 b(name)20 b(of)g(the)g(CherryClass)g(the)g
(method)f(belongs)g(to)0 2822 y(Let')-5 b(s)20 b(go)f(back)g(to)h(our)e
(e)o(xample:)24 b(let')-5 b(s)20 b(imagine)f(that)g(we)h(w)o(ant)g(to)f
(use)h(the)g(re)o(gular)e(header)g(and)h(footer)f(for)h(both)g(pages)g
Fi(inde)n(x)g Fl(and)0 2922 y Fi(otherP)-7 b(a)o(g)o(e)p
Fl(,)21 b(b)n(ut)h(we)g(w)o(ant)g(a)h(third)e(page)g(called)h
Fi(yetAnotherP)-7 b(a)o(g)o(e)20 b Fl(that)i(has)g(its)h(o)n(wn)e
(header)g(and)h(footer)-5 b(.)29 b(Here)22 b(is)g(what)g(the)g(code)0
3021 y(w)o(ould)d(look)h(lik)o(e:)236 3260 y Fh(CherryClass)43
b(NormalHeaderAndFooter:)236 3351 y(aspect:)416 3442
y(\(method.type=='mask')e(and)j(method.name!='yetAnotherPage'\))c
(start:)595 3534 y(_page.append\("<html><body>I'm)g(the)k
(header<br><br>"\))416 3625 y(\(method.type=='mask')d(and)j
(method.name!='yetAnotherPage'\))c(end:)595 3716 y
(_page.append\("<br><br>I'm)h(the)j(footer</body></html>"\))236
3899 y(CherryClass)f(Root\(NormalHeaderAndFooter\):)236
3990 y(mask:)416 4081 y(def)h(index\(self\):)774 4173
y(Hello,)g(world)g(!)416 4264 y(def)g(otherPage\(self\):)774
4355 y(I)h(love)f(cherry)g(pie)g(!)416 4447 y(def)g
(yetAnotherPage\(self\):)595 4538 y(<html><body)f(bgcolor=red>)774
4629 y(I)i(love)f(cherry)g(pie)g(!)595 4721 y(</body></html>)0
4960 y Fl(As)36 b(we)g(can)g(see,)k(we)c(use)g(the)f(aspect)h
(condition)e(to)i(indicate)f(which)g(method)f(the)i(aspect)g(will)g
(apply)f(to.)71 b(Note)36 b(that)g(the)0 5059 y("method.type='mask'")25
b(condition)i(is)j(useless,)i(since)d(all)h(methods)e(of)h
Fi(Root)h Fl(are)f(masks.)52 b(So)29 b(it)h(is)g(only)f(there)f(to)i
(sho)n(w)e(you)0 5159 y(an)20 b(e)o(xample)f(of)h(an)g(aspect)g
(condition.)p 0 5549 3901 4 v 0 5649 a Fk(11.2.)52 b(Basic)23
b(e)n(xample)3035 b(33)p eop
%%Page: 34 37
34 36 bop 0 88 a Fg(11.3)121 b(Ho)n(w)35 b(is)d(it)h(used)i(in)e
(CookieA)l(uthenticate)k(and)e(HttpA)l(uthenticate)0
321 y Fl(No)n(w)24 b(that)f(you)g(kno)n(w)g(ho)n(w)g(it)h(w)o(orks,)g
(you)f(can)g(look)g(at)h(the)g(source)f(code)g(for)g(these)g(tw)o(o)h
(modules)f(and)g(you)g(should)f(be)i(able)f(to)0 420
y(understand)18 b(it.)0 567 y(Basically)-5 b(,)24 b(when)f(you)f
(declare)h(a)h(CherryClass)f(that)g(inherits)g(from)g
(CookieAuthenticate)e(or)i(HttpAuthenticate,)f(some)h(code)g(is)0
667 y(automatically)e(added)h(at)i(the)e(be)o(ginning)f(of)h(each)h(of)
g(your)e(masks)i(and)g(vie)n(ws.)33 b(This)23 b(code)f(checks)h(if)g
(the)g(user)f(is)i(authenticated)0 766 y(or)c(not.)25
b(If)20 b(not,)f(it)i(returns)e(the)i(login)e(page)h(instead)f(of)h
(the)h(re)o(gular)d(page)i(...)p 0 5549 3901 4 v 0 5649
a Fk(34)1045 b(Chapter)23 b(11.)52 b(Ho)o(w)23 b(to)h(use)f(A)n(OP)g
(\(Aspect)f(Or)q(iented)i(Prog)o(r)o(aming\))g(with)g(Cherr)r(yPy)p
eop
%%Page: 35 38
35 37 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3415 427
y Fj(TWEL)-13 b(VE)p 0 515 V 136 978 a Fr(Ho)m(w)58 b(to)f(create)h(a)f
(spinning)g(ser)6 b(v)-5 b(er)57 b(and)g(then)3169 1227
y(deb)l(ug)g(it)0 1756 y Fg(12.1)121 b(Creating)35 b(a)f(spinning)g
(ser)t(v)m(er)0 1988 y Fl(By)21 b("spinning")d(serv)o(er)m(,)h(I)h
(mean)g(a)h(serv)o(er)e(that')-5 b(s)21 b(stuck)f(in)g(a)g(loop)g
(while)g(trying)f(to)i(b)n(uild)e(a)i(page.)0 2135 y(The)f(easiest)h(w)
o(ay)f(to)h(achie)n(v)o(e)e(that)h(is:)236 2373 y Fh(CherryClass)43
b(Root:)236 2465 y(view:)416 2556 y(def)h(index\(self\):)595
2647 y(while)g(1:)g(pass)0 2886 y Fl(Compile)23 b(that,)g(start)h(the)f
(serv)o(er)f(and)g(try)h(to)g(request)f(the)h(home)f(page)h(...)33
b(:-\))23 b(There)f(you)g(ha)n(v)o(e)g(it:)32 b(a)23
b(nice)g("spinning")f(serv)o(er)-5 b(.)32 b(Of)0 2986
y(course,)17 b(the)g(page)g(will)h(ne)n(v)o(er)e(be)i(rendered,)d(and)i
(if)h(you)e(try)h(to)h(load)f(the)g(same)h(page)f(from)f(another)g(bro)
n(wser)m(,)g(your)g(bro)n(wser)h(w)o(on')o(t)0 3086 y(e)n(v)o(en)24
b(be)h(able)g(to)g(connect)f(to)i(the)f(CherryPy)f(serv)o(er)g(because)
g(it')-5 b(s)27 b(still)f(b)n(usy)f(trying)f(to)h(serv)o(e)g(the)g
(\002rst)h(page)e(\(unless)h(you)f(ha)n(v)o(e)0 3185
y(multiple)c(serv)o(er)f(processes)h(running\).)0 3332
y(The)27 b(w)o(ay)g(you)g(can)g(tell)h(that)f(your)f(serv)o(er)g(is)j
(spinning)d(is)i(v)o(ery)e(easy:)39 b(you')l(re)26 b(no)h(longer)f
(able)h(to)g(connect)f(to)i(it,)h(and)e(the)g(cpu)0 3432
y(time)20 b(used)f(by)g(the)h(process)f(\(which)g(is)h(displayed)f
(when)g(you)f(do)i(a)g Fi(ps)g Fl(on)f(Unix)g(for)g(instance\))g(k)o
(eeps)g(gro)n(wing,)f(meaning)g(that)i(the)0 3531 y(process)g(is)h(not)
f(stalled,)g(b)n(ut)g(it')-5 b(s)21 b(actually)f(doing)f(something.)0
3678 y(Y)-9 b(ou)20 b(might)f(be)h(thinking)f("I'm)g(not)h(that)g
(stupid)g(!)26 b(I)20 b(will)h(ne)n(v)o(er)e(write)h(such)g(an)g(ob)o
(vious)f(loop)g(!".)0 3825 y(But)i(here)e(is)i(another)e(less)j(tri)n
(vial)e(case)g(that)g(actually)g(happened)e(to)i(me)g(\(and)g(that')-5
b(s)20 b(the)h(reason)e(why)g(I)i(wrote)f(this)g(Ho)n(wT)-7
b(o\):)p 0 5549 3901 4 v 3808 5649 a Fk(35)p eop
%%Page: 36 39
36 38 bop 236 174 a Fh(CherryClass)43 b(Root:)236 266
y(function:)416 357 y(def)h(extractText\(self,)e(code\):)595
448 y(#)j(Remove)e(text)i(between)e(<)i(and)f(>)595 540
y(while)g(1:)774 631 y(i=code.find\('<'\))774 722 y(if)h(i==-1:)f
(break)774 814 y(j=code.find\('>',)e(i\))774 905 y(if)j(j!=-1:)f
(code=code[:i]+')e('+code[j+1:])595 996 y(return)i(code)236
1088 y(mask:)416 1179 y(def)g(index\(self,)f(code=''\):)595
1270 y(<html><body>)774 1362 y(Extracted)h(text:)g
(<py-eval="self.extractText\(code\)">)774 1453 y(<form)g
(action="index">)774 1544 y(New)h(text:)f(<textarea)f
(name="code"></textarea>)774 1636 y(<input)h(type=submit>)774
1727 y(</form>)595 1818 y(</body></html>)0 2057 y Fl(The)26
b Fi(e)n(xtr)o(actT)-8 b(e)n(xt)29 b Fl(function)c(tak)o(es)h(some)h
(HTML)f(code)g(as)h(an)f(input)g(and)g(strips)h(out)f(the)g(HTML)h
(tags.)44 b(The)26 b(output)f(is)i(the)g(te)o(xt)0 2157
y(that')-5 b(s)21 b(e)o(xtracted)d(from)i(the)g(HTML)g(code.)k(The)c
Fi(inde)n(x)g Fl(mask)g(just)h(pro)o(vides)d(a)j(te)o(xtarea-based)d
(interf)o(ace)h(to)h(test)i(the)e(function.)0 2304 y(If)d(you)g
(compile)g(this)h(code,)f(run)g(it)h(and)f(test)h(it)h(with)e(some)h
(HTML)f(code,)g(it)i(might)d(run)h(\002ne)h(for)f(a)h(while,)g(b)n(ut)f
(in)h(some)f(cases)i(it)f(will)0 2403 y(start)k("spinning")f(!)30
b(The)22 b(reason)f(is)i(that)f(the)g Fi(e)n(xtr)o(actT)-8
b(e)n(xt)24 b Fl(function)c(is)j(b)n(uggy)e(in)h(some)f(cases:)30
b(if)22 b(the)g(code)f(is)i(not)f(proper)e(HTML)0 2503
y(\(for)c(instance,)h(a)g(tag)g(is)h(opened)e(with)h(a)g("<")g(b)n(ut)g
(ne)n(v)o(er)f(closed)h(with)g(a)g(">"\),)h(the)f(function)e(will)j
(enter)e(an)h(in\002nite)g(loop.)23 b(Correcting)0 2602
y(that)d(is)h(v)o(ery)e(easy)i(once)e(you)h(kno)n(w)f(what')-5
b(s)20 b(happening)e(\(just)i(add)g("else:)26 b(break")19
b(after)g(the)i(second)e("if")h(of)g(the)g(function\).)0
2749 y(But)33 b(when)f(this)h(is)h(happening)c(on)i(your)g(production)e
(serv)o(er)m(,)k(all)g(you)d(see)j(is)f(that)g(your)e(CherryPy)h(serv)o
(er)g(sometimes)g(start)0 2849 y(spinning.)61 b(Besides,)36
b(the)d(serv)o(er)e(might)h(run)g(\002ne)h(for)f(days,)j(and)d(start)h
(spinning)f(all)h(the)f(sudden,)j(making)c(it)i(v)o(ery)f(hard)f(to)0
2949 y(reproduce)18 b(it)j(in)f(your)f(de)n(v)o(elopment)e(en)m
(vironment)g(and)j(thus)g(almost)g(impossible)g(to)g(\002nd)g(out)g
(where)g(it)g(comes)g(from)f(!)0 3095 y(The)h(ne)o(xt)f(section)h(e)o
(xplain)f(ho)n(w)h(to)g(easily)h(deb)n(ug)e(that)h(to)g(track)g(do)n
(wn)f(the)h(culprit)g(...)0 3423 y Fg(12.2)121 b(Deb)n(ugging)36
b(a)e(spinning)g(ser)t(v)m(er)0 3656 y Fl(The)20 b(follo)n(wing)e
(method)h(only)h(w)o(orks)f(on)h(Unix)g(because)g(it)g(uses)h(the)f
Fi(gdb)g Fl(deb)n(ugger)-5 b(.)0 3803 y(All)23 b(you)d(ha)n(v)o(e)i(to)
g(do)f(is)i(w)o(ait)g(for)e(your)f(CherryPy)h(serv)o(er)g(to)h(start)g
(spinning.)29 b(Once)22 b(it)g(happens,)f(\002re)h(up)f
Fi(gdb)g Fl(using)h(the)g(name)f(of)0 3902 y(the)f(Python)f(program)f
(that')-5 b(s)21 b(running)d(your)h(CherryPy)g(serv)o(er)g(\(with)h
(the)g(correct)g(v)o(ersion\).)j(This)d(might)g(be)g(for)g(instance:)
236 4140 y Fh(gdb)45 b(python2.1)236 4232 y(or)236 4323
y(gdb)g(python2.2)0 4562 y Fl(Once)20 b(you')l(re)e(in)j
Fi(gdb)p Fl(,)e(just)h(attach)g(to)h(the)f(CherryPy)f(process)h(\(you)f
(can)h(get)g(the)g(process)g(number)e(with)i(the)h Fi(ps)f
Fl(command\):)236 4800 y Fh(attach)44 b(7457)0 5039 y
Fl(At)21 b(this)f(point,)g Fi(gdb)f Fl(will)i(display)f(a)g(b)n(unch)f
(of)h(messages)g(saying)g(that)g(it')-5 b(s)21 b(reading)e(and)h
(loading)f(some)h(symbols.)0 5186 y(No)n(w)g(comes)g(the)g(cle)n(v)o
(er)f(trick:)25 b(run)20 b(the)g(follo)n(wing)f(command)f(in)i(gdb:)p
0 5549 3901 4 v 0 5649 a Fk(36)1493 b(Chapter)23 b(12.)52
b(Ho)o(w)23 b(to)h(create)e(a)i(spinning)g(ser)r(v)n(er)e(and)i(then)f
(deb)n(ug)h(it)p eop
%%Page: 37 40
37 39 bop 236 174 a Fh(call)44 b(PyRun_SimpleString\("import)d(sys,)j
(traceback;)f(sys.stderr=open\('/tmp/tb','w',0\);)c
(traceback.print_stack\(\)"\))0 461 y Fl(This)24 b(will)g(sa)n(v)o(e)f
(the)h(traceback)e(in)h(the)h(`)p Fn(/tmp/tb)p Fl(')d(\002le.)35
b(Just)24 b(e)o(xit)g(gdb)e(and)h(look)f(at)i(this)g(\002le)g(...)35
b(It)24 b(should)e(be)h(ob)o(vious)f(where)h(the)0 560
y(serv)o(er)c(w)o(as)i(stuck.)k(In)20 b(our)f(e)o(xample,)g(the)h
(\002le)h(contained)e(the)h(follo)n(wing)e(lines:)326
798 y Fh(File)44 b("TestServer.py",)e(line)i(454,)h(in)f(?)416
890 y(try:)g(_serveForever\(_masterSocket\))326 981 y(File)g
("TestServer.py",)e(line)i(215,)h(in)f(_serveForever)416
1072 y(_handleRequest\(_wfile\))326 1164 y(File)g("TestServer.py",)e
(line)i(363,)h(in)f(_handleRequest)416 1255 y
(response.body=eval\("\045s.\045s\(\045s\)"\045\(_myC)o(lass,_)o
(functi)o(on,)39 b(_paramStr\)\))326 1346 y(File)44 b("<string>",)f
(line)h(0,)h(in)f(?)326 1438 y(File)g("TestServer.py",)e(line)i(61,)h
(in)f(index)416 1529 y(_page.append\(str\(self.extractText\(co)o
(de\)\)\))326 1620 y(File)g("TestServer.py",)e(line)i(55,)h(in)f
(extractText)416 1712 y(if)g(j!=-1:)g(code=code[:i]+')e('+code[j+1:])
326 1803 y(File)i("<string>",)f(line)h(1,)h(in)f(?)0
2089 y Fl(PS:)21 b(Thanks)e(to)i(Barry)e(W)-7 b(arsa)o(w)21
b(for)f(this)h(trick)f(\(which)f(w)o(as)i(originally)d(posted)i(to)g(a)
h(Zope)e(mailing)h(list\).)p 0 5549 3901 4 v 0 5649 a
Fk(12.2.)52 b(Deb)n(ugging)25 b(a)e(spinning)i(ser)r(v)n(er)2515
b(37)p eop
%%Page: 38 41
38 40 bop 0 5549 3901 4 v 0 5649 a Fk(38)p eop
%%Page: 39 42
39 41 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3305 427
y Fj(THIR)n(TEEN)p 0 515 V 298 978 a Fr(Ho)m(w)57 b(to)h(create)f(an)h
(XML-RPC)e(ser)6 b(v)-5 b(er)58 b(with)3033 1227 y(Cherr)6
b(yPy)0 1714 y Fl(Writing)19 b(an)g(XML-RPC)h(service)f(with)g
(CherryPy)f(is)j(v)o(ery)d(easy)-5 b(.)24 b(It)c(w)o(orks)e(v)o(ery)g
(much)h(the)g(same)g(w)o(ay)h(as)g(a)f(re)o(gular)f(web)h(service.)0
1814 y(It)f(is)h(base)f(on)f(the)h Fi(xmlrpclib)g Fl(module.)23
b(This)18 b(module)e(is)j(included)d(with)i(Python-2.2)e(and)h(higher)m
(,)f(b)n(ut)i(if)g(you)f(use)h(a)h(lo)n(wer)e(v)o(ersion,)0
1913 y(you')o(ll)i(ha)n(v)o(e)h(to)g(do)n(wnload)e(it)j(from)e
Fn(http://www)l(.p)n(ythonw)o(are)o(.com)-6 b Fl(.)0
2060 y(All)20 b(you)f(ha)n(v)o(e)g(to)h(do)f(is)h(add)f(the)h(k)o(e)o
(yw)o(ord)e(xmlrpc)g(after)h(the)h(de\002nition)e(of)i(the)f(mask)h(or)
f(vie)n(w)-5 b(,)19 b(and)g(before)f(the)i(colon.)k(No)n(w)-5
b(,)18 b(that)0 2160 y(vie)n(w)i(or)g(mask)g(will)h(be)f(a)n(v)n
(ailable)g(to)g(XML-RPC)h(requests.)0 2487 y Fg(13.1)121
b(Basic)33 b(Example)0 2720 y Fl(Let')-5 b(s)21 b(tak)o(e)f(an)g(e)o
(xample.)k(Just)d(create)f(a)g(\002le)h(called)f(testXmlRpc.cp)o(y)f
(containing)g(the)h(follo)n(wing)e(code:)236 2958 y Fh(CherryClass)43
b(Root:)236 3050 y(view:)416 3141 y(def)h(add\(self,)f(a,)i(b,)f(c\))h
(xmlrpc:)595 3232 y(#)g(Return)e(the)i(sum)f(of)h(three)f(numbers)595
3324 y(return)g(a+b+c)236 3506 y(CherryClass)f(Xml_rpc:)236
3598 y(view:)416 3689 y(def)h(reverse\(self,)f(label\))g(xmlrpc:)595
3780 y(#)i(Reverse)e(the)i(characters)e(of)h(a)h(string)595
3872 y(newStr='')595 3963 y(for)f(i)h(in)f
(range\(len\(label\)-1,-1,-1\):)774 4054 y(newStr+=label[i])595
4146 y(return)g(newStr)0 4432 y Fl(Also,)20 b(create)g(a)h
(con\002guration)c(\002le)k(\(te)o(xtXmlRpcServ)o(er)-5
b(.cfg\))17 b(to)j(tell)h(the)f(serv)o(er)f(to)i(accept)e(XML-RPC)i
(requests:)236 4670 y Fh([server])236 4761 y(typeOfRequests=xmlRpc,web)
0 5047 y Fl(Compile)f(the)g(source)f(\002le)i(and)f(start)h(the)f(serv)
o(er:)k(you)c(ha)n(v)o(e)f(an)h(XML-RPC)h(serv)o(er)e(running.)0
5194 y(No)n(w)h(let')-5 b(s)21 b(write)g(a)f(client.)25
b(Just)c(create)f(a)h(\002le)g(called)f(testXmlRpcClient.p)o(y)f
(containing)f(the)i(follo)n(wing)f(code:)p 0 5549 3901
4 v 3808 5649 a Fk(39)p eop
%%Page: 40 43
40 42 bop 236 174 a Fh(import)44 b(xmlrpclib)236 266
y(testsvr)g(=)h(xmlrpclib.Server\("http://localhost:8)o(000"\))236
357 y(print)f(testsvr.add\(1,2,3\))236 448 y(print)g
(testsvr.xml.rpc.reverse\("I)d(love)j(cherry)g(pie"\))0
734 y Fl(Run)20 b(the)g(client)h(and)e(you)h(should)f(see:)236
973 y Fh([remi@serveur]$)43 b(python)g(xmlrpcTestClient.py)236
1064 y(6)236 1155 y(eip)i(yrrehc)e(evol)i(I)236 1247
y([remi@serveur]$)0 1695 y Fg(13.2)121 b(Multiple)33
b(Ser)t(v)m(ers)0 1928 y Fl(CherryPy)19 b(lets)i(you)e(de\002ne)h(your)
f(XML-RPC)i(serv)o(er)e(URIs)i(an)o(y)e(w)o(ay)i(you)e(w)o(ant.)25
b(In)20 b(our)f(e)o(xample)g(client)h(abo)o(v)o(e,)f(we)h(used:)236
2166 y Fh(testsvr)44 b(=)h(xmlrpclib.Server\("http://localhost:8)o
(000"\))236 2258 y(print)f(testsvr.xml.rpc.reverse\("I)d(love)j(cherry)
g(pie"\))0 2544 y Fl(Ho)n(we)n(v)o(er)m(,)18 b(either)i(of)g(the)g
(follo)n(wing)f(w)o(ould)g(w)o(ork)h(just)g(as)h(well.)236
2782 y Fh(testsvr)44 b(=)h(xmlrpclib.Server\("http://localhost:8)o
(000/xm)o(l"\))236 2873 y(print)f(testsvr.rpc.reverse\("I)d(love)k
(cherry)e(pie"\))0 3141 y Fl(or)236 3379 y Fh(testsvr)h(=)h
(xmlrpclib.Server\("http://localhost:8)o(000/xm)o(l/rpc")o(\))236
3471 y(print)f(testsvr.reverse\("I)e(love)i(cherry)g(pie"\))0
3757 y Fl(Note)18 b(that)g(in)g(these)g(tw)o(o)h(e)o(xamples,)e(the)h
Fi(add)h Fl(vie)n(w)f(in)g(the)g Fi(Root)h Fl(CherryClass)f(w)o(ould)g
(not)f(be)h(a)n(v)n(ailable)g(to)g(the)g(XML-RPC)h(client.)0
3857 y(This)h(gi)n(v)o(es)g(you)f(the)i(\003e)o(xibility)e(to)h
(de\002ne)g(your)f(XML-RPC)i(APIs)g(to)f(mak)o(e)g(dif)n(ferent)e
(methods)h(a)n(v)n(ailable)h(at)h(dif)n(ferent)d(URIs.)0
4003 y(PS:)h(Note)g(that)f(you)g(can)g(also)h(declare)e(a)i(whole)f
(CherryClass)g(as)h(xmlrpc.)24 b(This)18 b(is)h(equi)n(v)n(alent)e(to)i
(declaring)e(each)h(mask)g(and)g(vie)n(w)0 4103 y(of)i(this)h
(CherryClass)f(as)h(xmlrpc.)i(F)o(or)d(instance,)g(the)g(basic)g(e)o
(xample)f(of)h(this)h(Ho)n(wT)-7 b(o)20 b(could)f(ha)n(v)o(e)g(been)h
(written)g(as:)p 0 5549 3901 4 v 0 5649 a Fk(40)1503
b(Chapter)24 b(13.)52 b(Ho)o(w)23 b(to)g(create)g(an)g(XML-RPC)h(ser)r
(v)n(er)e(with)i(Cherr)r(yPy)p eop
%%Page: 41 44
41 43 bop 236 174 a Fh(CherryClass)43 b(Root)h(xmlrpc:)236
266 y(view:)416 357 y(def)g(add\(self,)f(a,)i(b,)f(c\):)595
448 y(#)h(Return)e(the)i(sum)f(of)h(three)f(numbers)595
540 y(return)g(a+b+c)236 722 y(CherryClass)f(Xml_rpc)h(xmlrpc:)236
814 y(view:)416 905 y(def)g(reverse\(self,)f(label\):)595
996 y(#)i(Reverse)e(the)i(characters)e(of)h(a)h(string)595
1088 y(newStr='')595 1179 y(for)f(i)h(in)f
(range\(len\(label\)-1,-1,-1\):)774 1270 y(newStr+=label[i])595
1362 y(return)g(newStr)p 0 5549 3901 4 v 0 5649 a Fk(13.2.)52
b(Multiple)25 b(Ser)r(v)n(ers)2976 b(41)p eop
%%Page: 42 45
42 44 bop 0 5549 3901 4 v 0 5649 a Fk(42)p eop
%%Page: 43 46
43 45 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3245 427
y Fj(FOUR)n(TEEN)p 0 515 V 560 978 a Fr(Ho)m(w)57 b(to)h(mak)l(e)f
(hidden)g(masks)h(or)f(vie)l(ws)0 1506 y Fg(14.1)121
b(Introduction)0 1739 y Fl(Masks)21 b(and)e(vie)n(ws)i(usually)e
(correspond)f(to)i(URLs.)26 b(F)o(or)20 b(instance,)f(if)i(one)e
(writes)i(the)f(follo)n(wing)f(code:)236 1977 y Fh(CherryClass)43
b(CommonMasks:)236 2069 y(mask:)416 2160 y(def)h(redLabel\(self,)e
(label\):)595 2251 y(<b><font)h(color=red)h
(py-eval="label"></font></b>)236 2343 y(CherryClass)f(Root:)236
2434 y(mask:)416 2525 y(def)h(index\(self\):)595 2617
y(<html><body>)774 2708 y(Hello,)g
(<py-eval="commonMasks.redLabel\('world'\))o(">)595 2799
y(</body></html>)0 3038 y Fl(The)20 b(URL)h Fn(http://localhost:8000)14
b Fl(will)21 b(correspond)d(to)i Fi(r)l(oot.inde)n(x)p
Fl(.)0 3185 y(That')-5 b(s)141 b(\002ne,)170 b(b)n(ut)140
b(this)h(also)g(means)f(that)h(if)g(someone)e(arti\002cially)h(types)g
(the)h(URL)0 3285 y Fn(http://localhost:8000/co)o(mmonMasks/redL)o(ab)o
(el)o(?l)o(abe)o(l=)o(IHat)o(eCh)o(err)r(yPy)-5 b Fl(,)20
b(the)o(y)f(will)i(get)g(the)f(result)g(of)g(the)g Fi(r)m(edLabel)g
Fl(mask.)0 3432 y(In)i(this)h(case,)f(it')-5 b(s)24 b(not)d(a)i(v)o
(ery)e(big)h(deal)g(because)f(the)h Fi(r)m(edLabel)g
Fl(mask)g(doesn')o(t)e(do)i(an)o(ything)e(important,)h(b)n(ut)h(in)g
(some)g(cases)h(this)0 3531 y(might)d(be)g(a)g(problem.)j(That')-5
b(s)21 b(why)e Fm(hidden)i Fl(masks)g(and)e(vie)n(ws)i(were)f(included)
e(in)j(CherryPy-0.8.)0 3859 y Fg(14.2)121 b(Ho)n(w)35
b(it)e(w)o(or)r(ks)0 4092 y Fl(All)25 b(you)e(ha)n(v)o(e)g(to)h(do)g
(is)h(add)e(the)h(k)o(e)o(yw)o(ord)f Fm(hidden)i Fl(after)e(the)i
(de\002nition)d(of)i(the)g(mask)g(or)g(vie)n(w)-5 b(,)24
b(and)f(before)g(the)h(colon.)36 b(In)23 b(our)0 4191
y(e)o(xample,)c(one)g(could)g(write:)236 4429 y Fh(CherryClass)43
b(CommonMasks:)236 4521 y(mask:)416 4612 y(def)h(redLabel\(self,)e
(label\))i(hidden:)595 4703 y(<b><font)f(color=red)h
(py-eval="label"></font></b>)236 4795 y(CherryClass)f(Root:)236
4886 y(mask:)416 4977 y(def)h(index\(self\):)595 5069
y(<html><body>)774 5160 y(Hello,)g
(<py-eval="commonMasks.redLabel\('world'\))o(">)595 5251
y(</body></html>)p 0 5549 3901 4 v 3808 5649 a Fk(43)p
eop
%%Page: 44 47
44 46 bop 0 83 a Fl(All)19 b(this)f(means)f(is)i(that)f(the)g
Fi(r)m(edLabel)f Fl(mask)h(can)g(no)f(longer)g(be)g(accessed)h
(directly)f(from)g(the)h(bro)n(wser)-5 b(.)24 b(But)18
b(it)g(can)g(be)g(called)g(from)0 183 y(another)h(mask)h(or)g(vie)n(w)
-5 b(.)0 330 y(It)20 b(is)i(also)e(possible)g(to)g(declare)g(that)g(an)
g(entire)g(CherryClass)g(is)h(hidden,)e(lik)o(e)h(this:)236
568 y Fh(CherryClass)43 b(CommonMasks)g(hidden:)236 659
y(mask:)416 750 y(def)h(redLabel\(self,)e(label\):)595
842 y(<b><font)h(color=red)h(py-eval="label"></font></b>)236
933 y(CherryClass)f(Root:)236 1024 y(mask:)416 1116 y(def)h
(index\(self\):)595 1207 y(<html><body>)774 1298 y(Hello,)g
(<py-eval="commonMasks.redLabel\('world'\))o(">)595 1390
y(</body></html>)0 1629 y Fl(In)20 b(this)h(case,)f(all)h(masks)f(and)g
(vie)n(ws)g(of)g Fi(CommonMasks)g Fl(will)h(be)f(hidden.)p
0 5549 3901 4 v 0 5649 a Fk(44)1980 b(Chapter)23 b(14.)52
b(Ho)o(w)23 b(to)h(mak)n(e)f(hidden)h(masks)e(or)h(vie)n(ws)p
eop
%%Page: 45 48
45 47 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3402 427
y Fj(FIFTEEN)p 0 515 V 2147 978 a Fr(Ho)m(w)57 b(to)h(control)f(logs)0
1468 y Fl(By)27 b(def)o(ault,)h(a)f(CherryPy)f(serv)o(er)g(outputs)g
(all)h(logs)g(to)g(the)g(console.)44 b(But)27 b(you)f(can)h(control)e
(that)i(by)g(using)f(tw)o(o)h(con\002guration)0 1567
y(v)n(ariables)19 b(in)i(the)f Fm([ser)o(v)o(er])g Fl(section)g(of)f
(the)i(con\002guration)c(\002le:)125 1780 y Fe(\017)41
b Fm(logT)-8 b(oScr)o(een)p Fl(:)27 b(This)22 b(indicates)g(if)g(the)g
(logs)f(should)g(be)h(sent)g(to)g(the)g(console)f(or)g(not.)30
b(Possible)22 b(v)n(alues)f(are)h(0)g(or)f(1,)h(def)o(ault)208
1880 y(v)n(alue)d(is)i(1.)k(Example:)444 2104 y Fh([server])444
2196 y(socketPort=80)444 2287 y(logToScreen=0)125 2593
y Fe(\017)41 b Fm(logFile)p Fl(:)24 b(Here)c(you)g(can)g(specify)f(the)
h(path)g(of)g(a)h(\002le)f(where)g(all)h(logs)f(will)h(be)f(stored.)k
(Example:)444 2817 y Fh([server])444 2909 y(socketPort=80)444
3000 y(logToScreen=0)444 3091 y(logFile=/mydir/myLog.log)0
3444 y Fl(If)d(these)f(options)g(are)h(not)f(enough)f(for)h(you)g
(\(for)f(instance,)i(you)e(might)i(be)f(running)f(CherryPy)g(on)h(some)
h(embedded)e(de)n(vice)g(with)0 3544 y(weird)j(logging)g
(constraints\),)g(you)g(can)g(de\002ne)h(your)e(o)n(wn)h(special)h
(function)e(called)i Fi(lo)o(gMessa)o(g)o(e)p Fl(,)g(which)f(tak)o(es)i
(tw)o(o)f(ar)o(guments)0 3643 y(\(including)18 b(the)h(optional)g(le)n
(v)o(el\).)24 b(The)c(def)o(ault)f(beha)n(viour)e(of)j(this)g(function)
e(is)j(to)f(output)e(the)i(message)g(to)g(screen)f(and/or)g(to)h(a)g
(\002le)0 3743 y(according)e(to)i(the)h Fi(lo)o(gT)-8
b(oScr)m(een)19 b Fl(and)g Fi(lo)o(gF)l(ile)h Fl(con\002guration)e(v)n
(ariables.)0 3890 y(The)i(follo)n(wing)e(code)i(is)h(an)f(e)o(xample)f
(of)h(ho)n(w)g(to)g(write)g(your)f(o)n(wn)h Fi(lo)o(gMessa)o(g)o(e)g
Fl(function:)236 4128 y Fh(def)45 b(logMessage\(message,)c(level=0\):)
416 4219 y(#)j(Only)g(print)g(message)g(if)h(level)f(<)g(5)416
4311 y(if)g(level)g(<)h(5:)595 4402 y(print)f("Here)g(is)g(your)h
(message:",)e(message)236 4584 y(CherryClass)g(Root:)236
4676 y(mask:)416 4767 y(def)h(index\(self\):)595 4858
y(<html><body>Hello</body></html>)0 5146 y Fl(Note)20
b(that)g(the)h(\002rst)g(line)f Fm(def)g(logMessage\(message,)f(le)o(v)
o(el=0\):)24 b Fl(has)c(to)h(be)f(e)o(xactly)f(that)h(!)p
0 5549 3901 4 v 3808 5649 a Fk(45)p eop
%%Page: 46 49
46 48 bop 0 5549 3901 4 v 0 5649 a Fk(46)p eop
%%Page: 47 50
47 49 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3388 427
y Fj(SIXTEEN)p 0 515 V 2009 978 a Fr(Ho)m(w)57 b(to)h(use)f(sessions)0
1506 y Fg(16.1)121 b(Introduction)36 b(to)e(sessions)0
1739 y Fl(The)d(main)f(dif)n(ference)f(between)i(a)g(web)g(application)
f(and)g(a)i(re)o(gular)d(application)h(is)i(that)f(in)g(a)h(web)e
(application,)j(each)d(page)0 1839 y(requested)24 b(by)h(a)h(client)g
(is)g(independant)d(from)h(the)i(other)e(pages)i(requested)e(by)h(the)g
(same)h(client.)41 b(In)25 b(other)g(w)o(ords,)h(we)g(ha)n(v)o(e)e(to)0
1939 y(start)d(from)e(scratch)h(for)f(each)h(page.)0
2085 y(Of)h(course,)f(for)g(an)o(y)g(serious)g(application,)f(this)j
(is)f(not)g(acceptable)e(and)h(we)h(need)f(to)h(k)o(eep)g(some)f(data)h
(about)e(a)j(gi)n(v)o(en)d(user)i(across)0 2185 y(se)n(v)o(eral)f
(pages.)0 2332 y(Let')-5 b(s)23 b(assume)g(for)e(e)o(xample)h(that)g
(we)h(w)o(ant)g(to)f(k)o(eep)g(the)h(\002rst)g(name)f(and)g(the)g(last)
i(name)e(of)g(the)g(user)h(across)f(se)n(v)o(eral)g(pages.)31
b(W)-7 b(e)0 2432 y(ask)19 b(the)f(user)g(for)g(his)h(\002rst)g(name)f
(and)f(last)j(name)d(on)h(the)h(\002rst)g(page)f(of)g(the)g(website)h
(\(using)e(a)i(form\))e(and)h(we)g(need)g(to)h(use)f(that)h(data)0
2531 y(in)h(other)g(pages)g(of)f(the)i(site.)0 2678 y(First)g(of)f
(all,)g(we)h(ha)n(v)o(e)f(basically)g(tw)o(o)g(options:)125
2889 y Fe(\017)41 b Fl(k)o(eep)19 b(the)h(\002rst)h(name)f(and)g(the)g
(last)h(name)e(from)h(one)f(page)h(to)g(the)g(ne)o(xt)g(on)g(the)g
(client)g(side)125 3055 y Fe(\017)41 b Fl(store)21 b(the)g(\002rst)h
(name)f(and)f(the)i(last)g(name)e(some)n(where)g(on)h(the)g(serv)o(er)g
(side,)g(and)g(only)f(k)o(eep)h(a)h(pointer)e(to)h(that)h(data)f(on)g
(the)208 3154 y(client)f(side:)25 b Fm(this)c(is)g(what)f(sessions)i
(do)0 3366 y Fl(If)e(we)h(choose)e(the)h(\002rst)h(option,)e(we)h(ha)n
(v)o(e)g(se)n(v)o(eral)f(w)o(ays)i(to)f(do)g(this:)125
3577 y Fe(\017)41 b Fl(K)n(eep)22 b(the)h(\002rst)h(name)e(and)h(the)g
(\002rst)h(name)e(in)h(the)g(URL:)h(each)e(time)i(there)e(is)i(a)g
(link)e(to)h(another)f(page,)h(we)g(could)f(add)h(the)208
3677 y(follo)n(wing)18 b(ar)o(guments)g(to)j(the)f(URL:)h
("\002rstName=....&lastName=...")125 3842 y Fe(\017)41
b Fl(K)n(eep)19 b(the)i(data)f(in)g(hidden)f(\002elds)h(of)g(a)h(form:)
j(in)d(each)e(page,)h(we)g(could)f(ha)n(v)o(e)h(a)h(form)e(with)h(tw)o
(o)h(hidden)d(\002elds)j(lik)o(e)f(this:)444 4066 y Fh(<form)44
b(method="post")e(name="myForm")h(action="dummy">)623
4157 y(<hidden)h(name="firstName")e(value="...">)623
4248 y(<hidden)i(name="lastName")e(value="...">)444 4340
y(</form>)208 4579 y Fl(Ev)o(erytime)17 b(there)h(is)i(a)f(link)g(to)g
(another)e(page,)i(we)g(ha)n(v)o(e)f(to)h(submit)g(the)g(form)f(to)h
(get)g(the)g(data.)24 b(W)-7 b(e)20 b(can)f(use)g(something)e(lik)o(e)
208 4678 y(this:)444 4902 y Fh(<a)44 b(href="#")578 4993
y(onClick=")713 5085 y(document.myForm.action='...put)c(link)k
(here...';)713 5176 y(document.myForm.submit\(\);)713
5267 y(return)g(false;">...</a>)p 0 5549 3901 4 v 3808
5649 a Fk(47)p eop
%%Page: 48 51
48 50 bop 125 83 a Fe(\017)41 b Fl(Store)20 b(the)g(\002rst)h(name)e
(and)h(the)g(last)h(name)f(in)g(a)h(cookie)0 296 y(The)h(\002rst)h(tw)o
(o)f(options)f(are)h(not)g(really)g(handy)e(as)j(the)o(y)e(force)h(you)
f(to)h(use)g(e)o(xtra)g(code)f(for)h(each)f(link.)31
b(The)22 b(third)f(option)g(is)i(better)0 396 y(b)n(ut)d(it)h(is)g(not)
f(v)o(ery)f(handy)g(if)h(we)h(ha)n(v)o(e)e(lots)i(of)f(data)g(to)g(k)o
(eep)g(about)f(a)i(user)-5 b(.)0 543 y(So)20 b(another)e(option)g(is)i
(to)g(store)f(the)g(data)g(on)g(the)h(serv)o(er)e(side)i(and)f(to)g
(just)h(k)o(eep)f(a)h(pointer)e(to)i(that)f(data)g(on)g(the)h(client)f
(side.)25 b(This)20 b(is)0 642 y(what)g(sessions)h(do)f(...)0
970 y Fg(16.2)121 b(P)-6 b(ossib)n(le)33 b(implementations)h(f)l(or)h
(sessions)0 1203 y Fl(The)19 b(pointer)f(to)h(the)g(data)g(is)h
(usually)f(called)g(a)h Fm(sessionId)p Fl(.)26 b(Since)19
b(we)g(need)g(to)g(k)o(eep)g(the)g(sessionId)g(from)f(one)h(page)f(to)h
(the)h(ne)o(xt)e(on)0 1302 y(the)i(client)g(side,)h(we)f(still)i(ha)n
(v)o(e)d(the)h(same)h(options)e(as)i(described)e(in)h(the)g(pre)n
(vious)f(section:)125 1532 y Fe(\017)41 b Fl(Store)55
b(the)h(sessionId)f(in)g(the)h(URL)g(\(this)g(is)g(why)f(you)g
(sometimes)g(see)h(long)f(URLs)h(for)f(some)h(sites)g(lik)o(e)208
1632 y Fn(http://domain/page)o(?session)o(Id=)o(dsql)o
(kjsqlkdsklsjsk798)o(79)o(87)o(98)o(798)o(7d)o(qkshsqjkh)o(sq79)o(87)o
(98)-6 b Fl(\))125 1798 y Fe(\017)41 b Fl(Store)20 b(the)g(sessionId)g
(in)g(the)g(hidden)f(\002eld)h(of)g(a)h(form)e(future.)125
1964 y Fe(\017)41 b Fl(Store)20 b(the)g(sessionId)g(in)g(a)g(cookie)0
2194 y(The)g(session)h(data)g(itself)g(\(in)f(our)g(e)o(xample:)25
b(the)20 b(\002rst)i(name)e(and)g(the)g(last)i(name\))d(is)j(stored)e
(on)g(the)h(serv)o(er)f(side.)26 b(Again,)20 b(there)g(are)0
2293 y(man)o(y)f(options)g(to)i(store)f(it:)125 2507
y Fe(\017)41 b Fl(Store)20 b(it)g(in)h(RAM)307 2673 y
Fm(\226)41 b Fl(Adv)n(antage:)24 b(v)o(ery)19 b(f)o(ast;)i(can)f(store)
g(an)o(y)f(p)o(ython)g(object)307 2806 y Fm(\226)41 b
Fl(Disa)n(v)n(antage:)25 b(doesn')o(t)18 b(w)o(ork)i(in)g(in)h(a)f
(multi-process)f(en)m(vironment;)e(we)k(lose)f(the)g(data)g(when)g(the)
g(serv)o(er)g(is)h(stopped)125 2972 y Fe(\017)41 b Fl(Store)20
b(it)g(in)h(the)f(\002lesystem)307 3138 y Fm(\226)41
b Fl(Adv)n(antage:)24 b(ne)n(v)o(er)18 b(lose)j(data;)f(w)o(orks)g(in)g
(a)h(multi-process)e(en)m(vironment)307 3271 y Fm(\226)41
b Fl(Disa)n(v)n(antage:)25 b(slo)n(w;)20 b(lots)h(of)f(reads/writes)g
(to)g(disk;)g(can)g(only)g(store)g(pickable)f(p)o(ython)f(objects)125
3437 y Fe(\017)41 b Fl(Store)20 b(it)g(in)h(a)f(cookie)g(in)g(the)g
(client')-5 b(s)21 b(bro)n(wser)307 3603 y Fm(\226)41
b Fl(Adv)n(antage:)28 b(w)o(orks)22 b(in)g(multi-thread)f(or)h
(multi-process)f(en)m(vironments.)28 b(Serv)o(er)22 b(is)h(not)f
(vulnerable)e(to)j(attacks)f(that)390 3702 y(consist)f(in)f
(arti\002cially)g(starting)g(thousands)f(of)h(sessions)g(on)g(the)g
(serv)o(er)g(to)g(bring)f(it)i(to)f(its)i(knees.)307
3835 y Fm(\226)41 b Fl(Disa)n(v)n(antage:)36 b(can)26
b(only)f(store)g(pickable)g(p)o(ython)f(objects.)42 b(Session)26
b(data)g Fm(must)h Fl(be)e(quite)h(small)g(\(some)f(bro)n(wsers)390
3935 y(limit)c(the)f(size)h(of)f(cookie)f(data)h(to)g(4KB\))125
4101 y Fe(\017)41 b Fl(Store)20 b(it)g(in)h(a)f(database)307
4267 y Fm(\226)41 b Fl(Adv)n(antage:)24 b(ne)n(v)o(er)18
b(lose)j(data;)f(w)o(orks)g(in)g(a)h(multi-process)e(en)m(vironment)307
4400 y Fm(\226)41 b Fl(Disa)n(v)n(antage:)25 b(slo)n(wer)20
b(than)f(RAM;)i(lots)g(of)f(reads/writes)g(to)g(database;)g(can)g(only)
f(store)h(pickable)f(p)o(ython)g(objects)125 4566 y Fe(\017)41
b Fl(Store)20 b(it)g(an)o(ywhere)f(you)g(can)h(think)f(of)h(...)0
4779 y(Some)h(systems)g(can)g(also)h(mix)e(some)h(of)g(these)g
(options:)26 b(for)21 b(instance,)f(session)i(data)f(can)g(be)g(stored)
f(in)h(RAM)h(and)f(sa)n(v)o(ed)f(to)i(disk)0 4879 y(or)e(to)g(a)h
(database)e(once)h(in)g(a)h(while.)0 5025 y(Another)h(option)f(is)j(to)
f(store)g(e)n(v)o(erything)d(in)j(RAM)h(and)e(sa)n(v)o(e)h(it)h(to)f
(disk)g(when)f(the)h(serv)o(er)f(shutsdo)n(wn)f(\(although)g(this)i
(might)g(be)0 5125 y(dangerous)18 b(because)h(we)i(might)f(not)f(ha)n
(v)o(e)h(time)g(to)h(sa)n(v)o(e)f(it)h(if)g(the)f(serv)o(er)f(crashes)h
(or)g(is)h(killed)f(badly\).)0 5272 y(Also,)e(session)g(data)f(might)f
(not)h(change)f(too)h(often)g(so)g(another)f(option)g(is)i(to)g(store)f
(it)h(in)f(RAM)h(and)f(sa)n(v)o(e)g(it)h(to)g(disk)f(or)g(to)g(a)h
(database)0 5372 y(only)h(when)h(it)h(changes.)p 0 5549
3901 4 v 0 5649 a Fk(48)2563 b(Chapter)23 b(16.)52 b(Ho)o(w)23
b(to)g(use)g(sessions)p eop
%%Page: 49 52
49 51 bop 0 88 a Fg(16.3)121 b(Sessions)33 b(implementation)i(in)e
(Cherr)t(yPy)0 321 y Fl(The)20 b(follo)n(wing)e(options)i(are)g
(supported)e(in)i(CherryPy:)125 514 y Fe(\017)41 b Fl(sessionId:)24
b(for)c(no)n(w)-5 b(,)19 b(the)h(sessionId)g(is)h(al)o(w)o(ays)g
(stored)e(in)i(a)f(cookie)125 666 y Fe(\017)41 b Fl(session)20
b(data:)25 b(three)20 b(options)f(are)h(b)n(uild)g(in)h(and)e(you)g
(can)h(implement)f(v)o(ery)g(easily)i(an)o(y)e(storage)h(method)f(you)g
(w)o(ant)h(...)307 817 y Fm(\226)41 b Fl(Store)20 b(e)n(v)o(erything)e
(in)i(RAM;)h(ne)n(v)o(er)e(sa)n(v)o(e)h(it)h(to)g(disk)f(or)g(to)g(a)h
(database)307 935 y Fm(\226)41 b Fl(Store)20 b(e)n(v)o(erything)e(in)i
(the)g(\002lesystem;)h(read)e(and)h(sa)n(v)o(e)h(the)f(data)g(for)f
(each)h(request)307 1054 y Fm(\226)41 b Fl(Store)20 b(the)g(session)h
(data)f(in)g(the)h(client)f(bro)n(wser)m(,)e(as)j(a)g(cookie)307
1172 y Fm(\226)41 b Fl(Write)21 b(your)e(o)n(wn)h(storage)f(functions)g
(so)h(you)g(can)g(store)g(the)g(data)g(where)n(v)o(er)e(you)i(w)o(ant)0
1365 y(Y)-9 b(ou)22 b(should)g(use)h(the)f(\002rst)i(option)d(\(RAM\))i
(if)g(you)f(don')o(t)f(use)i(multiple)f(processes)g(\(using)g(multiple)
g(threads)g(is)i(\002ne\))e(and)g(if)h(you)0 1465 y(don')o(t)c(care)h
(about)f(losing)g(session)i(data)f(when)g(the)g(serv)o(er)f(is)i
(stopped/restarted.)0 1612 y(Y)-9 b(ou)20 b(should)f(use)h(the)g
(second)g(option)f(\(\002lesystem\))g(if)i(you)e(don')o(t)g(ha)n(v)o(e)
g(a)i(database)f(and)f(don')o(t)g(w)o(ant)h(to)g(lose)h(data.)0
1759 y(The)d(third)g(option)f(is)j(quite)e(interesting)f(b)n(ut)i(only)
e(w)o(orks)h(if)h(the)g(session)f(data)h(for)f(each)g(user)g(is)i
(quite)e(small)h(\(some)e(bro)n(wsers)h(limit)0 1858
y(the)i(size)h(of)f(cookies)f(to)i(4KB\).)0 2005 y(The)e(fourth)e
(option)h(\(storing)g(your)g(session)i(data)f(in)g(a)h(database\))e(is)
i(the)f(recommended)d(option)i(for)h(most)g("real-w)o(orld")e
(websites.)0 2326 y Fg(16.4)121 b(Con\002gur)o(ation)36
b(v)m(ar)r(iab)n(les)d(used)i(to)f(control)g(sessions)0
2559 y Fl(In)18 b(order)e(to)j(use)f(sessions,)h(you)e(must)h(\002rst)g
(enable)g(sessions)g(by)g(setting)g(a)g(fe)n(w)g(con\002guration)d(v)n
(ariables)j(on)f(the)h(con\002g)f(\002le,)i(under)0 2658
y(the)h Fi([session])h Fl(scope.)k(The)20 b(ne)n(w)g(con\002guration)d
(options)j(are:)125 2843 y Fe(\017)41 b Fi(stor)o(a)o(g)o(eT)-6
b(ype)p Fl(:)23 b(Can)d(be)f(either)g("ram",)g("\002le",)h("cookie")e
(or)h("custom":)24 b(this)c(tells)g(whether)f(you)f(w)o(ant)i(to)f
(store)h(session)g(data)208 2942 y(in)g(RAM,)h(to)f(disk,)g(in)g(a)h
(cookie,)e(or)h(write)g(your)f(o)n(wn)g(storage)h(functions.)125
3094 y Fe(\017)41 b Fi(stor)o(a)o(g)o(eF)l(ileDir)r Fl(:)31
b(This)23 b(must)g(be)g(set)h(if)f(you)f(set)i Fi(stor)o(a)o(g)o(eT)-6
b(ype)22 b Fl(to)h("\002le".)34 b(Set)24 b(it)g(to)f(the)g(directory)f
(where)g(the)h(session)h(data)208 3193 y(will)c(be)h(stored)125
3345 y Fe(\017)41 b Fi(timeout)q Fl(:)25 b(Number)19
b(of)h(minutes)f(after)h(which)g(a)g(session)h(e)o(xpires)e(if)i(there)
f(w)o(as)h(no)e(acti)n(vity)-5 b(.)24 b(The)c(def)o(ault)g(is)h(60)f
(minutes.)125 3496 y Fe(\017)41 b Fi(cleanUpDelay)p Fl(:)34
b(If)26 b(cleanUpDelay)e(is)j(set)g(to)f(N)g(minutes,)h(then)f(the)f
(CherryPy)g(serv)o(er)g(will)i(check)e(e)n(v)o(ery)f(N)j(minutes)e(if)
208 3596 y(there)19 b(are)h(old/e)o(xpired)e(sessions)j(that)f(need)g
(to)g(be)g(cleaned)g(up.)k(The)c(def)o(ault)f(is)i(60)f(minutes.)125
3747 y Fe(\017)41 b Fi(cookieName)p Fl(:)24 b(Name)c(of)g(the)g(cookie)
f(that)h(stores)h(the)f(sessionId:)25 b(The)20 b(def)o(ault)f(is)i
("CherryPySession")0 4068 y Fg(16.5)121 b(Cleaning)35
b(up)f(old)g(sessions)0 4301 y Fl(If)21 b Fi(stor)o(a)o(g)o(eT)-6
b(ype)20 b Fl(is)i(either)e("ram",)g("\002le")i(or)e("cookie",)g(then)g
(CherryPy)g(will)i(automatically)d(clean)i(up)g(e)o(xpired)e(sessions)i
(for)g(you.)0 4401 y(If)g Fi(stor)o(a)o(g)o(eT)-6 b(ype)21
b Fl(is)h(set)h(to)e("custom",)g(then)g(you)g(ha)n(v)o(e)g(to)h(write)f
(your)g(o)n(wn)g(code)f(to)i(clean)f(up)h(old)f(sessions)h(in)g(a)g
(special)f(function)0 4500 y(called)f Fi(cleanUpOldSessions)p
Fl(.)0 4821 y Fg(16.6)121 b(Using)34 b(sessions)f(in)h(y)n(our)f(code)0
5054 y Fl(Once)24 b(you)g(ha)n(v)o(e)g(enabled)f(sessions)j(in)f(the)f
(con\002g)g(\002le,)i(the)f(w)o(ay)f(it)i(w)o(orks)e(is)h(v)o(ery)f
(easy:)34 b(CherryPy)23 b(just)j(mak)o(es)e(a)n(v)n(ailable)g(for)0
5154 y(you)f(a)h(dictionary)f(that)h(can)f(be)h(accessed)g(through)e
Fi(r)m(equest.sessionMap)p Fl(.)35 b(Y)-9 b(ou)23 b(can)h(use)g(this)h
(dictionary)d(to)i(store)g(the)g(data)f(that)0 5253 y(you)c(w)o(ant)i
(to)f(k)o(eep)g(about)f(a)h(perticular)f(client.)0 5400
y(The)h(reason)f(why)h Fi(sessionMap)f Fl(is)j(a)e(member)f(v)n
(ariable)g(of)h Fi(r)m(equest)i Fl(is)f(because)e(this)i(mak)o(es)f(it)
h(thread-safe.)p 0 5549 3901 4 v 0 5649 a Fk(16.3.)52
b(Sessions)23 b(implementation)j(in)e(Cherr)r(yPy)2189
b(49)p eop
%%Page: 50 53
50 52 bop 0 85 a Fg(16.7)121 b(Example)0 318 y Fl(F)o(or)23
b(instance,)g(if)g(you)f(w)o(ant)i(to)f(store)g(session)g(data)g(in)h
(RAM,)f(if)h(you)e(w)o(ant)h(sessions)h(to)f(e)o(xpire)f(after)h(2)g
(hours,)f(and)h(if)g(you)f(w)o(ant)0 418 y(CherryPy)d(to)h(clean)g(up)g
(e)o(xpired)f(sessions)h(e)n(v)o(ery)f(hour)m(,)g(use)h(the)g(follo)n
(wing)f(con\002g)g(\002le)i(\(`)p Fn(RootSer)r(v)n(er)l(.cfg)p
Fl('\):)236 656 y Fh([session])236 747 y(storageType=ram)236
838 y(timeout=120)236 930 y(cleanUpDelay=60)0 1169 y
Fl(If)e(you)e(w)o(ant)i(to)g(store)g(session)g(data)f(to)h(disk)g(\(in)
f(a)h(directory)e(called)i(`)p Fn(/home/user/sessionData)p
Fl('\),)13 b(use)19 b(the)g(follo)n(wing)e(con\002g)h(\002le:)236
1407 y Fh([session])236 1498 y(storageType=file)236 1590
y(storageFileDir=/home/user/sessionData)0 1876 y Fl(The)i(follo)n(wing)
e(e)o(xample)h(is)i(a)g(tri)n(vial)f(page)f(vie)n(w)i(counter:)236
2114 y Fh(CherryClass)43 b(Root:)236 2205 y(mask:)416
2297 y(def)h(index\(self\):)595 2388 y(<py-code=")774
2479 y(count=sessionMap.get\('pageViews',)39 b(0\)+1)774
2571 y(sessionMap['pageViews']=count)595 2662 y(">)595
2753 y(<html><body>)774 2845 y(Hello,)44 b(you've)g(been)g(here)g
(<py-eval="count">)e(time\(s\))595 2936 y(</body></html>)0
3384 y Fg(16.8)121 b(Stor)r(ing)34 b(session)f(data)i(in)f(a)f
(database)j(\(or)e(an)n(ywhere)h(else\))0 3617 y Fl(From)23
b(CherryPy-0.9-gamma)18 b(and)24 b(later)m(,)f(you)g(can)h(no)n(w)f
(write)g(your)g(o)n(wn)g(custom)g(functions)f(to)i(sa)n(v)o(e/load)e
(session)i(data.)35 b(This)0 3717 y(allo)n(ws)19 b(you)f(to)g(store)h
(them)f(where)n(v)o(er)f(you)h(w)o(ant.)24 b(In)19 b(order)e(to)i(do)f
(so,)h(all)g(you)f(ha)n(v)o(e)g(to)h(do)f(is)i(declare)e(the)g(three)g
(follo)n(wing)f(special)0 3816 y(functions)i(some)n(where)g(in)h(your)f
(code:)125 4030 y Fe(\017)41 b Fi(saveSessionData\(sessionId,)26
b(sessionData,)j(e)n(xpir)o(ationT)-5 b(ime\))p Fl(:)40
b(Store)28 b(the)g(sessionData)g(and)g(e)o(xpiration)e(time)i(for)f
(this)208 4129 y(sessionId)19 b(some)n(where.)24 b Fi(e)n(xpir)o
(ationT)-5 b(ime)19 b Fl(is)j(a)e Fi(\003oat)h Fl(as)g(returned)d(by)i
(the)g Fi(time)o(.time\(\))g Fl(function.)125 4295 y
Fe(\017)41 b Fi(loadSessionData\(sessionId\))p Fl(:)19
b(Retrie)n(v)o(e)f(the)h(sessionData)f(and)g(e)o(xpiration)e(time)j
(for)f(this)h(sessionId)f(and)f(returns)h(them)g(as)208
4395 y(a)i(tuple)125 4561 y Fe(\017)41 b Fi(cleanUpOldSessions\(\))p
Fl(:)22 b(Delete)e(e)o(xpired)f(sessions)0 4774 y(The)g(follo)n(wing)e
(e)o(xample)g(sho)n(ws)i(ho)n(w)g(to)g(store)f(the)h(session)h(data)e
(in)h(a)h(MySql)e(database.)24 b(It)19 b(assumes)g(that)g(there)g(is)h
(a)f(table)g(called)0 4874 y("session_data":)p 0 5549
3901 4 v 0 5649 a Fk(50)2563 b(Chapter)23 b(16.)52 b(Ho)o(w)23
b(to)g(use)g(sessions)p eop
%%Page: 51 54
51 53 bop 236 174 a Fh(mysql>)44 b(create)g(table)g
(session_data\(sessionId)d(varchar\(50\),)i(sessionData)g(text,)h
(expirationTime)e(int)j(unsigned\);)236 266 y(Query)f(OK,)h(0)f(rows)g
(affected)g(\(0.00)g(sec\))236 448 y(mysql>)g(describe)g(session_data;)
236 540 y(+----------------+------------------+---)o(---+--)o(---+--)o
(------)o(-+----)o(---+)236 631 y(|)h(Field)447 b(|)45
b(Type)582 b(|)45 b(Null)f(|)h(Key)f(|)h(Default)e(|)i(Extra)f(|)236
722 y(+----------------+------------------+---)o(---+--)o(---+--)o
(------)o(-+----)o(---+)236 814 y(|)h(sessionId)267 b(|)45
b(varchar\(50\))267 b(|)45 b(YES)89 b(|)224 b(|)45 b(NULL)178
b(|)314 b(|)236 905 y(|)45 b(sessionData)177 b(|)45 b(text)582
b(|)45 b(YES)89 b(|)224 b(|)45 b(NULL)178 b(|)314 b(|)236
996 y(|)45 b(expirationTime)d(|)j(int\(10\))f(unsigned)f(|)i(YES)89
b(|)224 b(|)45 b(NULL)178 b(|)314 b(|)236 1088 y
(+----------------+------------------+---)o(---+--)o(---+--)o(------)o
(-+----)o(---+)236 1179 y(3)45 b(rows)f(in)h(set)f(\(0.01)g(sec\))0
1509 y Fl(Note)30 b(that)f(we')l(v)o(e)g(chosen)g(to)h(use)g(an)f
Fi(int)j Fl(column)c(to)i(store)g(the)f(e)o(xpiration)f(time,)k(which)d
(is)i(easier)f(because)f(that')-5 b(s)30 b(ho)n(w)f(this)0
1609 y(v)n(ariable)17 b(is)i(passed)e(to)h(the)g Fi(saveSessionData)e
Fl(function.)23 b(W)-7 b(e)19 b(could)d(ha)n(v)o(e)i(chosen)f(to)h(use)
g(a)g Fi(datetime)f Fl(column)g(b)n(ut)h(then)f(we)h(w)o(ould)0
1708 y(ha)n(v)o(e)e(to)h(con)m(v)o(ert)e Fi(e)n(xpir)o(ation)h
Fl(time)h(into)f(a)i(suitable)e(format)g(to)h(insert)g(it)g(into)g(the)
g(table)g(\(and)e(con)m(v)o(ert)g(it)j(back)e(in)h Fi(loadSessionData)p
Fl(\).)0 1855 y(Here)j(is)h(an)f(e)o(xample)f(code)h(that)g(uses)h(the)
f Fi(session_data)f Fl(MySql)g(table)i(to)f(store)g(session)h(data:)p
0 5549 3901 4 v 0 5649 a Fk(16.8.)52 b(Stor)q(ing)25
b(session)d(data)i(in)f(a)h(database)f(\(or)g(an)o(ywhere)g(else\))1587
b(51)p eop
%%Page: 52 55
52 54 bop 236 174 a Fh(use)45 b(MySql)236 266 y(import)f(pickle,)g
(base64,)f(StringIO,)h(time)236 357 y(CherryClass)f(MyDb\(MySql\):)236
448 y(function:)416 540 y(def)h(__init__\(self\):)595
631 y(self.openConnection\('localhost',)39 b('test',)44
b('',)g('test'\))236 814 y(def)h(saveSessionData\(sessionId,)40
b(sessionData,)j(expirationTime\):)416 905 y(#)h(Pickle)g(sessionData)f
(and)h(base64)g(encode)g(it)416 996 y(f)g(=)h(StringIO.StringIO\(\))416
1088 y(pickle.dump\(sessionData,)40 b(f,)45 b(1\))416
1179 y(dumpStr)e(=)i(f.getvalue\(\))416 1270 y(f.close\(\))416
1362 y(dumpStr)e(=)i(base64.encodestring\(dumpStr\))416
1453 y(myDb.query\("delete)c(from)k(session_data)d(where)i
(sessionId='\045s'")f(\045)h(sessionId\))416 1544 y
(myDb.query\("insert)d(into)k(session_data)d(values\('\045s',)h
('\045s',)h(\045s\)")g(\045)h(\()595 1636 y(sessionId,)e(dumpStr,)h
(int\(expirationTime\)\)\))236 1818 y(def)h
(loadSessionData\(sessionId\):)416 1910 y(sessionList)e(=)h
(myDb.query\("select)e(sessionData,)h(expirationTime)f(from)i
(session_data)f(where)h(sessionId='\045s'")f(\045)h(sessionId\))416
2001 y(if)g(not)g(sessionList:)595 2092 y(return)g(None)416
2183 y(dumpStr)f(=)i(base64.decodestring\(sessionList[0][0]\))416
2275 y(f)f(=)h(StringIO.StringIO\(dumpStr\))416 2366
y(sessionData)e(=)h(pickle.load\(f\))416 2457 y(f.close\(\))416
2549 y(return)f(\(sessionData,)g(sessionList[0][1]\))236
2731 y(def)i(cleanUpOldSessions\(\):)416 2823 y(now)f(=)h
(time.time\(\))416 2914 y(myDb.query\("delete)c(from)k(session_data)d
(where)i(expirationTime)f(<)h(\045s")h(\045)f(int\(now\)\))236
3097 y(CherryClass)f(Root:)236 3188 y(view:)416 3279
y(def)h(index\(self\):)595 3371 y(i)h(=)f
(request.sessionMap.get\('counter',)39 b(0\))45 b(+)g(1)595
3462 y(request.sessionMap['counter'])40 b(=)k(i)595 3553
y(return)g(str\(i\))p 0 5549 3901 4 v 0 5649 a Fk(52)2563
b(Chapter)23 b(16.)52 b(Ho)o(w)23 b(to)g(use)g(sessions)p
eop
%%Page: 53 56
53 55 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3176 427
y Fj(SEVENTEEN)p 0 515 V 901 978 a Fr(Ho)m(w)57 b(to)h(use)g(Psyco)f
(with)h(Cherr)6 b(yPy)0 1465 y Fl(Psyco)39 b(is)i(a)f(p)o(ython)e
(module)g(that)i(can)f(impro)o(v)o(e)e(the)j(speed)f(of)g(some)h(p)o
(ython)e(programs.)81 b(Psyco)39 b(can)h(be)f(found)f(here:)0
1565 y Fn(http://psyco)m(.sourcef)n(orge)o(.net)-6 b
Fl(.)0 1712 y(Pysco)22 b(has)f(little)i(impact)e(on)g(the)h(speed)f(of)
g(the)h(CherryPy)f(code)f(itself)j(\(the)e(code)g(is)h(already)f
(really)g(f)o(ast)h(:-\))g(so)g(you)f(should)f(only)0
1811 y(use)27 b(it)h(if)f(you)f(think)g(it)i(can)e(impro)o(v)o(e)f(the)
i(speed)f(of)h(the)g(code)f(that)h Fm(y)n(ou)g Fl(wrote)f(for)g(your)g
(site)i(\(for)e(instance,)h(if)h(you)e(use)h(some)0 1911
y(number)n(-crunching)15 b(functions)k(to)h(b)n(uild)g(your)f(pages\).)
0 2058 y(Also,)k(some)f(users)g(reported)f(that)h(Psyco)g(introduces)f
(big)g(memory)g(leaks)h(in)h(CherryPy)e(web)h(apps.)30
b(So)23 b(if)f(you)f(try)h(to)h(use)f(it)h(and)0 2157
y(notice)d(that)g(your)f(site)i(leaks)f(memory)-5 b(,)18
b(you')o(ll)h(kno)n(w)h(where)f(to)h(look)g(...)0 2304
y(In)f(order)g(to)h(enable)f(Psyco)h(with)g(CherryPy)-5
b(,)18 b(you)g(should)h(ha)n(v)o(e)g(Psyco)h(installed)g(on)f(your)g
(machine)f(and)h(then)h(all)g(you)f(ha)n(v)o(e)g(to)h(do)0
2404 y(is)h(to)f(use)h(the)f("initProgram")e(special)j(function)d(and)i
(to)g(put)g(the)g(follo)n(wing)f(code)g(in)h(it:)236
2642 y Fh(def)45 b(initProgram\(\):)416 2733 y(import)e(psyco)416
2825 y(psyco.full\(\))p 0 5549 3901 4 v 3808 5649 a Fk(53)p
eop
%%Page: 54 57
54 56 bop 0 5549 3901 4 v 0 5649 a Fk(54)p eop
%%Page: 55 58
55 57 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3289 427
y Fj(EIGHTEEN)p 0 515 V 763 978 a Fr(Ho)m(w)58 b(to)f(use)h(cookies)f
(with)h(Cherr)6 b(yPy)0 1465 y Fl(CherryPy)16 b(uses)i(the)f
Fi(Cookie)g Fl(module)f(from)g(p)o(ython)g(and)h(in)g(particular)f(the)
i Fi(SimpleCookie)e Fl(object)h(type)f(to)i(handle)e(cookies.)23
b(More)0 1565 y(information)18 b(can)i(be)g(found)e(here:)25
b Fn(http://www)l(.p)n(ython.org/d)o(oc/curre)o(nt)o(/li)o(b/mo)o(dul)o
(e-Co)o(okie)n(.h)o(tml)0 1892 y Fg(18.1)121 b(Setting)35
b(cookies)0 2125 y Fl(In)21 b(order)f(to)h(send)g(a)h(cookie)e(to)h(a)h
(bro)n(wser)m(,)d(you)i(ha)n(v)o(e)f(to)i(use)f(the)g(global)g(v)n
(ariable)f Fi(r)m(esponse)o(.simpleCookie)p Fl(,)f(which)i(is)h(a)f
Fi(Simple-)0 2225 y(Cookie)f Fl(object.)0 2371 y(The)g(follo)n(wing)e
(code)i(sho)n(ws)g(ho)n(w)g(to)g(set)h(a)g(cookie)e(in)h(your)f
(CherryPy)g(code:)236 2610 y Fh(CherryClass)43 b(Root:)236
2701 y(view:)416 2792 y(def)h(index\(self\):)595 2884
y(response.simpleCookie['cookieName']='c)o(ookieV)o(alue')595
2975 y(response.simpleCookie['cookieName']['p)o(ath']=)o('/')595
3066 y(response.simpleCookie['cookieName']['m)o(ax-age)o(']=360)o(0)595
3158 y(response.simpleCookie['cookieName']['v)o(ersion)o(']=1)595
3249 y(return)g("<html><body>Hello,)d(I)k(just)f(sent)g(you)h(a)f
(cookie</body></html>")0 3695 y Fg(18.2)121 b(Reading)36
b(cookies)0 3928 y Fl(Cookies)23 b(that)g(are)f(sent)i(by)e(a)h(bro)n
(wser)f(are)h(stored)f(in)h(the)g(global)f(v)n(ariable)g
Fi(r)m(esponse)o(.simpleCookie)p Fl(,)f(which)i(is)h(a)f
Fi(SimpleCookie)0 4027 y Fl(object.)0 4174 y(The)d(follo)n(wing)e(code)
i(sho)n(ws)g(ho)n(w)g(to)g(read)g(a)g(cookie)f(in)i(your)e(CherryPy)g
(code:)p 0 5549 3901 4 v 3808 5649 a Fk(55)p eop
%%Page: 56 59
56 58 bop 236 174 a Fh(CherryClass)43 b(Root:)236 266
y(mask:)416 357 y(def)h(index\(self\):)595 448 y(<html><body>)774
540 y(Hi,)h(you)f(sent)g(me)h(<py-eval="len\(request.simpleCookie\)")o
(>)39 b(cookies.<br>)774 631 y(Here)44 b(is)h(a)g(list)f(of)g(cookie)g
(names/values:<br>)774 722 y(<py-for="cookieName)e(in)i
(request.simpleCookie.keys\(\)">)954 814 y(<py-eval="cookieName+':)c
('+request.simpleCookie[cookieName].value">)o(<br>)774
905 y(</py-for>)595 996 y(</body></html>)p 0 5549 3901
4 v 0 5649 a Fk(56)2062 b(Chapter)23 b(18.)52 b(Ho)o(w)23
b(to)g(use)g(cookies)g(with)h(Cherr)r(yPy)p eop
%%Page: 57 60
57 59 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3296 427
y Fj(NINETEEN)p 0 515 V 654 978 a Fr(Ho)m(w)58 b(to)f(use)h(Cheetah)f
(templates)h(with)3033 1227 y(Cherr)6 b(yPy)0 1714 y
Fl(Cheetah)38 b(is)g(a)h(templating)d(language)g(for)i(p)o(ython.)76
b(CherryPy)37 b(comes)g(with)h(its)h(o)n(wn)f(templating)e(language)g
(\(CGTL)i(and)0 1814 y(CHTL\),)45 b(b)n(ut)h(if)g(you)f(prefer)f(to)i
(use)g(Cheetah,)51 b(that')-5 b(s)46 b(v)o(ery)f(easy)g(to)h(do.)101
b(More)45 b(about)g(Cheetah)g(can)h(be)f(found)f(at:)0
1913 y Fn(http://www)l(.cheetahtempla)o(te)n(.org)o(/)-6
b Fl(.)0 2060 y(Here)20 b(is)h(a)g(sample)f(code)f(that)i(sho)n(ws)f
(ho)n(w)f(to)i(do)f(it:)p 0 5549 3901 4 v 3808 5649 a
Fk(57)p eop
%%Page: 58 61
58 60 bop 236 174 a Fh(#################)236 266 y(#)45
b(File)f(Root.cpy)236 357 y(#################)236 448
y(from)g(Cheetah.Template)f(import)g(Template)236 540
y(CherryClass)g(Root:)236 631 y(view:)416 722 y(def)h(index\(self\):)
595 814 y(template)f(=)i(Template\(file='index.tmpl'\))595
905 y(template.colors)d(=)j(['AA',)f('BB',)g('CC'])595
996 y(return)g(template.respond\(\))236 1179 y(#################)236
1270 y(#)h(File)f(index.tmpl)236 1362 y(#################)236
1453 y(<html>)236 1544 y(<head>)236 1636 y(<title>Cheetah)f
(Experiment</title>)236 1727 y(</head>)236 1818 y(#attr)h($colors)g(=)h
([])236 1910 y(#if)g($colors)e(is)i([])416 2001 y(#set)f(codelist)f(=)i
(['00','33','66','99','CC','FF'])236 2092 y(#else)416
2183 y(#set)f(codelist)f(=)i($colors)236 2275 y(#end)f(if)236
2366 y(<body>)236 2457 y(<table)g(border=1>)236 2549
y(#for)g($r)h(in)f($codelist)416 2640 y(#for)g($g)g(in)h($codelist)595
2731 y(<tr>)595 2823 y(#for)f($b)h(in)f(codelist)595
2914 y(#set)g(color)g(=)h('#\045s\045s\045s'\045\(r,g,b\))595
3005 y(<td)f(bgColor)g(=)h($color>&nbsp;&nbsp;)c($color)j(&nbsp;)g
(</td>)595 3097 y(#end)g(for)416 3188 y(#end)g(for)236
3279 y(#end)g(for)236 3371 y(</table>)236 3462 y(</body>)236
3553 y(</html>)0 3840 y Fl(Note)24 b(that)h(this)f(e)o(xample)f(is)j
(not)e(optimized)e(because)i(the)g(template)g(\002le)h(will)g(be)f
(read/parsed/rendered)c(each)k(time)h(the)f(page)g(is)0
3939 y(displayed.)g(It)c(is)h(quite)f(easy)g(to)h(change)e(that)h(code)
f(so)i(it)g(only)e(does)h(it)h(once,)e(or)h(e)n(v)o(erytime)f(the)h
(template)g(\002le)g(is)i(changed.)0 4086 y(Man)o(y)d(thanks)h(to)g("T)
-7 b(oddB")20 b(for)f(contrib)n(uting)f(this)j(code)e(:-\))p
0 5549 3901 4 v 0 5649 a Fk(58)1646 b(Chapter)24 b(19.)52
b(Ho)o(w)23 b(to)g(use)g(Cheetah)h(templates)g(with)g(Cherr)r(yPy)p
eop
%%Page: 59 62
59 61 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3395 427
y Fj(TWENTY)p 0 515 V 557 978 a Fr(Ho)m(w)57 b(to)h(use)f(streaming)g
(with)h(Cherr)6 b(yPy)0 1468 y Fl(If)21 b(you)e(need)h(to)h(return)f(a)
h(v)o(ery)e(big)i(page)e(to)i(a)g(bro)n(wser)m(,)f(then)g(you)f(might)h
(w)o(ant)h(to)g(use)g(streaming,)f(which)g(means)g(that)h(CherryPy)0
1567 y(will)k(start)h(sending)d(the)i(page)f(back)g(to)g(the)h(bro)n
(wser)f(before)f(the)i(page)e(is)j(completely)d(b)n(uilt,)j(and)e(the)h
(page)f(will)h(be)g(returned)d(in)0 1667 y(chunks.)0
1814 y(All)i(you)f(need)h(to)g(do)f(to)h(use)g(streaming)f(is)i(to)e
(use)i(the)e Fi(r)m(esponse)o(.w\002le)g Fl(v)n(ariable,)h(which)f
(contains)g(the)h(sock)o(et)f(used)h(to)g(send)g(the)0
1913 y(response)19 b(back)h(to)g(the)g(bro)n(wser)-5
b(.)25 b(Y)-9 b(ou)19 b(need)h(to)g(write)g Fm(all)h
Fl(the)f(data)g(on)g(the)g(sock)o(et)g(\(including)e(the)i(response)g
(header\).)0 2060 y(Y)-9 b(ou)19 b(also)h(need)f(to)h(tell)g(CherryPy)f
(that)h(you')l(v)o(e)d(already)i(sent)h(the)f(response)g(to)h(the)g
(bro)n(wser)e(and)i(therefore)d(it)k(doesn')o(t)d(ha)n(v)o(e)h(to)h(do)
0 2160 y(it.)26 b(T)-7 b(o)20 b(do)g(so,)g(you)f(need)h(to)g(set)h(the)
f Fi(r)m(esponse)o(.sendResponse)e Fl(v)n(ariable)h(to)h(0.)0
2307 y(The)g(follo)n(wing)e(code)i(sho)n(ws)g(an)g(e)o(xample)f(of)h
(ho)n(w)g(to)g(use)g(streaming:)236 2545 y Fh(import)44
b(time)236 2636 y(CherryClass)f(Root:)236 2728 y(view:)416
2819 y(def)h(index\(self\):)595 2910 y(response.wfile.write\("HTTP/1.1)
c(200\\r\\n"\))595 3001 y(response.wfile.write\("Content-Type:)f
(text/plain\\r\\n\\r\\n"\))595 3093 y(response.wfile.write\("First)h
(line.)k(Sleeping)g(2)g(seconds)g(...\\n"\))595 3184
y(time.sleep\(2\))595 3275 y(response.wfile.write\("Second)c(line.)k
(Sleeping)f(2)i(seconds)f(...\\n"\))595 3367 y(time.sleep\(2\))595
3458 y(response.wfile.write\("Third)c(and)k(last)h(line"\))595
3549 y(response.sendResponse)c(=)k(0)595 3641 y(return)f("")g(#)h(The)f
(view)g(still)g(needs)g(to)h(return)f(a)g(string)p 0
5549 3901 4 v 3808 5649 a Fk(59)p eop
%%Page: 60 63
60 62 bop 0 5549 3901 4 v 0 5649 a Fk(60)p eop
%%Page: 61 64
61 63 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3145 427
y Fj(TWENTY)-8 b(ONE)p 0 515 V 378 978 a Fr(Sample)57
b(deplo)-6 b(yment)57 b(con\002gur)n(ation)g(f)-6 b(or)57
b(a)2237 1227 y(real-w)n(or)s(ld)f(w)n(ebsite)0 1706
y Fl(This)16 b(Ho)n(wT)-7 b(o)16 b(describes)g(a)h(sample)f(deplo)o
(yment)e(con\002guration)f(that)k(I)f(belie)n(v)o(e)g(is)h(well)g
(adapted)e(for)g(most)i("real-w)o(orld")d(websites.)0
1805 y(It)20 b(is)i(the)e(con\002guration)d(used)j(by)g(the)g
Fn(http://www)l(.cherr)r(yp)n(y)-7 b(.org)16 b Fl(website)k(itself.)0
2133 y Fg(21.1)121 b(Hardw)n(are)0 2366 y Fl(The)25 b(website)g(runs)g
(on)f(the)h(Celeron)g(1.3Ghz)e(with)j(512MB)e(RAM)i(and)e(shares)h(the)
g(machine)f(with)h(about)f(30)h(other)f(sites.)41 b(The)0
2465 y(choice)19 b(of)h(the)h(hardw)o(are)d(depends)h(mostly)h(on)g
(your)f(b)n(udget)g(and)g(ho)n(w)h(much)f(traf)n(\002c)h(you)f(plan)h
(to)h(get...)0 2793 y Fg(21.2)121 b(Softw)n(are)35 b(en)n(vironment)0
3025 y Fl(The)21 b(site)h(runs)e(on)h(Linux)f(RedHat,)i(b)n(ut)f(I)g
(belie)n(v)o(e)f(it)i(w)o(ould)f(run)f(just)i(as)f(well)h(on)f(other)f
(OSes)i(\(including)d(W)m(indo)n(ws\).)27 b(It)21 b(runs)g(on)0
3125 y(Python-2.3,)h(b)n(ut)h(I)h(belie)n(v)o(e)f(it)i(w)o(ould)e(run)g
(just)h(as)h(well)f(on)f(Python-2.2)e(or)j(Python-2.1.)33
b(Ho)n(we)n(v)o(er)m(,)22 b(Python-2.3)f(seems)k(to)e(be)h(a)0
3225 y(bit)c(f)o(aster)h(than)e(older)h(v)o(ersions.)0
3552 y Fg(21.3)121 b(Cherr)t(yPy)33 b(v)m(ersion)0 3785
y Fl(The)24 b(site)h(usually)e(uses)i(the)f(latest)h(CVS)h(v)o(ersion)c
(from)i(CherryPy)f(\(currently)f(the)i(0.9-\002nal\))e(v)o(ersion.)36
b(The)24 b(0.9)f(v)o(ersion)g(seems)0 3885 y(to)i(be)f(much)g(more)g
(stable)g(than)g(pre)n(vious)f(v)o(ersions)h(so)h(if)g(you)e(are)i
(running)d(an)j(older)f(v)o(ersion,)g(I)g(highly)g(recommend)e(that)i
(you)0 3984 y(upgrade)18 b(to)j(that)f(v)o(ersion.)0
4312 y Fg(21.4)121 b(Cherr)t(yPy)33 b(ser)t(v)m(er)g(con\002gur)o
(ation)0 4544 y Fl(The)21 b(site)i(is)f(deplo)o(yed)e(as)i(a)g
(thread-pool)d(serv)o(er)-5 b(.)28 b(I)22 b(belie)n(v)o(e)f(this)h(is)g
(the)g(best)g(option)e(for)h(most)h(websites.)29 b(It)22
b(is)g(con\002gured)e(to)h(run)0 4644 y(with)j(10)f(threads)g(and)g
(since)h(each)g(page)f(is)h(really)g(f)o(ast)g(to)g(b)n(uild,)g(the)g
(site)g(should)f(be)g(able)h(to)g(support)e(man)o(y)h(\(much)f(more)h
(than)0 4744 y(10\))c(concurrent)f(users...)0 4891 y(The)h(number)e(of)
i(threads)g(that)g(you)f(should)h(use)g(for)g(your)e(site)k(depends)c
(on)i(man)o(y)f(criteria,)h(including)e(the)j(number)d(of)i(concurrent)
0 4990 y(users)i(you)g(plan)f(to)h(ha)n(v)o(e,)g(the)g(a)n(v)o(erage)f
(time)h(your)f(pages)h(tak)o(e)g(to)g(b)n(uild)g(and)g(the)g(po)n(wer)f
(\(CPU)i(and)e(RAM\))i(of)e(the)i(machine)d(that)0 5090
y(will)i(run)e(the)i(site.)p 0 5549 3901 4 v 3808 5649
a Fk(61)p eop
%%Page: 62 65
62 64 bop 0 88 a Fg(21.5)121 b(Cherr)t(yPy)33 b(ser)t(v)m(er)g(deplo)l
(yment)0 321 y Fl(The)20 b(site)h(is)g(running)d("e)o(xposed")g(on)i
(port)g(80,)f(which)h(means)g(that)g(there)g(is)h(no)f(other)f(webserv)
o(er)g(\(lik)o(e)h(Apache\))f(in)m(v)n(olv)o(ed.)0 468
y(In)k(order)f(to)i(listen)g(on)f(port)f(80,)i(the)f(serv)o(er)g(has)g
(to)h(be)f(started)h(by)f(the)g(user)g("root".)34 b(Ho)n(we)n(v)o(er)m
(,)22 b(running)f(the)j(serv)o(er)e(as)i("root")f(is)0
567 y(not)g(v)o(ery)f(safe,)i(so)g(we)f(use)h(the)f(special)g(function)
f Fi(initAfterBind)i Fl(to)g(switch)f(the)h(user)f(running)e(the)i
(serv)o(er)f(to)i(another)e(user)-5 b(.)34 b(The)0 667
y(code)20 b(is)h(v)o(ery)e(simple:)236 905 y Fh(def)45
b(initAfterBind\(\):)416 996 y(import)e(os)416 1088 y(#)h(We)h(must)f
(switch)g(the)g(group)g(first)416 1179 y(os.setegid\(500\))87
b(#)44 b(Replace)g(with)g(desired)g(user)g(id.)416 1270
y(os.seteuid\(2524\))e(#)i(Idem)0 1557 y Fl(Also,)20
b(since)h(the)f(serv)o(er)f(runs)g(a)i(pool)e(of)h(threads,)f(we)i
(must)f(switch)g(the)g(user)g(for)g(all)g(these)h(threads)e(as)i(well)f
(\(otherwise,)f(only)h(the)0 1656 y(parent)f(thread)g(will)i(be)g
(switched\).)j(T)-7 b(o)20 b(do)g(so,)g(we)h(just)g(use)f(the)g
Fi(initThr)m(ead)i Fl(special)e(function,)e(lik)o(e)j(this:)236
1894 y Fh(def)45 b(initThread\(threadIndex\):)416 1986
y(import)e(os)416 2077 y(#)h(We)h(must)f(switch)g(the)g(group)g(first)
416 2168 y(os.setegid\(500\))87 b(#)44 b(Replace)g(with)g(desired)g
(user)g(id.)416 2260 y(os.seteuid\(2524\))e(#)i(Idem)0
2708 y Fg(21.6)121 b(Database)36 b(con\002gur)o(ation)0
2941 y Fl(The)28 b(site)h(uses)g(MySql)f(as)h(a)g(database)e(back)o
(end)g(to)h(log)g(the)h(requests)f(that)g(are)g(being)g(made)f(to)i
(the)f(serv)o(er)-5 b(.)49 b(Therefore,)28 b(each)0 3041
y(request)20 b(triggers)f(a)i(database)e(write.)0 3188
y(Since)31 b(the)g(MySQLdb)f(dri)n(v)o(er)g(doesn')o(t)f(w)o(ork)i
(well)g(\(from)f(my)h(e)o(xperience\))d(if)k(we)f(ha)n(v)o(e)f(se)n(v)o
(eral)h(threads)f(sharing)g(the)h(same)0 3287 y(database)20
b(connection,)d(each)j(thread)f(is)j(gi)n(v)o(en)d(its)i(o)n(wn)e
(database)h(connection,)e(so)i(it)h(doesn')o(t)e(interfer)g(with)h
(other)g(threads.)0 3434 y(This)g(is)h(done)f(v)o(ery)f(easily)h(using)
g(the)g Fi(initThr)m(ead)i Fl(special)e(function)e(and)i(the)g
Fi(r)m(equest)i Fl(special)e(v)n(ariable,)f(lik)o(e)h(this:)236
3672 y Fh(def)45 b(initThread\(threadIndex\):)416 3764
y(time.sleep\(threadIndex)c(*)j(0.2\))h(#)f(Sleep)g(0.2)g(seconds)g
(between)g(each)g(new)g(database)g(connection)f(to)h(make)h(sure)f
(MySql)g(can)g(keep)g(up)h(...)416 3855 y(request.connection)c(=)k
(MySQLdb.connect\('host',)c('user',)j('password',)f('name'\))0
4141 y Fl(This)21 b(tak)o(es)g(adv)n(antage)e(of)i(the)g(f)o(act)g
(that)g Fi(r)m(equest)h Fl(is)g(a)f(special)g(thread-a)o(w)o(are)e
(class)j(instance)e(\(so)h(each)g(thread)f(can)h(safely)f(set/get)0
4241 y(member)f(v)n(ariables)g(without)h(ha)n(v)o(e)f(to)i(w)o(orry)e
(about)g(other)g(threads\))0 4388 y(Then,)g(when)h(we)g(need)g(to)g
(run)g(a)g(query)-5 b(,)18 b(we)j(just)g(use)f(code)g(lik)o(e)g(this:)
236 4626 y Fh(c=request.connection.cursor\(\))236 4717
y(c.execute\(query\))236 4808 y(res=c.fetchall\(\))236
4900 y(c.close\(\))0 5186 y Fl(And)h(also,)h(the)f(forum)f(on)h(the)g
(website)g(runs)g(on)g(top)g(of)g(ZODB)h(and)f(since)g(ZODB)h(doesn')o
(t)e(support)g(multiple)h(threads)f(by)h(itself,)0 5286
y(I)f(had)g(to)g(install)h(ZEO)f(so)h(each)f(thread)f(also)h(beha)n(v)o
(es)g(as)h(a)f(ZEO)g(client.)p 0 5549 3901 4 v 0 5649
a Fk(62)1216 b(Chapter)23 b(21.)52 b(Sample)25 b(deplo)n(yment)e
(con\002gur)o(ation)h(f)n(or)e(a)i(real-w)o(or)q(ld)f(w)o(ebsite)p
eop
%%Page: 63 66
63 65 bop 0 88 a Fg(21.7)121 b(Sessions)0 321 y Fl(The)21
b(site)i(also)f(uses)g(sessions)h(\(mostly)e(for)g(the)h(forum,)e(and)h
(also)i(for)e(one)g(page)g(in)h(the)g(online)f(demo\).)28
b(Sessions)22 b(are)g(con\002gured)0 420 y(to)27 b(store)g(the)g(data)g
(in)g(RAM.)g(Since)g(the)g(code)f(for)g(managing)f(sessions)j(is)f
(thread-safe,)g(all)h(threads)e(ha)n(v)o(e)g(access)h(to)g(the)g(same)0
520 y(session)21 b(data)f(and)f(e)n(v)o(erybody)e(is)k(happ)o(y)e(:-\))
0 667 y(I)h(belie)n(v)o(e)g(that)g(other)f(storage)h(types)g(for)f
(sessions)i(\(\002le,)f(database,)g(cookie\))f(w)o(ould)g(w)o(ork)h
(just)g(as)h(well.)0 994 y Fg(21.8)121 b(Results)0 1227
y Fl(As)23 b(I)f(write)h(these)f(lines,)h(the)f(site)h(has)g(been)e
(running)f(with)i(no)g(problem)f(with)h(this)h(ne)n(w)f
(con\002guration)d(for)j(about)f(20)h(days)g(and)f(I)0
1327 y(ne)n(v)o(er)f(had)h(to)g(restart)h(it,)g(pro)o(ving)d(that)i(it)
h(is)h(quite)e(stable.)28 b(Also,)22 b(the)g(RAM)g(used)f(by)g(the)g
(threads)g(has)g(ne)n(v)o(er)f(increased,)h(pro)o(ving)0
1426 y(that)h(there)f(is)i(no)f(memory)e(leaks)i(...)30
b(It)22 b(is)h(true)e(that)h(the)g(CherryPy)-5 b(.or)o(g)18
b(website)k(is)h(not)f(a)g("high-traf)n(\002c")e(website,)i(b)n(ut)g
(it)g(is)h(still)g(a)0 1526 y(good)c(sign.)0 1673 y(Note)f(that)f(if)h
(you')l(re)e(afraid)g(that)i(your)e(CherryPy)h(serv)o(er)f(might)h
(crash)h(while)f(you')l(re)f(sleeping,)h(you)g(can)g(al)o(w)o(ays)h
(set)g(up)f(a)h(cronjob)0 1772 y(to)i(check)g(that)g(the)g(site)h(is)g
(still)h(running)c(and)h(to)i(restart)f(it)h(if)f(it)h(isn')o(t)f(...)p
0 5549 3901 4 v 0 5649 a Fk(21.7.)52 b(Sessions)3235
b(63)p eop
%%Page: 64 67
64 66 bop 0 5549 3901 4 v 0 5649 a Fk(64)p eop
%%Page: 65 68
65 67 bop 0 83 3901 9 v 3503 230 a Fk(CHAPTER)3119 427
y Fj(TWENTYTW)n(O)p 0 515 V 298 978 a Fr(Ho)m(w)58 b(to)g(stream)f
(uploaded)f(\002les)i(directly)g(to)3533 1227 y(disk)0
1706 y Fl(By)27 b(def)o(ault,)g(CherryPy)e(handles)g(in)i(the)f(same)g
(w)o(ay)h(all)g(data)f(posted)f(to)i(the)f(serv)o(er)g(through)e(a)i
(form.)43 b(In)26 b(all)g(cases,)j(CherryPy)0 1805 y(con)m(v)o(erts)18
b(that)j(data)f(to)g(a)h(string)f(or)g(a)g(list)h(of)f(strings.)25
b(This)c(data)f(can)g(be)g(a)g(short)g(string)g(or)g(a)h(big)f(\002le)g
(that')-5 b(s)21 b(being)e(uploaded.)0 1952 y(In)24 b(most)h(cases,)i
(this)e(is)h(v)o(ery)d(con)m(v)o(enient)f(and)i(it)i(w)o(orks)e(v)o
(ery)g(well.)39 b(Ho)n(we)n(v)o(er)m(,)24 b(if)h(your)e(application)g
(requires)h(users)h(to)g(upload)0 2052 y(v)o(ery)19 b(big)h(\002les,)h
(then)f(con)m(v)o(erting)d(them)j(to)g(a)h(string)e(and)h(ha)n(ving)f
(this)i(string)f(in)g(memory)f(can)h(be)g(a)g(problem)f(...)0
2199 y(In)h(that)g(case,)h(you)e(may)h(w)o(ant)g(to)g(write)h(these)f
(\002les)h(directly)f(to)g(a)g(\002le)h(instead)f(of)g(ha)n(ving)f
(them)h(in)g(memory)-5 b(.)0 2346 y(Here)20 b(is)h(ho)n(w)f(this)h(can)
f(be)g(done:)125 2559 y Fe(\017)41 b Fl(Use)25 b(the)f
Fi(initRequestBefor)m(eP)-7 b(ar)o(se)23 b Fl(special)i(function)e(to)h
(tell)i(CherryPy)d(not)h(to)h(parse)f(the)g(POST)h(data)g(itself)g
(\(by)f(setting)208 2658 y Fi(r)m(equest.par)o(seP)-7
b(ostData)18 b Fl(to)i(0\).)125 2825 y Fe(\017)41 b Fl(Use)24
b(the)g Fi(F)l(ieldStor)o(a)o(g)o(e)f Fl(class)i(of)f(the)g
Fi(cgi)g Fl(module)f(to)h(parse)g(the)g(POST)h(data)f(\(by)f(reading)g
Fi(r)m(equest.r\002le)p Fl(\))g(and)h(stream)g(the)208
2924 y(uploaded)18 b(\002le)j(to)f(disk.)0 3137 y(Here)g(is)h(an)f(e)o
(xample)f(code)h(that)g(does)g(this:)p 0 5549 3901 4
v 3808 5649 a Fk(65)p eop
%%Page: 66 69
66 68 bop 236 174 a Fh(import)44 b(cgi)236 357 y(def)h
(initRequestBeforeParse\(\):)416 448 y(if)f(request.path)f(==)h
('postFile':)595 540 y(request.parsePostData)d(=)k(0)236
722 y(CherryClass)e(Root:)236 814 y(mask:)416 905 y(def)h
(index\(self\):)595 996 y(<html><body>)595 1088 y(<form)g(method=post)f
(action=postFile)f(enctype="multipart/form-data">)774
1179 y(Upload)i(a)h(file:)f(<input)g(type=file)f(name=myFile><br>)774
1270 y(<input)h(type=submit>)595 1362 y(</form>)595 1453
y(</body></html>)236 1636 y(view:)416 1727 y(def)g(postFile\(self\):)
595 1818 y(#)h(Use)f(cgi.FieldStorage)e(to)j(parse)e(the)i(POST)f(data)
595 1910 y(dataDict)f(=)i(cgi.FieldStorage\(fp=request.rfile,)39
b(headers=request.headerMap,)i(environ={'REQUEST_METHOD':'POST'},)e
(keep_blank_values=1\))595 2092 y(value)44 b(=)h(dataDict['myFile'])595
2275 y(#)g(Value)f(has)g(2)h(attributes:)595 2366 y(#)179
b(-)45 b(filename)e(contains)h(the)g(name)g(of)h(the)f(uploaded)f(file)
595 2457 y(#)179 b(-)45 b(file)f(is)g(an)h(input)f(stream)g(opened)f
(for)i(reading)595 2640 y(f)g(=)f(open\('/tmp/myFile',)e('wb'\))595
2731 y(while)i(1:)774 2823 y(data)g(=)h(value.file.read\(1024)c(*)k
(8\))g(#)f(Read)g(blocks)g(of)h(8KB)f(at)h(a)f(time)774
2914 y(if)h(not)f(data:)g(break)774 3005 y(f.write\(data\))595
3097 y(f.close\(\))595 3279 y(return)g("<html><body>The)e(file)i(has)g
(been)g(saved)g(in)h(/tmp/myFile</body></html>")0 3566
y Fl(Note)19 b(that)g(the)h(\002le)f(is)h(not)f(streamed)g(directly)f
(from)g(the)h(bro)n(wser)f(to)i(`)p Fn(/tmp/m)o(yFile)p
Fl('.)i(Instead,)c(it)i(is)g(sa)n(v)o(ed)f(in)h(a)f Fi(temp\002le)g
Fl(by)f(the)i Fi(cgi)0 3665 y Fl(module)f(and)g(then)h(streamed)g(from)
f(this)i Fi(temp\002le)e Fl(to)h(`)p Fn(/tmp/m)o(yFile)p
Fl('.)p 0 5549 3901 4 v 0 5649 a Fk(66)1704 b(Chapter)24
b(22.)52 b(Ho)o(w)23 b(to)g(stream)g(uploaded)h(\002les)f(directly)g
(to)g(disk)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
