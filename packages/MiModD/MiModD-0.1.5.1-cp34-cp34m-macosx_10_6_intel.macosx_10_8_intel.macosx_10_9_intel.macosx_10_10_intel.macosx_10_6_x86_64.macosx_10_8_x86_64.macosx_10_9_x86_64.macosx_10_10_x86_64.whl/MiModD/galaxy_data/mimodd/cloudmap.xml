<tool id="cloudmap_prepare" name="Prepare variant data for mapping">
  <description>with the CloudMap series of tools.</description>
  <version_command>mimodd version -q</version_command>
  <command>
    mimodd cloudmap "$ifile" ${run.mode} 
    
    #if $str($run.mode) != "SVD":
        "${run.refsample}"
    #end if
    
    "$sample" -o $ofile
    
    #if $seqdict:
        -s $dictfile
    #end if
  </command>

  <inputs>
    <param name="ifile" type="data" format="vcf" label="vcf input file" />
    <conditional name="run">
      <param name="mode" type="select" label="CloudMap analysis to prepare data for">
        <option value="SVD">EMS Variant Density Mapping</option>
        <option value="VAF">Variant Discovery / Hawaiian Variant Mapping</option>
      </param>
      <when value="SVD">
        <param name="refsample" type="hidden" value="None" />
      </when>
      <when value="VAF">
        <param name="refsample" type="text" label="name of the reference sample" help="the sample that provides mapping strain variants" />
      </when>
    </conditional>
    <param name="sample" type="text" label="subject sample name" help="the sample to perform CloudMap mapping for" />
    <param name="seqdict" type="boolean" checked="true" label="Generate species configuration file for CloudMap" />      
      
  </inputs>

  <outputs>
    <data name="ofile" format="vcf" label="CloudMap-ready ${run.mode} File from ${on_string}" />
    <data name="dictfile" format="tabular" label="Species Configuration File for CloudMap from ${on_string}">
      <filter>seqdict</filter>
    </data>
  </outputs>

  <help>
.. class:: infomark

   **What it does**

The purpose of this tool is to provide compatibility of the MiModD analysis workflow with the external `CloudMap`_ *EMS Variant Density Mapping*, *Variant Discovery Mapping* and *Hawaiian Variant Mapping* tools.

These tools complement MiModD by providing easily interpreted visualizations of mapping-by-sequencing analysis workflows.

The tool converts a VCF file as generated by the *Extract Variant Sites* or *VCF Filter* tools to the format expected by the *CloudMap* series of tools.

Optionally, it also extracts the chromosome names and sizes and reports them in the *CloudMap* *species configuration file* format.
Such a file is required as input to the current versions of the *CloudMap* *Hawaiian* and *Variant Density* mapping tools, if you are working with a species other than the natively supported ones (i.e., other than *C. elegans* or *A. thaliana*).

To use the output datasets of the tool with *CloudMap*, you only have to upload them to any public Galaxy server that hosts *CloudMap* like, e.g., the main Galaxy server at https://usegalaxy.org .

.. class:: warningmark

   EMS Variant Density Mapping is currently limited to *C. elegans* and other species with six chromosomes on the *CloudMap* side.

.. _CloudMap: https://usegalaxy.org/u/gm2123/p/cloudmap

  </help>
</tool>
