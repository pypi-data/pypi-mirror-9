#!/usr/bin/python
# Elecraft K3/K2 Rig Control Python Utilities
# Copyright (C) 2006-2011 Leigh L. Klotz, Jr <Leigh@WA5ZNU.org>
# Licensed under Academic Free License 3.0 (See LICENSE)

import sys
from steppirlib import Steppir

def main(argv):
  if (len(argv) < 1 or len(argv) > 3) or (len(argv) == 2 and argv[1]=='-h'):
    sys.stderr.write("Usage: %s 14070|.|home [N|R|B|V|.] \n\n" % (argv[0]))
    sys.stderr.write("step:		prints frequency and direction (N,B,R,V)\n")
    sys.stderr.write("step 14070:	sets to 14.070, current direction\n")
    sys.stderr.write("step 28120 R:	sets to 28.120, reverse direction\n")
    sys.stderr.write("step 21250 B:	sets to 21.250 bidirectional\n")
    sys.stderr.write("step . R:	sets to current frequency, reverse direction\n")
    sys.stderr.write("step home:	sets 'home' position\n")
    return
  steppir = Steppir()
  steppir.open()
  steppir.status()
  (frequency, dir, elts) = steppir.readin()
  if len(argv) == 1:
    sys.stderr.write("%d %c %s\n" % (frequency, dir, elts))
    return
  elif len(argv) == 2:
    frequency = steppir.parseFrequency(argv[1], frequency)
    dir = steppir.parseDir(dir, dir)
  elif len(argv) == 3:
    frequency = steppir.parseFrequency(argv[1], frequency)
    dir = steppir.parseDir(argv[2], dir)
  if frequency == None:
    steppir.home()
  else:
    steppir.setfreqdir(frequency, dir)
  steppir.status()
  (frequency, dir, elts) = steppir.readin()
  #sys.stderr.write("%d %c %s\n" % (frequency, dir, elts))

if __name__ == "__main__":
    main(sys.argv)
