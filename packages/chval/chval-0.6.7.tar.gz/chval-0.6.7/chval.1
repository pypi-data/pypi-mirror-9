.TH chval 1  "May 6, 2013" "version 0.6.6"

.SH NAME
chval \- Wrapper to getmail to store passwords encrypted, and to run getmail as
a daemon.

.SH SYNOPSIS
\fBchval\fP [\-\-help] [\-\-version] [COMMAND COMMAND_OPTIONS]

.SH DESCRIPTION
\fBchval\fP is a wrapper to \fBgetmail\fP(1), that extends it by adding the
ability to store passwords encrypted, and to be run as a daemon (fetching mails
on a frequency set by user).

It relies on \fBgetmail\fP configuration: email account settings remain in
\fBgetmail\fP directory (~/.getmail), excepted for the password which is
stored, encrypted, in \fBchval\fP configuration files. When running \fBchval\fP
to get mail, it calls \fBgetmail\fP, using the appropriate \fBgetmailrc\fP
file, and provides password when asked. All this is transparent to end user.

The main features of \fBchval\fP are:
.TP
- it manages passwords (adding, removing, looking which accounts handled by
  \fBgetmail\fP miss a password, etc.);
.TP
- it can fetch mail;
.TP
- it can be run as a daemon, in which case it fetches mail on a regular basis,
  or when the client asks it;
.TP
- it can be a client that interact with daemons.

.SH GETMAIL CONFIGURATION FILES
Getmail configuration file names used with \fBchval\fP must begin with
\fBgetmailrc-\fP. This is done so that \fBchval\fP can guess which files are
\fBgetmail\fP configuration files, and which are not.

.SH OPTIONS
.TP
.BR \-\-chvaldir\ DIR
Set directory containing configuration files. Default is ~/.chval.
.TP
.BR \-h,\ \-\-help
Print help and exit.
.TP
.BR \-\-version
Print version

.SH COMMANDS
Unless using one of the options above, \fBchval\fP action is set by a command,
which is the first argument. Options following the command are specific to it.
Command can be one of the above.

Getmail email account configuration files are of the form
\fB~/.getmail/getmailrc-*\fP. When referring to getmailrc files in this page,
and in \fBchval\fP, the relevant part is the last one (referred by the star).
For examble, command \fBchval add work\fP deals with file
\fB~/.getmail/getmailrc-work\fP.

.SS [no command]
If no command is provided, the behaviour of \fBchval\fP depends whether there
are daemons running or not. If daemons are running, implicit command is
\fBclient\fP. Otherwise, implicit command is \fBgetmail\fP.

.SS add GETMAILRC [GETMAILRC ...]
Provide a password for getmailrc files GETMAILRC.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS clean
Remove ashes of dead daemons.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS client [DAEMON...]
Ask some daemons (depending of the syntax of \fBDAEMON\fP, see above) to fetch
mails. If password has not be provided for a daemon, ask for it.

\fBDAEMON\fP is a list of daemons or getmailrc files handled by daemons to ask
to download mails. If no daemon is given, action is performed on all getmailrc
files of all available daemons. Special forms are available (where DAEMON and
GETMAILRC are to be replaced by relevant values):
.IP
.I DAEMON
Get mail from this daemon.
.IP
.I DAEMON/
Equivalent to DAEMON.
.IP
.I DAEMON/GETMAILRC
get mail from GETMAILRC file handled by DAEMON.
.IP
.I /GETMAILRC
get mail from GETMAILRC files from all daemons that handle such a file.


.TP
.BR \-a,\ \-\-auth
Do not ask to fetch mail, but only provide password if necessary.
.TP
.BR \-h,\ \-\-help
Help about this command.
.TP
.BI \-i\  LAYOUT ,\ \-\-interface\  LAYOUT
Set layout of user feedback. Available choices are: default, none, linear, dialog
.TP
.BI \-p\  MODE ,\ \-\-parallel\  MODE
How parallel behavion should be. Accepted values are:
.IP
.I none
calls to different daemons are done in sequential mode.
.IP
.I daemons
calls to different daemons are done in parallel.
.IP
.I getmail
irrelevant here (useful for command \fBdaemon\fP and \fBgetmail\fP).
.IP
.I all
as \fBdaemons\fP.

.SS daemon [GETMAILRC...]
Run \fBchval\fP in daemon mode. Regularly call \fBgetmail\fP to fetch mails.
Arguments are the getmailrc files to consider. If no arguments are given,
consider every available getmailrc file, for which a password is known (either
in the file itself, or by \fBchval\fP), and that is not handled yet by another
running daemon.

Note that, unless option \fB--auth\fP is used, a client call will be needed to
provide its password to the daemon before it is effective.
.TP
.BR \-a,\ \-\-auth
Daemon ask password right after it is launched. Otherwise, password must be
provided by a client call.
.TP
.BI \-d\  DELAY ,\ \-\-delay\  DELAY
Time (in minutes) between two successive calls to \fBgetmail\fP. Default is 60
minutes. Value 0 means that no automatic call to \fBgetmail\fP; these calls are
performed only when a client asks for it.
.TP
.BI \-g\  TIME ,\ \-\-gap\  TIME
Set the time interval between two calls of \fBgetmail\fP. This is done so that,
if you have ten accounts to get mail from, you will not launch ten instances of
\fBgetmail\fP at the same time, but leave a small time interval between two
calls. Default is 0.
.TP
.BI \-\-getmaildir\  DIR
Use \fBDIR\fP for configuration and data files of \fBgetmail\fP.
.TP
.BR \-h,\ \-\-help
Help about this command.
.TP
.BI \-n\  NAME ,\ \-\-name\  NAME
Give a name to the daemon. Default is its PID.
.TP
.BI \-o\  GETMAIL_OPTIONS ,\ \-\-options\  GETMAIL_OPTIONS
Options to be passed to \fBgetmail\fP when invoking it. Note that in order to
prevent these options to be mixed up with \fBchval\fP options, you have to
replace \fB-\fP signs by \fB+\fP (e.g. if you want getmail to use option \fB-q
--all\fP, use the command \fBchval daemon --options +q ++all\fP).
.TP
.BI \-p\  MODE ,\ \-\-parallel\  MODE
How parallel behavion should be. Accepted values are:
.IP
.I none
calls to \fBgetmail\fP are done in sequential mode.
.IP
.I daemons
irrelevant here (useful for command \fBclient\fP).
.IP
.I getmail
calls to \fBgetmail\fP are done in parallel.
.IP
.I all
as above.

.SS fill
Look for every getmailrc file, and ask a password for those which do not have
one specifyed in the getmailrc file, and whose password is unknown by
\fBchval\fP.
.TP
.BI \-\-getmaildir\  DIR
Use \fBDIR\fP for configuration and data files of \fBgetmail\fP.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS getmail [GETMAILRC...]
Fetch mails for getmailrc files specifyed in argument. If no file is specifyed,
get mails for every getmailrc files.
.TP
.BI \-g\  TIME ,\ \-\-gap\  TIME
Set the time interval between two calls of \fBgetmail\fP. This is done so that,
if you have ten accounts to get mail from, you will not launch ten instances of
\fBgetmail\fP at the same time, but leave a small time interval between two
calls. Default is 0.
.TP
.BI \-\-getmaildir\  DIR
Use \fBDIR\fP for configuration and data files of \fBgetmail\fP.
.TP
.BR \-h,\ \-\-help
Help about this command.
.TP
.BI \-i\  LAYOUT ,\ \-\-interface\  LAYOUT
Set layout of user feedback. Available choices are: default, none, linear, dialog.
.TP
.BI \-o\  GETMAIL_OPTIONS ,\ \-\-options\  GETMAIL_OPTIONS
Options to be passed to \fBgetmail\fP. Same meaning as for command \fBdaemon\fP.
.TP
.BI \-p\  MODE ,\ \-\-parallel\  MODE
Parallel mode. Same meaning as for command \fBdaemon\fP.

.SS kill [DAEMONS...]
Kill daemons given in argument. If no argument is given, kill all daemons.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS list
Print names of getmailrc files for which a password is known by \fBchval\fP.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS passwords [GETMAILRC...]
Print passwords recorded by \fBchval\fP, for the getmailrc files given in
argument. If no argument is given, print all passwords.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS remove GETMAILRC...
Remove (forget) password for getmailrc files given in argument.
.TP
.BR \-h,\ \-\-help
Help about this command.

.SS scan
List available daemons.
.TP
.BR \-h,\ \-\-help
Help about this command.
.TP
.BI \-d\  [DAEMONS] ,\ \-\-daemon\  [DAEMONS]
List of daemons to scan: for each of them, print the list of getmailrc files
they handle. If none is given, perform action for all daemons.
.TP
.BR \-o,\ \-\-only
With option \fB--daemon\fP only: do not print daemon names, but only print a
list of getmailrc files instead.

.SH SEE ALSO
\fBchvalrc\fP(5)
\fBgetmail\fP(1)

.SH AUTHOR
Louis Paternault (spalax (at) gresille (dot) org)
