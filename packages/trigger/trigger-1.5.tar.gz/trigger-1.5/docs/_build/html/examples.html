<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simple Examples &mdash; Trigger 1.5 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Trigger 1.5 documentation" href="index.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Trigger Development" href="development.html" />
 
<style type="text/css">
    span.changelog-support {color: #4070A0;}
    span.changelog-bug {color: #A04040;}
    span.changelog-feature {color: #40A056;}
    a.changelog-release {font-weight: bold;}
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="development.html" title="Trigger Development"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Trigger 1.5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p>To illustrate how Trigger works, here are some basic examples of leveraging the
API.</p>
<p>For these examples to work you must have already <a class="reference internal" href="index.html#install-docs"><em>installed</em></a> and <a class="reference internal" href="index.html#config-docs"><em>configured</em></a> Trigger, so if you haven&#8217;t
already please do that first!</p>
<div class="section" id="simple-examples">
<h1>Simple Examples<a class="headerlink" href="#simple-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="working-with-metadata">
<h2>Working with metadata<a class="headerlink" href="#working-with-metadata" title="Permalink to this headline">¶</a></h2>
<p>Get a count of all your devices:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">trigger.netdevices</span> <span class="kn">import</span> <span class="n">NetDevices</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nd</span> <span class="o">=</span> <span class="n">NetDevices</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span>
<span class="go">5539</span>
</pre></div>
</div>
<p>(Whoa! That&#8217;s a lot!) Let&#8217;s look up a device.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dev</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;edge1-abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dev</span><span class="o">.</span><span class="n">vendor</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">deviceType</span>
<span class="go">(&lt;Vendor: Juniper&gt;, &#39;ROUTER&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dev</span><span class="o">.</span><span class="n">has_ssh</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="get-an-interactive-shell">
<h2>Get an interactive shell<a class="headerlink" href="#get-an-interactive-shell" title="Permalink to this headline">¶</a></h2>
<p>Since this device has SSH, let&#8217;s connect to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dev</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;edge1-abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dev</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="go">Connecting to edge1-abc.net.aol.com.  Use ^X to exit.</span>

<span class="go">Fetching credentials from /home/jathan/.tacacsrc</span>
<span class="go">--- JUNOS 10.2S6.3 built 2011-01-22 20:06:27 UTC</span>
<span class="go">jathan@edge1-abc&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="work-with-access-lists">
<h2>Work with access-lists<a class="headerlink" href="#work-with-access-lists" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start with a simple Cisco ACL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">trigger.acl</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aclobj</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s">&quot;&quot;&quot;access-list 123 permit tcp any host 10.20.30.40 eq 80&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aclobj</span><span class="o">.</span><span class="n">terms</span>
<span class="go">[&lt;Term: None&gt;]</span>
</pre></div>
</div>
<p>And convert it to Juniper format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aclobj</span><span class="o">.</span><span class="n">name_terms</span><span class="p">()</span> <span class="c"># Juniper policy terms must have names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aclobj</span><span class="o">.</span><span class="n">terms</span>
<span class="go">[&lt;Term: T1&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aclobj</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;junos&#39;</span><span class="p">))</span>
<span class="go">filter 123 {</span>
<span class="go">    term T1 {</span>
<span class="go">        from {</span>
<span class="go">            destination-address {</span>
<span class="go">                10.20.30.40/32;</span>
<span class="go">            }</span>
<span class="go">            protocol tcp;</span>
<span class="go">            destination-port 80;</span>
<span class="go">        }</span>
<span class="go">        then {</span>
<span class="go">            accept;</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cache-your-login-credentials">
<h2>Cache your login credentials<a class="headerlink" href="#cache-your-login-credentials" title="Permalink to this headline">¶</a></h2>
<p>Trigger will encrypt and store your credentials in a file called <tt class="docutils literal"><span class="pre">.tacacsrc</span></tt>
in your home directory. We already had them cached in the previous examples, so
I removed it and then:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">trigger.tacacsrc</span> <span class="kn">import</span> <span class="n">Tacacsrc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcrc</span> <span class="o">=</span> <span class="n">Tacacsrc</span><span class="p">()</span>
<span class="go">/home/jathan/.tacacsrc not found, generating a new one!</span>

<span class="go">Updating credentials for device/realm &#39;tacacsrc&#39;</span>
<span class="go">Username: jathan</span>
<span class="go">Password:</span>
<span class="go">Password (again):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcrc</span><span class="o">.</span><span class="n">creds</span><span class="p">[</span><span class="s">&#39;aol&#39;</span><span class="p">]</span>
<span class="go">Credentials(username=&#39;jathan&#39;, password=&#39;boguspassword&#39;, realm=&#39;tacacsrc&#39;)</span>
</pre></div>
</div>
<p>Passwords can be cached by realm. By default this realm is <tt class="docutils literal"><span class="pre">'aol'</span></tt>, but you
can change that in the settings. Your credentials are encrypted and decrypted
using a shared key. A more secure experimental GPG-encrypted method is in the
works.</p>
</div>
<div class="section" id="login-to-a-device-using-the-gong-script">
<h2>Login to a device using the <tt class="docutils literal"><span class="pre">gong</span></tt> script<a class="headerlink" href="#login-to-a-device-using-the-gong-script" title="Permalink to this headline">¶</a></h2>
<p>Trigger includes a simple tool for end-users to connect to devices called
<tt class="docutils literal"><span class="pre">gong</span></tt>. (It should be just <tt class="docutils literal"><span class="pre">go</span></tt> but we&#8217;re in the future, so...):</p>
<div class="highlight-python"><div class="highlight"><pre>$ gong foo1-cisco
Connecting to foo1-cisco.net.aol.com.  Use ^X to exit.

Fetching credentials from /home/jathan/.tacacsrc
foo1-cisco#
foo1-cisco#show clock
20:52:05.777 UTC Sat Jun 23 2012
foo1-cisco#
</pre></div>
</div>
<p>Partial hostnames are supported, too:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gong foo1
2 possible matches found for &#39;foo1&#39;:
[ 1] foo1-abc.net.aol.com
[ 2] foo1-xyz.net.aol.com
[ 0] Exit

Enter a device number: 2
Connecting to foo1-xyz.net.aol.com.  Use ^X to exit.

Fetching credentials from /home/jathan/.tacacsrc
foo1-xyz#
</pre></div>
</div>
</div>
</div>
<div class="section" id="slightly-advanced-examples">
<h1>Slightly Advanced Examples<a class="headerlink" href="#slightly-advanced-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="execute-commands-asynchronously-using-twisted">
<h2>Execute commands asynchronously using Twisted<a class="headerlink" href="#execute-commands-asynchronously-using-twisted" title="Permalink to this headline">¶</a></h2>
<p>This is a little more advanced... so we saved it for last.</p>
<p>Trigger uses Twisted, which is a callback-based event loop. Wherever possible
Twisted&#8217;s implementation details are abstracted away, but the power is there
for those who choose to wield it. Here&#8217;s a super simplified example of how this
might be accomplished:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">trigger.netdevices</span> <span class="kn">import</span> <span class="n">NetDevices</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="n">nd</span> <span class="o">=</span> <span class="n">NetDevices</span><span class="p">()</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;foo1-abc&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_result</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display results from a command&quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&#39;Result:&#39;</span><span class="p">,</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">stop_reactor</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stop the event loop&quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&#39;Stopping reactor&#39;</span>
    <span class="k">if</span> <span class="n">reactor</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c"># Create an event chain that will execute a given list of commands on this</span>
<span class="c"># device</span>
<span class="n">async</span> <span class="o">=</span> <span class="n">dev</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s">&#39;show clock&#39;</span><span class="p">])</span>

<span class="c"># When we get results from the commands executed, call this</span>
<span class="n">async</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">print_result</span><span class="p">)</span>

<span class="c"># Once we&#39;re out of commands, or we an encounter an error, call this</span>
<span class="n">async</span><span class="o">.</span><span class="n">addBoth</span><span class="p">(</span><span class="n">stop_reactor</span><span class="p">)</span>

<span class="c"># Start the event loop</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Which outputs:</p>
<div class="highlight-python"><div class="highlight"><pre>Result: [&#39;21:27:46.435 UTC Sat Jun 23 2012\n&#39;]
Stopping reactor
</pre></div>
</div>
<p>Observe, however, that this only communicated with a single device.</p>
</div>
<div class="section" id="execute-commands-asynchronously-using-the-commando-api">
<h2>Execute commands asynchronously using the Commando API<a class="headerlink" href="#execute-commands-asynchronously-using-the-commando-api" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="api/cmds.html#trigger.cmds.Commando" title="trigger.cmds.Commando"><tt class="xref py py-obj docutils literal"><span class="pre">Commando</span></tt></a> tries to hide Twisted&#8217;s implementation details so you
don&#8217;t have to deal with callbacks, while also implementing a worker pool so
that you may easily communicate with multiple devices in parallel.</p>
<p>This is a base class that is intended to be extended to perform the operations
you desire. Here is a basic example of how we might perform the same example
above using <tt class="docutils literal"><span class="pre">Commando</span></tt> instead, but also communicating with a second device
in parallel:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">trigger.cmds</span> <span class="kn">import</span> <span class="n">Commando</span>

<span class="k">class</span> <span class="nc">ShowClock</span><span class="p">(</span><span class="n">Commando</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Execute &#39;show clock&#39; on a list of Cisco devices.&quot;&quot;&quot;</span>
    <span class="n">vendors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;cisco&#39;</span><span class="p">]</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;show clock&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">device_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;foo1-abc.net.aol.com&#39;</span><span class="p">,</span> <span class="s">&#39;foo2-xyz.net.aol.com&#39;</span><span class="p">]</span>
    <span class="n">showclock</span> <span class="o">=</span> <span class="n">ShowClock</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">device_list</span><span class="p">)</span>
    <span class="n">showclock</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c"># Commando exposes this to start the event loop</span>

    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Results:&#39;</span>
    <span class="k">print</span> <span class="n">showclock</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
<p>Which outputs:</p>
<div class="highlight-python"><div class="highlight"><pre>Sending [&#39;show clock&#39;] to foo2-xyz.net.aol.com
Sending [&#39;show clock&#39;] to foo1-abc.net.aol.com
Received [&#39;21:56:44.701 UTC Sat Jun 23 2012\n&#39;] from foo2-xyz.net.aol.com
Received [&#39;21:56:44.704 UTC Sat Jun 23 2012\n&#39;] from foo1-abc.net.aol.com

Results:
{
    &#39;foo1-abc.net.aol.com&#39;: {
        &#39;show clock&#39;: &#39;21:56:44.704 UTC Sat Jun 23 2012\n&#39;
    },
    &#39;foo2-xyz.net.aol.com&#39;: {
        &#39;show clock&#39;: &#39;21:56:44.701 UTC Sat Jun 23 2012\n&#39;
    }
}
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simple Examples</a><ul>
<li><a class="reference internal" href="#working-with-metadata">Working with metadata</a></li>
<li><a class="reference internal" href="#get-an-interactive-shell">Get an interactive shell</a></li>
<li><a class="reference internal" href="#work-with-access-lists">Work with access-lists</a></li>
<li><a class="reference internal" href="#cache-your-login-credentials">Cache your login credentials</a></li>
<li><a class="reference internal" href="#login-to-a-device-using-the-gong-script">Login to a device using the <tt class="docutils literal"><span class="pre">gong</span></tt> script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#slightly-advanced-examples">Slightly Advanced Examples</a><ul>
<li><a class="reference internal" href="#execute-commands-asynchronously-using-twisted">Execute commands asynchronously using Twisted</a></li>
<li><a class="reference internal" href="#execute-commands-asynchronously-using-the-commando-api">Execute commands asynchronously using the Commando API</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="development.html"
                        title="previous chapter">Trigger Development</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="installation.html"
                        title="next chapter">Installation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/examples.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >next</a> |</li>
        <li class="right" >
          <a href="development.html" title="Trigger Development"
             >previous</a> |</li>
        <li><a href="index.html">Trigger 1.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2015, AOL Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>