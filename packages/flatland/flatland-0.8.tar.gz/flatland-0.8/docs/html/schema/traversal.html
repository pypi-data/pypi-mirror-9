<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Traversal &mdash; flatland 0.0.hg-tip documentation</title>
    
    <link rel="stylesheet" href="../_static/flatland.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.hg-tip',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="flatland 0.0.hg-tip documentation" href="../index.html" />
    <link rel="up" title="Defining and Using Forms" href="index.html" />
    <link rel="next" title="Annotations &amp; Properties" href="properties.html" />
    <link rel="prev" title="Elements" href="schema.html" /> 
  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="traversal">
<h1>Traversal<a class="headerlink" href="#traversal" title="Permalink to this headline">¶</a></h1>
<p>Flatland supplies a rich set of tools for working with structured data.  For
this section, we&#8217;ll use the following schema as an example.  It is simple yet
has a bit of variety in its structure.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">flatland</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>

<span class="k">class</span> <span class="nc">Annotation</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A spot on a 2D surface.&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">Dict</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">),</span>
                       <span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">))</span>

<span class="n">sample_data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;Interesting Spot&#39;</span><span class="p">,</span>
  <span class="s">&#39;flags&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
  <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">ann1</span> <span class="o">=</span> <span class="n">Annotation</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;ann1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="going-raw">
<h2>Going Raw<a class="headerlink" href="#going-raw" title="Permalink to this headline">¶</a></h2>
<p>You may not even need to use any of these traversal strategies in your
application.  An element&#8217;s <a class="reference internal" href="schema.html#flatland.schema.base.Element.value" title="flatland.schema.base.Element.value"><tt class="xref py py-attr docutils literal"><span class="pre">value</span></tt></a> is a full &amp; recursive
&#8220;export&#8221; of its native Python value.  Many times this is sufficient.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>     <span class="c"># ann1 is a flatland structure</span>
<span class="go">&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">ann1</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c"># but its .value is not</span>
<span class="go">&lt;type &#39;dict&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">sample_data</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="python-syntax">
<h2>Python Syntax<a class="headerlink" href="#python-syntax" title="Permalink to this headline">¶</a></h2>
<p>Containers elements such as <tt class="xref py py-class docutils literal"><span class="pre">Form</span></tt>, <a class="reference internal" href="dicts.html#flatland.schema.containers.Dict" title="flatland.schema.containers.Dict"><tt class="xref py py-class docutils literal"><span class="pre">Dict</span></tt></a>,
and <a class="reference internal" href="lists.html#flatland.schema.containers.List" title="flatland.schema.containers.List"><tt class="xref py py-class docutils literal"><span class="pre">List</span></tt></a> implement the Python methods you&#8217;d expect for
their type.  In most cases you may use them as if they were <tt class="docutils literal"><span class="pre">dict</span></tt> and
<tt class="docutils literal"><span class="pre">list</span></tt> instances- the difference being that they always contain
<a class="reference internal" href="schema.html#flatland.schema.base.Element" title="flatland.schema.base.Element"><tt class="xref py py-class docutils literal"><span class="pre">Element</span></tt></a> instances.</p>
<p>For example, <tt class="docutils literal"><span class="pre">Form</span></tt> and <tt class="docutils literal"><span class="pre">Dict</span></tt> can be indexed and used like <tt class="docutils literal"><span class="pre">dict</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">u&#39;Interesting Spot&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(u&#39;x&#39;, &lt;Integer u&#39;x&#39;; value=10&gt;), (u&#39;y&#39;, &lt;Integer u&#39;y&#39;; value=20&gt;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">u&#39;title&#39;</span> <span class="ow">in</span> <span class="n">ann1</span>
<span class="go">True</span>
</pre></div>
</div>
<p>And <tt class="docutils literal"><span class="pre">List</span></tt> and similar types can be used like lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">[1, 3, 5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Integer</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The final example is of special note: the value in the expression is not an
<tt class="docutils literal"><span class="pre">Element</span></tt>.  Most containers will accept native Python values in these types
of expressions and convert them into a temporary <tt class="docutils literal"><span class="pre">Element</span></tt> for the
operation.  The example below is equivalent to the example above.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">member_schema</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="traversal-properties">
<h2>Traversal Properties<a class="headerlink" href="#traversal-properties" title="Permalink to this headline">¶</a></h2>
<p>Elements of all types support a core set of properties that allow navigation
to related elements: <a class="reference internal" href="schema.html#flatland.schema.base.Element.root" title="flatland.schema.base.Element.root"><tt class="xref py py-attr docutils literal"><span class="pre">root</span></tt></a>,
<a class="reference internal" href="schema.html#flatland.schema.base.Element.parents" title="flatland.schema.base.Element.parents"><tt class="xref py py-attr docutils literal"><span class="pre">parents</span></tt></a>, <a class="reference internal" href="schema.html#flatland.schema.base.Element.children" title="flatland.schema.base.Element.children"><tt class="xref py py-attr docutils literal"><span class="pre">children</span></tt></a>, and
<a class="reference internal" href="schema.html#flatland.schema.base.Element.all_children" title="flatland.schema.base.Element.all_children"><tt class="xref py py-attr docutils literal"><span class="pre">all_children</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>  <span class="c"># title is a String and has no children</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ann1</span><span class="o">.</span><span class="n">all_children</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="go">[u&#39;flags&#39;, u&#39;location&#39;, u&#39;title&#39;, u&#39;x&#39;, u&#39;y&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parents</span><span class="p">]</span>
<span class="go">[u&#39;location&#39;, u&#39;ann1&#39;]</span>
</pre></div>
</div>
<p>Each of these properties (excepting <tt class="docutils literal"><span class="pre">root</span></tt>) returns an iterator of
elements.</p>
</div>
<div class="section" id="path-lookups">
<span id="id1"></span><h2>Path Lookups<a class="headerlink" href="#path-lookups" title="Permalink to this headline">¶</a></h2>
<p>Another option for operating on elements is the <a class="reference internal" href="schema.html#flatland.schema.base.Element.find" title="flatland.schema.base.Element.find"><tt class="xref py py-meth docutils literal"><span class="pre">find()</span></tt></a>
method.  <tt class="docutils literal"><span class="pre">find</span></tt> selects elements by <em>path</em>, a string that represents one or
more related elements.  Looking up elements by path is a powerful technique to
use when authoring flexible &amp; reusable validators.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>   <span class="c"># find &#39;ann1&#39;s child named &#39;title&#39;</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Paths are evaluated relative to the element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer u&#39;x&#39;; value=10&gt;]</span>
</pre></div>
</div>
<p>Referencing parents is possible with <tt class="docutils literal"><span class="pre">..</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;../../title&#39;</span><span class="p">)</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Absolute paths begin with a <tt class="docutils literal"><span class="pre">/</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/title&#39;</span><span class="p">)</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Members of sequences can be selected like any other child (their index number
is their name), or you can use Python-like slicing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/flags/0&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/flags[0]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;]</span>
</pre></div>
</div>
<p>Full Python slice notation is supported as well.  With slices, paths can
select more than one element.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/flags[:]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/flags[1:]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
</pre></div>
</div>
<p>Further path operations are permissible after slices.  A richer schema is
needed to illustrate this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Points</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Dict</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">),</span>
<span class="gp">... </span>                                 <span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Points</span><span class="p">([[</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)],</span>
<span class="gp">... </span>            <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[:][:]/x&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer u&#39;x&#39;; value=1&gt;, &lt;Integer u&#39;x&#39;; value=2&gt;, &lt;Integer u&#39;x&#39;; value=3&gt;]</span>
</pre></div>
</div>
<p>The equivalent straight Python to select the same set of elements is quite a
bit more wordy.</p>
<div class="section" id="path-syntax">
<h3>Path Syntax<a class="headerlink" href="#path-syntax" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">/</span></tt> (leading slash)</dt>
<dd>Selects the root of the element tree</dd>
<dt><tt class="docutils literal"><span class="pre">element</span></tt></dt>
<dd>The name of a child element</dd>
<dt><tt class="docutils literal"><span class="pre">element/child</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">/</span></tt> separates path segments</dd>
<dt><tt class="docutils literal"><span class="pre">..</span></tt></dt>
<dd>Traverse to the parent element</dd>
<dt><tt class="docutils literal"><span class="pre">element[0]</span></tt></dt>
<dd>For a sequence container element, select the 0th child</dd>
<dt><tt class="docutils literal"><span class="pre">element[:]</span></tt></dt>
<dd>Select all children of a container element (need not be a sequence)</dd>
<dt><tt class="docutils literal"><span class="pre">element[1:5]</span></tt></dt>
<dd>Select a slice of a sequence container&#8217;s children</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flatland.png" alt="Logo"/>
            </a></p>
  <h3>Contents</h3>
  <ul>
    <li><ul>
<li><a class="reference internal" href="#">Traversal</a><ul>
<li><a class="reference internal" href="#going-raw">Going Raw</a></li>
<li><a class="reference internal" href="#python-syntax">Python Syntax</a></li>
<li><a class="reference internal" href="#traversal-properties">Traversal Properties</a></li>
<li><a class="reference internal" href="#path-lookups">Path Lookups</a><ul>
<li><a class="reference internal" href="#path-syntax">Path Syntax</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
  </ul>
<h3>Topics</h3>
<ul>
  <li><ul>
  <li><a href="index.html">Defining and Using Forms</a><ul>
      <li>Previous: <a href="schema.html" title="previous chapter">Elements</a></li>
      <li>Next: <a href="properties.html" title="next chapter">Annotations &amp; Properties</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2013, the flatland authors and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>