/*! proso-apps-client 2014-10-20 */

!function(){"use strict";angular.module("addaptivePractice",["addaptivePractice.filters","addaptivePractice.services","addaptivePractice.directives","addaptivePractice.controllers","ngRoute","ngAnimate","ngSanitize","angulartics","angulartics.google.analytics","timer","ng-polymer-elements"]).value("$",jQuery).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{}).when("/login/:somepath/",{controller:"ReloadController",templateUrl:"loading.html"}).when("/how-it-works",{templateUrl:"how-it-works.html"}).when("/about",{templateUrl:"static/tpl/about.html"}).when("/view/:category?",{controller:"AppView",templateUrl:"static/tpl/view_tpl.html"}).when("/refreshpractice/:category?",{redirectTo:"/practice/:category"}).when("/practice/:category?",{controller:"AppPractice",templateUrl:"static/tpl/practice_tpl.html"}).when("/test/",{controller:"AppTest",templateUrl:"static/tpl/test_tpl.html"}).when("/overview/:user?",{controller:"AppOverview",templateUrl:"static/tpl/overview_tpl.html"}).otherwise({}),b.html5Mode(!0)}]).run(["$analytics",function(a){a.settings.pageTracking.autoTrackFirstPage=!1}])}(),function(){"use strict";angular.module("addaptivePractice.controllers",[]).controller("AppCtrl",["$scope","$rootScope","user","pageTitle",function(a,b,c,d){b.topScope=b,b.initTitle=function(a){b.initialTitle=a,b.title=a},b.$on("$routeChangeStart",function(a,c){b.title=d(c)+b.initialTitle,b.isHomepage=!c.templateUrl});var e=function(a){b.user=a};a.initUser=function(a,d){b.user=c.initUser(a,d)},b.logout=function(){b.user=c.logout(e)}}]).controller("AppView",["$scope","$routeParams","$filter","places",function(a,b,c,d){function e(){a.loading||(a.loading=!0,d.get(a.category,a.page).error(function(){a.error="V aplikaci bohužel nastala chyba.",a.loading=!1}).success(function(b){var c=b.data;c=c.map(function(a){for(var b=0;b<a.options.length;b++)a.options[b].correct&&(a.correct=a.options[b].order);return a}),a.questions=a.questions.concat(c),a.loading=!1,a.hasMoreQuestions=c.length>0}),a.page++)}a.category=b.category,a.page=0,a.questions=[],a.onBottomReached=function(){e()},e(),a.selectQuestion=function(b){a.selected=b!=a.selected?b:void 0}}]).controller("AppPractice",["$scope","$routeParams","$timeout","$filter","question","user","events",function(a,b,c,d,e,f,g){function h(){a.layer=void 0,a.summary=e.summary(),a.showSummary=!0,g.emit("questionSetFinished",f.getUser().points)}function i(b){a.question=b,a.canNext=!1}function j(b){a.question.options.map(function(a){return a.disabled=!0,a.selected=a==b,a})}a.category=b.category,a.checkAnswer=function(b){j(b),b&&(a.question.answered=b),a.progress=e.answer(a.question),b&&b.correct?(f.addPoint(),c(function(){a.next()},700)):a.canNext=!0},a.next=function(){a.progress<100?e.next(a.category,i):h()},e.first(a.category,function(a){i(a)}).error(function(){a.error="V aplikaci bohužel nastala chyba."})}]).controller("AppTest",["$scope","$timeout","question","$",function(a,b,c,d){function e(){a.question=a.questions[a.activeQuestionIndex]}function f(b){a.question.options.map(function(a){return a.selected=a==b,a})}a.checkAnswer=function(c){f(c),c&&(a.question.answered=c),b(function(){a.next()},700)},a.prev=function(){a.activeQuestionIndex--,a.activeQuestionIndex<0&&(a.activeQuestionIndex=a.questions.length-1),e()},a.next=function(){a.activeQuestionIndex++,a.activeQuestionIndex>a.questions.length-1&&(a.activeQuestionIndex=0),e()},a.activateQuestion=function(b){a.activeQuestionIndex=b,e()},a.evaluate=function(b){a.activeQuestionIndex=void 0,a.showSummary=!0,a.questions.map(function(a){a.isCorrect=a.options[a.answered.order]&&a.options[a.answered.order].correct,a.isWrong=!a.isCorrect}),a.summary={questions:a.questions,correctlyAnsweredRatio:.5},b?a.$apply():d("timer")[0].stop()},c.test(function(b){a.questions=b,a.activateQuestion(0)}).error(function(){a.error="V aplikaci bohužel nastala chyba."})}]).controller("ReloadController",["$window",function(a){a.location.reload()}])}(),function(){"use strict";angular.module("addaptivePractice.services",["ngCookies"]).value("chroma",chroma).value("colors",{GOOD:"#0d0",BAD:"#ff0000",NEUTRAL:"#bbb",BRIGHT_GRAY:"#ddd",WATER_COLOR:"#73c5ef"}).factory("colorScale",["colors","chroma",function(a,b){var c=b.scale([a.BAD,"#ff4500","#ffa500","#ffff00",a.GOOD]);return c}]).factory("places",["$http","$routeParams",function(a,b){function c(a,b){h[a]||(h[a]=b)}function d(a,b){angular.forEach(b,function(a){angular.forEach(a.places,function(a){c(a.code,a.name)})})}var e={},f={},g={},h={},i={get:function(c,d){var e="questions/questions/",f={params:{stats:!0,page:d,limit:b.limit||20}};c&&(f.params.filter_column="category_id",f.params.filter_value=c);var g=a.get(e,f);return g},setName:function(a,b){h[a]=h[a]||b},getName:function(a){return h[a]},_setActiveCategory:function(a,b){i.getCategories(a,b),angular.forEach(g[a],function(a){a.hidden=a.slug!=b&&0===a.types.filter(function(a){return a==b}).length})},practicing:function(a,b){i._setActiveCategory(a,b);var c=function(b){d(a,b)},f="usersplaces/"+a+"/";e[f]?c(e[f]):i.get(a,"",c)},getOverview:function(){return a.get("/placesoverview/",{cache:!0})},getMapLayers:function(a){return f[a].placesTypes.map(function(a){return a.slug})},getMapLayerCount:function(a,b){return f[a]?f[a].placesTypes.filter(function(a){return a.slug==b}).map(function(a){return a.count})[0]:0}};return i}]).service("question",["$http","$log","$cookies","$","$routeParams",function(a,b,c,d,e){function f(a){var b=j[i++];b&&(b.response_time=-(new Date).valueOf()),a(b)}function g(a){for(var b=0,c=a.length;c>b+1;b++)if(a[b].asked_code==a[b+1].asked_code)return!1;return!0}var h,i=0;a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var j=[],k=[];return{test:function(b){h="questions/test";var c=a.get(h).success(function(a){b(a)});return c},first:function(b,c){var d={params:{limit:e.limit,user:e.user,category:b}};h="questions/practice",k=[];var g=a.get(h,d).success(function(a){i=0,j=a.data,f(c)});return g},next:function(a,b){f(b)},answer:function(e){e.response_time+=(new Date).valueOf(),e.index=i-1;var f=d.param({question:e.id,answered:e.answered.id,response_time:e.response_time});return k.push(e),a({method:"POST",url:"questions/answer",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRFToken":c.csrftoken}}).success(function(a){var c=i+a.length;if(j.length==c){var d=j.slice(0,i).concat(a);g(d)&&(j=d,b.log("questions updated, question index",i))}}),100*i/j.length},summary:function(){var a=k.filter(function(a){return a.answered.correct});return{correctlyAnsweredRatio:a.length/k.length,questions:k}}}}]).factory("user",["$http","$cookies","events",function(a,b,c){var d;return{initUser:function(a,b){return d={username:a,points:b}},getUser:function(){return d},logout:function(b){return a.get("user/logout/").success(b),this.initUser("",0),c.emit("userUpdated",d),d},addPoint:function(){d.points++,b.points=d.points,c.emit("userUpdated",d)}}}]).factory("events",function(){var a={};return{on:function(b,c){a[b]=a[b]||[],a[b].push(c)},emit:function(b,c){a[b]=a[b]||[],a[b].map(function(a){a(c)})}}}).factory("pageTitle",[function(){var a={"":"","../templates/home/how_it_works.html":"Jak to funguje? - ","static/tpl/about.html":"O prjektu - ","static/tpl/overview_tpl.html":"Přehled map - ","static/tpl/view_tpl.html":"Prohlížení otázek - ","static/tpl/practice_tpl.html":"Procvičování otázek - ","static/tpl/test_tpl.html":"Test - "};return function(b){var c=b.templateUrl?a[b.templateUrl]:"";return c}}])}(),function(){"use strict";angular.module("addaptivePractice.filters",[]).filter("percent",function(){return function(a){return a=a||0,Math.round(100*a)+"%"}}).filter("StatesFromPlaces",function(){return function(a){var b={};return a&&a[0]&&angular.forEach(a,function(a){!a.haveMaps&&a.places&&angular.forEach(a.places,function(a){b[a.code]=a})}),b}}).filter("colNum",function(){return function(a){return Math.floor(12/a)}}).filter("isActive",["$location",function(a){return function(b){return-1!=a.path().indexOf(b)?"active":""}}]).filter("isFindOnMapType",function(){return function(a){return a&&a.type<20}}).filter("isPickNameOfType",function(){return function(a){return a&&a.type>=20}}).filter("isAllowedOption",function(){return function(a,b){return!a.options||1==a.options.filter(function(a){return a.code==b}).length}}).filter("imgSrc",function(){return function(a){var b=a&&a.images&&a.images[0]&&a.images[0].url;return b}}).filter("stripImg",function(){return function(a){return a&&a.text&&a.text.replace(/\!\[Image\]\((.*)\)/,"").replace("<br />","")}}).filter("stripHtml",function(){return function(a){return a.replace(/(<([^>]+)>)/gi,"")}}).filter("isTypeCategory",function(){return function(a,b){return a=a&&a.filter(function(a){return 1==b.types.filter(function(b){return b==a.slug}).length})}}).filter("codeToName",["places",function(a){return function(b){return a.getName(b)||"Neznámý"}}]).filter("probColor",["colorScale",function(a){return function(b){return a(b).hex()}}]).filter("sumCounts",[function(){return function(a){if(!a||0===a.length)return 0;var b=a.map(function(a){return a.count}).reduce(function(a,b){return a+b});return b}}]).filter("prettify",function(){function a(a){var b=JSON.stringify(a,void 0,4)||"";return b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),b.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})}return a})}(),function(){"use strict";angular.module("addaptivePractice.directives",[]).directive("email",function(){return{restrict:"C",compile:function(a){var b=a.html();b=b.replace("{zavinac}","@"),b='<a href="mailto:'+b+'">'+b+"</a>",a.html(b)}}}).directive("atooltip",function(){return{restrict:"C",link:function(a,b,c){b.tooltip({placement:c.placement||"bottom"})}}}).directive("dropLogin",function(){return{restrict:"C",compile:function(a){a.bind("click",function(){a.tooltip("destroy"),a.parent().find(".tooltip").remove()})}}}).directive("dropLogin",["$timeout","events",function(a,b){return{restrict:"C",link:function(c,d){b.on("questionSetFinished",function(b){b>10&&20>=b&&a(function(){d.tooltip("show")},0)})}}}]).directive("mapProgress",[function(){return{restrict:"C",template:'<div class="progress overview-progress"><div class="progress-bar progress-bar-learned" style="width: {{(skills.learned / count)|percent}};"></div><div class="progress-bar progress-bar-practiced" style="width: {{(skills.practiced / count)|percent}};"></div></div>',link:function(a,b,c){a.count=c.count,c.$observe("skills",function(c){""!==c&&(a.skills=angular.fromJson(c),b.tooltip({html:!0,placement:"bottom",title:'<div class="skill-tooltip">Naučeno: <span class="badge badge-default"><i class="color-indicator learned"></i>'+a.skills.learned+" / "+a.count+'</span></div><div class="skill-tooltip">Procvičováno: <span class="badge badge-default"><i class="color-indicator practiced"></i>'+a.skills.practiced+" / "+a.count+"</span></div>"}))})}}}]).directive("levelProgressBar",["user","$timeout",function(a,b){function c(a){for(var b=0,c=30,d=0,e=1;!0;e++){if(b+=c,b>a)return{level:e,form:b-c,to:b,range:c,points:a-(b-c)};c+=d,d+=10}}return{restrict:"C",template:'<span class="badge level-start atooltip" ng-bind="level.level" title="Aktuální úroveň"></span><div class="progress level-progress" ><div class="progress-bar progress-bar-warning" style="width: {{(level.points/level.range)|percent}};"></div></div><span class="badge level-goal atooltip" ng-bind="level.level+1" title="Příští úroveň"></span>',link:function(d,e){d.level=c(a.getUser().points),b(function(){e.find(".level-progress").tooltip({placement:"bottom",title:d.level.points+" z "+d.level.range+" bodů"})},100)}}}]).directive("infiniteScroll",["$window","$document","$",function(a,b,c){return{link:function(d,e,f){var g=parseInt(f.threshold)||0;b.unbind("scroll"),b.bind("scroll",function(){d.$eval(f.canLoad)&&c(a).scrollTop()+c(a).height()>=c(b).height()-g&&d.$apply(f.infiniteScroll)})}}}]).directive("debug",["$filter","$routeParams",function(a,b){return{restrict:"A",template:'<pre ng-show="debug" ng-bind-html="debug | prettify"></pre>',link:function(a,c,d){a.$watch(d.debug,function(){a.debug=b.debug?a[d.debug]:void 0})}}}]).directive("loadingIndicator",[function(){return{restrict:"C",template:'<svg class="spinner" width="65px" height="65px"  viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg>'}}])}();
//# sourceMappingURL=proso-apps-client.min.map