Site control panel
==================

First some initial setup code:

    >>> self.loginAsManager()
    >>> syndication_configlet_url = 'http://nohost/plone/@@syndication-settings'

Test Form
---------

Edit some settings and make sure they stick.

    >>> self.browser.open(syndication_configlet_url)
    >>> self.browser.getControl('Enabled').selected = False
    >>> self.browser.getControl('Show author info').selected = False
    >>> self.browser.getControl('Show Feed Link').selected = True
    >>> self.browser.getControl('Save').click()

We should be back on the Site Setup screen:

    >>> 'plone_control_panel' in self.browser.url
    True

Navigate back to the syndication settings:

    >>> self.browser.getLink('Syndication').click()

Check values:

    >>> self.browser.getControl('Enabled').selected
    False
    >>> self.browser.getControl('Show author info').selected
    False
    >>> self.browser.getControl('Show Feed Link').selected
    True

Test enabling syndication settings button:

    >>> self.browser.getControl('Enabled').selected = True
    >>> self.browser.getControl('Show Settings Button').selected = True
    >>> self.browser.getControl('Save').click()

Create collection and check syndication settings button:

    >>> from plone.protect.utils import addTokenToUrl
    >>> self.login('root')
    >>> self.browser.open(addTokenToUrl('http://nohost/plone/createObject?type_name=Collection', self.fake_request))
    >>> self.browser.getControl(name="title").value = 'test-collection'
    >>> self.browser.getControl(name="query").value = '[{"i": "portal_type", "o": "plone.app.querystring.operation.selection.is", "v": ["News Item"]}, {"i": "review_state", "o": "plone.app.querystring.operation.selection.is", "v": ["published"]}]'
    >>> self.browser.getControl('Save').click()

    >>> 'Please finish your search terms / criteria' in self.browser.contents
    False
    >>> 'Please correct the indicated errors.' in self.browser.contents
    False
    >>> '/synPropertiesForm' in self.browser.contents
    True
