<html>
  <head>
    <title>Async testing</title>
    <script type="text/javascript">
$(document).ready(function() {
  var myLoadingDiv = $("#progressbar");
  var mySpinner = $("#loadspinner");
  myLoadingDiv.progressbar({disabled:true});
  function update() {
  $.getJSON("status?",  {jobid: "4",}, function(data) {
    if (data == null) {
      myLoadingDiv.progressbar("disable");
      myLoadingDiv.progressbar("value", 0);
      mySpinner.html('No Data');
      $("#msg").html("Syncing...");
      clearInterval(intervalID);
      //alert('No Data'):
      }
    else {
      myLoadingDiv.progressbar("enable");
      myLoadingDiv.progressbar("value", data.percent);
      $("#msg").html(data.msg + ' (' + data.status + ') ');
      //alert(data.msg);
      if (data.percent == 100) {
        mySpinner.html('Job finished.')
        clearInterval(intervalID);
        }
      }
  });}
  intervalID = setInterval(update, 500);
  //update();
});
    </script>
  </head>
  <body>
    <h1>Async stuff</h1>
    <div>Dispatcher: <span tal:content="view/dispatcher"></span></div>
    <div>Queue: <span tal:content="view/queue"></span></div>
    <div>Jobs: <span tal:content="structure view/job_status"></span></div>
    <form method="POST">
      <input type="submit" name="reload" value="reload" />
      <input type="submit" name="start" value="start up" />
    </form>
    <div id="progressbar"
	 class="ui-progressbar ui-widget ui-widget-content ui-corner-all">
    </div>
    <div id="msg">Hi there</div>
    <div id="loadspinner">
      <img src="" alt="Please wait..."
	   tal:attributes="src view/spinner_url" />
    </div>
  </body>
</html>
