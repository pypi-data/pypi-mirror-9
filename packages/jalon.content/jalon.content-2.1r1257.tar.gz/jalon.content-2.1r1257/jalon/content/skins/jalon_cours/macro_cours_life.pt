<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="jalon.content">

<body>

<metal:content-core fill-slot="content-core">

<!-- Macro d'affichage du plan -->
<metal:macro define-macro="afficher-actus">
    <h2>
        <span class="sup" tal:content="nbActu" />
        <i class="fa fa-bell-o"></i><tal:block i18n:translate="">Nouveautés</tal:block>
    </h2>
    <div class="course_life-actus panel radius">
        <h4 i18n:translate=""
            tal:condition="python:context.test(nbActu == 1, 1, 0)">La dernière nouveauté du cours</h4>
        <h4 i18n:translate=""
            tal:condition="python:context.test(nbActu > 1 and nbActu < 4, 1, 0)">Les dernières nouveautés du cours</h4>
        <h4 i18n:translate=""
            tal:condition="python:context.test(nbActu >= 4, 1, 0)">Les 3 dernières nouveautés du cours</h4>
        <dl>
        <tal:block repeat="actu actualites/listeActu">
            <dt>
                <span class="label bkgrnd"
                      tal:content="python:context.getLocaleDate(actu['date'])" />
            </dt>
            <dd tal:attributes="class string:typeElement type_${actu/type}">
                <tal:condition condition="python:actu['type'] == 'Titre'">
                    « <strong tal:content="python:context.getShortText(context.supprimerMarquageHTML(actu['titre']), 60)" /> »
                    <i tal:content="actu/description" />
                </tal:condition>
                <tal:condition condition="python:actu['type'] == 'TexteLibre'">
                    « <tal:block content="python:context.getShortText(context.supprimerMarquageHTML(actu['titre']), 120)" /> »
                    <i tal:content="actu/description" />
                </tal:condition>
                <tal:condition condition="python:not(actu['type'] == 'Titre' or actu['type'] == 'TexteLibre')">
                    <strong tal:content="python:context.getShortText(actu['titre'], 60)" />
                    <i tal:content="actu/description" />
                </tal:condition>
            </dd>
        </tal:block>
        </dl>
        <a class="button tiny expand radius"
           tal:attributes="href string:${context/absolute_url}/cours_lister_actualites?mode_etudiant=${mode_etudiant}"
           data-reveal-id="reveal-main" data-reveal-ajax="true">
            <i class="fa fa-arrow-circle-right"></i><tal:block i18n:translate="label_consulter_actualites">Voir toutes les nouveautés</tal:block>
        </a>
    </div>
</metal:macro>

<!-- Macro mode d'affichage du plan -->
<metal:macro define-macro="mode_affichage">
<style type="text/css">
#mode_affichage{
    margin-bottom:1em;
}

#mode_affichage ul.button-group li {
    width: 50%;
}

#mode_affichage ul.button-group li .button {
    background-color: #e7e7e7;
    border-color: #b9b9b9;
    color: #333;
    margin-bottom: 0;
    width: 100%;
}

#mode_affichage ul.button-group li .button.selected, #mode_affichage ul.button-group li .button:hover, #mode_affichage ul.button-group li .button:focus {
    color: #fff;
}

#mode_affichage ul.button-group li .button.selected, #mode_affichage ul.button-group li .button.selected:focus {
    background-color: #43ac6a;
    border-color: #227da3;
}

#mode_affichage ul.button-group li .button:hover, #mode_affichage ul.button-group li .button:focus, #mode_affichage ul.button-group li .button.selected:hover {
    background-color: #368a55;
    border-color: #227da3;
}
</style>

<div id="mode_affichage">
    <h2>
        <i class="fa fa-desktop"></i><tal:block i18n:translate="">Affichage</tal:block>
    </h2>

    <ul class="button-group radius"
        tal:define="menu menu | nothing;
                    menu_aff python:context.test(menu, '&amp;menu=%s' % menu, '')">
        <li>
            <a tal:attributes="href string:${context/absolute_url}?mode_etudiant=false${menu_aff};
                               class python:context.test(mode_etudiant  != 'true', 'button small selected', 'button small')">
                <i class="fa fa-university"></i>
                <tal:replace i18n:translate="">Enseignant</tal:replace>
            </a>
        </li>
        <li>
            <a tal:attributes="href string:${context/absolute_url}?mode_etudiant=true${menu_aff};
                               class python:context.test(mode_etudiant == 'true', 'button small selected', 'button small')">
                <i class="fa fa-graduation-cap"></i>
                <tal:replace i18n:translate="">Étudiant</tal:replace>
            </a>
        </li>
    </ul>
</div>

</metal:macro>

<!-- Macro d'affichage du plan -->
<metal:macro define-macro="course_life">
    <h2>
        <i class="fa fa-leaf"></i><tal:block i18n:translate="">Vie du cours</tal:block>
    </h2>

    <ul role="tablist" class="tabs" data-tab="data-tab">
        <li class="tab-title active">
            <a href="#course_life-annonces">
                <span tal:content="annonces/nbAnnonces" />
                <i class="fa fa-bullhorn fa-2x"></i>
                <tal:replace i18n:translate="">Annonces</tal:replace>
            </a>
        </li>
        <li class="tab-title show-for-medium-up">
            <a href="#course_life-forum">
                <span tal:content="dicoForums/nbForums" />
                <i class="fa fa-comments fa-2x"></i>
                <tal:replace i18n:translate="">Forums</tal:replace>
            </a>
        </li>
        <li class="tab-title">
            <a href="#course_life-participants">
                <span tal:content="nbEtuFormation | string:0" />
                <i class="fa fa-child fa-2x"></i>
                <tal:replace i18n:translate="">Participants</tal:replace>
            </a>
        </li>
    </ul>

    <tal:block define="script string:setTabMemory('js-tab-course_life')">
        <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
    </tal:block>

    <div class="tabs-content">

        <div class="content active" id="course_life-annonces" role="tabpanel">

            <h3>
                <i class="fa fa-bullhorn"></i><tal:block i18n:translate="">Annonces</tal:block>
            </h3>
            <a class="button tiny radius show-for-medium-only"
               data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:condition="personnel"
               tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_annonce&amp;formulaire=ajout-annonce">
               <i class="fa fa-plus-circle"></i><tal:block i18n:translate="">Nouvelle ann.</tal:block>
            </a>
            <a class="button tiny radius show-for-large-up"
               data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:condition="personnel"
               tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_annonce&amp;formulaire=ajout-annonce">
               <i class="fa fa-plus-circle"></i><tal:block i18n:translate="">Nouvelle annonce</tal:block>
            </a>

        <tal:block condition="not:annonces/nbAnnonces">
            <div class="panel secondary radius" i18n:translate="">Il n'y a aucune annonce dans ce cours.</div>
        </tal:block>

        <tal:block condition="annonces/nbAnnonces">

            <div class="panel warning radius"
                 tal:condition="mode_etudiant">
                 Les étudiants ne verront que les annonces qui leur sont destinées.
            </div>

            <div class="panel radius"
                 tal:define="annonce python:annonces['listeAnnonces'][0]">
                 <h4>La dernière annonce</h4>
                <span class="label bkgrnd round" tal:content="python:context.getLocaleDate(annonce.modified())" />

            <tal:condition condition="personnel">
                <a class="dropdown right show-for-medium-up" data-dropdown="last_announce" data-options="align:left">
                    <i class="fa fa-cog fa-fw fa-lg no-pad"></i>
                </a>
                <ul id="last_announce" class="f-dropdown" data-dropdown-content="data-dropdown-content">
                    <li>
                        <a data-reveal-id="reveal-main" data-reveal-ajax="true"
                           tal:attributes="href string:${context/absolute_url}/annonce/${annonce/getId}/folder_form?macro=macro_annonce&amp;formulaire=modifier-annonce">
                            <i class="fa fa-pencil fa-fw"></i>
                            <tal:block i18n:translate="">Modifier</tal:block>
                        </a>
                    </li>
                    <li>
                        <a data-reveal-id="reveal-main" data-reveal-ajax="true"
                           tal:define="titre python:context.jalon_quote(annonce['title'])"
                           tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_annonce&amp;formulaire=supprimer-annonce&amp;annonce=${annonce/getId}&amp;titre=${titre}">
                            <i class="fa fa-trash-o fa-fw"></i>
                            <tal:block i18n:translate="">Supprimer</tal:block>
                        </a>
                    </li>
                </ul>
            </tal:condition>

                <h4 class="typeElementTitre" tal:content="annonce/Title" />
                <p class="panel radius" tal:content="structure annonce/getDescriptionAff" />
                <a class="button tiny expand radius"
                   tal:attributes="href string:${context/absolute_url}/cours_lister_annonces">
                    <i class="fa fa-arrow-circle-right"></i><tal:block i18n:translate="label_consulter_annonces">Voir toutes les annonces</tal:block>
                </a>

            </div>
        </tal:block>
        </div>

        <div class="content" id="course_life-forum" role="tabpanel">

            <h3>
                <i class="fa fa-comments"></i><tal:block i18n:translate="">Forums</tal:block>
            </h3>

        <tal:block condition="not:dicoForums/listeForums">
            <a class="button tiny radius show-for-medium-up"
               data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_forum&amp;formulaire=ajout-forum"
               tal:condition="not:anonymous">
                <i class="fa fa-plus-circle"></i><tal:block i18n:translate="">Créer un forum</tal:block>
            </a>
            <div class="panel radius" i18n:translate="">
                Il n'y a aucun forum dans ce cours.
            </div>
        </tal:block>

        <tal:block condition="dicoForums/listeForums">
            <a class="button tiny radius show-for-medium-up"
               data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_forum&amp;formulaire=ajout-forum"
               tal:condition="not:anonymous">
                <i class="fa fa-plus-circle"></i><tal:block i18n:translate="">Créer un forum</tal:block>
            </a>
            <div class="panel radius">
                <dl>
            <tal:repeat repeat="forum dicoForums/listeForums">
                <tal:define define="author forum/getLastCommentAuthor;">
                    <dt>
                        <a tal:attributes="href string:${forum/absolute_url}?mode_etudiant=${mode_etudiant}"
                           tal:content="forum/Title" />
                    </dt>
                    <dd class="panel radius">
                        <i tal:condition="not: author"
                           i18n:translate="no_conversations_started">
                            Aucune conversation en cours.
                        </i>
                        <i tal:condition="author"
                           i18n:translate="no_conversations_started">
                            <tal:replace replace="forum/getNumberOfConversations" /> conversation(s)<br />
                            <tal:block i18n:translate="label_by_author">dernier message par</tal:block>
                            <strong><tal:author i18n:name="author"
                                        define="creator author;
                                                creatorinfo python: mtool.getMemberInfo(creator);"
                                        content="python:creatorinfo and creatorinfo['fullname'] or creator" /></strong><br />
                            le <tal:replace replace="python:context.convertirDate(forum.getLastCommentDate())" />
                        </i>
                    </dd>
                </tal:define>
            </tal:repeat>
                </dl>
                <a class="button tiny expand radius"
                   tal:attributes="href string:${context/absolute_url}/forum?mode_etudiant=${mode_etudiant}">
                    <i class="fa fa-arrow-circle-right"></i><tal:block i18n:translate="">Voir la liste des forums</tal:block>
                </a>
            </div>
        </tal:block>

        </div>

        <div class="content" id="course_life-participants" role="tabpanel">

            <h3>
                <i class="fa fa-child"></i><tal:block i18n:translate="">Participants</tal:block>
            </h3>

            <div class="panel radius">

                <dl>

        <tal:define define="isLDAP context/isLDAP">

            <tal:condition condition="isLDAP">
            <tal:define define="baseAnnuaire context/getBaseAnnuaire">

                    <dt>
                        <i class="fa fa-user author"></i>
                        <tal:block i18n:translate="auteur">Auteur</tal:block>
                    </dt>

                    <dd class="panel radius">
                        <a tal:define="auteurPrincipal context/getAuteur"
                           tal:attributes="href python:context.getFicheAnnuaire(auteurPrincipal, baseAnnuaire)" target="_blank"
                           tal:content="auteurPrincipal/fullname" />
                    </dd>

                <tal:block define="coauteurs context/getCoAuteursCours"
                           condition="coauteurs">

                    <dt>
                        <i class="fa fa-user co_author"></i>
                        <tal:block i18n:translate="coauteurs">Co-auteur(s)</tal:block>
                    </dt>

                    <dd class="panel radius"
                        tal:repeat="auteur coauteurs">
                        <a target="_blank"
                           tal:attributes="href python:context.getFicheAnnuaire(auteur, baseAnnuaire)"
                           tal:content="auteur/fullname" />
                    </dd>

                </tal:block>
            </tal:define>
            </tal:condition>

            <tal:condition condition="not:isLDAP">

                    <dt>
                        <i class="fa fa-user author"></i>
                        <tal:block i18n:translate="auteur">Auteur</tal:block>
                    </dt>

                    <dd class="panel radius">
                        <a tal:define="auteurPrincipal context/getAuteur"
                           tal:attributes="href string:mailto:${auteurPrincipal/email}"
                           tal:content="auteurPrincipal/fullname" />
                    </dd>

                <tal:block define="coauteurs context/getCoAuteursCours"
                           condition="coauteurs">

                    <dt>
                        <i class="fa fa-user co_author"></i>
                        <tal:block i18n:translate="coauteurs">Co-auteur(s)</tal:block>
                    </dt>

                    <dd class="panel radius"
                        tal:repeat="auteur coauteurs">
                        <a tal:attributes="href string:mailto:${auteur/email}"
                           tal:content="auteur/fullname" />
                    </dd>

                </tal:block>
            </tal:condition>

        </tal:define>

                    <dt>
                        <i class="fa fa-users"></i>
                        <tal:block i18n:translate="etudiants">Étudiants</tal:block>
                    </dt>

                <tal:block tal:condition="formations"
                           tal:define="portal python:context.portal_url.getPortalObject()">
                    <dd class="panel radius" tal:repeat="formation formations">
                        <a target="_blank"
                           tal:define="code python:formation[1];
                                       type python:formation[-1]"
                           tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_etudiants&amp;formulaire=listing&amp;code=${code}&amp;type=${type}&amp;mode_etudiant=${mode_etudiant}"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                            <tal:block content="python:formation[0]" />
                        </a>
                        <p>
                            <tal:block replace="python:formation[-1]" i18n:translate="" /> &bull;
                            <tal:block content="python:formation[2]" />
                            <tal:block i18n:translate="label_etudiant">étudiants</tal:block>
                        </p>
                    </dd>
                </tal:block>

                    <dd class="panel warning radius"
                        tal:condition="not:formations"
                        i18n:translate="">
                        Le cours n'est encore diffusé à aucun étudiant.
                    </dd>

                </dl>
            </div>
        </div>
    </div>
</metal:macro>

</metal:content-core>

</body>

</html>