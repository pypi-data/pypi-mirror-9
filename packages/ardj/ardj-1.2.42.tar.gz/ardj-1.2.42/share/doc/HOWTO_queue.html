<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" type="text/css" href="screen.css"/>
</head>
<body>
<h1 id="управление-очередью-проигрывания-заказ-музыки">Управление очередью проигрывания (заказ музыки)</h1>
<p>Любой слушатель может заказывать композиции, отправляя jabber-боту команду <code>queue</code>. Эта команда принимает в качестве параметра фрагмент имени исполнителя или заголовка композиции, ей идентификатор или список меток. Найденная композиция добавляется в конец очереди. При выборе следующей композиции для проигрывания очередь имеет максимальный приоритет; за ней следует виртуальный плейлист, затем остальные плейлисты.</p>
<p>Привилегированные пользователи могут добавлять композиции в любом количестве и в любое время. Обычные пользователи могут добавлять по одной композиции за раз (новую добавить нельзя пока предыдущая не проиграна), и к таким композициям в качестве подмотки добавляется случайная композиция с меткой «queue-jingle», если такие есть (смысл этих ограничений в том, чтобы резвящийся слушатель был очевиден, чтобы его нельзя было принять за дефект программного обеспечения).</p>
<h2 id="управление-через-jabber">Управление через jabber</h2>
<pre><code>&gt; find дом
«Песня идущего домой» by Ю-Питер — #6899 ⚖1.00 ♺0
&gt; queue 6899</code></pre>
<h2 id="управление-через-api">Управление через API</h2>
<p>Для постановки дорожки в очередь следует вызвать <code>track/queue.json</code>. Параметры:</p>
<ul>
<li><code>track</code> — номер дорожки.</li>
<li><code>token</code> — ключ для аутентификации.</li>
</ul>
<p>Пример вызова:</p>
<pre><code>$ curl &#39;http://music.tmradio.net/track/queue.json?track=6065&amp;token=secret&#39;
{
  &quot;success&quot;: true
}</code></pre>
<p>Это идентично выполнению команды <code>queue -s 6065</code> в консоли или через jabber.</p>
</body>
</html>
