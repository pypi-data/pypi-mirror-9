{% load i18n l10n %}

{% get_current_language as LANGUAGE_CODE %}

	<div id="{{view_name}}_div_grid_container" class="div_grid_container">
		<table id="{{view_name}}_table_grid" ></table>
		<div id="{{view_name}}_grid_pager"> </div>
	</div><!-- /Grid Container -->

<script type="text/javascript" lang="text/javascript">


	createGrid();
	function createGrid() {

		// Vars definition
		col_model= {% autoescape off %} {{col_model}} {% endautoescape %};
		col_names = {% autoescape off %} {{col_name}} {% endautoescape %};
		var jsonReader_id = {% autoescape off %} '{{jsonReader_id}}' {% endautoescape %};
		var mult = {% autoescape off %} '{{multiselect}}' {% endautoescape %};
		var url_grid =  '{{ URL_GRID }}';
		var sortname =  '{{ sortname }}';
		var multiselect = false;
		var sortorder = 'asc';
		var footerrow = '{{footerrow}}';
		//console.log('url_grid',url_grid)
		// Order data desc by default
		if (sortname.indexOf('-') != -1) {
			sortorder = 'desc';
			// sortname = sortname.replace('-', '');
			sortname = sortname.substring(1, sortname.length);
		}
		//console.log('{{multiselect}}')
		if ('{{multiselect}}' != 'false') {
			multiselect = true;
		}
		
		if (footerrow == 'true')
			footerrow = true
		else 
			footerrow = false

		// Grid configuration
		var selColumn = undefined
		$("#{{view_name}}_table_grid").jqGrid({
		  	url: url_grid, 
		  	datatype:'json',
		  	colNames: col_names,
		  	colModel: col_model,
		  	rowNum: '{{row_num|unlocalize}}',
		  	pager: '#{{view_name}}_grid_pager',
		  	sortname: sortname,
		  	sortorder: sortorder,
		  	jsonReader : {
			  	root: 'rows',
			  	page: 'page',
			  	total: "total",
			  	records: "records",
			  	userdata: "footerData",

			  	repeatitems: false,
			  	id:jsonReader_id,
		  	},
  			altRows: true,
		  	autowidth: true,
		  	caption: "{% trans 'VIEW NAME' %}",
		  	height: 300,
		  	scroll:true,
		  	gridview: true,
		 	viewrecords: true,
		  	pgbuttons : false,
		  	pginput: false,
		  	pgtext: false,
		  	multiboxonly: multiselect,
		  	multiselect: multiselect,
		  	footerrow : footerrow,
			userDataOnFooter : footerrow,
		    subGrid: {{subGrid}},
    		subGridOptions: { "plusicon" : "ui-icon-triangle-1-e",
                      "minusicon" :"ui-icon-triangle-1-s",
                      "openicon" : "ui-icon-arrowreturn-1-e",
                      "reloadOnExpand" : false,
                      "selectOnExpand" : true },		
			

			loadComplete: function(data) {
				//$("#{{view_name}}_table_grid").footerData('set', data['footerData']);
			},

			gridComplete: function(){
				{{view_name}}_grid_complete_callback();
				//resizeToGrid('TEST_int_table_grid','TEST_int_div_grid_container');
			},
			// Click row
			onSelectRow: function(id){ 
				if (multiselect == false)
					row_id = jQuery("#{{view_name}}_table_grid").jqGrid('getGridParam','selrow');
				else
				{	
					row_id = jQuery("#{{view_name}}_table_grid").jqGrid('getGridParam','selrow');
					row_ids = jQuery("#{{view_name}}_table_grid").jqGrid('getGridParam','selarrrow');
				}
				//this function allows overwriting OnSelectRow
				{{view_name}}_select_row_callback(row_id, id);
			},
			// Click all rows
			onSelectAll: function(aRowids, status){
				{{view_name}}_select_all_row_callback(aRowids, status);
			},
			
			onHeaderClick: function(){
				{{view_name}}_hear_click();
			},

		    onCellSelect: function (rowid,iCol) {

		    	{{view_name}}_cell_click(rowid,iCol,this);
		    },
			subGridRowExpanded: function(subgrid_id, row_id){
				{{view_name}}_subgrid_row_expanded_callback(subgrid_id, row_id);
			}
		});//grid definition	



	}

	// definition by default
	function {{view_name}}_grid_complete_callback(){}
	function {{view_name}}_select_row_callback(row_id){}
	function {{view_name}}_select_all_row_callback(aRowids, status){}
	function {{view_name}}_hear_click(){}
	function {{view_name}}_subgrid_row_expanded_callback(subgrid_id, row_id){}
	function {{view_name}}_cell_click(rowid,iCol,cell){}


//EXAMPLE  (NON DELETE) 
// function view_name_cell_click(rowid,iCol,cell){
// 	var i; 
// 	var rows = cell.rows
// 	var rl = rows.length
// 	var  row;
// 	var rowCells;
	
// 	$('#view_name_table_grid .ui-state-highlight').removeClass('ui-state-highlight');

// 	for(i=0; i<rl; i++) {
// 		console.log(i)
// 	    row = rows[i];
// 	    if($(row).hasClass('jqgrow')) {
// 	        rowCells = row.cells;
// 	        	$(rowCells[iCol]).addClass("ui-state-highlight");
// 	    }
// 	}
// }
</script>

