{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "description": "MBE Event Schema",
  "title": "Event",
  "type": "object",
  "version": "0.1",
  "properties": {
    "_id": {
      "$ref": "mbe://type.json#properties/objectId",
      "description": "The object _id of the event, an object id.",
      "propertyId": "dcf7fb13-f934-4121-90ec-c8992203a299",
      "objectId": "true"
    },
    "user_id": {
      "$ref": "mbe://type.json#properties/objectId",
      "description": "The user involved in the event.",
      "refSchemaId": "2fb3b2c9-a29c-4fc0-b29d-6eed738b6dab",
      "propertyId": "d1714064-a023-4d54-b801-4e6385cf6975",
      "isObjectId": "true"
    },
    "writtenWhen": {
      "description": "The time the event was written to the database",
      "type": "string",
      "format": "date-time",
      "propertyId": "b2dc70cf-93a1-4275-842a-76fc48d1d2d2"
    },
    "occurredWhen": {
      "description": "The time the event occurred",
      "type": "string",
      "format": "date-time",
      "propertyId": "965e56c4-2501-453e-b1c7-2fe4d22ca546"
    },
    "node_id": {
      "$ref": "mbe://type.json#properties/objectId",
      "description": "The relevant _id in the node-collection, used for tracking changes to a node or identifying reporting functionality.",
      "propertyId": "a062bbc2-1f61-4237-a41f-c16482d5c196",
      "isObjectId": "true"
    },
    "event": {
      "description": "The event that occurred",
      "propertyId": "aaef2cff-c762-48b5-86b7-06cc55aec675",
      "anyOf": [
        {
          "add": {
            "description": "This document was written to a collection ",
            "type": "any"
          },
          "remove": {
            "description": "This document was removed from a collection ",
            "type": "any"
          },
          "change": {
            "description": "This/these field(s) was changed in a collection",
            "type": "array",
            "items": [
              {
                "description": "An individual change",
                "type": "object",
                "properties": {
                  "propertyId": {
                    "description": "The field uuid of the change",
                    "type": "string"
                  },
                  "before": {
                    "description": "The value before the change",
                    "type": "any"
                  },
                  "after": {
                    "description": "The value after the change",
                    "type": "any"
                  }
                },
                "required": ["propertyId"],
                "additionalItems": false
              }
            ]
          },
          "error": {
            "description": "This error occurred",
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            },
            "required": ["type"],
            "additionalItems": false
          },
          "security": {
            "description": "A security related error occurred",
            "type": "object",
            "properties": {
              "type": {
                "enum": [
                  "right",
                  "permission",
                  "attack"
                ]
              },
              "message": {
                "type": "string"
              }
            },
            "required": ["type"],
            "additionalItems": false
          },
          "notification": {
            "description": "This happened",
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            },
            "required": ["type"],
            "additionalItems": false
          }
        }
      ]
    },
    "schemaId": {
      "description": "A reference to the schema to which this data adheres.",
      "$ref": "mbe://type.json#properties/uuid",
      "propertyId": "b1b75292-10d4-42be-a438-cd4f9835cc0a"
    }
  },
  "required": [
    "user_id",
    "writtenWhen",
    "occurredWhen",
    "node_id",
    "schemaId"
  ],
  "collection": "session",
  "schemaId": "3b9018ce-bc9b-46b4-9e67-4979c36d77fe"
}
