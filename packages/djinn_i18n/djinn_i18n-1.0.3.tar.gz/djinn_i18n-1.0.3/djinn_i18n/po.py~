import polib
import os
from utils import generate_po_path, get_override_base


class Override(polib.POFile):

    """ The override class takes care of overriding translations of existing
    modules. The po file that is created when saving this overrides should be
    loaded first, to allow for overriding """

    def __init__(self, locale, *args, **kwargs):

        super(Override, self).__init__(*args, **kwargs)

        # Do we already exist? If not, we'll make sure we do now
        #
        if not self.fpath:

            self.metadata = {
                'Project-Id-Version': '1.0',
                'Report-Msgid-Bugs-To': 'devnull@pythonunited.com',
                'POT-Creation-Date': '2007-10-18 14:00+0100',
                'PO-Revision-Date': '2007-10-18 14:00+0100',
                'Last-Translator': 'djinn <djinn@pythonunited.com',
                'Language-Team': '%s <djinn@pythonunited.com>' % locale,
                'MIME-Version': '1.0',
                'Content-Type': 'text/plain; charset=utf-8',
                'Content-Transfer-Encoding': '8bit',
            }

            self.fpath = generate_po_path(get_override_base(), locale)

            if not os.path.exists(self.fpath):

                os.makedirs(os.path.dirname(self.fpath))

            self.save()
