/*
 *
 * Copyright (c) 2006-2011 Sam Collett (http://www.texotela.co.uk)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * 
 * Version 1.3.1
 * Demo: http://www.texotela.co.uk/code/jquery/numeric/
 *
 */(function(a){a.fn.numeric=function(b,c){typeof b=="boolean"&&(b={decimal:b}),b=b||{},typeof b.negative=="undefined"&&(b.negative=!0);var d=b.decimal===!1?"":b.decimal||".",e=b.negative===!0?!0:!1;return c=typeof c=="function"?c:function(){},this.data("numeric.decimal",d).data("numeric.negative",e).data("numeric.callback",c).keypress(a.fn.numeric.keypress).keyup(a.fn.numeric.keyup).blur(a.fn.numeric.blur)},a.fn.numeric.keypress=function(b){var c=a.data(this,"numeric.decimal"),d=a.data(this,"numeric.negative"),e=b.charCode?b.charCode:b.keyCode?b.keyCode:0;if(e==13&&this.nodeName.toLowerCase()=="input")return!0;if(e==13)return!1;var f=!1;if(b.ctrlKey&&e==97||b.ctrlKey&&e==65)return!0;if(b.ctrlKey&&e==120||b.ctrlKey&&e==88)return!0;if(b.ctrlKey&&e==99||b.ctrlKey&&e==67)return!0;if(b.ctrlKey&&e==122||b.ctrlKey&&e==90)return!0;if(b.ctrlKey&&e==118||b.ctrlKey&&e==86||b.shiftKey&&e==45)return!0;if(e<48||e>57){var g=a(this).val();if(g.indexOf("-")===0||!d||e!=45||g.length!==0&&parseInt(a.fn.getSelectionStart(this),10)!==0)c&&e==c.charCodeAt(0)&&g.indexOf(c)!=-1&&(f=!1),e!=8&&e!=9&&e!=13&&e!=35&&e!=36&&e!=37&&e!=39&&e!=46?f=!1:typeof b.charCode!="undefined"&&(b.keyCode==b.which&&b.which!==0?(f=!0,b.which==46&&(f=!1)):b.keyCode!==0&&b.charCode===0&&b.which===0&&(f=!0)),c&&e==c.charCodeAt(0)&&(g.indexOf(c)==-1?f=!0:f=!1);else return!0}else f=!0;return f},a.fn.numeric.keyup=function(b){var c=a(this).val();if(c&&c.length>0){var d=a.fn.getSelectionStart(this),e=a.fn.getSelectionEnd(this),f=a.data(this,"numeric.decimal"),g=a.data(this,"numeric.negative");if(f!==""&&f!==null){var h=c.indexOf(f);h===0&&(this.value="0"+c),h==1&&c.charAt(0)=="-"&&(this.value="-0"+c.substring(1)),c=this.value}var i=[0,1,2,3,4,5,6,7,8,9,"-",f],j=c.length;for(var k=j-1;k>=0;k--){var l=c.charAt(k);k!==0&&l=="-"?c=c.substring(0,k)+c.substring(k+1):k===0&&!g&&l=="-"&&(c=c.substring(1));var m=!1;for(var n=0;n<i.length;n++)if(l==i[n]){m=!0;break}if(!m||l==" ")c=c.substring(0,k)+c.substring(k+1)}var o=c.indexOf(f);if(o>0)for(var p=j-1;p>o;p--){var q=c.charAt(p);q==f&&(c=c.substring(0,p)+c.substring(p+1))}this.value=c,a.fn.setSelection(this,[d,e])}},a.fn.numeric.blur=function(){var b=a.data(this,"numeric.decimal"),c=a.data(this,"numeric.callback"),d=this.value;if(d!==""){var e=new RegExp("^\\d+$|^\\d*"+b+"\\d+$");e.exec(d)||c.apply(this)}},a.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).unbind("keypress",a.fn.numeric.keypress).unbind("blur",a.fn.numeric.blur)},a.fn.getSelectionStart=function(a){if(a.createTextRange){var b=document.selection.createRange().duplicate();return b.moveEnd("character",a.value.length),b.text===""?a.value.length:a.value.lastIndexOf(b.text)}return a.selectionStart},a.fn.getSelectionEnd=function(a){if(a.createTextRange){var b=document.selection.createRange().duplicate();return b.moveStart("character",-a.value.length),b.text.length}return a.selectionEnd},a.fn.setSelection=function(a,b){typeof b=="number"&&(b=[b,b]);if(b&&b.constructor==Array&&b.length==2)if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveStart("character",b[0]),c.moveEnd("character",b[1]),c.select()}else a.setSelectionRange&&(a.focus(),a.setSelectionRange(b[0],b[1]))}})(jQuery);