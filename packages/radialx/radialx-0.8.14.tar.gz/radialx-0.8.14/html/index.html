

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>radialx Documentation &mdash; radialx 0.8.14 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.8.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="radialx 0.8.14 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">radialx 0.8.14 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="radialx-documentation">
<h1>radialx Documentation<a class="headerlink" href="#radialx-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>RadialX is a python package for working with x-ray
powder diffraction data and for simulating
x-ray powder diffraction patterns from models.</p>
<p>The most complete documentation is available at
<a class="reference external" href="http://pythonhosted.org/radialx/">http://pythonhosted.org/radialx/</a>.</p>
<div class="section" id="fully-documented-functionalities">
<h3>Fully Documented Functionalities<a class="headerlink" href="#fully-documented-functionalities" title="Permalink to this headline">¶</a></h3>
<p>At present, the only 100% documented functionalities of RadialX are</p>
<ol class="arabic simple">
<li>The simulation of powder diffraction patterns
from PDB files using the utility called <strong>powderx</strong>.</li>
<li>Displaying of diffraction image header information
using the utility called <strong>headerx</strong>.</li>
</ol>
<p>Detailed usage for <a class="reference internal" href="#powderx">powderx</a> and <a class="reference internal" href="#headerx">headerx</a> are below.</p>
</div>
<div class="section" id="less-documented-functionalities">
<h3>Less Documented Functionalities<a class="headerlink" href="#less-documented-functionalities" title="Permalink to this headline">¶</a></h3>
<p>Other less documented functionalities correspond to &#8220;modes&#8221; of the
utility called <strong>profilex</strong>:</p>
<ul class="simple">
<li><em>centering</em> mode: Finding the centers of powder diffraction images
in <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary format.</li>
<li><em>averaging</em> mode: Radial integration of one or
more experimental powder diffraction patterns in <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary format.</li>
<li><em>averaging</em> mode: Scaling of several powder experimental or simulated
diffraction patterns to a single experimental or simulated pattern.</li>
<li><em>difference</em> mode: Calculating the difference of two scaled
radially integrated experimental powder diffraction patterns.</li>
</ul>
<p>Although <strong>profilex</strong> is fully functional and heavily tested, its
user interface (i.e. config file format, etc.) is very likely to
change. For example, the modes will probably be split into different
different utilities and several config file parameters will
probably be renamed. The <strong>profilex</strong> utility is fairly well documented by
comments in the config files that populate the <tt class="docutils literal"><span class="pre">test/test-profilex</span></tt>
directory of the source distribution, as explained below.</p>
<p>It is hoped that the entire RadialX package will be fully
and heavily documented soon.</p>
</div>
</div>
<div class="section" id="home-page-repository">
<h2>Home Page &amp; Repository<a class="headerlink" href="#home-page-repository" title="Permalink to this headline">¶</a></h2>
<p>Home Page: <a class="reference external" href="https://pypi.python.org/pypi/radialx/">https://pypi.python.org/pypi/radialx/</a></p>
<p>Documentation: <a class="reference external" href="http://pythonhosted.org/radialx/">http://pythonhosted.org/radialx/</a></p>
<p>Repository: <a class="reference external" href="https://github.com/jcstroud/radialx">https://github.com/jcstroud/radialx</a></p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pip-setuptools">
<h4>pip &amp; setuptools<a class="headerlink" href="#pip-setuptools" title="Permalink to this headline">¶</a></h4>
<p>The installation of RadialX and many other python packages will
be made easier by <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>. So, before going any further towards
installation, it is advisable to follow the
<a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip installation instructions</a>, including the
installation of setuptools described therein.
Setuptools is essential to pip.</p>
</div>
<div class="section" id="cctbx">
<h4>CCTBX<a class="headerlink" href="#cctbx" title="Permalink to this headline">¶</a></h4>
<p>At this point the <a class="reference external" href="http://cctbx.sourceforge.net/">CCTBX package</a> is <em>only</em> needed to
simulate powder diffraction patterns with the <strong>powderx</strong> utility.</p>
<p>For <strong>powderx</strong>, it will be necessary to have the full CCTBX package installed
and the <tt class="docutils literal"><span class="pre">cctbx.python</span></tt> executable in your path. <a class="reference external" href="http://cci.lbl.gov/cctbx_build/">Downloads are available</a>
for numerous operating systems, including Mac OS X, Windows 7 &amp; XP, and
several flavors of Linux. Additionally, it is possible to build
CCTBX from a source bundle or, for the more ambitious,
the SVN repository at sourceforge.</p>
<p>Because of the unusual python interpreter behavior forced by
the cctbx.python executable,
it is necessary to have all dependencies (except CCTBX itself)
installed both to the <tt class="docutils literal"><span class="pre">cctbx.python</span></tt> interpreter and to a system python
interpreter (e.g. at <tt class="docutils literal"><span class="pre">/usr/local/bin/python</span></tt>).</p>
<p>The difficulty here might be in using pip with CCTBX if
you are using one of the pre-built CCTBX distributions
called &#8220;cctbx+Python&#8221; or &#8220;cctbx plus&#8221;,
wherein the CCTBX distribution python
will be different from your system python.</p>
<p>One way to overcome this difficulty is simply to install all of the
packages twice, once to the CCTBX python
and once to the system python.</p>
<p>Installing to the system python interpreter is easy with pip.
For example, to install the <a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a> package:</p>
<div class="highlight-python"><pre>% sudo pip install pyfscache</pre>
</div>
<p>Note that &#8220;<tt class="docutils literal"><span class="pre">%</span></tt>&#8221; is the prompt and is not actually typed.</p>
<p>For the CCTBX python, things are slightly more complicated. First, when
following the <a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip installation instructions</a>, use <tt class="docutils literal"><span class="pre">cctbx.python</span></tt>
with <tt class="docutils literal"><span class="pre">ez_setup.py</span></tt> and <tt class="docutils literal"><span class="pre">get-pip.py</span></tt>. For example:</p>
<div class="highlight-python"><pre>% sudo cctbx.python ez_setup.py
% sudo cctbx.python get-pip.py</pre>
</div>
<p>Once this latter command completes, you&#8217;ll see among the final lines of output
something similar to:</p>
<div class="highlight-python"><pre>Installing pip script to /opt/cctbx/Python.framework/Versions/2.7/bin</pre>
</div>
<p>The directory path in this output points to the location of CCTBX&#8217;s pip,
which can be used directly. Using <a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a> as an example:</p>
<div class="highlight-python"><pre>% sudo /opt/cctbx/Python.framework/Versions/2.7/bin/pip install pyfscache</pre>
</div>
</div>
<div class="section" id="other-dependencies">
<h4>Other Dependencies<a class="headerlink" href="#other-dependencies" title="Permalink to this headline">¶</a></h4>
<p>Other python dependencies are (in alphabetical order):</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://pypi.python.org/pypi/configobj/">configobj</a></li>
<li><a class="reference external" href="http://www.numpy.org/">numpy</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/phyles/">phyles</a></li>
<li><a class="reference external" href="http://www.pythonware.com/products/pil/">PIL</a></li>
<li><a class="reference external" href="http://www.pydblite.net/">PyDBLite</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pygmyplot">pygmyplot</a></li>
<li><a class="reference external" href="http://pyyaml.org/">pyyaml</a></li>
<li><a class="reference external" href="http://scipy.org/">scipy</a></li>
</ul>
</div></blockquote>
<p>If not already present on your system, most (if not all) of
these dependencies can be installed by the python package
manager called <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>.
The availability of each of these packages will be checked
during the <a class="reference internal" href="#build">build</a> of RadialX by the <tt class="docutils literal"><span class="pre">setup.py</span></tt> script.</p>
</div>
</div>
<div class="section" id="download">
<h3>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h3>
<p>Because of the CCTBX dependency, it is not yet recommended
to install RadialX by using <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>.</p>
<p>For now, the best way to obtain RadialX is to download the source
code from the GitHub repository:</p>
<div class="highlight-python"><pre>% git clone https://github.com/jcstroud/radialx.git</pre>
</div>
<p>This command automatically downloads and unpacks the complete
RadialX repository, which includes all of the code and some test data.</p>
</div>
<div class="section" id="build">
<h3>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>It is advisable to look at the <tt class="docutils literal"><span class="pre">Makefile.inc</span></tt> file inside
the <tt class="docutils literal"><span class="pre">radialx</span></tt> directory to ensure that the settings reflect
your build environment. Most notably, ensure that the
<tt class="docutils literal"><span class="pre">PYTHON</span></tt> setting points to the desired python version and
that the <tt class="docutils literal"><span class="pre">bin</span></tt> directory under the directory specified
by the <tt class="docutils literal"><span class="pre">PREFIX</span></tt> setting is in your path.</p>
<p>For example, if <tt class="docutils literal"><span class="pre">PREFIX</span></tt> is set to <tt class="docutils literal"><span class="pre">/usr/local</span></tt>, then
ensure that <tt class="docutils literal"><span class="pre">/usr/local/bin</span></tt> is in your path.</p>
<p>These settings only affect how RadialX is built and where it is installed,
not how it will execute once installed.</p>
<p>Once downloaded, build and installation are easy:</p>
<div class="highlight-python"><pre>% cd radialx
% make
% sudo make install</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">make</span></tt> command will automatically call <tt class="docutils literal"><span class="pre">setup.py</span></tt> and install
the utilities (<tt class="docutils literal"><span class="pre">powderx</span></tt>, <tt class="docutils literal"><span class="pre">headerx</span></tt>, and <tt class="docutils literal"><span class="pre">profilex</span></tt>) into
the appropriate location, specified by the <tt class="docutils literal"><span class="pre">PREFIX</span></tt> setting.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Complete examples of how to use all of the RadialX utilites are
currently in the <tt class="docutils literal"><span class="pre">test</span></tt> directory of the <a class="reference internal" href="#download">source distribution</a>.
These examples are documented by comments in the config files called
<tt class="docutils literal"><span class="pre">powder.yml</span></tt> and <tt class="docutils literal"><span class="pre">profile.cfg</span></tt>, the latter serving presently
as the only source of documentation for the <strong>profilex</strong> utility.</p>
<p>Detailed instructions for the <a class="reference internal" href="#headerx">headerx</a> and <a class="reference internal" href="#powderx">powderx</a> utilities follow.</p>
<div class="section" id="headerx">
<h3>headerx<a class="headerlink" href="#headerx" title="Permalink to this headline">¶</a></h3>
<p>The <strong>headerx</strong> utility is the most straightforward to use. First,
convert an image file from the synchrotron or a home-source detector
to an <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary file. This function is found under the
<tt class="docutils literal"><span class="pre">File</span></tt> → <tt class="docutils literal"><span class="pre">Save..</span></tt> menu of <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a>. Ensure that the checkboxes
for &#8220;Image&#8221; and &#8220;Binary&#8221; are checked in the <em>Adxv Save</em>
window. I prefer to name these adxv binary files with the &#8220;<tt class="docutils literal"><span class="pre">.bin</span></tt>&#8221;
extension.</p>
<p>Using a filed called <tt class="docutils literal"><span class="pre">stsaa_119a_0_003.bin</span></tt> as an example:</p>
<div class="highlight-python"><pre>% headerx stsaa_119a_0_003.bin</pre>
</div>
<p>This file is in the <tt class="docutils literal"><span class="pre">test/testdata</span></tt> directory and yields the following
output:</p>
<div class="highlight-python"><pre>     ===============  ===============
        HEADER_BYTES: 1024
                 DIM: 2
          BYTE_ORDER: little_endian
                TYPE: unsigned_short
               SIZE1: 3072
               SIZE2: 3072
          PIXEL_SIZE: 0.10259
                 BIN: 2x2
                 ADC: slow
         DETECTOR_SN: 911
            BEAMLINE: 24_ID_C
                DATE: Mon Jun  8 02:28:42 2009
                TIME: 10.0
            DISTANCE: 400.0
           OSC_RANGE: 1.0
                 PHI: 47.0
           OSC_START: 47.0
            TWOTHETA: 0.0
                AXIS: phi
          WAVELENGTH: 0.9793
       BEAM_CENTER_X: 157.11
       BEAM_CENTER_Y: 156.05
        TRANSMISSION: 10.0871
                PUCK: C
              SAMPLE: 2
            RING_CUR: 102.2
           RING_MODE: 0+24x1, ~1.3% Coupling
        MD2_APERTURE: 30
            UNIF_PED: 1500
CCD_IMAGE_SATURATION: 65535
     ===============  ===============
         Sanity Test
            4.7 Angs: 2357,1550 px
            4.7 Angs: 1531,2376 px
     ===============  ===============</pre>
</div>
<p>The &#8220;Sanity Test&#8221; is based on the header beam center. Hovering
the mouse over the given pixels in adxv should produce approximately
the given resolutions (depending on what adxv thinks is the beam center).</p>
</div>
<div class="section" id="powderx">
<h3>powderx<a class="headerlink" href="#powderx" title="Permalink to this headline">¶</a></h3>
<p>The <strong>powderx</strong> utility simulates powder diffraction patterns
from PDB files. These patterns are presented graphically and
also written to a file name designated by the user, as described
below.</p>
<div class="section" id="the-powderx-config-file">
<h4>The powderx Config File<a class="headerlink" href="#the-powderx-config-file" title="Permalink to this headline">¶</a></h4>
<p>A <a class="reference external" href="http://www.yaml.org/">yaml</a> formatted config file controls the behavior of <strong>powderx</strong>.
This config file is specified as an argument on the command line:</p>
<div class="highlight-python"><pre>powderx powder.yml</pre>
</div>
<p>An example config file named <tt class="docutils literal"><span class="pre">powder.yml</span></tt> is in the <tt class="docutils literal"><span class="pre">test/test-powder</span></tt>
directory of the source distribution. The powder config file will be
referred to as &#8220;<tt class="docutils literal"><span class="pre">powder.yml</span></tt>&#8221; herein. The provided example file
has comments that briefly describe each parameter. It is suggested just
to copy and modify the example <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file from the
<tt class="docutils literal"><span class="pre">test/test-powder</span></tt> directory of the source distribution because
its format may change slightly between versions of RadialX.</p>
<p>An introduction to the <a class="reference internal" href="#yaml-config-format">yaml config format</a> is given below and provides
everything users need to know about yaml to write a config file
for <strong>powderx</strong>. For the curious, the full yaml specification (version 1.2) can
be found at <a class="reference external" href="http://www.yaml.org/spec/1.2/spec.html">http://www.yaml.org/spec/1.2/spec.html</a>.</p>
<p>The <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file has three sections:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">general</span></tt>: parameters that effect the user experience</li>
<li><tt class="docutils literal"><span class="pre">simulation</span></tt>: parameters for the powder diffraction simulation</li>
<li><tt class="docutils literal"><span class="pre">plot</span></tt>: parameters that modify the appearance of the plot</li>
<li><tt class="docutils literal"><span class="pre">experiment</span></tt>: parameters of the simulated diffraction experiment</li>
</ul>
<p>A detailed discussion of each section follows.</p>
<div class="section" id="general">
<h5>general<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h5>
<p>Parameters in the <tt class="docutils literal"><span class="pre">general</span></tt> section effect the user experience to
a limited extent.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">powderx_version</span></tt>: version number of the <strong>powderx</strong> program;
it is critical for the config file version to match the version
of the <strong>powderx</strong> program</li>
<li><tt class="docutils literal"><span class="pre">verbosity</span></tt>: controls how verbose the output is;
values may be <tt class="docutils literal"><span class="pre">DEBUG</span></tt> (most verbose), <tt class="docutils literal"><span class="pre">INFO</span></tt>, <tt class="docutils literal"><span class="pre">WARNING</span></tt>,
<tt class="docutils literal"><span class="pre">ERROR</span></tt>, or <tt class="docutils literal"><span class="pre">CRITICAL</span></tt> (least verbose)</li>
</ul>
</div>
<div class="section" id="simulation">
<h5>simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h5>
<p>Of the three sections in <tt class="docutils literal"><span class="pre">powder.yml</span></tt>, the <tt class="docutils literal"><span class="pre">simulation</span></tt> section
has the most parameters. Most of these parameters are self-explanatory.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">pdb_name</span></tt>: pdb file from which to make a simulated pattern</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">pattern_name</span></tt>: the simulated pattern is written to a file
of this name; the <a class="reference internal" href="#simulated-pattern-format">simulated pattern format</a> is described below</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">d_max</span></tt>: maximum d-spacing (lowest resolution) for the
simulation, given in Ångstroms.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">d_min</span></tt>: minimum d-spacing (highest resolution) for the
simulation, given in Ångstroms.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">extinction_correction_x</span></tt>: an optional parameter refined during
extinction correction, which is applied to the simulated pattern;
this correction is discussed in the SHELXL 97 manual on page 7-7
(<a class="reference external" href="http://shelx.uni-ac.gwdg.de/SHELX/shelx97.pdf">http://shelx.uni-ac.gwdg.de/SHELX/shelx97.pdf</a>); use <tt class="docutils literal"><span class="pre">null</span></tt>
or <tt class="docutils literal"><span class="pre">0</span></tt> if extinction correction is not desired</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">v</span></tt> &amp; <tt class="docutils literal"><span class="pre">w</span></tt>: for the summation of reflections, the square
of the full-width at half-max (FWHM) of a Lorentzian diffraction
peak is equal to to v + w tan(θ)</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">B</span></tt>: isotropic temperature factor; if the simulated pattern</dt>
<dd><p class="first last">is to be scaled with experimental data, then <tt class="docutils literal"><span class="pre">B</span></tt> should be
set to 0 because it will be refined during scaling</p>
</dd>
</dl>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">apply_Lp</span></tt>: apply <a class="reference external" href="http://reference.iucr.org/dictionary/Lorentz%E2%80%93polarization_correction">Lorentz polarization correction</a>
(<tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt>)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">pattern_shells</span></tt>: number of points in the simulated pattern;
each point represents the integrated intensity of the shell</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">peak_widths</span></tt>: the intensity of a reflection is taken to be
0 beyond this number of FWHM from the center of the Lorentzian
reflection peak</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">combine</span> <span class="pre">_reflections</span></tt>: reflections may be combined by resolution
such that all the reflections within a shell
(specified by <tt class="docutils literal"><span class="pre">pattern_shells</span></tt>) are taken to have the
same center and peak shape (i.e. the same FWHM),
making the calculations significantly faster at
the expense of a small decrease in accuracy;
values for <tt class="docutils literal"><span class="pre">combine_reflections</span></tt> may be <tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt></p>
</li>
</ul>
</div>
<div class="section" id="plot">
<h5>plot<a class="headerlink" href="#plot" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">plot</span></tt> section controls the appearance of the plot.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">window_name</span></tt>: name of the plot window</li>
<li><tt class="docutils literal"><span class="pre">left</span></tt>, <tt class="docutils literal"><span class="pre">right</span></tt>, <tt class="docutils literal"><span class="pre">top</span></tt>, <tt class="docutils literal"><span class="pre">bottom</span></tt>:
margins between plot and page border; note that axes labels
are in the margins</li>
<li><tt class="docutils literal"><span class="pre">plot_points</span></tt>: the data is rebinned simply for the purposes
of the plot; the plot will have <tt class="docutils literal"><span class="pre">plot_points</span></tt> points</li>
<li><tt class="docutils literal"><span class="pre">x_ticks</span></tt>: number of ticks on the x-axis; labeled
by 2θ.</li>
</ul>
</div>
<div class="section" id="experiment">
<h5>experiment<a class="headerlink" href="#experiment" title="Permalink to this headline">¶</a></h5>
<p>A simulated diffraction pattern is the result of a simulated
experiment. The parameters of the <tt class="docutils literal"><span class="pre">experiment</span></tt> section specify
simulated experimental details.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">WAVELENGTH</span></tt>: radiation wavelength</li>
<li><tt class="docutils literal"><span class="pre">DISTANCE</span></tt>: the distance from the sample to the detector</li>
</ul>
<p>Please note that yaml is case-sensitive, so these latter
two parameter names must be in all caps.</p>
</div>
</div>
<div class="section" id="summation">
<h4>Summation<a class="headerlink" href="#summation" title="Permalink to this headline">¶</a></h4>
<p>The simulated powder diffraction pattern is the spherical
summation of diffraction intensity over each resolution shell,
where the number of resolution shells is specified by the <tt class="docutils literal"><span class="pre">patern_shells</span></tt>
setting of the <strong>powderx</strong> config file.
Each shell is summed independently. All shells have approximately the same
width in <span class="math">\(\varrho\)</span>, or <span class="math">\(\sin(\theta)/\lambda\)</span>, where
<span class="math">\(\theta\)</span> is the Bragg angle and <span class="math">\(\lambda\)</span> is
the wavelength.</p>
<p>Given that the structure factor for a Miller index, <span class="math">\(hk\ell\)</span>,
is <span class="math">\(F_{hk\ell}\)</span>, the corresponding intensity
<span class="math">\(I_{hk\ell}\)</span> is</p>
<div class="math" id="equation-intensity">
<span class="eqno">(1)</span>\[I_{hk\ell} =
  \dfrac{M_{hk\ell}}{V^{2}} \cdot
  L_{p} \cdot
  F_{hk\ell} \cdot F_{hk\ell}^{*} \cdot
  \exp \left (
          \dfrac{-2B\sin^{2}\theta}{\lambda^{2}}
       \right )\]</div>
<p><span class="math">\(V\)</span> is the unit cell volume, <span class="math">\(M_{hk\ell}\)</span> is
the multiplicity of the reflection, <span class="math">\(B\)</span> the isotropic
temperature factor, and <span class="math">\(F_{hk\ell}^{*}\)</span> is the
complex conjugate of <span class="math">\(F_{hk\ell}\)</span>.
The term <span class="math">\(L_{p}\)</span> is the <a class="reference external" href="http://reference.iucr.org/dictionary/Lorentz%E2%80%93polarization_correction">Lorentz polarization correction</a>:</p>
<div class="math" id="equation-Lp">
<span class="eqno">(2)</span>\[L_{p} =
  \left [
    \dfrac{1 + \cos^{2}(2\theta)}
           {\sin^{2}\theta \cos\theta}
  \right ]\]</div>
<p>The <a class="reference external" href="http://reference.iucr.org/dictionary/Lorentz%E2%80%93polarization_correction">Lorentz polarization correction</a> may be aplied
to the simulated pattern using the <tt class="docutils literal"><span class="pre">apply_Lp</span></tt> setting
within the <tt class="docutils literal"><span class="pre">simulation</span></tt> section of the <strong>powderx</strong> config file.</p>
<p>If the simulated pattern is to be scaled to
experimental data using the <strong>profilex</strong> utility,
<span class="math">\(B\)</span> should be set to 0 because <span class="math">\(B\)</span> is
refined during scaling. Note that when <span class="math">\(B\)</span>
is set to 0, the expression for diffraction intensity
simplifies to</p>
<div class="math" id="equation-zeroB">
<span class="eqno">(3)</span>\[I_{hk\ell} =
  \dfrac{M_{hk\ell}}{V^{2}} \cdot
  L_{p} \cdot
  F_{hk\ell} \cdot F_{hk\ell}^{*}\]</div>
<p>Diffraction intensities are distributed throughout a profile,
approximated by <strong>powderx</strong> as a <a class="reference external" href="http://en.wikipedia.org/wiki/Cauchy_distribution">Lorentzian distribution</a> (also
called a &#8220;Cauchy distribution&#8221;). This distribution takes the form</p>
<div class="math" id="equation-lorentzian">
<span class="eqno">(4)</span>\[A_{J}^{L} = \dfrac{2}{\pi H_{B}}
   \left [1 + \dfrac{4}{H_{B}^{2}}
              \left ( 2\theta_{i} - 2\theta_{hk\ell} \right )^2
   \right ]^{-1}\]</div>
<p><span class="math">\(A_{J}^{L}\)</span> is the intensity contribution
at angle <span class="math">\(\theta_{i}\)</span>, <span class="math">\(H_{B}\)</span> is the FWHM
of the peak, and <span class="math">\(\theta_{hk\ell}\)</span> is the angle of
diffraction for the Miller index <span class="math">\(hk\ell\)</span>.
For the purposes of the simulation, values of <span class="math">\(\theta_{i}\)</span> are taken
from the middles (in <span class="math">\(\varrho\)</span>) of the shells.</p>
<p>The FWHM, or <span class="math">\(H_{B}\)</span>, can be expressed as a function of the Bragg
angle of the reflection:</p>
<div class="math" id="equation-FWHM">
<span class="eqno">(5)</span>\[H_{B}^{2} = v \tan \theta_{hk\ell} + w\]</div>
<p>The two parameters of this expression, <span class="math">\(v\)</span> and <span class="math">\(w\)</span>,
may be adjusted using the <strong>powderx</strong> config file
settings <tt class="docutils literal"><span class="pre">v</span></tt> and <tt class="docutils literal"><span class="pre">w</span></tt>, respectively.</p>
<p>Because it is computationally expensive to calculate the contribution
of every reflection to every shell, <strong>powderx</strong> allows the user
to limit the calculations to the shells in the neighborhood
of <span class="math">\(\theta_{i}\)</span> using the <tt class="docutils literal"><span class="pre">peak_widths</span></tt> setting. This setting
specifies the width of the neighborhood in multiples of the FWHM.</p>
<div class="section" id="combining-reflections">
<h5>Combining Reflections<a class="headerlink" href="#combining-reflections" title="Permalink to this headline">¶</a></h5>
<p>With a small sacrifice in accuracy, a significant
improvement in the speed of the summation
can be realized by combining reflections by bin before
applying Equation <a href="#equation-lorentzian">(4)</a>. For each bin, intensities
are summed over each Miller index of the bin,
<span class="math">\(hk\ell(\text{bin})\)</span>:</p>
<div class="math" id="equation-sum_bin">
<span class="eqno">(6)</span>\[I_{\text{bin}} = \sum I_{hk\ell(\text{bin})}\]</div>
<p>Each bin intensity <span class="math">\(I_{\text{bin}}\)</span> has a peak center,
<span class="math">\(2\theta_{\text{bin}}\)</span>, at the
middle of the bin as determined
by the taking the mean of the <span class="math">\(2\theta\)</span> angles
of the reflections therein. If <span class="math">\(N_{\text{bin}}\)</span> is
the number of reflections in the bin, the middle of the
bin is given by Equation <a href="#equation-bin_middle">(7)</a>:</p>
<div class="math" id="equation-bin_middle">
<span class="eqno">(7)</span>\[2\theta_{\text{bin}} =
   \dfrac
      {\sum 2\theta_{hk\ell(\text{bin})}}
      {N_{\text{bin}}}\]</div>
<p>When reflections are combined in this manner, Equation <a href="#equation-lorentzian">(4)</a>
becomes</p>
<div class="math" id="equation-combined_lorentzian">
<span class="eqno">(8)</span>\[   A_{J}^{L} = \dfrac{2}{\pi H_{B}}
   \left [1 + \dfrac{4}{H_{B}^{2}}
              \left ( 2\theta_{i} - 2\theta_{\text{bin}} \right )^2
   \right ]^{-1}\]</div>
<p>This approximation can be applied with the <tt class="docutils literal"><span class="pre">combine_reflections</span></tt> setting
of the <strong>powderx</strong> config file.</p>
</div>
</div>
</div>
</div>
<div class="section" id="file-formats">
<h2>File Formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simulated-pattern-format">
<h3>Simulated Pattern Format<a class="headerlink" href="#simulated-pattern-format" title="Permalink to this headline">¶</a></h3>
<p>The simulated integrated diffraction pattern is written to a yaml
formatted file specified by the <tt class="docutils literal"><span class="pre">pattern_name</span></tt> setting
in the <tt class="docutils literal"><span class="pre">simulation</span></tt> section of <tt class="docutils literal"><span class="pre">powder.yml</span></tt>. In yaml terms, the
pattern is stored as a list of [2θ, intensity] pairs keyed by
the word &#8220;<tt class="docutils literal"><span class="pre">pattern</span></tt>&#8221;.
A python program can make a 2-D <a class="reference external" href="http://www.numpy.org/">numpy</a> array from the pattern easily
if <a class="reference external" href="http://www.numpy.org/">numpy</a> (<a class="reference external" href="http://numpy.scipy.org/">http://numpy.scipy.org/</a>) and <a class="reference external" href="http://pyyaml.org/">pyYAML</a> (<a class="reference external" href="http://pyyaml.org/">http://pyyaml.org/</a>)
are installed.  For example, if the pattern is stored in the
file &#8220;<tt class="docutils literal"><span class="pre">pattern.yml</span></tt>&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="n">ary</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;pattern.yml&#39;</span><span class="p">)))[</span><span class="s">&#39;pattern&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The array called &#8220;<tt class="docutils literal"><span class="pre">ary</span></tt>&#8221; is a Nx2 array, with each of the N rows being a
[2θ, intensity] pair.</p>
<p>More generally, the pattern starts on the fourth line of the yaml
file and each data line conforms to the following FORTRAN
formatted read:</p>
<div class="highlight-python"><pre>REAL X, Y
READ '(5X, F10.0, 1X, F10.0)', X, Y</pre>
</div>
<p>The following are the first six lines of a yaml simulated powder diffraction
pattern file:</p>
<div class="highlight-python"><pre>model : "../testdata/stg06-phi06.4-wc-03.8-rc1.0-m4-12.pdb"
pattern :
  # [   2-theta, intensity ]
  - [  5.205029, 0.5671240 ]
  - [  5.285076, 0.5882654 ]
  - [  5.365124, 0.6002413 ]</pre>
</div>
</div>
<div class="section" id="yaml-config-format">
<h3>YAML Config Format<a class="headerlink" href="#yaml-config-format" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file has a simple structure, which can be understood
from the following listing:</p>
<div class="highlight-python"><pre>%YAML 1.2
---
section_1 :
   parameter_a : value_a
   parameter_b : value_b
section_2 :
   parameter_c : value_c</pre>
</div>
<p>Here, the first line is optional and indicates to a yaml parser that
the file conforms to the yaml specification version 1.2. The second
line of three dashes indicates the beginning of a yaml document.
Each section name is on a line by itself and followed by a colon.
Each parameter key-value pair is <em>indented</em> relative to
the section names. All parameter key-value pairs are indented the
same number of spaces.
A colon separates the parameter key from its
associated value.</p>
<p>Note that yaml is case sensitive.</p>
</div>
</div>
<div class="section" id="scaling-patterns">
<h2>Scaling Patterns<a class="headerlink" href="#scaling-patterns" title="Permalink to this headline">¶</a></h2>
<p>Scaling is achieved using the <em>averaging</em> mode of the <strong>profilex</strong>
utility, which is still not officially documented. However,
this functionality is available, so a brief discussion of the
method follows.</p>
<div class="section" id="method-of-scaling">
<h3>Method of Scaling<a class="headerlink" href="#method-of-scaling" title="Permalink to this headline">¶</a></h3>
<p>When scaling, the integrated pattern intensity in the resolution
range of interest (specfied by the <tt class="docutils literal"><span class="pre">roi</span></tt> setting) is partitioned
into the number of bins specified by the setting <tt class="docutils literal"><span class="pre">roi_bins</span></tt>.
Each bin has a center at <span class="math">\(\varrho\)</span>, or
<span class="math">\(\sin(\theta)/\lambda\)</span>, where <span class="math">\(\theta\)</span> is the
Bragg angle. The scaled intensity <span class="math">\(I_{\varrho}^{\circ}\)</span>
for a bin with center <span class="math">\(\varrho\)</span>
is related to the expermental intensity <span class="math">\(I_{\varrho}\)</span>
for that bin by Equation <a href="#equation-scaled_intensity">(9)</a>:</p>
<div class="math" id="equation-scaled_intensity">
<span class="eqno">(9)</span>\[I_{\varrho}^{\circ} =
\alpha \left \{
          I_{\varrho} -
          \left (m\varrho + b \right )
       \right \}
\exp \left \{ -2B\varrho^{2} \right \}\]</div>
<p>The terms <span class="math">\(\alpha\)</span>, <span class="math">\(m\)</span>, <span class="math">\(b\)</span>, and <span class="math">\(B\)</span>
are fit during scaling to the pattern specified by the <tt class="docutils literal"><span class="pre">scaled_to</span></tt>
setting. The parameter <span class="math">\(B\)</span> is the isotropic temperature factor
and <span class="math">\(\alpha\)</span> is the overall scale.</p>
</div>
<div class="section" id="background-correction">
<h3>Background Correction<a class="headerlink" href="#background-correction" title="Permalink to this headline">¶</a></h3>
<p>The parameters <span class="math">\(m\)</span> and <span class="math">\(b\)</span> in
Equation <a href="#equation-scaled_intensity">(9)</a> estimate the contribution
of background scatter, such that the
Equation <a href="#equation-background_corrected">(10)</a> describes the background
correction of experimental intensities
<span class="math">\(I_{\varrho}\)</span>:</p>
<div class="math" id="equation-background_corrected">
<span class="eqno">(10)</span>\[I_{\varrho}^{\circ}
\exp \left \{ 2B\varrho^{2} \right \} \alpha^{-1} =
I_{\varrho} - \left (m\varrho + b \right )\]</div>
<p>Note that the expression <span class="math">\(m\varrho + b\)</span> in
Equation <a href="#equation-background_corrected">(10)</a> describes a straight
line, meaning that the background scatter is coarsely estimated
to require a simple linear correction. This coarseness reduces
the risk of overfitting the background.</p>
<p>Background correction is applied with the <tt class="docutils literal"><span class="pre">background_correction</span></tt>
setting using the the reference pattern specified by <tt class="docutils literal"><span class="pre">scaled_to</span></tt>.
In other words, the background correction is estimated directly from
scaling, which assumes that the reference pattern has no background
(<em>i.e.</em> the reference pattern comes from a model).</p>
<p>Background correction will fail if an attempt is made to
scale more than one pattern to the reference pattern. The reason
can be seen on the left hand side of Equation
<a href="#equation-background_corrected">(10)</a>, which implies that the reference
intensities (analogous to the scaled intensities
<span class="math">\(I_{\varrho}^{\circ}\)</span>) are scaled with <span class="math">\(\alpha\)</span>
and corrected for the isotropic temperature factor <span class="math">\(B\)</span>
to make them comprable to the background-corrected experimental
intensities. Thus, the scaled reference intensities
<span class="math">\(I_{\varrho}^{\prime\circ}\)</span> are
described by Equation <a href="#equation-scaled_reference">(11)</a>:</p>
<div class="math" id="equation-scaled_reference">
<span class="eqno">(11)</span>\[I_{\varrho}^{\prime\circ} =
I_{\varrho}^{\prime}
\exp \left \{ 2B\varrho^{2} \right \} \alpha^{-1}\]</div>
<p>Since scaling produces unique values of these fitting parameters
for each pair of patterns, <strong>profilex</strong> will terminate with
an error if more than one pair is specified for scaling while
background correction is turned on. Scaling more than
two patterns <em>simultaneously</em> to find a common set of scaling
parameters is not yet supported.</p>
<div class="section" id="experimental-considerations-in-background-correction">
<h4>Experimental Considerations in Background Correction<a class="headerlink" href="#experimental-considerations-in-background-correction" title="Permalink to this headline">¶</a></h4>
<p>It should be emphasized that the proper experimental way
to correct for background is to take a background exposure
(<em>i.e.</em> an exposure with no sample but with a holder, etc.)
and subtract the blank from the otherwise equivalent exposure
of a sample. This subtraction can be achieved with the <em>difference</em>
mode of the <strong>profilex</strong> utility.</p>
</div>
</div>
<div class="section" id="goodness-of-fit">
<h3>Goodness of Fit<a class="headerlink" href="#goodness-of-fit" title="Permalink to this headline">¶</a></h3>
<p>The goodness of fit between patterns is measured if
a reference pattern is specified by the <tt class="docutils literal"><span class="pre">scaled_to</span></tt> setting.
The metric for goodness of fit is called <span class="math">\(R_{o}^{2}\)</span>,
which is calculated using Equation <a href="#equation-Ro_squared">(12)</a>.</p>
<div class="math" id="equation-Ro_squared">
<span class="eqno">(12)</span>\[\begin{split}R_{o}^{2} =
  \dfrac{\sum_{\varrho}
           (I_{\varrho}^{\circ} - I_{\varrho}')^{2}}
        {\sum_{\varrho}
           (\left &lt; I' \right &gt; - I_{\varrho}')^{2}}\end{split}\]</div>
<p><span class="math">\(I_{\varrho}'\)</span> is the intensity of the bin
with a middle at <span class="math">\(\varrho\)</span> for
the reference pattern. The term <span class="math">\(\left &lt; I' \right &gt;\)</span>
is the average bin intensity for the reference pattern.</p>
<p>The <span class="math">\(R_{o}^{2}\)</span> metric has been described in
Proc Natl Acad Sci U S A. 2012 May 15;109(20):7717-22.</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">radialx Documentation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#fully-documented-functionalities">Fully Documented Functionalities</a></li>
<li><a class="reference internal" href="#less-documented-functionalities">Less Documented Functionalities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#home-page-repository">Home Page &amp; Repository</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li><a class="reference internal" href="#pip-setuptools">pip &amp; setuptools</a></li>
<li><a class="reference internal" href="#cctbx">CCTBX</a></li>
<li><a class="reference internal" href="#other-dependencies">Other Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#build">Build</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#headerx">headerx</a></li>
<li><a class="reference internal" href="#powderx">powderx</a><ul>
<li><a class="reference internal" href="#the-powderx-config-file">The powderx Config File</a><ul>
<li><a class="reference internal" href="#general">general</a></li>
<li><a class="reference internal" href="#simulation">simulation</a></li>
<li><a class="reference internal" href="#plot">plot</a></li>
<li><a class="reference internal" href="#experiment">experiment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summation">Summation</a><ul>
<li><a class="reference internal" href="#combining-reflections">Combining Reflections</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#file-formats">File Formats</a><ul>
<li><a class="reference internal" href="#simulated-pattern-format">Simulated Pattern Format</a></li>
<li><a class="reference internal" href="#yaml-config-format">YAML Config Format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scaling-patterns">Scaling Patterns</a><ul>
<li><a class="reference internal" href="#method-of-scaling">Method of Scaling</a></li>
<li><a class="reference internal" href="#background-correction">Background Correction</a><ul>
<li><a class="reference internal" href="#experimental-considerations-in-background-correction">Experimental Considerations in Background Correction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#goodness-of-fit">Goodness of Fit</a><ul>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">radialx 0.8.14 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Copyright (c) 2013, James C. Stroud; All rights reserved..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>