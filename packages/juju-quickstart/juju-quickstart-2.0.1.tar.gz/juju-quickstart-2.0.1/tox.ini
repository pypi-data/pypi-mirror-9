# This file is part of the Juju Quickstart Plugin, which lets users set up a
# Juju environment in very few steps (https://launchpad.net/juju-quickstart).
# Copyright (C) 2015 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU Affero General Public License version 3, as published by
# the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

[tox]
# The envlist option must only include platform scenarios. In essence, those
# are used to test Juju Quickstart with the specific dependencies present in
# each supported OS platform.
envlist = pypi,ppa,trusty,utopic,vivid

# Define the base requirements and commands to use when testing the program.

[testenv]
basepython = python2.7
deps =
    mock==1.0.1
    nose==1.3.4
commands =
    nosetests {posargs:--quiet}


# Set up the development environment.

[testenv:devenv]
envdir = devenv
usedevelop = True
deps =
    {[testenv]deps}
    {[testenv:lint]deps}
    coverage==3.7.1
commands =


# Set up different scenarios for each Juju Quickstart source repository.
# Note that the setup.py distribution file calculates Juju Quickstart
# requirements based on this file. For this reason, when updating dependencies,
# respect the following rules:
# - all scenarios must be listed in the envlist above (in the tox section);
# - each scenario must at least include a "{[testenv]deps}" line in its deps;
# - keep each requirement in deps in its own line;
# - always use specific revisions for environments (i.e. use "==").
# After updating this file, run "make requirements" and ensure the general
# dependency rules in the output make sense.

[testenv:pypi]
# Always recreate the virtualenv here so that old installed dependencies are
# not reused and a fresh pip install can be accurately simulated.
recreate = True
deps =
    {[testenv]deps}
    # All the dependencies are installed by Juju Quickstart itself, using
    # the dynamically generated "install_requires" setup field.
    # Note that, since Homebrew internally uses pip when installing Quickstart,
    # this scenario also covers OSX installations.

[testenv:ppa]
deps =
    {[testenv]deps}
    # Dependencies present in ppa:juju/stable.
    # See https://launchpad.net/~juju/+archive/ubuntu/stable.
    websocket-client==0.18.0
    jujuclient==0.50.1
    urwid==1.2.1
    # The distribution PyYAML requirement is used in this case.

[testenv:trusty]
deps =
    {[testenv]deps}
    # Ubuntu 14.04 (trusty) distro dependencies.
    websocket-client==0.12.0
    jujuclient==0.17.5
    PyYAML==3.10
    urwid==1.1.1

[testenv:utopic]
deps =
    {[testenv]deps}
    # Ubuntu 14.10 (utopic) distro dependencies.
    websocket-client==0.12.0
    jujuclient==0.17.5
    PyYAML==3.11
    urwid==1.2.1

[testenv:vivid]
deps =
    {[testenv]deps}
    # Ubuntu 15.04 (vivid) distro dependencies.
    websocket-client==0.18.0
    jujuclient==0.18.5
    PyYAML==3.11
    urwid==1.2.1


# Define additional tox targets to be used to validate and lint the code.

[testenv:lint]
usedevelop = True
deps = flake8==2.3.0
commands = flake8 --ignore E731 --show-source quickstart
