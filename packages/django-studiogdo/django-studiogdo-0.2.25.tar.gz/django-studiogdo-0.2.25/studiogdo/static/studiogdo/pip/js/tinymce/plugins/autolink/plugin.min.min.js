tinymce.PluginManager.add("autolink",function(h){function g(b){j(b,-1,"(",!0)}function l(b){j(b,0,"",!0)}function k(b){j(b,-1,"",!1)}function j(F,E,D){function C(e,d){if(0>d&&(d=0),3==e.nodeType){var f=e.data.length;d>f&&(d=f)}return d}function B(d,c){1!=d.nodeType||d.hasChildNodes()?z.setStart(d,C(d,c)):z.setStartBefore(d)}function A(d,c){1!=d.nodeType||d.hasChildNodes()?z.setEnd(d,C(d,c)):z.setEndAfter(d)}var z,y,x,w,v,u,t,s,r,q;if(z=F.selection.getRng(!0).cloneRange(),z.startOffset<5){if(s=z.endContainer.previousSibling,!s){if(!z.endContainer.firstChild||!z.endContainer.firstChild.nextSibling){return}s=z.endContainer.firstChild.nextSibling}if(r=s.length,B(s,r),A(s,r),z.endOffset<5){return}y=z.endOffset,w=s}else{if(w=z.endContainer,3!=w.nodeType&&w.firstChild){for(;3!=w.nodeType&&w.firstChild;){w=w.firstChild}3==w.nodeType&&(B(w,0),A(w,w.nodeValue.length))}y=1==z.endOffset?2:z.endOffset-1-E}x=y;do{B(w,y>=2?y-2:0),A(w,y>=1?y-1:0),y-=1,q=z.toString()}while(" "!=q&&""!==q&&160!=q.charCodeAt(0)&&y-2>=0&&q!=D);z.toString()==D||160==z.toString().charCodeAt(0)?(B(w,y),A(w,x),y+=1):0===z.startOffset?(B(w,0),A(w,x)):(B(w,y),A(w,x)),u=z.toString(),"."==u.charAt(u.length-1)&&A(w,x-1),u=z.toString(),t=u.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),t&&("www."==t[1]?t[1]="http://www.":/@$/.test(t[1])&&!/^mailto:/.test(t[1])&&(t[1]="mailto:"+t[1]),v=F.selection.getBookmark(),F.selection.setRng(z),F.execCommand("createlink",!1,t[1]+t[2]),F.selection.moveToBookmark(v),F.nodeChanged())}var i;return h.on("keydown",function(a){return 13==a.keyCode?k(h):void 0}),tinymce.Env.ie?void h.on("focus",function(){if(!i){i=!0;try{h.execCommand("AutoUrlDetect",!1,!0)}catch(a){}}}):(h.on("keypress",function(a){return 41==a.keyCode?g(h):void 0}),void h.on("keyup",function(a){return 32==a.keyCode?l(h):void 0}))});