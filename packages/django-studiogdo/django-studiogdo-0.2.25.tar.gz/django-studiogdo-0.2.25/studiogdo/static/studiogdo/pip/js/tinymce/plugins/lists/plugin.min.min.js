tinymce.PluginManager.add("lists",function(h){function g(b){return b&&/^(OL|UL|DL)$/.test(b.nodeName)}function l(b){return b.parentNode.firstChild==b}function k(b){return b.parentNode.lastChild==b}function j(a){return a&&!!h.schema.getTextBlockElements()[a.nodeName]}var i=this;h.on("init",function(){function C(n){function m(p){var s,r,q;r=n[p?"startContainer":"endContainer"],q=n[p?"startOffset":"endOffset"],1==r.nodeType&&(s=E.create("span",{"data-mce-type":"bookmark"}),r.hasChildNodes()?(q=Math.min(q,r.childNodes.length-1),p?r.insertBefore(s,r.childNodes[q]):E.insertAfter(s,r.childNodes[q])):r.appendChild(s),r=s,q=0),o[p?"startContainer":"endContainer"]=r,o[p?"startOffset":"endOffset"]=q}var o={};return m(!0),n.collapsed||m(),o}function B(n){function m(p){function t(v){for(var u=v.parentNode.firstChild,w=0;u;){if(u==v){return w}(1!=u.nodeType||"bookmark"!=u.getAttribute("data-mce-type"))&&w++,u=u.nextSibling}return -1}var s,r,q;s=q=n[p?"startContainer":"endContainer"],r=n[p?"startOffset":"endOffset"],s&&(1==s.nodeType&&(r=t(s),s=s.parentNode,E.remove(q)),n[p?"startContainer":"endContainer"]=s,n[p?"startOffset":"endOffset"]=r)}m(!0),m();var o=E.createRng();o.setStart(n.startContainer,n.startOffset),n.endContainer&&o.setEnd(n.endContainer,n.endOffset),D.setRng(o)}function A(m,t){var s,r,q,p=E.createFragment(),o=h.schema.getBlockElements();if(h.settings.forced_root_block&&(t=t||h.settings.forced_root_block),t&&(r=E.create(t),r.tagName===h.settings.forced_root_block&&E.setAttribs(r,h.settings.forced_root_block_attrs),p.appendChild(r)),m){for(;s=m.firstChild;){var n=s.nodeName;q||"SPAN"==n&&"bookmark"==s.getAttribute("data-mce-type")||(q=!0),o[n]?(p.appendChild(s),r=null):t?(r||(r=E.create(t),p.appendChild(r)),r.appendChild(s)):p.appendChild(s)}}return h.settings.forced_root_block?q||tinymce.Env.ie&&!(tinymce.Env.ie>10)||r.appendChild(E.create("br",{"data-mce-bogus":"1"})):p.appendChild(E.create("br")),p}function z(){return tinymce.grep(D.getSelectedBlocks(),function(m){return/^(LI|DT|DD)$/.test(m.nodeName)})}function y(n,m,r){var q,p,o=E.select('span[data-mce-type="bookmark"]',n);r=r||A(m),q=E.createRng(),q.setStartAfter(m),q.setEndAfter(n),p=q.extractContents(),E.isEmpty(p)||E.insertAfter(p,n),E.insertAfter(r,n),E.isEmpty(m.parentNode)&&(tinymce.each(o,function(s){m.parentNode.parentNode.insertBefore(s,m.parentNode)}),E.remove(m.parentNode)),E.remove(m)}function x(m){var o,n;if(o=m.nextSibling,o&&g(o)&&o.nodeName==m.nodeName){for(;n=o.firstChild;){m.appendChild(n)}E.remove(o)}if(o=m.previousSibling,o&&g(o)&&o.nodeName==m.nodeName){for(;n=o.firstChild;){m.insertBefore(n,m.firstChild)}E.remove(o)}}function f(m){tinymce.each(tinymce.grep(E.select("ol,ul",m)),function(n){var p,o=n.parentNode;"LI"==o.nodeName&&o.firstChild==n&&(p=o.previousSibling,p&&"LI"==p.nodeName&&(p.appendChild(n),E.isEmpty(o)&&E.remove(o))),g(o)&&(p=o.previousSibling,p&&"LI"==p.nodeName&&p.appendChild(n))})}function e(m){function q(r){E.isEmpty(r)&&E.remove(r)}var p,o=m.parentNode,n=o.parentNode;return"DD"==m.nodeName?(E.rename(m,"DT"),!0):l(m)&&k(m)?("LI"==n.nodeName?(E.insertAfter(m,n),q(n),E.remove(o)):g(n)?E.remove(o,!0):(n.insertBefore(A(m),o),E.remove(o)),!0):l(m)?("LI"==n.nodeName?(E.insertAfter(m,n),m.appendChild(o),q(n)):g(n)?n.insertBefore(m,o):(n.insertBefore(A(m),o),E.remove(m)),!0):k(m)?("LI"==n.nodeName?E.insertAfter(m,n):g(n)?E.insertAfter(m,o):(E.insertAfter(A(m),o),E.remove(m)),!0):("LI"==n.nodeName?(o=n,p=A(m,"LI")):p=g(n)?A(m,"LI"):A(m),y(o,m,p),f(o.parentNode),!0)}function d(m){function p(s,r){var q;if(g(s)){for(;q=m.lastChild.firstChild;){r.appendChild(q)}E.remove(s)}}var o,n;return"DT"==m.nodeName?(E.rename(m,"DD"),!0):(o=m.previousSibling,o&&g(o)?(o.appendChild(m),!0):o&&"LI"==o.nodeName&&g(o.lastChild)?(o.lastChild.appendChild(m),p(m.lastChild,o.lastChild),!0):(o=m.nextSibling,o&&g(o)?(o.insertBefore(m,o.firstChild),!0):o&&"LI"==o.nodeName&&g(m.lastChild)?!1:(o=m.previousSibling,o&&"LI"==o.nodeName?(n=E.create(m.parentNode.nodeName),o.appendChild(n),n.appendChild(m),p(m.lastChild,n),!0):!1)))}function c(){var m=z();if(m.length){for(var o=C(D.getRng(!0)),n=0;n<m.length&&(d(m[n])||0!==n);n++){}return B(o),h.nodeChanged(),!0}}function b(){var m=z();if(m.length){var r,q,p=C(D.getRng(!0)),o=h.getBody();for(r=m.length;r--;){for(var n=m[r].parentNode;n&&n!=o;){for(q=m.length;q--;){if(m[q]===n){m.splice(r,1);break}}n=n.parentNode}}for(r=0;r<m.length&&(e(m[r])||0!==r);r++){}return B(p),h.nodeChanged(),!0}}function a(q){function p(){function r(L){var K,M;for(K=o[L?"startContainer":"endContainer"],M=o[L?"startOffset":"endOffset"],1==K.nodeType&&(K=K.childNodes[Math.min(M,K.childNodes.length-1)]||K);K.parentNode!=w;){if(j(K)){return K}if(/^(TD|TH)$/.test(K.parentNode.nodeName)){return K}K=K.parentNode}return K}for(var J,I=[],w=h.getBody(),v=r(!0),u=r(),t=[],s=v;s&&(t.push(s),s!=u);s=s.nextSibling){}return tinymce.each(t,function(L){if(j(L)){return I.push(L),void (J=null)}if(E.isBlock(L)||"BR"==L.nodeName){return"BR"==L.nodeName&&E.remove(L),void (J=null)}var K=L.nextSibling;return tinymce.dom.BookmarkManager.isBookmarkNode(L)&&(j(K)||!K&&L.parentNode==w)?void (J=null):(J||(J=E.create("p"),L.parentNode.insertBefore(J,L),I.push(J)),void J.appendChild(L))}),I}var o=D.getRng(!0),n=C(o),m="LI";q=q.toUpperCase(),"DL"==q&&(m="DT"),tinymce.each(p(),function(r){var t,s;s=r.previousSibling,s&&g(s)&&s.nodeName==q?(t=s,r=E.rename(r,m),s.appendChild(r)):(t=E.create(q),r.parentNode.insertBefore(t,r),t.appendChild(r),r=E.rename(r,m)),x(t)}),B(n)}function H(){var n=C(D.getRng(!0)),m=h.getBody();tinymce.each(z(),function(o){var q,p;if(E.isEmpty(o)){return void e(o)}for(q=o;q&&q!=m;q=q.parentNode){g(q)&&(p=q)}y(p,o)}),B(n)}function G(n){var m=E.getParent(D.getStart(),"OL,UL,DL");if(m){if(m.nodeName==n){H(n)}else{var o=C(D.getRng(!0));x(E.rename(m,n)),B(o)}}else{a(n)}}function F(m){return function(){var n=E.getParent(h.selection.getStart(),"UL,OL,DL");return n&&n.nodeName==m}}var E=h.dom,D=h.selection;i.backspaceDelete=function(s){function r(t,J){var I,w,v=t.startContainer,u=t.startOffset;if(3==v.nodeType&&(J?u<v.data.length:u>0)){return v}for(I=h.schema.getNonEmptyElements(),w=new tinymce.dom.TreeWalker(t.startContainer);v=w[J?"next":"prev"]();){if("LI"==v.nodeName&&!v.hasChildNodes()){return v}if(I[v.nodeName]){return v}if(3==v.nodeType&&v.data.length>0){return v}}}function q(t,I){var w,v,u=t.parentNode;if(g(I.lastChild)&&(v=I.lastChild),w=I.lastChild,w&&"BR"==w.nodeName&&t.hasChildNodes()&&E.remove(w),E.isEmpty(I)&&E.$(I).empty(),!E.isEmpty(t)){for(;w=t.firstChild;){I.appendChild(w)}}v&&I.appendChild(v),E.remove(t),E.isEmpty(u)&&E.remove(u)}if(D.isCollapsed()){var p=E.getParent(D.getStart(),"LI");if(p){var o=D.getRng(!0),n=E.getParent(r(o,s),"LI");if(n&&n!=p){var m=C(o);return s?q(n,p):q(p,n),B(m),!0}if(!n&&!s&&H(p.parentNode.nodeName)){return !0}}}},h.addCommand("Indent",function(){return c()?void 0:!0}),h.addCommand("Outdent",function(){return b()?void 0:!0}),h.addCommand("InsertUnorderedList",function(){G("UL")}),h.addCommand("InsertOrderedList",function(){G("OL")}),h.addCommand("InsertDefinitionList",function(){G("DL")}),h.addQueryStateHandler("InsertUnorderedList",F("UL")),h.addQueryStateHandler("InsertOrderedList",F("OL")),h.addQueryStateHandler("InsertDefinitionList",F("DL")),h.on("keydown",function(m){9!=m.keyCode||tinymce.util.VK.metaKeyPressed(m)||h.dom.getParent(h.selection.getStart(),"LI,DT,DD")&&(m.preventDefault(),m.shiftKey?b():c())})}),h.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var a=this;h.on("nodechange",function(){for(var o=h.selection.getSelectedBlocks(),n=!1,m=0,c=o.length;!n&&c>m;m++){var b=o[m].nodeName;n="LI"==b&&l(o[m])||"UL"==b||"OL"==b||"DD"==b}a.disabled(n)})}}),h.on("keydown",function(b){b.keyCode==tinymce.util.VK.BACKSPACE?i.backspaceDelete()&&b.preventDefault():b.keyCode==tinymce.util.VK.DELETE&&i.backspaceDelete(!0)&&b.preventDefault()})});