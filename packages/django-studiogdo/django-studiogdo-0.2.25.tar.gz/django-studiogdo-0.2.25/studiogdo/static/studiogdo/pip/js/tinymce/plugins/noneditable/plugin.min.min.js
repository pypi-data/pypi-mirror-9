tinymce.PluginManager.add("noneditable",function(x){function w(d){var c;if(1===d.nodeType){if(c=d.getAttribute(n),c&&"inherit"!==c){return c}if(c=d.contentEditable,"inherit"!==c){return c}}return null}function v(b){for(var d;b;){if(d=w(b)){return"false"===d?b:null}b=b.parentNode}}function u(){function C(d){for(;d;){if(d.id===b){return d}d=d.parentNode}}function B(e){var d;if(e){for(d=new p(e,e),e=d.current();e;e=d.next()){if(3===e.nodeType){return e}}}}function A(k,j){var h,g;return"false"===w(k)&&i.isBlock(k)?void c.select(k):(g=i.createRng(),"true"===w(k)&&(k.firstChild||k.appendChild(x.getDoc().createTextNode("\xa0")),k=k.firstChild,j=!0),h=i.create("span",{id:b,"data-mce-bogus":!0},a),j?k.parentNode.insertBefore(h,k):i.insertAfter(h,k),g.setStart(h.firstChild,1),g.collapse(!0),c.setRng(g),h)}function z(e){var d,k,j,h;if(e){d=c.getRng(!0),d.setStartBefore(e),d.setEndBefore(e),k=B(e),k&&k.nodeValue.charAt(0)==a&&(k=k.deleteData(0,1)),i.remove(e,!0),c.setRng(d)}else{for(j=C(c.getStart());(e=i.get(b))&&e!==h;){j!==e&&(k=B(e),k&&k.nodeValue.charAt(0)==a&&(k=k.deleteData(0,1)),i.remove(e,!0)),h=e}}}function y(){function f(j,N){var M,L,K,J,I;if(M=D.startContainer,L=D.startOffset,3==M.nodeType){if(I=M.nodeValue.length,L>0&&I>L||(N?L==I:0===L)){return}}else{if(!(L<M.childNodes.length)){return N?null:j}var H=!N&&L>0?L-1:L;M=M.childNodes[H],M.hasChildNodes()&&(M=M.firstChild)}for(K=new p(M,j);J=K[N?"prev":"next"]();){if(3===J.nodeType&&J.nodeValue.length>0){return}if("true"===w(J)){return J}}return j}var G,F,E,D,g;z(),E=c.isCollapsed(),G=v(c.getStart()),F=v(c.getEnd()),(G||F)&&(D=c.getRng(!0),E?(G=G||F,(g=f(G,!0))?A(g,!0):(g=f(G,!1))?A(g,!1):c.select(G)):(D=c.getRng(!0),G&&D.setStartBefore(G),F&&D.setEndAfter(F),c.setRng(D)))}function l(G){function F(f,e){for(;f=f[e?"previousSibling":"nextSibling"];){if(3!==f.nodeType||f.nodeValue.length>0){return f}}}function E(f,e){c.select(f),c.collapse(e)}function D(R){function Q(f){for(var e=N;e;){if(e===f){return}e=e.parentNode}i.remove(f),y()}function P(){var j,f,e=x.schema.getNonEmptyElements();for(f=new tinymce.dom.TreeWalker(N,x.getBody());(j=R?f.prev():f.next())&&!e[j.nodeName.toLowerCase()]&&!(3===j.nodeType&&tinymce.trim(j.nodeValue).length>0);){if("false"===w(j)){return Q(j),!0}}return v(j)?!0:!1}var O,N,M,S;if(c.isCollapsed()){if(O=c.getRng(!0),N=O.startContainer,M=O.startOffset,N=C(N)||N,S=v(N)){return Q(S),!1}if(3==N.nodeType&&(R?M>0:M<N.nodeValue.length)){return !0}if(1==N.nodeType&&(N=N.childNodes[M]||N),P()){return !1}}return !0}var k,h,g,d,L=G.keyCode;if(g=c.getStart(),d=c.getEnd(),k=v(g)||v(d),k&&(112>L||L>124)&&L!=m.DELETE&&L!=m.BACKSPACE){if((tinymce.isMac?G.metaKey:G.ctrlKey)&&(67==L||88==L||86==L)){return}if(G.preventDefault(),L==m.LEFT||L==m.RIGHT){var K=L==m.LEFT;if(x.dom.isBlock(k)){var J=K?k.previousSibling:k.nextSibling,I=new p(J,J),H=K?I.prev():I.next();E(H,!K)}else{E(k,K)}}}else{if(L==m.LEFT||L==m.RIGHT||L==m.BACKSPACE||L==m.DELETE){if(h=C(g)){if(L==m.LEFT||L==m.BACKSPACE){if(k=F(h,!0),k&&"false"===w(k)){if(G.preventDefault(),L!=m.LEFT){return void i.remove(k)}E(k,!0)}else{z(h)}}if(L==m.RIGHT||L==m.DELETE){if(k=F(h),k&&"false"===w(k)){if(G.preventDefault(),L!=m.RIGHT){return void i.remove(k)}E(k,!1)}else{z(h)}}}if((L==m.BACKSPACE||L==m.DELETE)&&!D(L==m.BACKSPACE)){return G.preventDefault(),!1}}}}var i=x.dom,c=x.selection,b="mce_noneditablecaret",a="\ufeff";x.on("mousedown",function(f){var e=x.selection.getNode();"false"===w(e)&&e==f.target&&y()}),x.on("mouseup keyup",y),x.on("keydown",l)}function t(a){var h=q.length,g=a.content,f=tinymce.trim(r);if("raw"!=a.format){for(;h--;){g=g.replace(q[h],function(d){var i=arguments,e=i[i.length-2];return e>0&&'"'==g.charAt(e-1)?d:'<span class="'+f+'" data-mce-content="'+x.dom.encode(i[0])+'">'+x.dom.encode("string"==typeof i[1]?i[1]:i[0])+"</span>"})}a.content=g}}var s,r,q,p=tinymce.dom.TreeWalker,o="contenteditable",n="data-mce-"+o,m=tinymce.util.VK;s=" "+tinymce.trim(x.getParam("noneditable_editable_class","mceEditable"))+" ",r=" "+tinymce.trim(x.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",q=x.getParam("noneditable_regexp"),q&&!q.length&&(q=[q]),x.on("PreInit",function(){u(),q&&x.on("BeforeSetContent",t),x.parser.addAttributeFilter("class",function(f){for(var e,h,g=f.length;g--;){h=f[g],e=" "+h.attr("class")+" ",-1!==e.indexOf(s)?h.attr(n,"true"):-1!==e.indexOf(r)&&h.attr(n,"false")}}),x.serializer.addAttributeFilter(n,function(e){for(var d,f=e.length;f--;){d=e[f],q&&d.attr("data-mce-content")?(d.name="#text",d.type=3,d.raw=!0,d.value=d.attr("data-mce-content")):(d.attr(o,null),d.attr(n,null))}}),x.parser.addAttributeFilter(o,function(e){for(var d,f=e.length;f--;){d=e[f],d.attr(n,d.attr(o)),d.attr(o,null)}})}),x.on("drop",function(b){v(b.target)&&b.preventDefault()})});