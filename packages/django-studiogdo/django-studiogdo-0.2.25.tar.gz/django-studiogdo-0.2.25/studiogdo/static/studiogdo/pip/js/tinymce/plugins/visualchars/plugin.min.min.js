tinymce.PluginManager.add("visualchars",function(g){function f(r){var q,p,o,n,m,e,d=g.getBody(),a=g.selection;if(i=!i,h.state=i,g.fire("VisualChars",{state:i}),r&&(e=a.getBookmark()),i){for(p=[],tinymce.walk(d,function(b){3==b.nodeType&&b.nodeValue&&-1!=b.nodeValue.indexOf("\xa0")&&p.push(b)},"childNodes"),o=0;o<p.length;o++){for(n=p[o].nodeValue,n=n.replace(/(\u00a0)/g,'<span data-mce-bogus="1" class="mce-nbsp">$1</span>'),m=g.dom.create("div",null,n);q=m.lastChild;){g.dom.insertAfter(q,p[o])}g.dom.remove(p[o])}}else{for(p=g.dom.select("span.mce-nbsp",d),o=p.length-1;o>=0;o--){g.dom.remove(p[o],1)}}a.moveToBookmark(e)}function j(){var a=this;g.on("VisualChars",function(b){a.active(b.state)})}var i,h=this;g.addCommand("mceVisualChars",f),g.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j}),g.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j,selectable:!0,context:"view",prependToContext:!0}),g.on("beforegetcontent",function(b){i&&"raw"!=b.format&&!b.draft&&(i=!0,f(!1))})});