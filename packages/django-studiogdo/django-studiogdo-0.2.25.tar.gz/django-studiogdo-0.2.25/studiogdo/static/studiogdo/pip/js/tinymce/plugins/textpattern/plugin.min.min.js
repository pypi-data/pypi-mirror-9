tinymce.PluginManager.add("textpattern",function(t){function s(){return k&&(l.sort(function(d,c){return d.start.length>c.start.length?-1:d.start.length<c.start.length?1:0}),k=!1),l}function r(b){for(var f=s(),e=0;e<f.length;e++){if(0===b.indexOf(f[e].start)&&(!f[e].end||b.lastIndexOf(f[e].end)==b.length-f[e].end.length)){return f[e]}}}function q(b,v,u){var j,i,h;for(j=s(),h=0;h<j.length;h++){if(i=j[h],i.end&&b.substr(v-i.end.length-u,i.end.length)==i.end){return i}}}function p(D){function C(){y=y.splitText(w),y.splitText(x-w-c),y.deleteData(0,d.start.length),y.deleteData(y.data.length-d.end.length,d.end.length)}var B,A,z,y,x,w,v,u,d,c,a;return B=t.selection,A=t.dom,B.isCollapsed()&&(z=B.getRng(!0),y=z.startContainer,x=z.startOffset,v=y.data,c=D?1:0,3==y.nodeType&&(d=q(v,x,c),d&&(w=Math.max(0,x-c),w=v.lastIndexOf(d.start,w-d.end.length-1),-1!==w&&(u=A.createRng(),u.setStart(y,w),u.setEnd(y,x-c),d=r(u.toString()),d&&d.end&&!(y.data.length<=d.start.length+d.end.length)))))?(a=t.formatter.get(d.format),a&&a[0].inline?(C(),t.formatter.apply(d.format,{},y),y):void 0):void 0}function o(){var C,B,A,z,y,x,w,v,u,c,a;if(C=t.selection,B=t.dom,C.isCollapsed()&&(w=B.getParent(C.getStart(),"p"))){for(u=new tinymce.dom.TreeWalker(w,w);y=u.next();){if(3==y.nodeType){z=y;break}}if(z){if(v=r(z.data),!v){return}if(c=C.getRng(!0),A=c.startContainer,a=c.startOffset,z==A&&(a=Math.max(0,a-v.start.length)),tinymce.trim(z.data).length==v.start.length){return}v.format&&(x=t.formatter.get(v.format),x&&x[0].block&&(z.deleteData(0,v.start.length),t.formatter.apply(v.format,{},z),c.setStart(A,a),c.collapse(!0),C.setRng(c))),v.cmd&&t.undoManager.transact(function(){z.deleteData(0,v.start.length),t.execCommand(v.cmd)})}}}function n(){var a,d;d=p(),d&&(a=t.dom.createRng(),a.setStart(d,d.data.length),a.setEnd(d,d.data.length),t.selection.setRng(a)),o()}function m(){var a,j,i,h,e;a=p(!0),a&&(e=t.dom,j=a.data.slice(-1),/[\u00a0 ]/.test(j)&&(a.deleteData(a.data.length-1,1),i=e.doc.createTextNode(j),a.nextSibling?e.insertAfter(i,a.nextSibling):a.parentNode.appendChild(i),h=e.createRng(),h.setStart(i,1),h.setEnd(i,1),t.selection.setRng(h)))}var l,k=!0;l=t.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],t.on("keydown",function(b){13!=b.keyCode||tinymce.util.VK.modifierPressed(b)||n()},!0),t.on("keyup",function(b){32!=b.keyCode||tinymce.util.VK.modifierPressed(b)||m()}),this.getPatterns=s,this.setPatterns=function(b){l=b,k=!0}});