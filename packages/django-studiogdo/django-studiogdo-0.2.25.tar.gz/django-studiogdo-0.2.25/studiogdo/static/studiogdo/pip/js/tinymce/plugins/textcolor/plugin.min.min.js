tinymce.PluginManager.add("textcolor",function(t){function s(a){var d;return t.dom.getParents(t.selection.getStart(),function(b){var c;(c=b.style["forecolor"==a?"color":"background-color"])&&(d=c)}),d}function r(){var a,f,e=[];for(f=t.settings.textcolor_map||["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],a=0;a<f.length;a+=2){e.push({text:f[a+1],color:"#"+f[a]})}return e}function q(){function A(e,d){var f="transparent"==e;return'<td class="mce-grid-cell'+(f?" mce-colorbtn-trans":"")+'"><div id="'+c+"-"+a+++'" data-mce-color="'+(e?e:"")+'" role="option" tabIndex="-1" style="'+(e?"background-color: "+e:"")+'" title="'+tinymce.translate(d)+'">'+(f?"&#215;":"")+"</div></td>"}var z,y,x,w,v,u,j,i=this,c=i._id,a=0;for(z=r(),z.push({text:tinymce.translate("No color"),color:"transparent"}),x='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',w=z.length-1,u=0;k>u;u++){for(x+="<tr>",v=0;l>v;v++){j=u*l+v,j>w?x+="<td></td>":(y=z[j],x+=A(y.color,y.text))}x+="</tr>"}if(t.settings.color_picker_callback){for(x+='<tr><td colspan="'+l+'" class="mce-custom-color-btn"><div id="'+c+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+c+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",x+="<tr>",v=0;l>v;v++){x+=A("","Custom color")}x+="</tr>"}return x+="</tbody></table>"}function p(a,d){t.focus(),t.formatter.apply(a,{value:d}),t.nodeChanged()}function o(a){t.focus(),t.formatter.remove(a,{value:null},null,!0),t.nodeChanged()}function n(i){function f(c){a.hidePanel(),a.color(c),p(a.settings.format,c)}function e(d,c){d.style.background=c,d.setAttribute("data-mce-color",c)}var b,a=this.parent();if(tinymce.DOM.getParent(i.target,".mce-custom-color-btn")&&(a.hidePanel(),t.settings.color_picker_callback.call(t,function(g){var d,u,j,h=a.panel.getEl().getElementsByTagName("table")[0];for(d=tinymce.map(h.rows[h.rows.length-1].childNodes,function(c){return c.firstChild}),j=0;j<d.length&&(u=d[j],u.getAttribute("data-mce-color"));j++){}if(j==l){for(j=0;l-1>j;j++){e(d[j],d[j+1].getAttribute("data-mce-color"))}}e(u,g),f(g)},s(a.settings.format))),b=i.target.getAttribute("data-mce-color")){if(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),i.target.setAttribute("aria-selected",!0),this.lastId=i.target.id,"transparent"==b){return o(a.settings.format),void a.hidePanel()}f(b)}else{null!==b&&a.hidePanel()}}function m(){var b=this;b._color&&p(b.settings.format,b._color)}var l,k;k=t.settings.textcolor_rows||5,l=t.settings.textcolor_cols||8,t.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{role:"application",ariaRemember:!0,html:q,onclick:n},onclick:m}),t.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{role:"application",ariaRemember:!0,html:q,onclick:n},onclick:m})});