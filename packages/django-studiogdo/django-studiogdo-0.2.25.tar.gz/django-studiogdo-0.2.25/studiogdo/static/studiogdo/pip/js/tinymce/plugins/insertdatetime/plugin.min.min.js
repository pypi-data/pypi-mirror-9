tinymce.PluginManager.add("insertdatetime",function(t){function s(a,f){function e(g,d){if(g=""+g,g.length<d){for(var h=0;h<d-g.length;h++){g="0"+g}}return g}return f=f||new Date,a=a.replace("%D","%m/%d/%Y"),a=a.replace("%r","%I:%M:%S %p"),a=a.replace("%Y",""+f.getFullYear()),a=a.replace("%y",""+f.getYear()),a=a.replace("%m",e(f.getMonth()+1,2)),a=a.replace("%d",e(f.getDate(),2)),a=a.replace("%H",""+e(f.getHours(),2)),a=a.replace("%M",""+e(f.getMinutes(),2)),a=a.replace("%S",""+e(f.getSeconds(),2)),a=a.replace("%I",""+((f.getHours()+11)%12+1)),a=a.replace("%p",""+(f.getHours()<12?"AM":"PM")),a=a.replace("%B",""+t.translate(l[f.getMonth()])),a=a.replace("%b",""+t.translate(m[f.getMonth()])),a=a.replace("%A",""+t.translate(n[f.getDay()])),a=a.replace("%a",""+t.translate(o[f.getDay()])),a=a.replace("%%","%")}function r(h){var g=s(h);if(t.settings.insertdatetime_element){var b;b=s(/%[HMSIp]/.test(h)?"%Y-%m-%dT%H:%M":"%Y-%m-%d"),g='<time datetime="'+b+'">'+g+"</time>";var a=t.dom.getParent(t.selection.getStart(),"time");if(a){return void t.dom.setOuterHTML(a,g)}}t.insertContent(g)}var q,p,o="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),n="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),m="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),l="January February March April May June July August September October November December".split(" "),k=[];t.addCommand("mceInsertDate",function(){r(t.getParam("insertdatetime_dateformat",t.translate("%Y-%m-%d")))}),t.addCommand("mceInsertTime",function(){r(t.getParam("insertdatetime_timeformat",t.translate("%H:%M:%S")))}),t.addButton("insertdatetime",{type:"splitbutton",title:"Insert date/time",onclick:function(){r(q||p)},menu:k}),tinymce.each(t.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(b){p||(p=b),k.push({text:s(b),onclick:function(){q=b,r(b)}})}),t.addMenuItem("insertdatetime",{icon:"date",text:"Insert date/time",menu:k,context:"insert"})});