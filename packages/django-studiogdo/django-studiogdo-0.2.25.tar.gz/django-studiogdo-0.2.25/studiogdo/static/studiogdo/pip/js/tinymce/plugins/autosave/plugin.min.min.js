tinymce._beforeUnloadHandler=function(){var b;return tinymce.each(tinymce.editors,function(a){a.plugins.autosave&&a.plugins.autosave.storeDraft(),!b&&a.isDirty()&&a.getParam("autosave_ask_before_unload",!0)&&(b=a.translate("You have unsaved changes are you sure you want to navigate away?"))}),b},tinymce.PluginManager.add("autosave",function(B){function A(e,d){var f={s:1000,m:60000};return e=/^(\d+)([ms]?)$/.exec(""+(e||d)),(e[2]?f[e[2]]:1)*parseInt(e,10)}function z(){var b=parseInt(o.getItem(r+"time"),10)||0;return(new Date).getTime()-b>p.autosave_retention?(y(!1),!1):!0}function y(a){o.removeItem(r+"draft"),o.removeItem(r+"time"),a!==!1&&B.fire("RemoveDraft")}function x(){!s()&&B.isDirty()&&(o.setItem(r+"draft",B.getContent({format:"raw",no_events:!0})),o.setItem(r+"time",(new Date).getTime()),B.fire("StoreDraft"))}function w(){z()&&(B.setContent(o.getItem(r+"draft"),{format:"raw"}),B.fire("RestoreDraft"))}function v(){q||(setInterval(function(){B.removed||x()},p.autosave_interval),q=!0)}function u(){var a=this;a.disabled(!z()),B.on("StoreDraft RestoreDraft RemoveDraft",function(){a.disabled(!z())}),v()}function t(){B.undoManager.beforeChange(),w(),y(),B.undoManager.add()}function s(a){var d=B.settings.forced_root_block;return a=tinymce.trim("undefined"==typeof a?B.getBody().innerHTML:a),""===a||new RegExp("^<"+d+"[^>]*>((\xa0|&nbsp;|[ 	]|<br[^>]*>)+?|)</"+d+">|<br>$","i").test(a)}var r,q,p=B.settings,o=tinymce.util.LocalStorage;r=p.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",r=r.replace(/\{path\}/g,document.location.pathname),r=r.replace(/\{query\}/g,document.location.search),r=r.replace(/\{id\}/g,B.id),p.autosave_interval=A(p.autosave_interval,"30s"),p.autosave_retention=A(p.autosave_retention,"20m"),B.addButton("restoredraft",{title:"Restore last draft",onclick:t,onPostRender:u}),B.addMenuItem("restoredraft",{text:"Restore last draft",onclick:t,onPostRender:u,context:"file"}),B.settings.autosave_restore_when_empty!==!1&&(B.on("init",function(){z()&&s()&&w()}),B.on("saveContent",function(){y()})),window.onbeforeunload=tinymce._beforeUnloadHandler,this.hasDraft=z,this.storeDraft=x,this.restoreDraft=w,this.removeDraft=y,this.isEmpty=s});