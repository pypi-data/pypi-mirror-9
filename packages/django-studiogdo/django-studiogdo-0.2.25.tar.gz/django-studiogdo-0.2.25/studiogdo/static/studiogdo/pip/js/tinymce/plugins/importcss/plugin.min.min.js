tinymce.PluginManager.add("importcss",function(h){function g(b){return"string"==typeof b?function(a){return -1!==a.indexOf(b)}:b instanceof RegExp?function(a){return b.test(a)}:b}function l(a,p){function o(d,c){var r,q=d.href;if(q&&p(q,c)){i(d.imports,function(b){o(b,!0)});try{r=d.cssRules||d.rules}catch(e){}i(r,function(b){b.styleSheet?o(b.styleSheet,!0):b.selectorText&&i(b.selectorText.split(","),function(s){n.push(tinymce.trim(s))})})}}var n=[],m={};i(h.contentCSS,function(b){m[b]=!0}),p||(p=function(d,c){return c||m[d]});try{i(a.styleSheets,function(b){o(b)})}catch(f){}return n}function k(a){var q,p=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(a);if(p){var o=p[1],n=p[2].substr(1).split(".").join(" "),m=tinymce.makeMap("a,img");return p[1]?(q={title:a},h.schema.getTextBlockElements()[o]?q.block=o:h.schema.getBlockElements()[o]||m[o.toLowerCase()]?q.selector=o:q.inline=o):p[2]&&(q={inline:"span",title:a.substr(1),classes:n}),h.settings.importcss_merge_classes!==!1?q.classes=n:q.attributes={"class":n},q}}var j=this,i=tinymce.each;h.on("renderFormatsMenu",function(n){var f=h.settings,e={},d=f.importcss_selector_converter||k,c=g(f.importcss_selector_filter),b=n.control;h.settings.importcss_append||b.items().remove();var a=[];tinymce.each(f.importcss_groups,function(m){m=tinymce.extend({},m),m.filter=g(m.filter),a.push(m)}),i(l(n.doc||h.getDoc(),g(f.importcss_file_filter)),function(m){if(-1===m.indexOf(".mce-")&&!e[m]&&(!c||c(m))){var s,r=d.call(j,m);if(r){var q=r.name||tinymce.DOM.uniqueId();if(a){for(var p=0;p<a.length;p++){if(!a[p].filter||a[p].filter(m)){a[p].item||(a[p].item={text:a[p].title,menu:[]}),s=a[p].item.menu;break}}}h.formatter.register(q,r);var o=tinymce.extend({},b.settings.itemDefaults,{text:r.title,format:q});s?s.push(o):b.add(o)}e[m]=!0}}),i(a,function(m){b.add(m.item)}),n.control.renderNew()}),j.convertSelectorToFormat=k});