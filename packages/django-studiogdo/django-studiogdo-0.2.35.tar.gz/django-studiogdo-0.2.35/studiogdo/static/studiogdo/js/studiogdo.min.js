(function(){var a,b=function(c,d){return function(){return c.apply(d,arguments)}};a=typeof exports!=="undefined"&&exports!==null?exports:window;if(String.prototype.trim==null){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(String.prototype.startsWith==null){String.prototype.startsWith=function(c){return this.slice(0,c.length)===c}}if(String.prototype.endsWith==null){String.prototype.endsWith=function(c){return this.slice(-c.length)===c}}if(String.prototype.toEuro==null){String.prototype.toEuro=function(c){return(parseInt(this)/100).toFixed(2)}}if(String.prototype.toCent==null){String.prototype.toCent=function(c){return parseInt(c)*100}}a.Command=function(e,f,d){this.bocall=new BOCall(e);this.menu=f||null;this.pochoir=d||null;this.steps=new Array();this.currentStepIndex=0;var c=this;this.done=function(){alert("command done")};this.setStep=function(g,h){this.steps[g]=h};this.getStep=function(g){return this.steps[g]};this.setCurrentStep=function(g){currentStepIndex=g;while(this.pochoir.firstChild){this.pochoir.removeChild(this.pochoir.firstChild)}this.pochoir.appendChild(this.getStep(g));var j=this;for(var h=0;h<g;h++){this.menu[h].className="previous_step";this.menu[h].addEventListener("click",function(){var i=h;j.setCurrentStep(i)})}this.menu[g].className="current_step";for(var h=g+1;h<this.menu.length;h++){this.menu[h].className="next_step"}};this.start=function(h,i,g){this.bocall.done=function(){c.path=c.bocall.commandPath;c.res=JSON.parse(c.bocall.responseText);c.done()};this.bocall.applyCommand(h,i,g)};this.callNextStep=function(g){this.bocall.done=function(){c.res=JSON.parse(c.bocall.responseText);c.done()};this.bocall.applyCommand(this.path,"NextStep",g)}};a.convertCentEuro=function(d,c){d=parseFloat(d);if(c){return d/100}return parseInt(d*100)};a.EditableNumber=function(e,d,g){if(!d){d="0,0.00 $"}if(!g){g=function(n,i){parseFloat(n)}}var c=document.querySelectorAll(e);for(var h=0;h<c.length;h++){var j=c[h];j.style.display="none";var l=document.createElement("input");var m=document.createElement("span");var k=document.createAttribute("type");k.value="text";l.setAttributeNode(k);l.style.display="none";var f=g(j.value,true);if(typeof(numeral)!="undefined"){m.innerText=numeralFormat(f,d)}else{m.innerText=f}j.parentNode.insertBefore(m,j.nextSibling);j.parentNode.insertBefore(l,j.nextSibling);m.addEventListener("dblclick",function(i){m=i.currentTarget;l=m.previousElementSibling;if(typeof(numeral)!="undefined"){l.value=numeralUnformat(m.innerText,d)}else{l.value=m.innerText}l.style.display="block";this.style.display="none";if(window.jQuery){$(l).trigger("focus")}});l.addEventListener("change",function(i){j=i.currentTarget.previousElementSibling;j.value=g(this.value,false)});l.addEventListener("blur",function(i){l=i.currentTarget;m=l.nextElementSibling;j=l.previousElementSibling;if(typeof(numeral)!="undefined"){m.innerText=numeralFormat(l.value,d)}else{m.innerText=l.value}j.value=g(this.value,false);m.style.display="block";this.style.display="none"})}};a.Datagrid=function(d){var c=this;this.table=d;this.editableNumber=function(e,g,f){new EditableNumber(e,g,f)};this.setToEuro=function(h,f){var k=c.table.querySelectorAll(h);for(var g=0;g<k.length;g++){var j=k[g].querySelector("span");var e=k[g].querySelector("input");centToEuro(j,e);centToEuro(j,j);if(f){c.editForm=null;function l(i){if(c.editForm!=null){return}var n=event.target;var p=n.parentNode;var o=p.querySelector("div");var m=p.querySelector("input");c.editForm=new DatagridEditForm(n,o);c.editForm.firstFocus();c.editForm.cancel=function(q){c.editForm=null};c.editForm.commit=function(){c.editForm=null;var q=new FormData(o);var r=f.clone();r.done=function(){toEuro(n,m);toEuro(n,n)};r.postEmpty(path,q)}}j.addEventListener("dblclick",l,false)}}};this.addDeleteButtons=function(k,e){k=k||"Voulez-vous réellement faire cette action?";e=e||"tbody tr > td:last-child";var j=this.table.querySelectorAll(e);for(var g=0;g<j.length;g++){var l=j[g];var f=document.createElement("BUTTON");f.setAttribute("style","float: right;");f.innerHTML='<img alt="Détruire" title="Détruire" src="/shared/css/images/btn_del.png"/>';l.appendChild(f);f.addEventListener("click",h,true)}function h(i){if(i){i.stopImmediatePropagation();i.preventDefault()}var n=confirm("Confirmation : "+k);if(n){var m=i.currentTarget;var o=getParentByTagName(m,"TR");c.doDelete(o,i)}}};this.doDelete=function(f,e){alert("delete button clicked")}};a.DatagridEditForm=function(d,e){var c=this;this.span=d;this.div=e;this.editionMode=true;this.inputs=e.querySelectorAll("input");this.selects=e.querySelectorAll("select");addClassName(this.span,"hidden");removeClassName(this.div,"hidden");this.commit=function(){alert("edition committing to be done")};this.cancel=function(){};this.commitChanges=function(f){if(!c.editionMode){return}if(f){f.preventDefault()}c.close();c.editionMode=false;if(c.changed()){c.commit()}else{c.cancel()}};this.changed=function(){for(var k=0;k<this.inputs.length;k++){var h=this.inputs[k];if(h.type=="checkbox"){return true}else{var j=h.value;var g=h.getAttribute("value");if(j!=g){return true}}}for(var k=0;k<this.selects.length;k++){var f=this.selects[k];var j=f.value;var g=f.getAttribute("value");if(j!=g){return true}}return false};this.addEventListenerOnInputs=function(){for(var h=0;h<c.inputs.length;h++){var g=this.inputs[h];if(g.type=="checkbox"){g.addEventListener("click",c.commitChanges);g.addEventListener("blur",c.close)}else{g.addEventListener("blur",c.commitChanges);g.addEventListener("keydown",c.enter)}}for(var h=0;h<c.selects.length;h++){var f=this.selects[h];f.addEventListener("change",c.commitChanges)}c.div.addEventListener("submit",c.commitChanges)};this.removeEventListenerOnInputs=function(){for(var g=0;g<c.inputs.length;g++){var f=this.inputs[g];if(f.type=="checkbox"){f.removeEventListener("click",c.commitChanges);f.removeEventListener("blur",c.close)}else{f.removeEventListener("blur",c.commitChanges);f.removeEventListener("keydown",c.enter)}}c.div.removeEventListener("submit",c.commitChanges)};this.enter=function(f){if(f.keyCode==27){f.target.blur()}};this.firstFocus=function(){var f=e.querySelector("input");if(f&&f.type!="checkbox"){f.focus();f.select()}};this.close=function(){c.removeEventListenerOnInputs();removeClassName(c.span,"hidden");addClassName(c.div,"hidden")};this.addEventListenerOnInputs()};a.isPathAbsolute=function(c){return c&&c.charAt(0)==="/"};a.getLastNamePath=function(d){var c;c=d.lastIndexOf("/");if(c>=0){return d.substring(c+1)}return d};a.getPathName=function(d){var c;c=d.lastIndexOf("/");if(c===0){return"/"}if(c>0){return d.substring(0,c)}return""};a.composePath=function(){var f,e,d,c;e="";for(d=0,c=arguments.length;d<c;d++){f=arguments[d];if(f){if(e.length===0){e=f}else{if(isPathAbsolute(f)){e=f}else{if(f==="."){continue}if(f.substring(0,2)==="./"){f=f.substring(2)}else{if(e.charAt(e.length-1)==="/"){e+=f}else{e+="/"+f}}}}}}return e};a.getParentByTagName=function(d,c,f){var e;e=f?d:d.parentNode;while((e!=null)&&e.tagName!==c){e=e.parentNode}if(e!=null){return e}return false};a.nextSiblingByTagName=function(d,c){var e=d.nextSibling;while(e){if(e.tagName===c){return e}e=e.nextSibling}return false};a.insertFirst=function(e,c){var d=c.chilNodes;if(d&&d.length>0){c.insertBefore(e,c.children[0])}else{c.appendChild(e)}};a.insertAfter=function(d,c){return c.parentNode.insertBefore(d,c.nextSibling)};a.hasClassName=function(e,d){var c=new RegExp("(?:^|\\s+)"+d+"(?:\\s+|$)");return c.test(e.className)};a.addClassName=function(d,c){if(!hasClassName(d,c)){d.className=[d.className,c].join(" ")}};a.removeClassName=function(f,e){if(hasClassName(f,e)){var c=new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)","g");var d=f.className;f.className=d.replace(c," ")}};a.htmlCheckboxSubmitOnlyOnPatch=function(c){if(!c.target.checked){nextSiblingByTagName(c.target,"INPUT").setAttribute("checked","checked")}};a.centToEuro=function(e,c){var d;d=e.tagName.toLowerCase()==="input"?e.value:e.innerHTML;d=(parseInt(d)/100).toFixed(2);d=d.replace(".",",")+" €";if(c.tagName.toLowerCase()==="input"){return c.value=d}else{return c.innerHTML=d}};a.euroToCent=function(e,c){var d;d=e.tagName.toLowerCase()==="input"?e.value:e.innerHTML;d=stripNonNumeric(d.replace(",","."))*100;d=d.toFixed(0);if(c==null){return d}if(c.tagName.toLowerCase()==="input"){return c.value=d}else{return c.innerHTML=d}};a.toEuro=function(e,c){var d=(e.tagName.toLowerCase()=="input")?e.value:e.innerHTML;d=parseInt(d).toFixed(2);d=d.replace(".",",")+" €";if(c.tagName.toLowerCase()=="input"){c.value=d}else{c.innerHTML=d}};a.doubleToLocale=function(e,c){var d=(e.tagName.toLowerCase()=="input")?e.value:e.innerHTML;d=d.replace(".",",");if(c.tagName.toLowerCase()=="input"){c.value=d}else{c.innerHTML=d}};a.localeToDouble=function(e,c){var d=(e.tagName.toLowerCase()=="input")?e.value:e.innerHTML;d=stripNonNumeric(d.replace(",","."));if(c.tagName.toLowerCase()=="input"){c.value=d}else{c.innerHTML=d}};a.numberFormat=function(d){d+="";d=stripNonNumeric(d);x=d.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var c=/(\d+)(\d{3})/;while(c.test(x1)){x1=x1.replace(c,"$1 $2")}return x1+x2};a.stripNonNumeric=function(g,c){g+="";var e=/^\d|\.|-$/;if(c==","){e=/^\d|,|-$/}var d="";for(var f=0;f<g.length;f++){if(e.test(g.charAt(f))){if(!((g.charAt(f)=="."&&d.indexOf(".")!=-1)||(g.charAt(f)=="-"&&d.length!=0))){d+=g.charAt(f)}}}return d};a.setInputUnit=function(c,e){if(c.getAttribute("type").toLowerCase()!="text"){return}c.addEventListener("focus",f);c.addEventListener("blur",g);addClassName(c,"setInputUnit");var d=getParentByTagName(c,"FORM");if(d&&!hasClassName(d,"setInputUnit")){addClassName(d,"setInputUnit");d.addEventListener("submit",function(k){console.log("test2");var h=k.currentTarget.querySelectorAll(".setInputUnit");for(var j=0;j<h.length;j++){f(h[j])}})}function g(){c.value=numberFormat(c.value)+e}function f(){c.value=stripNonNumeric(c.value)}g()};a.extractUrlParams=function(){var e=location.search.substring(1).split("&");var g=new Array();for(var d=0;d<e.length;d++){var c=e[d].split("=");g[c[0]]=c[1]}return g};a.BOCall=(function(){var e,d;c.rootAddress="";c.loginAddress="login.html";c.options={};c.options.async=true;c.options.acceptNoStencil=false;c.options.backToLoginOnError=false;c.counter=0;function c(g){this.setProp=b(this.setProp,this);this.afterSent=b(this.afterSent,this);this.beforeSend=b(this.beforeSend,this);this.abort=b(this.abort,this);this.cancel=b(this.cancel,this);this.checkStatus=b(this.checkStatus,this);this.defaultReadyStateChangeHandler=b(this.defaultReadyStateChangeHandler,this);this.appendBOParam=b(this.appendBOParam,this);this.send=b(this.send,this);this.applyCommand=b(this.applyCommand,this);this._postFacet=b(this._postFacet,this);this.postFacets=b(this.postFacets,this);this.postFacet=b(this.postFacet,this);this.postProp=b(this.postProp,this);this.postEmpty=b(this.postEmpty,this);this.disconnect=b(this.disconnect,this);this.login=b(this.login,this);this.simpleGet=b(this.simpleGet,this);this.addScripts=b(this.addScripts,this);this.disconnected=b(this.disconnected,this);this.error=b(this.error,this);this.done=b(this.done,this);this.clone=b(this.clone,this);var h,i,f;this.options={};for(h in c.options){this.options[h]=c.options[h]}for(h in g){this.options[h]=g[h]}this.xhr=new XMLHttpRequest();this.xhr.onreadystatechange=this.defaultReadyStateChangeHandler;this.rootAddress=(i=this.options.rootAddress)!=null?i:c.rootAddress;if(this.rootAddress.slice(-1)==="/"){this.rootAddress=this.rootAddress.slice(0,-1)}this.loginAddress=(f=this.options.loginAddress)!=null?f:c.loginAddress}c.prototype.clone=function(){return new c(this.rootAddress)};c.prototype.done=function(){return alert("bocall done")};c.prototype.error=function(f){if(f!=null){return alert("Erreur:\n"+f)}};c.prototype.disconnected=function(){alert("Vous avez été déconnecté.");return document.location.href=this.loginAddress};c.prototype.addScripts=function(h){var j,k,n,l,f,i,m,g;g=[];for(i=0,m=h.length;i<m;i++){l=h[i];f=l.src;if(f.length>0){k=document.getElementsByTagName("HEAD").item(0);n=document.createElement("script");n.language="javascript";n.type="text/javascript";n.defer=true;n.src=f;k.appendChild(n)}j=l.text;if(j.length>0){k=document.getElementsByTagName("HEAD").item(0);n=document.createElement("script");n.language="javascript";n.type="text/javascript";n.defer=true;n.text=decodeURI(j);g.push(k.appendChild(n))}else{g.push(void 0)}}return g};c.prototype.simpleGet=function(f){return this.send("GET",f)};c.prototype.login=function(h,g){var f;f=(function(i){return function(){var j,k;if(i.xhr.readyState===4){i.afterSent();if(i.xhr.status===200){return i.done(i.xhr.responseText)}else{if(i.xhr.status===201||i.xhr.status===403){j=i.rootAddress+("/j_security_check?j_username="+h+"&j_password="+g);k=new XMLHttpRequest();k.onreadystatechange=function(){if(k.readyState===4){if(k.status===200){return i.done(k.responseText)}else{if(k.status===503){return i.error("Service temporairement indisponible ou en maintenance.")}else{return i.error("connexion invalide")}}}};k.open("POST",j,true);return k.send()}else{if(i.xhr.status===503){return i.error("Service temporairement indisponible ou en maintenance.")}else{return i.error("connexion invalide")}}}}}})(this);this.xhr.onreadystatechange=f;return this.send("POST",this.rootAddress+("/login.gdo?j_username="+h+"&j_password="+g))};c.prototype.disconnect=function(){this.xhr.onreadystatechange=(function(f){return function(g){return f.defaultReadyStateChangeHandler(g,f.disconnected)}})(this);return this.send("POST",this.rootAddress+"/disconnect.gdo")};c.prototype.postEmpty=function(g,f){this.formData=f!=null?f:f;if(g!=null){this.appendBOParam("ap",g)}return this.send("POST",this.rootAddress+"/empty.gdo")};c.prototype.postProp=function(g,f){this.formData=f!=null?f:f;if(g!=null){this.appendBOParam("ap",g)}return this.send("POST",this.rootAddress+"/prop.gdo")};c.prototype.postFacet=function(h,g,i,f){return this._postFacet(h,g,i,f,false)};c.prototype.postFacets=function(h,g,i,f){return this._postFacet(h,g,i,f,true)};c.prototype._postFacet=function(j,i,k,h,g){var f;if(g==null){g=false}if((i==null)||(k==null)){alert("paramètres incorrects pour postFacet");return}f=!g?"/facet.gdo":"/facets.gdo";this.formData=h!=null?h:h;if(j!=null){this.appendBOParam("ap",j)}this.appendBOParam("m",i);this.appendBOParam("f",k);return this.send("POST",this.rootAddress+f)};c.prototype.applyCommand=function(g,h,f){if(h==null){alert("paramètres incorrects pour applyCommand");return}this.xhr.onreadystatechange=(function(i){return function(k){var l,j;if(i.xhr.readyState===4){i.afterSent();if(i.checkStatus()){i.responseText=i.xhr.responseText;if(i.responseText===""){return i.error("la commande a retourné une string vide")}else{try{j=JSON.parse(i.responseText);if(j.result<2){i.commandPath=j.infos[1];i.done(j)}if(j.result===2){return i.error(j.infos)}}catch(m){l=m;return i.error(i.responseText)}}}}}})(this);this.formData=f!=null?f:f;if(g!=null){this.appendBOParam("ap",g)}this.appendBOParam("c",h);return this.send("POST",this.rootAddress+"/apply.gdo")};c.prototype.send=function(j,f){var h,i,g;this.beforeSend();c.counter++;this.appendBOParam("acceptNoStencil",this.options.acceptNoStencil);if(this.options.saveProject!=null){this.appendBOParam("s",this.options.saveProject)}if(j==="GET"||window.ActiveXObject){for(i in this.data){if(f.indexOf("?")===-1){f+="?"+encodeURIComponent(i)+"="+encodeURIComponent(this.data[i])}else{f+="&"+encodeURIComponent(i)+"="+encodeURIComponent(this.data[i])}}}else{if(j==="POST"){h=(g=this.formData)!=null?g:new FormData();for(i in this.data){h.append(i,this.data[i])}}}this.xhr.open(j,f,this.options.async);return this.xhr.send(h||null)};c.prototype.appendBOParam=function(g,f){if(this.data==null){this.data={}}return this.data[g]=f};c.prototype.defaultReadyStateChangeHandler=function(f,g){if(this.xhr.readyState===4){this.afterSent();if(this.checkStatus()){this.responseText=this.xhr.responseText;if(g!=null){return g()}else{return this.done()}}else{return this.error(this.xhr.responseText)}}};c.prototype.checkStatus=function(){if(this.xhr.status>200){if(this.xhr.status===201){this.disconnected()}else{if(this.xhr.status===204){return true}else{if(this.xhr.status===401){this.error("Vous n'êtes pas autorisé à accéder à ce service.")}else{if(this.xhr.status===412){return false}else{if(this.xhr.status===418){this.error("Erreur 418 : "+this.xhr.responseText)}else{if(this.xhr.status===500){$("body").html("Erreur 500 : "+this.xhr.responseText)}else{if(this.xhr.status===501){this.error("Fonctionnalité réclamée non supportée par le serveur.")}else{if(this.xhr.status===502){this.error("Mauvaise réponse envoyée à un serveur intermédiaire par un autre serveur.")}else{if(this.xhr.status===503){this.error("Service temporairement indisponible ou en maintenance.")}else{if(this.xhr.status===504){this.error("Temps d’attente d’une réponse d’un serveur à un serveur intermédiaire écoulé.")}else{this.error("Erreur internet: "+this.xhr.status+"\n"+this.xhr.responseText)}}}}}}}}}}if(this.options.backToLoginOnError){this.disconnected()}return false}return true};c.prototype.cancel=function(){return this.abort()};c.prototype.abort=function(){this.xhr.abort();return this.afterSent()};c.prototype.beforeSend=function(){return $("#wait").show()};c.prototype.afterSent=function(){if(c.counter>0){c.counter--}if(c.counter===0){return $("#wait").hide()}};d=function(f){c.xhr.onreadystatechange=c.defaultReadyStateChangeHandler;if(f!=null){c.appendBOParam("ap",f)}return c.send("GET",c.rootAddress+"/stencils.gdo")};e=function(f){c.xhr.onreadystatechange=c.defaultReadyStateChangeHandler;if(f!=null){c.appendBOParam("ap",f)}return c.send("GET",c.rootAddress+"/prop.gdo")};c.prototype.setProp=function(g,f){this.xhr.onreadystatechange=this.defaultReadyStateChangeHandler;if(g!=null){this.appendBOParam("ap",g)}this.appendBOParam("v",f);return this.send("POST",this.rootAddress+"/set.gdo")};return c})()}).call(this);