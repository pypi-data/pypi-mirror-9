(function(){var b=function(d,e){return function(){return d.apply(e,arguments)}},a={}.hasOwnProperty,c=function(g,e){for(var d in e){if(a.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g};define(["studiogdo/skeleton","list/listFilter","list/listCellForm","list/listSelectionForm"],function(g,d,f,e){var h;return h=(function(k){var j,i;c(l,k);function l(p,o,r,n,m,q){this.list=p;this.selected=o;this.list_skel=r;this.selected_skel=n;this.CellForm=m;this.SelectionForm=q;this.deleteCallback=b(this.deleteCallback,this);this.addDeleteButtons=b(this.addDeleteButtons,this);this.selectLine=b(this.selectLine,this);this.fnSettings=b(this.fnSettings,this);this.inlineEditSelectedCallback=b(this.inlineEditSelectedCallback,this);this.commitSelectedList=b(this.commitSelectedList,this);this.commitSelected=b(this.commitSelected,this);this.closeSelected=b(this.closeSelected,this);this.drawSelectedCallback=b(this.drawSelectedCallback,this);this.drawSelectedBOCallback=b(this.drawSelectedBOCallback,this);this.drawSelectedBOCall=b(this.drawSelectedBOCall,this);this.drawSelected=b(this.drawSelected,this);this.showSelected=b(this.showSelected,this);this.hideSelected=b(this.hideSelected,this);this.__drawListCallback=b(this.__drawListCallback,this);this.drawListCallback=b(this.drawListCallback,this);this.drawListBOCallback=b(this.drawListBOCallback,this);this.drawList=b(this.drawList,this);this.showList=b(this.showList,this);this.hideList=b(this.hideList,this);this.mode="django";this.path=null;this.selectedPath=null;this.bDataTable=true;this.sSelectionClass="selected";this.sSelectionEvent="click";this.sEditionEvent="dblclick";this.jCellForm=null;this.jSelectionForm=null}l.prototype.hideList=function(){if(this.list==null){return}$(this.list).hide().addClass("hidden");if(this.filter!=null){if(this.filter instanceof d){return this.filter.hideFilter()}else{return $(this.filter).hide()}}};l.prototype.showList=function(){if(this.list==null){return}$(this.list).removeClass("hidden").show();if(this.filter!=null){if(this.filter instanceof d){return this.filter.showFilter()}else{return $(this.filter).show()}}};l.prototype.drawList=function(n,p,o){var m;if(n!=null){if(this.path==null){this.path=n}}if(n==null){n=this.path}this.hideList();if(this.list_skel==null){this.drawListBOCallback();return}m=new BOCall;m.done=(function(q){return function(){q.drawListBOCallback(m);return typeof o==="function"?o():void 0}})(this);return m.postFacet(n,this.list_skel,this.mode,p)};l.prototype.drawListBOCallback=function(m){if(m!=null){$(this.list).html(m.responseText);this.drawListCallback()}return $(this.selected).empty()};l.prototype.drawListCallback=function(){var m;if(this.bDataTable){m=$("table",this.list);if(m.length===0){m=$("table",this.list.parentNode)}return m.dataTable(this.fnSettings())}else{return this.__drawListCallback()}};l.prototype.__drawListCallback=function(A){var K,G,E,z,F,B,r,D,T,w,u,s,p,N,R,P,M,L,J,I,H,n,S,Q,O,C,y,x,v,t,q,o,m;this.hideList();if(this.list.querySelector("#nbaff span")!=null){E=this.list.querySelector("#nbaff span").innerHTML}if(this.list.querySelector("#nbsel span")!=null){z=this.list.querySelector("#nbsel span").innerHTML}if(E!==z){D=this.list.querySelector("#table_limit_warn");if(D!=null){D.innerHTML="Attention, la limite d’affichage a été atteinte ("+E+" lignes maximum)"}}C=$("tbody tr, tfoot tr",this.list);for(w=0,N=C.length;w<N;w++){r=C[w];if(!(!$(r).hasClass("initialized"))){continue}if((this.sSelectionEvent!=null)&&(this.selected_skel!=null)){$(r).on(this.sSelectionEvent,(function(U){return function(V){V.preventDefault();return U.drawSelected(null,$(V.delegateTarget).closest("tr"))}})(this))}if(this.sEditionEvent!=null){y=$("td.editable",r);for(u=0,R=y.length;u<R;u++){B=y[u];$(B).one(this.sEditionEvent,this.inlineEditSelectedCallback)}}x=$("td.euro span, td span.euro",r);for(s=0,P=x.length;s<P;s++){F=x[s];T=$(F).text();$(F).text(numeral(T).format("0,0$"))}v=$("td.cent span, td span.cent",r);for(p=0,M=v.length;p<M;p++){F=v[p];T=$(F).text()/100;$(F).text(numeral(T).format("0,0.00$"))}t=$("td.date span, td span.date",r);for(n=0,L=t.length;n<L;n++){F=t[n];K=moment($(F).text());if(K.isValid()){moment($(F).text()).lang();$(F).text(K.format("L"))}}q=$("td.time span, td span.time",r);for(S=0,J=q.length;S<J;S++){F=q[S];K=moment($(F).text(),["HH:mm","HH:mm:ss","hh:mm","hh:mm:ss"]);if(K.isValid()){$(F).text(K.format("LT"))}}o=$("td.datetime span, td span.datetime",r);for(Q=0,I=o.length;Q<I;Q++){F=o[Q];K=moment($(F).text());if(K.isValid()){$(F).text(K.format("LLL"))}}m=$("td.boolean span",r);for(O=0,H=m.length;O<H;O++){F=m[O];$(F).hide();G=$("<i></i>").appendTo($(F).parent());T=$(F).text();if(T==="true"){G.addClass("icon-ok")}else{G.addClass("icon-plus-sign")}}$(r).addClass("initialized")}return this.showList()};l.prototype.hideSelected=function(){return $(this.selected).hide().addClass("hidden")};l.prototype.showSelected=function(){return $(this.selected).removeClass("hidden").show()};l.prototype.drawSelected=function(n,m,p){var o;this.hideSelected();if(this.jSelectionForm==null){if(this.SelectionForm!=null){this.jSelectionForm=new this.SelectionForm(this)}else{this.jSelectionForm=new e(this)}}if(m==null){m=$("tr."+this.sSelectionClass,this.list)}if(m.length>0){o=m.data("apath");this.selectLine(m)}else{o=this.jSelectionForm.path}if(o==null){return}this.selectedPath=o;return this.drawSelectedBOCall(n,p)};l.prototype.drawSelectedBOCall=function(o,p){var n,m;n=new BOCall;m=n.error;n.error=(function(q){return function(r){q.showSelected();return typeof m==="function"?m(r):void 0}})(this);n.done=(function(q){return function(){q.drawSelectedBOCallback(n);return typeof p==="function"?p():void 0}})(this);return n.postFacet(this.selectedPath,this.jSelectionForm.skel,this.mode,o)};l.prototype.drawSelectedBOCallback=function(m){if(this.selected==null){alert("No selection holder defined for the list");return}this.hideSelected();$(this.selected).html(m.responseText);if(this.jSelectionForm!=null){this.jSelectionForm.showSelectedCallback(this.selected)}return this.drawSelectedCallback()};l.prototype.drawSelectedCallback=function(){return this.showSelected()};l.prototype.closeSelected=function(){this.jSelectionForm=null;return $(this.selected).empty()};l.prototype.commitSelected=function(o,n){var m;m=new FormData(this.selected.querySelector("form"));return this.drawSelected(m)};l.prototype.commitSelectedList=function(q,p){var o,m,n;o=new FormData(this.selected.querySelector("form"));for(m in q){n=q[m];o.append(m,n)}return this.drawList(this.path,o,(function(r){return function(){if(typeof p==="function"){p()}return r.closeSelected()}})(this))};l.prototype.inlineEditSelectedCallback=function(m){var o,n,q,p;q=m.currentTarget;$(q).one(this.sEditionEvent,this.inlineEditSelectedCallback);n=q.querySelector("span");if(n==null){return}o=q.querySelector("form");if(o==null){return}if(n.innerText===""){o.classList.remove("hidden")}if((p=this.jCellForm)!=null){p.close()}if(this.CellForm!=null){return this.jCellForm=new this.CellForm(this,n,o)}else{this.jCellForm=new f(this,n,o);this.jCellForm.firstFocus();return this.jCellForm.commit=(function(r){return function(s,u){var t;t=new FormData(o);r.drawList(r.path,t);return r.jCellForm=null}})(this)}};l.prototype.fnSettings=function(){return{aaSorting:[],aLengthMenu:[[10,25,100,500,-1],[10,25,100,500,"Tous"]],bStateSave:true,bLengthChange:true,iDisplayLength:10,fnDrawCallback:this.__drawListCallback,sDom:"Tlfrtip<'clear'>",sPaginationType:"full_numbers",oLanguage:{sLengthMenu:"Afficher _MENU_ lignes par page",sZeroRecords:"Pas trouvé..",sInfo:"Affichage de _START_ à _END_ sur _TOTAL_ lignes",sInfoEmpty:"Affichage de 0 à 0 sur 0 lignes",sInfoFiltered:"(filtrage sur _MAX_ lignes)",sSearch:"Rechercher",oPaginate:{sFirst:"&nbsp;&nbsp;&nbsp;",sLast:"&nbsp;&nbsp;&nbsp;",sNext:"&nbsp;&nbsp;&nbsp;",sPrevious:"&nbsp;&nbsp;&nbsp;"}}}};l.prototype.selectLine=function(n){var q,p,m,o;if(this.sSelectionClass!=null){o=$("tr",this.list);for(p=0,m=o.length;p<m;p++){q=o[p];$(q).removeClass(this.sSelectionClass)}return $(n).addClass(this.sSelectionClass)}};l.prototype.addDeleteButtons=function(m,r){var t,s,n,p,u,q,o;if(m==null){m="Voulez-vous réellement faire cette action?"}if(r==null){r="tbody tr > td:last-child"}t=(function(v){return function(w){var x;w.stopImmediatePropagation();w.preventDefault();if(confirm("Confirmation : "+m)){x=$(w.delegateTarget).closest("tr");return v.deleteCallback(x.data("apath"))}}})(this);q=this.list.querySelectorAll(r);o=[];for(p=0,u=q.length;p<u;p++){n=q[p];if(!(!(n.classList.contains("dataTables_empty")||n.classList.contains("delete_button")))){continue}s=$('<span alt="Détruire" title="Détruire" class="glyphicon glyphicon-trash small"/>').appendTo(n);s.css("float","right");$(n).addClass("delete_button");o.push(s.on("click",t))}return o};l.prototype.deleteCallback=function(n){var m;m=new BOCall;m.done=(function(o){return function(){return o.drawList()}})(this);return m.applyCommand(n,"Unplug")};j=(function(n){c(m,n);function m(){this.commit=b(this.commit,this);m.__super__.constructor.apply(this,arguments);this.firstFocus()}m.prototype.commit=function(o,r){var q,p,s;r.editForm=null;s=getParentByTagName(o.target,"TD",true);if(!s.classList.contains("boolean")){m.__super__.commit.apply(this,arguments);return}q=new BOCall;q.done=(function(t){return function(){return t.value.innerHTML=q.responseText}})(this);p=o.target.tagName==="INPUT"?o.target:o.target.querySelector("INPUT");q.appendBOParam("i_"+s.dataset.apath,p.value);return q.postProp(s.dataset.apath)};return m})(f);i=(function(n){c(m,n);function m(){this.commit=b(this.commit,this);m.__super__.constructor.apply(this,arguments);this.firstFocus()}m.prototype.commit=function(o,r){var q,p,s;r.editForm=null;s=getParentByTagName(o.target,"TD",true);if(!s.classList.contains("cent")){m.__super__.commit.apply(this,arguments);return}q=new BOCall;q.done=(function(t){return function(){return t.value.innerHTML=q.responseText}})(this);p=o.target.tagName==="INPUT"?o.target:o.target.querySelector("INPUT");q.appendBOParam("i_"+s.dataset.apath,p.value);return q.postProp(s.dataset.apath)};return m})(f);return l})(g)})}).call(this);