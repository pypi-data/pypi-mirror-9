{% extends "sanza/_bs_section.html" %}
{% load i18n pagination_tags favorite_tags %}

{% block section_title %}
  {% trans "Newsletters" %}
{% endblock %}
  
{% block section_data %}
  
  {% if newsletters %}
  {% autopaginate newsletters 10 %}
  <table class="table table-striped">
    <tr>
      <th>{% trans "Newsletter" %}</th><th>{% trans "Sending" %}</th>
    </tr>
  {% for nl in newsletters %}
    <tr>
      <td>
        {{nl.subject}}
        {% if nl.can_edit_newsletter %}
          <a href="{% url "coop_cms_edit_newsletter" nl.id %}">{% trans "Edit" %}</a>
        {% endif %}
          <a href="{% url "coop_cms_view_newsletter" nl.id %}">{% trans "View" %}</a>
      </td>
      <td>
        {% if nl.emailing_set.count %}
          <table>
          {% for e in nl.emailing_set.all %}
            <tr><td>
              {% favorite_item object=e %}{{e.get_info}} ({{e.get_contacts|length}} {% trans "recipients" %})
              <a href="{% url "emailing_view" e.id %}">{% trans "View" %}</a>
            </td></tr>
          {% endfor %}
          </table>
        {% else %}
          &nbsp;
        {% endif %}
      </td>
      
  </tr>
  {% endfor %}
  </table>
  {% paginate %}
  {% else %}
    {% trans "No newsletters" %}
  {% endif %}
{% endblock %}

{% block section_buttons %}
  <li><a class="colorbox-form" href="{% url "emailing_new_newsletter" %}">{% trans "Add Newsletter" %}</a></li>
  <li><a href="{% url "search" %}">{% trans "Add Sending" %}</a></li>
{% endblock %}
