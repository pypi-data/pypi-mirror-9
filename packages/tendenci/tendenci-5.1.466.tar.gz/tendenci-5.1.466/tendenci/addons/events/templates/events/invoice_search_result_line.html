{% load base_filters %}
{% load invoice_tags %}
{% load i18n %}

<table width="100%">
    {% invoices_search_line_header request invoice '#ff6600' %}

    {# display event registration #}
    <tr>
        <td>{% trans "RegID" %}</td>
        <td>{% trans "Reg" %}</td>
        <td>{% trans "Title" %}</td>
        <td>{% trans "Date" %}</td>
        <td>{% trans "Price" %}</td>
        <td>{% trans "Balance" %}</td>
    </tr>
    {% if obj %}
      <tr>
        {% if obj.event.pk %}
         <td><a href="{% url event.registration_confirmation obj.event.pk obj.pk %}">{{obj.pk}}</a></td>
         <td>{% spaceless %}
         {% with obj.registrant_set.all as registrants %}
         {% if registrants %}
            {% for reg in registrants %}
                {% if reg.get_name %}
                    {{ reg.get_name }}
                {% else %}
                    {% if reg.user %}
                        {{ reg.user.username }}
                    {% else %}
                        {% trans "Guest #" %}{{ forloop.counter0 }}
                    {% endif %}
                {% endif %}
                {% if not forloop.last %}, {% endif %}
            {% endfor %}
         {% else %}
            {{ obj.owner.username }}
         {% endif %}
         {% endwith %}
         {% endspaceless %}</td>
         <td><a href="{% url event obj.event.pk %}">{% blocktrans with title=obj.event.title|truncatewords:5 %}{{ title }}{% endblocktrans %}</a></td>
         {% endif %}
         <td>{{obj.event.start_dt|date:'long'}}</td>
         <td>{{obj.amount_paid|format_currency}}</td>
         <td><div {% if invoice.balance > 0 %}class="body-copy-yellow"{% endif %}>{{invoice.balance|format_currency}}</div></td>
     </tr>
     {% endif %}
  </table>