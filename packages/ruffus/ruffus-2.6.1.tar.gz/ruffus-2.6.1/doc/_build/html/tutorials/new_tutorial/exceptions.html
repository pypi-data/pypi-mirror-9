<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Ruffus is a Computation Pipeline library for python. It is open-sourced, powerful and user-friendly, and widely used in science and bioinformatics" name="description" />
<meta content="python, pipeline, computation, cluster, Ruffus, bioinformatics, parallel' name='keywords" name="keywords" />
<meta content="Leo Goodstadt" name="Author" />
<meta content="Leo Goodstadt" name="Publisher" />
<meta content="ruffus&#64;llew.org.uk" name="Email" />
<meta content="index, follow" name="robots" />
<meta content="en-uk" name="language" />
<meta content="United Kingdom" name="country" />
<meta content="Leo Goodstadt 2009-2014" name="copyright" />

    <title>Appendix 3: Exceptions thrown inside pipelines &mdash; ruffus 2.6 documentation</title>
    
    <link rel="stylesheet" href="../../_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6 documentation" href="../../index.html" />
    <link rel="next" title="Appendix 4: Names exported from Ruffus" href="list_of_ruffus_names.html" />
    <link rel="prev" title="Appendix 2: How dependency is checked" href="dependencies.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="list_of_ruffus_names.html" title="Appendix 4: Names exported from Ruffus"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dependencies.html" title="Appendix 2: How dependency is checked"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="new-manual-exceptions-chapter-num-exceptions-thrown-inside-pipelines">
<span id="new-manual-exceptions"></span><span id="index-0"></span><h1><strong>Appendix 3</strong>: Exceptions thrown inside pipelines<a class="headerlink" href="#new-manual-exceptions-chapter-num-exceptions-thrown-inside-pipelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The goal for <em>Ruffus</em> is that exceptions should just work <em>out-of-the-box</em> without any fuss.
This is especially important for exceptions that come from your code which may be raised
in a different process. Often multiple parallel operations (jobs or tasks) fail at the
same time. <em>Ruffus</em> will forward each of these exceptions with the tracebacks so you
can jump straight to the offending line.</p>
<p>This example shows separate exceptions from two jobs running in parallel:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@originate</span><span class="p">([</span><span class="s">&quot;a.start&quot;</span><span class="p">,</span> <span class="s">&quot;b.start&quot;</span><span class="p">,</span> <span class="s">&quot;c.start&quot;</span><span class="p">,</span> <span class="s">&quot;d.start&quot;</span><span class="p">,</span> <span class="s">&quot;e.start&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">throw_exceptions_here</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;OOPS&quot;</span><span class="p">)</span>

<span class="n">pipeline_run</span><span class="p">(</span><span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go">    &gt;&gt;&gt; pipeline_run(multiprocess = 2)</span>

<span class="go">    ruffus.ruffus_exceptions.RethrownJobError:</span>

<span class="hll"><span class="go">    Original exceptions:</span>
</span>
<span class="go">        Exception #1</span>
<span class="go">          &#39;exceptions.Exception(OOPS)&#39; raised in ...</span>
<span class="go">           Task = def throw_exceptions_here(...):</span>
<span class="go">           Job  = [None -&gt; b.start]</span>

<span class="go">        Traceback (most recent call last):</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 685, in run_pooled_job_without_exceptions</span>
<span class="go">            return_value =  job_wrapper(param, user_defined_work_func, register_cleanup, touch_files_only)</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 549, in job_wrapper_output_files</span>
<span class="go">            job_wrapper_io_files(param, user_defined_work_func, register_cleanup, touch_files_only, output_files_only = True)</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 504, in job_wrapper_io_files</span>
<span class="go">            ret_val = user_defined_work_func(*(param[1:]))</span>
<span class="go">          File &quot;&lt;stdin&gt;&quot;, line 3, in throw_exceptions_here</span>
<span class="go">        Exception: OOPS</span>
<span class="hll">
</span>
<span class="go">        Exception #2</span>
<span class="go">          &#39;exceptions.Exception(OOPS)&#39; raised in ...</span>
<span class="go">           Task = def throw_exceptions_here(...):</span>
<span class="go">           Job  = [None -&gt; a.start]</span>

<span class="go">        Traceback (most recent call last):</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 685, in run_pooled_job_without_exceptions</span>
<span class="go">            return_value =  job_wrapper(param, user_defined_work_func, register_cleanup, touch_files_only)</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 549, in job_wrapper_output_files</span>
<span class="go">            job_wrapper_io_files(param, user_defined_work_func, register_cleanup, touch_files_only, output_files_only = True)</span>
<span class="go">          File &quot;/usr/local/lib/python2.7/dist-packages/ruffus/task.py&quot;, line 504, in job_wrapper_io_files</span>
<span class="go">            ret_val = user_defined_work_func(*(param[1:]))</span>
<span class="go">          File &quot;&lt;stdin&gt;&quot;, line 3, in throw_exceptions_here</span>
<span class="go">        Exception: OOPS</span>


<span class="go">.. image:: ../../images/manual_exceptions.png</span>
</pre></div>
</div>
</div></blockquote>
<span class="target" id="new-manual-exceptions-multiple-errors"></span></div>
<div class="section" id="pipelines-running-in-parallel-accumulate-exceptions">
<span id="index-1"></span><h2>Pipelines running in parallel accumulate Exceptions<a class="headerlink" href="#pipelines-running-in-parallel-accumulate-exceptions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>As show above, by default <em>Ruffus</em> accumulates <tt class="docutils literal"><span class="pre">NN</span></tt> exceptions before interrupting the pipeline prematurely where
<tt class="docutils literal"><span class="pre">NN</span></tt> is the specified parallelism for <a class="reference internal" href="../../pipeline_functions.html#pipeline-functions-pipeline-run"><em>pipeline_run(multiprocess = NN)</em></a></p>
<p>This seems a fair tradeoff between being able to gather detailed error information for
running jobs, and not wasting too much time for a task that is going to fail anyway.</p>
</div></blockquote>
</div>
<div class="section" id="terminate-pipeline-immediately-upon-exceptions">
<h2>Terminate pipeline immediately upon Exceptions<a class="headerlink" href="#terminate-pipeline-immediately-upon-exceptions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="set-pipeline-run-exceptions-terminate-immediately-true">
<h3>Set <a class="reference internal" href="../../pipeline_functions.html#pipeline-functions-pipeline-run"><em>pipeline_run(exceptions_terminate_immediately = True)</em></a><a class="headerlink" href="#set-pipeline-run-exceptions-terminate-immediately-true" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>To have all exceptions interrupt the pipeline immediately, invoke:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">pipeline_run</span><span class="p">(</span><span class="n">exceptions_terminate_immediately</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>For example, with this change, only a single exception will be thrown before the pipeline is interrupted:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@originate</span><span class="p">([</span><span class="s">&quot;a.start&quot;</span><span class="p">,</span> <span class="s">&quot;b.start&quot;</span><span class="p">,</span> <span class="s">&quot;c.start&quot;</span><span class="p">,</span> <span class="s">&quot;d.start&quot;</span><span class="p">,</span> <span class="s">&quot;e.start&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">throw_exceptions_here</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;OOPS&quot;</span><span class="p">)</span>

<span class="n">pipeline_run</span><span class="p">(</span><span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">exceptions_terminate_immediately</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go">    &gt;&gt;&gt; pipeline_run(multiprocess = 2)</span>

<span class="go">    ruffus.ruffus_exceptions.RethrownJobError:</span>

<span class="hll"><span class="go">    Original exception:</span>
</span>
<span class="go">        Exception #1</span>
<span class="go">          &#39;exceptions.Exception(OOPS)&#39; raised in ...</span>
<span class="go">           Task = def throw_exceptions_here(...):</span>
<span class="go">           Job  = [None -&gt; a.start]</span>

<span class="go">        Traceback (most recent call last):</span>
<span class="go">          [Tedious traceback snipped out!!!....]</span>
<span class="go">        Exception: OOPS</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="raise-ruffus-jobsignalledbreak">
<h3>raise <tt class="docutils literal"><span class="pre">Ruffus.JobSignalledBreak</span></tt><a class="headerlink" href="#raise-ruffus-jobsignalledbreak" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The same can be accomplished on a finer scale by throwing the <tt class="docutils literal"><span class="pre">Ruffus.JobSignalledBreak</span></tt> Exception. Unlike
other exceptions, this causes an immediate halt in pipeline execution. If there are other exceptions in play at that
point, they will be rethrown in the main process but no new exceptions will be added.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@originate</span><span class="p">([</span><span class="s">&quot;a.start&quot;</span><span class="p">,</span> <span class="s">&quot;b.start&quot;</span><span class="p">,</span> <span class="s">&quot;c.start&quot;</span><span class="p">,</span> <span class="s">&quot;d.start&quot;</span><span class="p">,</span> <span class="s">&quot;e.start&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">throw_exceptions_here</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">JobSignalledBreak</span><span class="p">(</span><span class="s">&quot;OOPS&quot;</span><span class="p">)</span>

<span class="n">pipeline_run</span><span class="p">(</span><span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="display-exceptions-as-they-occur">
<h2>Display exceptions as they occur<a class="headerlink" href="#display-exceptions-as-they-occur" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In the following example, the jobs throw exceptions
at two second staggered intervals into the job. With <tt class="docutils literal"><span class="pre">log_exceptions</span> <span class="pre">=</span> <span class="pre">True</span></tt>, the
exceptions are displayed as they occur even though the pipeline continues running.</p>
<p>logger.error(...) will be invoked with the string representation of the each exception, and associated stack trace.</p>
<p>The default logger prints to sys.stderr, but as usual can be changed to any class from the logging module or compatible object via
<a class="reference internal" href="../../pipeline_functions.html#pipeline-functions-pipeline-run"><em>pipeline_run(logger = XXX)</em></a></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>

<span class="nd">@originate</span><span class="p">([</span><span class="s">&quot;1.start&quot;</span><span class="p">,</span> <span class="s">&quot;2.start&quot;</span><span class="p">,</span> <span class="s">&quot;3.start&quot;</span><span class="p">,</span> <span class="s">&quot;4.start&quot;</span><span class="p">,</span> <span class="s">&quot;5.start&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">throw_exceptions_here</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">JobSignalledBreak</span><span class="p">(</span><span class="s">&quot;OOPS&quot;</span><span class="p">)</span>

<span class="n">pipeline_run</span><span class="p">(</span><span class="n">log_exceptions</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><strong>Appendix 3</strong>: Exceptions thrown inside pipelines</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#pipelines-running-in-parallel-accumulate-exceptions">Pipelines running in parallel accumulate Exceptions</a></li>
<li><a class="reference internal" href="#terminate-pipeline-immediately-upon-exceptions">Terminate pipeline immediately upon Exceptions</a><ul>
<li><a class="reference internal" href="#set-pipeline-run-exceptions-terminate-immediately-true">Set <tt class="docutils literal"><span class="pre">pipeline_run(exceptions_terminate_immediately</span> <span class="pre">=</span> <span class="pre">True)</span></tt></a></li>
<li><a class="reference internal" href="#raise-ruffus-jobsignalledbreak">raise <tt class="docutils literal"><span class="pre">Ruffus.JobSignalledBreak</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#display-exceptions-as-they-occur">Display exceptions as they occur</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dependencies.html"
                        title="previous chapter"><strong>Appendix 2</strong>: How dependency is checked</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="list_of_ruffus_names.html"
                        title="next chapter"><strong>Appendix 4</strong>: Names exported from Ruffus</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/new_tutorial/exceptions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="../../decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="../../decorators/originate.html">@originate</a>                           </li>
            <li><a href="../../decorators/split.html">@split</a>                                   </li>
            <li><a href="../../decorators/transform.html">@transform</a>                           </li>
            <li><a href="../../decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="../../decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="../../decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="../../decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="../../decorators/collate.html">@collate</a>                               </li>
            <li><a href="../../decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="../../decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="../../decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="../../decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="../../decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="../../decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="../../decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="../../decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="../../decorators/product.html">@product </a>                              </li>
            <li><a href="../../decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="../../decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="../../decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="../../decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="../../decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="../../decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="../../decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="../../decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="../../drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="../../todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="list_of_ruffus_names.html" title="Appendix 4: Names exported from Ruffus"
             >next</a> |</li>
        <li class="right" >
          <a href="dependencies.html" title="Appendix 2: How dependency is checked"
             >previous</a> |</li>
        Ruffus v. 2.6
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>