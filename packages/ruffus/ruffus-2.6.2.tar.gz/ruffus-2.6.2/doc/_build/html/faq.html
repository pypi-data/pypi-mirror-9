<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Ruffus is a Computation Pipeline library for python. It is open-sourced, powerful and user-friendly, and widely used in science and bioinformatics" name="description" />
<meta content="python, pipeline, computation, cluster, Ruffus, bioinformatics, parallel' name='keywords" name="keywords" />
<meta content="Leo Goodstadt" name="Author" />
<meta content="Leo Goodstadt" name="Publisher" />
<meta content="ruffus&#64;llew.org.uk" name="Email" />
<meta content="index, follow" name="robots" />
<meta content="en-uk" name="language" />
<meta content="United Kingdom" name="country" />
<meta content="Leo Goodstadt 2009-2014" name="copyright" />

    <title>FAQ &mdash; ruffus 2.6.2 documentation</title>
    
    <link rel="stylesheet" href="_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6.2 documentation" href="index.html" />
    <link rel="next" title="Glossary" href="glossary.html" />
    <link rel="prev" title="Implementation Tips" href="implementation_notes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="implementation_notes.html" title="Implementation Tips"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="index.html">Home</a> | </li>
            <li><a href="contents.html">Contents</a> | </li>
            <li><a href="installation.html">Install</a>  | </li>
            <li><a href="tutorials/new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="tutorials/new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="#">FAQ</a>  | </li>
            <li><a href="cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="tutorials/new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="gallery.html">Gallery</a> |  </li>
            <li><a href="tutorials/new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="faq">
<h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q-how-should-ruffus-be-cited-in-academic-publications">
<h3>Q. How should <em>Ruffus</em> be cited in academic publications?<a class="headerlink" href="#q-how-should-ruffus-be-cited-in-academic-publications" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The official publication describing the original version of <em>Ruffus</em> is:</p>
<blockquote>
<div><a class="reference external" href="http://bioinformatics.oxfordjournals.org/content/early/2010/09/16/bioinformatics.btq524">Leo Goodstadt (2010)</a> : <strong>Ruffus: a lightweight Python library for computational pipelines.</strong> <em>Bioinformatics</em> 26(21): 2778-2779</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="good-practices">
<h2>Good practices<a class="headerlink" href="#good-practices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q-what-is-the-best-way-of-keeping-my-data-and-workings-separate">
<h3>Q. What is the best way of keeping my data and workings separate?<a class="headerlink" href="#q-what-is-the-best-way-of-keeping-my-data-and-workings-separate" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>It is good practice to run your pipeline in a temporary, &#8220;working&#8221; directory away from your original data.</p>
<p>The first step of your pipeline might be to make softlinks to your original data in your working directory.
This is example (relatively paranoid) code to do just this:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">re_symlink</span> <span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">soft_link_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logging_mutex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="hll"><span class="sd">        Helper function: relinks soft symbolic link if necessary</span>
</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="hll">        <span class="c"># Guard agains soft linking to oneself: Disastrous consequences of deleting the original files!!</span>
</span>        <span class="k">if</span> <span class="n">input_file</span> <span class="o">==</span> <span class="n">soft_link_name</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Warning: No symbolic link made. You are using the original data directory as the working directory.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c"># Soft link already exists: delete for relink?</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lexists</span><span class="p">(</span><span class="n">soft_link_name</span><span class="p">):</span>
            <span class="c"># do not delete or overwrite real (non-soft link) file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">soft_link_name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> exists and is not a link&quot;</span> <span class="o">%</span> <span class="n">soft_link_name</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">soft_link_name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">logging_mutex</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Can&#39;t unlink </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">soft_link_name</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">logging_mutex</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;os.symlink(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">soft_link_name</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c">#   symbolic link relative to original directory so that the entire path</span>
        <span class="c">#       can be moved around with breaking everything</span>
        <span class="c">#</span>
        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">input_file</span><span class="p">),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">soft_link_name</span><span class="p">))),</span> <span class="n">soft_link_name</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#   First task should soft link data to working directory</span>
    <span class="c">#</span>
    <span class="nd">@jobs_limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nd">@mkdir</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span>
    <span class="nd">@transform</span><span class="p">(</span> <span class="n">input_files</span><span class="p">,</span>
                <span class="n">formatter</span><span class="p">(),</span>
                <span class="c"># move to working directory</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span> <span class="s">&quot;{basename[0]}{ext[0]}&quot;</span><span class="p">),</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">logging_mutex</span>
               <span class="p">)</span>
    <span class="k">def</span> <span class="nf">soft_link_inputs_to_working_directory</span> <span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">soft_link_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logging_mutex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make soft link in working directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">logging_mutex</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Linking files </span><span class="si">%(input_file)s</span><span class="s"> -&gt; </span><span class="si">%(soft_link_name)s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span>
        <span class="n">re_symlink</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">soft_link_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logging_mutex</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="q-what-is-the-best-way-of-handling-data-in-file-pairs-or-triplets-etc">
<span id="faq-paired-files"></span><h3>Q. What is the best way of handling data in file pairs (or triplets etc.)<a class="headerlink" href="#q-what-is-the-best-way-of-handling-data-in-file-pairs-or-triplets-etc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>In Bioinformatics, DNA data often consists of only the nucleotide sequence at the two ends of larger fragments.
The <a class="reference external" href="http://www.illumina.com/technology/next-generation-sequencing/paired-end-sequencing_assay.ilmn">paired_end</a> or
<a class="reference external" href="http://en.wikipedia.org/wiki/Shotgun_sequencing#Whole_genome_shotgun_sequencing">mate pair</a> data frequently
consists of of file pairs with conveniently related names such as &#8220;<em>.R1.fastq&#8221; and &#8220;</em>.R2.fastq&#8221;.</p>
<p>At some point in data pipeline, these file pairs or triplets must find each other and be analysed in the same job.</p>
<p>Provided these file pairs or triplets are named consistently, an easiest way to regroup them is to use the
Ruffus <a class="reference internal" href="tutorials/new_tutorial/subdivide_collate.html#new-manual-collate"><em>&#64;collate</em></a> decorator. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@collate</span><span class="p">(</span><span class="n">original_data_files</span><span class="p">,</span>

            <span class="c"># match file name up to the &quot;R1.fastq.gz&quot;</span>
            <span class="n">formatter</span><span class="p">(</span><span class="s">&quot;([^/]+)R[12].fastq.gz$&quot;</span><span class="p">),</span>

            <span class="c"># Create output parameter supplied to next task</span>
            <span class="s">&quot;{path[0]}/{1[0]}.sam&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_paired_end</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">output_paired_files</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span><span class="p">):</span>
    <span class="c"># check that we really have a pair of two files not an orphaned singleton</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;One of read pairs </span><span class="si">%s</span><span class="s"> missing&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input_files</span><span class="p">,))</span>

    <span class="c"># do stuff here</span>
</pre></div>
</div>
<p>This (incomplete, untested) <a class="reference internal" href="examples/paired_end_data.py.html#faq-paired-files-code"><em>example code</em></a> shows what this would look like <em>in vivo</em>.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q-ruffus-won-t-create-dependency-graphs">
<h3>Q. <em>Ruffus</em> won&#8217;t create dependency graphs<a class="headerlink" href="#q-ruffus-won-t-create-dependency-graphs" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. You need to have installed <tt class="docutils literal"><span class="pre">dot</span></tt> from <a class="reference external" href="http://www.graphviz.org/">Graphviz</a> to produce
pretty flowcharts likes this:</p>
<blockquote>
<div><img alt="_images/pretty_flowchart.png" src="_images/pretty_flowchart.png" />
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="q-ruffus-seems-to-be-hanging-in-the-same-place">
<h3>Q. <em>Ruffus</em> seems to be hanging in the same place<a class="headerlink" href="#q-ruffus-seems-to-be-hanging-in-the-same-place" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. If <em>ruffus</em> is interrupted, for example, by a Ctrl-C,
you will often find the following lines of code highlighted:</p>
<div class="highlight-python"><div class="highlight"><pre>File &quot;build/bdist.linux-x86_64/egg/ruffus/task.py&quot;, line 1904, in pipeline_run
File &quot;build/bdist.linux-x86_64/egg/ruffus/task.py&quot;, line 1380, in run_all_jobs_in_task
File &quot;/xxxx/python2.6/multiprocessing/pool.py&quot;, line 507, in next
  self._cond.wait(timeout)
File &quot;/xxxxx/python2.6/threading.py&quot;, line 237, in wait
  waiter.acquire()
</pre></div>
</div>
<p>This is <em>not</em> where <em>ruffus</em> is hanging but the boundary between the main programme process
and the sub-processes which run <em>ruffus</em> jobs in parallel.</p>
<p>This is naturally where broken execution threads get washed up onto.</p>
</div></blockquote>
</div>
<div class="section" id="q-regular-expression-substitutions-don-t-work">
<h3>Q. Regular expression substitutions don&#8217;t work<a class="headerlink" href="#q-regular-expression-substitutions-don-t-work" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. If you are using the special regular expression forms <tt class="docutils literal"><span class="pre">&quot;\1&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;\2&quot;</span></tt> etc.
to refer to matching groups, remember to &#8216;escape&#8217; the subsitution pattern string.
The best option is to use <a class="reference external" href="http://docs.python.org/library/re.html">&#8216;raw&#8217; python strings</a>.
For example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="s">r&quot;\1_substitutes\2correctly\3four\4times&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Ruffus will throw an exception if it sees an unescaped <tt class="docutils literal"><span class="pre">&quot;\1&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;\2&quot;</span></tt> in a file name.</p>
</div></blockquote>
</div>
<div class="section" id="q-how-to-force-a-pipeline-to-appear-up-to-date">
<h3>Q. How to force a pipeline to appear up to date?<a class="headerlink" href="#q-how-to-force-a-pipeline-to-appear-up-to-date" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><em>I have made a trivial modification to one of my data files and now Ruffus wants to rerun my month long pipeline. How can I convince Ruffus that everything is fine and to leave things as they are?</em></p>
<p>The standard way to do what you are trying to do is to touch all the files downstream...
That way the modification times of your analysis files would postdate your existing files.
You can do this manually but Ruffus also provides direct support:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pipeline_run</span> <span class="p">(</span><span class="n">touch_files_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>pipeline_run will run your script normally stepping over up-to-date tasks and starting
with jobs which look out of date. However, after that, none of your pipeline task functions
will be called, instead, each non-up-to-date file is <a class="reference external" href="https://en.wikipedia.org/wiki/Touch_(Unix)">touch</a>-ed in
turn so that the file modification dates follow on successively.</p>
<p>See the documentation for <a class="reference internal" href="pipeline_functions.html#pipeline-functions-pipeline-run"><em>pipeline_run()</em></a></p>
<p>It is even simpler if you are using the new Ruffus.cmdline support from version 2.4. You can just type</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>your script --touch_files_only <span class="o">[</span>--other_options_of_your_own_etc<span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<p>See <a class="reference internal" href="tutorials/new_tutorial/command_line.html#new-manual-cmdline"><em>command line</em></a> documentation.</p>
</div></blockquote>
</div>
<div class="section" id="q-how-can-i-use-my-own-decorators-with-ruffus">
<h3>Q. How can I use my own decorators with Ruffus?<a class="headerlink" href="#q-how-can-i-use-my-own-decorators-with-ruffus" title="Permalink to this headline">¶</a></h3>
<p>(Thanks to Radhouane Aniba for contributing to this answer.)</p>
<ol class="upperalpha simple">
<li>With care! If the following two points are observed:</li>
</ol>
<div class="section" id="use-wraps-from-functools-or-michele-simionato-s-decorator-module">
<h4>1. Use <a class="reference external" href="https://docs.python.org/2/library/functools.html#functools.wraps">&#64;wraps</a>  from <tt class="docutils literal"><span class="pre">functools</span></tt> or Michele Simionato&#8217;s <a class="reference external" href="https://pypi.python.org/pypi/decorator">decorator</a> module<a class="headerlink" href="#use-wraps-from-functools-or-michele-simionato-s-decorator-module" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>These will automatically forward attributes from the task function correctly:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">__name__</span></tt> and <tt class="docutils literal"><span class="pre">__module__</span></tt> is used to identify functions uniquely in a Ruffus pipeline, and</li>
<li><tt class="docutils literal"><span class="pre">pipeline_task</span></tt> is used to hold per task data</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="always-call-ruffus-decorators-first-before-your-own-decorators">
<h4>2. Always call Ruffus decorators first before your own decorators.<a class="headerlink" href="#always-call-ruffus-decorators-first-before-your-own-decorators" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Otherwise, your decorator will be ignored.</p>
<p>So this works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@follows</span><span class="p">(</span><span class="n">prev_task</span><span class="p">)</span>
<span class="nd">@custom_decorator</span><span class="p">(</span><span class="n">something</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is a bit futile</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ignore @custom_decorator</span>
<span class="nd">@custom_decorator</span><span class="p">(</span><span class="n">something</span><span class="p">)</span>
<span class="nd">@follows</span><span class="p">(</span><span class="n">prev_task</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This order dependency is an unfortunate quirk of how python decorators work. The last (rather futile)
piece of code is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">test</span> <span class="o">=</span> <span class="n">custom_decorator</span><span class="p">(</span><span class="n">something</span><span class="p">)(</span><span class="n">ruffus</span><span class="o">.</span><span class="n">follows</span><span class="p">(</span><span class="n">prev_task</span><span class="p">)(</span><span class="n">test</span><span class="p">))</span>
</pre></div>
</div>
<p>Unfortunately, Ruffus has no idea that someone else (<tt class="docutils literal"><span class="pre">custom_decorator</span></tt>) is also modifying the <tt class="docutils literal"><span class="pre">test()</span></tt> function
after it (<tt class="docutils literal"><span class="pre">ruffus.follows</span></tt>) has had its go.</p>
</div></blockquote>
</div>
<div class="section" id="example-decorator">
<h4>Example decorator:<a class="headerlink" href="#example-decorator" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Let us look at a decorator to time jobs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">time_func_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;prints elapsed time to standard out, or any other file-like object with a .write() method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
   <span class="c"># Run the decorated function.</span>
   <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
   <span class="c"># Stop the timer.</span>
   <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
   <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
   <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{} took {} seconds</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">))</span>
   <span class="k">return</span> <span class="n">ret</span>


<span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@time_job</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">first_task</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;First task&quot;</span>


<span class="nd">@follows</span><span class="p">(</span><span class="n">first_task</span><span class="p">)</span>
<span class="nd">@time_job</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">second_task</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;Second task&quot;</span>


<span class="nd">@follows</span><span class="p">(</span><span class="n">second_task</span><span class="p">)</span>
<span class="nd">@time_job</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">final_task</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;Final task&quot;</span>

<span class="n">pipeline_run</span><span class="p">()</span>
</pre></div>
</div>
<p>What would <tt class="docutils literal"><span class="pre">&#64;time_job</span></tt> look like?</p>
</div></blockquote>
</div>
<div class="section" id="using-functools-wraps">
<h4>1. Using functools <a class="reference external" href="https://docs.python.org/2/library/functools.html#functools.wraps">&#64;wraps</a><a class="headerlink" href="#using-functools-wraps" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">functools</span>
<span class="k">def</span> <span class="nf">time_job</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">actual_time_job</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">time_func_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">actual_time_job</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="using-michele-simionato-s-decorator-module">
<h4>2. Using Michele Simionato&#8217;s <a class="reference external" href="https://pypi.python.org/pypi/decorator">decorator</a> module<a class="headerlink" href="#using-michele-simionato-s-decorator-module" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">decorator</span>
<span class="k">def</span> <span class="nf">time_job</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">time_job</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time_func_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorator</span><span class="o">.</span><span class="n">decorator</span><span class="p">(</span><span class="n">time_job</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="by-hand-using-a-callable-object">
<h4>2. By hand, using a <a class="reference external" href="https://docs.python.org/2/reference/datamodel.html#emulating-callable-objects">callable object</a><a class="headerlink" href="#by-hand-using-a-callable-object" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">time_job</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">time_func_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># remember to forward __name__</span>
        <span class="n">inner</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">inner</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">inner</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__doc__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s">&quot;pipeline_task&quot;</span><span class="p">):</span>
            <span class="n">inner</span><span class="o">.</span><span class="n">pipeline_task</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">pipeline_task</span>
        <span class="k">return</span> <span class="n">inner</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="q-can-a-task-function-in-a-ruffus-pipeline-be-called-normally-outside-of-ruffus">
<h3>Q. Can a task function in a <em>Ruffus</em> pipeline be called normally outside of Ruffus?<a class="headerlink" href="#q-can-a-task-function-in-a-ruffus-pipeline-be-called-normally-outside-of-ruffus" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. Yes. Most python decorators wrap themselves around a function. However, <em>Ruffus</em> leaves the
original function untouched and unwrapped. Instead, <em>Ruffus</em> adds a <tt class="docutils literal"><span class="pre">pipeline_task</span></tt> attribute
to the task function to signal that this is a pipelined function.</p>
<p>This means the original task function can be called just like any other python function.</p>
</div></blockquote>
</div>
<div class="section" id="q-my-ruffus-tasks-create-two-files-at-a-time-why-is-the-second-one-ignored-in-successive-stages-of-my-pipeline">
<h3>Q. My  <em>Ruffus</em> tasks create two files at a time. Why is the second one ignored in successive stages of my pipeline?<a class="headerlink" href="#q-my-ruffus-tasks-create-two-files-at-a-time-why-is-the-second-one-ignored-in-successive-stages-of-my-pipeline" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><em>This is my code:</em></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nd">@transform</span><span class="p">(</span><span class="s">&quot;start.input&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="p">(</span><span class="s">&quot;.+&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;first_output.txt&quot;</span><span class="p">,</span> <span class="s">&quot;second_output.txt&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">task1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">o</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@transform</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.txt&quot;</span><span class="p">),</span> <span class="s">&quot;.result&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">task2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">pipeline_printout</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="n">task2</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>________________________________________
Tasks which will be run:

Task = task1
       Job = [start.input
             -&gt;[first_output.txt, second_output.txt]]

Task = task2
       Job = [[first_output.txt, second_output.txt]
             -&gt;first_output.result]

________________________________________
</pre></div>
</div>
</div></blockquote>
<p>A: This code produces a single output of a tuple of 2 files. In fact, you want two
outputs, each consisting of 1 file.</p>
<p>You want a single job (single input) to be produce multiple outputs (multiple jobs
in downstream tasks). This is a one-to-many operation which calls for
<a class="reference internal" href="decorators/split.html#decorators-split"><em>&#64;split</em></a>:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nd">@split</span><span class="p">(</span><span class="s">&quot;start.input&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;first_output.txt&quot;</span><span class="p">,</span> <span class="s">&quot;second_output.txt&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">task1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">o</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@transform</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.txt&quot;</span><span class="p">),</span> <span class="s">&quot;.result&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">task2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">pipeline_printout</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="n">task2</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>________________________________________
Tasks which will be run:

Task = task1
       Job = [start.input
             -&gt;[first_output.txt, second_output.txt]]

Task = task2
       Job = [first_output.txt
             -&gt;first_output.result]
       Job = [second_output.txt
             -&gt;second_output.result]

________________________________________
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="q-how-can-a-ruffus-task-produce-output-which-goes-off-in-different-directions">
<h3>Q. How can a <em>Ruffus</em> task produce output which goes off in different directions?<a class="headerlink" href="#q-how-can-a-ruffus-task-produce-output-which-goes-off-in-different-directions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. As above, anytime there is a situation which requires a one-to-many operation, you should reach
for <a class="reference internal" href="decorators/subdivide.html#decorators-subdivide"><em>&#64;subdivide</em></a>. The advanced form takes a regular expression, making
it easier to produce multiple derivatives of the input file. The following example subdivides
<em>2</em> jobs each into <em>3</em>, so that the subsequence task will run <em>2</em> x <em>3</em> = <em>6</em> jobs.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nd">@subdivide</span><span class="p">([</span><span class="s">&quot;1.input_file&quot;</span><span class="p">,</span>
            <span class="s">&quot;2.input_file&quot;</span><span class="p">],</span>
            <span class="n">regex</span><span class="p">(</span><span class="s">r&quot;(.+).input_file&quot;</span><span class="p">),</span>      <span class="c"># match file prefix</span>
           <span class="p">[</span><span class="s">r&quot;\1.file_type1&quot;</span><span class="p">,</span>
            <span class="s">r&quot;\1.file_type2&quot;</span><span class="p">,</span>
            <span class="s">r&quot;\1.file_type3&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">split_task</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
   <span class="k">pass</span>


<span class="nd">@transform</span><span class="p">(</span><span class="n">split_task</span><span class="p">,</span> <span class="n">regex</span><span class="p">(</span><span class="s">&quot;(.+)&quot;</span><span class="p">),</span> <span class="s">r&quot;\1.test&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_split_output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
   <span class="k">pass</span>

<span class="n">pipeline_printout</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="n">test_split_output</span><span class="p">],</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Each of the original 2 files have been split in three so that test_split_output will run
6 jobs simultaneously.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>________________________________________
Tasks which will be run:

Task = split_task
       Job = [1.input_file -&gt;[1.file_type1, 1.file_type2, 1.file_type3]]
       Job = [2.input_file -&gt;[2.file_type1, 2.file_type2, 2.file_type3]]

Task = test_split_output
       Job = [1.file_type1 -&gt;1.file_type1.test]
       Job = [1.file_type2 -&gt;1.file_type2.test]
       Job = [1.file_type3 -&gt;1.file_type3.test]
       Job = [2.file_type1 -&gt;2.file_type1.test]
       Job = [2.file_type2 -&gt;2.file_type2.test]
       Job = [2.file_type3 -&gt;2.file_type3.test]
________________________________________
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="q-can-i-call-extra-code-before-each-job">
<h3>Q. Can I call extra code before each job?<a class="headerlink" href="#q-can-i-call-extra-code-before-each-job" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. This is easily accomplished by hijacking the process
for checking if jobs are up to date or not (<a class="reference internal" href="decorators/check_if_uptodate.html#decorators-check-if-uptodate"><em>&#64;check_if_uptodate</em></a>):</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">run_this_before_each_job</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Calling function before each job using these args&quot;</span><span class="p">,</span> <span class="n">args</span>
    <span class="c"># Remember to delegate to the default *Ruffus* code for checking if</span>
    <span class="c">#   jobs need to run.</span>
    <span class="k">return</span> <span class="n">needs_update_check_modify_time</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="nd">@check_if_uptodate</span><span class="p">(</span><span class="n">run_this_before_each_job</span><span class="p">)</span>
<span class="nd">@files</span><span class="p">([[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;a.1&quot;</span><span class="p">],</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;b.1&quot;</span><span class="p">]])</span>
<span class="k">def</span> <span class="nf">task_func</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">pipeline_printout</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="n">task_func</span><span class="p">])</span>
</pre></div>
</div>
<p>This results in:</p>
<div class="highlight-python"><div class="highlight"><pre>________________________________________
&gt;&gt;&gt; pipeline_run([task_func])
Calling function before each job using these args (None, &#39;a.1&#39;)
Calling function before each job using these args (None, &#39;a.1&#39;)
Calling function before each job using these args (None, &#39;b.1&#39;)
    Job = [None -&gt; a.1] completed
    Job = [None -&gt; b.1] completed
Completed Task = task_func
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because <tt class="docutils literal"><span class="pre">run_this_before_each_job(...)</span></tt> is called whenever <em>Ruffus</em> checks to see if
a job is up to date or not, the function may be called twice for some jobs
(e.g. <tt class="docutils literal"><span class="pre">(None,</span> <span class="pre">'a.1')</span></tt> above).</p>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="q-does-ruffus-allow-checkpointing-to-distinguish-interrupted-and-completed-results">
<h3>Q. Does <em>Ruffus</em> allow checkpointing: to distinguish interrupted and completed results?<a class="headerlink" href="#q-does-ruffus-allow-checkpointing-to-distinguish-interrupted-and-completed-results" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-use-the-builtin-sqlite-checkpointing">
<h4>A. Use the builtin sqlite checkpointing<a class="headerlink" href="#a-use-the-builtin-sqlite-checkpointing" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>By default, <tt class="docutils literal"><span class="pre">pipeline_run(...)</span></tt> will save the timestamps for output files from successfully run jobs to an sqlite database file (<tt class="docutils literal"><span class="pre">.ruffus_history.sqlite</span></tt>) in the current directory .</p>
<ul class="simple">
<li>If you are using <tt class="docutils literal"><span class="pre">Ruffus.cmdline</span></tt>, you can change the checksum / timestamp database file name on the command line using  <tt class="docutils literal"><span class="pre">--checksum_file_name</span> <span class="pre">NNNN</span></tt></li>
<li></li>
</ul>
<p>The level of timestamping / checksumming can be set via the <tt class="docutils literal"><span class="pre">checksum_level</span></tt> parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pipeline_run</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">checksum_level</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>where the default is 1:</p>
<div class="highlight-python"><div class="highlight"><pre>level 0 : Use only file timestamps
level 1 : above, plus timestamp of successful job completion
level 2 : above, plus a checksum of the pipeline function body
level 3 : above, plus a checksum of the pipeline function default arguments and the additional arguments passed in by task decorators
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="a-use-a-flag-file">
<h4>A. Use a flag file<a class="headerlink" href="#a-use-a-flag-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>When gmake is interrupted, it will delete the target file it is updating so that the target is
remade from scratch when make is next run. Ruffus, by design, does not do this because, more often than
not, the partial / incomplete file may be usefully if only to reveal, for example, what might have caused an interrupting error
or exception. It also seems a bit too clever and underhand to go around the programmer&#8217;s back to delete files...</p>
<p>A common <em>Ruffus</em> convention is create an empty checkpoint or &#8220;flag&#8221; file whose sole purpose
is to record a modification-time and the successful completion of a job.</p>
<p>This would be task with a completion flag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#</span>
<span class="c">#   Assuming a pipelined task function named &quot;stage1&quot;</span>
<span class="c">#</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">stage1</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.stage1&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;.stage2&quot;</span><span class="p">,</span> <span class="s">&quot;.stage2_finished&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">stage2</span> <span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">output_files</span><span class="p">):</span>
    <span class="n">task_output_file</span><span class="p">,</span> <span class="n">flag_file</span> <span class="o">=</span> <span class="n">output_files</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;do_something2 </span><span class="si">%(input_file)s</span><span class="s"> &gt;| </span><span class="si">%(task_output_file)s</span><span class="s"> &quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">%</span> <span class="p">{</span>
                    <span class="s">&quot;input_file&quot;</span><span class="p">:</span>               <span class="n">input_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s">&quot;task_output_file&quot;</span><span class="p">:</span>         <span class="n">task_output_file</span>
                <span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">):</span>
        <span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888</span>
        <span class="c">#</span>
        <span class="c">#   It worked: Create completion flag_file</span>
        <span class="c">#</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">flag_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888</span>
</pre></div>
</div>
<p>The flag_files <tt class="docutils literal"><span class="pre">xxx.stage2_finished</span></tt> indicate that each job is finished. If this is missing,
<tt class="docutils literal"><span class="pre">xxx.stage2</span></tt> is only a partial, interrupted result.</p>
<p>The only thing to be aware of is that the flag file will appear in the list of inputs of the
downstream task, which should accordingly look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@transform</span><span class="p">(</span><span class="n">stage2</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.stage2&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;.stage3&quot;</span><span class="p">,</span> <span class="s">&quot;.stage3_finished&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">stage3</span> <span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">output_files</span><span class="p">):</span>

    <span class="c">#888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>
    <span class="c">#</span>
    <span class="c">#   Note that the first parameter is a LIST of input files, the last of which</span>
    <span class="c">#       is the flag file from the previous task which we can ignore</span>
    <span class="c">#</span>
    <span class="n">input_file</span><span class="p">,</span> <span class="n">previous_flag_file</span>  <span class="o">=</span> <span class="n">input_files</span>
    <span class="c">#</span>
    <span class="c">#888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>
    <span class="n">task_output_file</span><span class="p">,</span> <span class="n">flag_file</span>     <span class="o">=</span> <span class="n">output_files</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;do_something3 </span><span class="si">%(input_file)s</span><span class="s"> &gt;| </span><span class="si">%(task_output_file)s</span><span class="s"> &quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">%</span> <span class="p">{</span>
                    <span class="s">&quot;input_file&quot;</span><span class="p">:</span>               <span class="n">input_file</span><span class="p">,</span>
                    <span class="s">&quot;task_output_file&quot;</span><span class="p">:</span>         <span class="n">task_output_file</span>
                <span class="p">}</span>
    <span class="c"># completion flag file for this task</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">):</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">flag_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="examples/bioinformatics/part2.html#examples-bioinformatics-part2-step2"><em>Bioinformatics example</em></a> contains <a class="reference internal" href="examples/bioinformatics/part2_code.html#examples-bioinformatics-part2-code"><em>code</em></a> for checkpointing.</p>
</div></blockquote>
</div>
<div class="section" id="a-use-a-temp-file">
<h4>A. Use a temp file<a class="headerlink" href="#a-use-a-temp-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Thanks to Martin Goodson for suggesting this and providing an example. In his words:</p>
<p>&#8220;I normally use a decorator to create a temporary file which is only renamed after the task has completed without any problems. This seems a more elegant solution to the problem:&#8221;</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">usetemp</span><span class="p">(</span><span class="n">task_func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decorate a function to write to a tmp file and then rename it. So half finished tasks cannot create up to date targets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">task_func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">outnames</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outnames</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">and</span>  <span class="nb">hasattr</span><span class="p">(</span><span class="n">outnames</span><span class="p">,</span> <span class="s">&#39;__getitem__&#39;</span><span class="p">):</span>
            <span class="n">tmpnames</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;.tmp&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outnames</span><span class="p">]</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tmpnames</span>
            <span class="n">task_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tmpnames</span><span class="p">,</span> <span class="n">outnames</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">outnames</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outnames</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;.tmp&#39;</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
            <span class="n">task_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">outnames</span><span class="p">))</span>
<span class="k">return</span> <span class="n">wrapper_function</span>
</pre></div>
</div>
</div></blockquote>
<p>Use like this:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="nd">@files</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;client1.price&#39;</span><span class="p">)</span>
<span class="nd">@usetemp</span>
<span class="k">def</span> <span class="nf">getusers</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span> <span class="n">outputname</span><span class="p">):</span>
    <span class="c">#**************************************************</span>
    <span class="c"># code goes here</span>
    <span class="c"># outputname now refers to temporary file</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="windows">
<h2>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q-windows-seems-to-spawn-ruffus-processes-recursively">
<h3>Q. Windows seems to spawn <em>ruffus</em> processes recursively<a class="headerlink" href="#q-windows-seems-to-spawn-ruffus-processes-recursively" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A. It is necessary to protect the &#8220;entry point&#8221; of the program under windows.
Otherwise, a new process will be started each time the main module is imported
by a new Python interpreter as an unintended side effects. Causing a cascade
of new processes.</p>
<p>See: <a class="reference external" href="http://docs.python.org/library/multiprocessing.html#multiprocessing-programming">http://docs.python.org/library/multiprocessing.html#multiprocessing-programming</a></p>
<p>This code works:</p>
<div class="highlight-python"><div class="highlight"><pre>if __name__ == &#39;__main__&#39;:
    try:
        pipeline_run([parallel_task], multiprocess = 5)
except Exception, e:
    print e.args
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="sun-grid-engine-pbs-slurm-etc">
<h2>Sun Grid Engine / PBS / SLURM etc<a class="headerlink" href="#sun-grid-engine-pbs-slurm-etc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q-can-ruffus-be-used-to-manage-a-cluster-or-grid-based-pipeline">
<h3>Q. Can Ruffus be used to manage a cluster or grid based pipeline?<a class="headerlink" href="#q-can-ruffus-be-used-to-manage-a-cluster-or-grid-based-pipeline" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha simple">
<li>Some minimum modifications have to be made to your <em>Ruffus</em> script to allow it to submit jobs to a cluster</li>
</ol>
<p>See <a class="reference internal" href="tutorials/new_tutorial/multiprocessing.html#new-manual-ruffus-drmaa-wrapper-run-job"><em>ruffus.drmaa_wrapper</em></a></p>
<p>Thanks to Andreas Heger and others at CGAT and Bernie Pope for contributing ideas and code.</p>
</div></blockquote>
</div>
<div class="section" id="q-when-i-submit-lots-of-jobs-via-sun-grid-engine-sge-the-head-node-occassionally-freezes-and-dies">
<h3>Q. When I submit lots of jobs via Sun Grid Engine (SGE), the head node occassionally freezes and dies<a class="headerlink" href="#q-when-i-submit-lots-of-jobs-via-sun-grid-engine-sge-the-head-node-occassionally-freezes-and-dies" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha simple">
<li>You need to use multithreading rather than multiprocessing. See <a class="reference internal" href="tutorials/new_tutorial/multiprocessing.html#new-manual-ruffus-drmaa-wrapper-run-job"><em>ruffus.drmaa_wrapper</em></a></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="q-keeping-large-intermediate-files">
<h3>Q. Keeping Large intermediate files<a class="headerlink" href="#q-keeping-large-intermediate-files" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Sometimes pipelines create a large number of intermediate files which might not be needed later.</p>
<p>Unfortunately, the current design of <em>Ruffus</em> requires these files to hang around otherwise the pipeline
will not know that it ran successfully.</p>
<p>We have some tentative plans to get around this but in the meantime, Bernie Pope suggests
truncating intermediate files in place, preserving timestamps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># truncate a file to zero bytes, and preserve its original modification time</span>
<span class="k">def</span> <span class="nf">zeroFile</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
        <span class="c"># save the current time of the file</span>
        <span class="n">timeInfo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c"># change the time of the file back to what it was</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="nb">file</span><span class="p">,(</span><span class="n">timeInfo</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">timeInfo</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="sharing-python-objects-between-ruffus-processes-running-concurrently">
<h2>Sharing python objects between Ruffus processes running concurrently<a class="headerlink" href="#sharing-python-objects-between-ruffus-processes-running-concurrently" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The design of Ruffus envisages that much of the data flow in pipelines occurs in files but it is also possible to pass python objects in memory.</p>
<p>Ruffus uses the <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html">multiprocessing</a> module and much of the following is a summary of what is covered
in depth in the Python Standard Library <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#sharing-state-between-processes">Documentation</a>.</p>
<p>Running Ruffus using <tt class="docutils literal"><span class="pre">pipeline_run(...,</span> <span class="pre">multiprocess</span> <span class="pre">=</span> <span class="pre">NNN)</span></tt> where <tt class="docutils literal"><span class="pre">NNN</span></tt> &gt; 1 runs each job concurrently on up to <tt class="docutils literal"><span class="pre">NNN</span></tt> separate local processes.
Each task function runs independently in a different python intepreter, possibly on a different CPU, in the most efficient way.
However, this does mean we have to pay some attention to how data is sent across process boundaries (unlike the situation with <tt class="docutils literal"><span class="pre">pipeline_run(...,</span> <span class="pre">multithread</span> <span class="pre">=</span> <span class="pre">NNN)</span></tt> ).</p>
<p>The python code and data which comprises your multitasking Ruffus job is sent to a separate process in three ways:</p>
<ol class="arabic simple">
<li>The python function code and data objects are <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickled</a>, i.e. converting into a byte stream, by the master process, sent to the remote process
before being converted back into normal python (unpickling).</li>
<li>The parameters for your jobs, i.e. what Ruffus calls your task functions with, are separately <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickled</a> and sent to the remote process via
<a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Queue">multiprocessing.Queue</a></li>
<li>You can share and synchronise other data yourselves. The canonical example is the logger provided by <tt class="docutils literal"><span class="pre">Ruffus.cmdline.setup_logging</span></tt></li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Check that your function code and data can be <a class="reference external" href="http://docs.python.org/2/library/pickle.html#what-can-be-pickled-and-unpickled">pickled</a>.</p>
<p class="last">Only functions, built-in functions and classes defined at the top level of a module are picklable.</p>
</div>
<p>The following answers are a short &#8220;how-to&#8221; for sharing and synchronising data yourselves.</p>
</div></blockquote>
<div class="section" id="can-ordinary-python-objects-be-shared-between-processes">
<h3>Can ordinary python objects be shared between processes?<a class="headerlink" href="#can-ordinary-python-objects-be-shared-between-processes" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha">
<li><p class="first">Objects which can be <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickled</a> can be shared as is. These include</p>
<blockquote>
<div><ul class="simple">
<li>numbers</li>
<li>strings</li>
<li>tuples, lists, sets, and dictionaries containing only objects which can be <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickled</a>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If these do not change during your pipeline, you can just use them without any further effort in your task.</p>
</li>
<li><p class="first">If you need to use the value at the point when the task function is <em>called</em>, then you need to pass the python object as parameters to your task.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="hll"> <span class="c"># changing_list changes...</span>
</span> <span class="nd">@transform</span><span class="p">(</span><span class="n">previous_task</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.foo&quot;</span><span class="p">),</span> <span class="s">&quot;.bar&quot;</span><span class="p">,</span> <span class="n">changing_list</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">next_task</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">changing_list</span><span class="p">):</span>
     <span class="k">pass</span>
</pre></div>
</div>
</li>
<li><p class="first">If you need to use the value when the task function is <em>run</em> then see <a class="reference internal" href="#how-about-synchronising-python-objects-in-real-time"><em>the following answer.</em></a>.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="why-am-i-getting-picklingerror">
<h3>Why am I getting <tt class="docutils literal"><span class="pre">PicklingError</span></tt>?<a class="headerlink" href="#why-am-i-getting-picklingerror" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>What is happening? Didn&#8217;t <a class="reference external" href="https://en.wikipedia.org/wiki/Battle_of_the_Herrings">Joan of Arc</a> solve this once and for all?</p>
<ol class="upperalpha">
<li><p class="first">Some of the data or code in your function cannot be <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickled</a> and is being asked to be sent by python <tt class="docutils literal"><span class="pre">mulitprocessing</span></tt> across process boundaries.</p>
<blockquote>
<div><p>When you run your pipeline using multiprocess:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">pipeline_run</span><span class="p">([],</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">ruffusLoggerProxy</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>You will get the following errors:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="ne">Exception</span> <span class="ow">in</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;/path/to/python/python2.7/threading.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">808</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__bootstrap_inner</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
  <span class="n">File</span> <span class="s">&quot;/path/to/python/python2.7/threading.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">761</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__target</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">__args</span><span class="p">,</span> <span class="o">*</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">&quot;/path/to/python/python2.7/multiprocessing/pool.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">342</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_handle_tasks</span>
    <span class="n">put</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="n">PicklingError</span><span class="p">:</span> <span class="n">Can</span><span class="s">&#39;t pickle &lt;type &#39;</span><span class="n">function</span><span class="s">&#39;&gt;: attribute lookup __builtin__.function failed</span>
</pre></div>
</div>
</div></blockquote>
<p>which go away when you set <tt class="docutils literal"><span class="pre">pipeline_run([],</span> <span class="pre">multiprocess</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">...)</span></tt></p>
</div></blockquote>
</li>
</ol>
<p>Unfortunately, pickling errors are particularly ill-served by standard python error messages. The only really good advice is to take the offending
code and try and <a class="reference external" href="http://docs.python.org/2/library/pickle.html">pickle</a> it yourself and narrow down the errors. Check your objects against the list
in the <a class="reference external" href="http://docs.python.org/2/library/pickle.html#what-can-be-pickled-and-unpickled">pickle</a> module.
Watch out especially for nested functions. These will have to be moved to file scope.
Other objects may have to be passed in proxy (see below).</p>
</div></blockquote>
</div>
<div class="section" id="how-about-synchronising-python-objects-in-real-time">
<span id="id1"></span><h3>How about synchronising python objects in real time?<a class="headerlink" href="#how-about-synchronising-python-objects-in-real-time" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha simple">
<li>You can use managers and proxy objects from the <a class="reference external" href="http://docs.python.org/library/multiprocessing.html">multiprocessing</a> module.</li>
</ol>
<p>The underlying python object would be owned and managed by a (hidden) server process. Other processes can access the shared objects transparently by using proxies. This is how the logger provided by
<tt class="docutils literal"><span class="pre">Ruffus.cmdline.setup_logging</span></tt> works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#  optional logger which can be passed to ruffus tasks</span>
<span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span> <span class="o">=</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">setup_logging</span> <span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">logger</span></tt> is a proxy for the underlying python <a class="reference external" href="http://docs.python.org/2/library/logging.html">logger</a> object, and it can be shared freely between processes.</p>
<p>The best course is to pass <tt class="docutils literal"><span class="pre">logger</span></tt> as a parameter to a <em>Ruffus</em> task.</p>
<p>The only caveat is that we should make sure multiple jobs are not writting to the log at the same time. To synchronise logging, we use proxy to a non-reentrant <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Lock">multiprocessing.lock</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span> <span class="o">=</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">setup_logging</span> <span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>


<span class="nd">@transform</span><span class="p">(</span><span class="n">previous_task</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.foo&quot;</span><span class="p">),</span> <span class="s">&quot;.bar&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_task</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">logger_mutex</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">logger_mutex</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;We are in the middle of next_task: </span><span class="si">%s</span><span class="s"> -&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="can-i-share-and-synchronise-my-own-python-classes-via-proxies">
<h3>Can I  share and synchronise my own python classes via proxies?<a class="headerlink" href="#can-i-share-and-synchronise-my-own-python-classes-via-proxies" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha">
<li><p class="first"><a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.managers.SyncManager">multiprocessing.managers.SyncManager</a> provides out of the box support for lists, arrays and dicts etc.</p>
<blockquote>
<div><p>Most of the time, we can use a &#8220;vanilla&#8221; manager provided by <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.sharedctypes.multiprocessing.Manager">multiprocessing.Manager()</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>

<span class="n">list_proxy</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="n">dict_proxy</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<span class="n">lock_proxy</span>          <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="n">namespace_proxy</span>     <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
<span class="n">queue_proxy</span>         <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Queue</span><span class="p">([</span><span class="n">maxsize</span><span class="p">])</span>
<span class="n">rentrant_lock_proxy</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
<span class="n">semaphore_proxy</span>     <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">([</span><span class="n">value</span><span class="p">])</span>
<span class="n">char_array_proxy</span>    <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">integer_proxy</span>       <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="nd">@transform</span><span class="p">(</span><span class="n">previous_task</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.foo&quot;</span><span class="p">),</span> <span class="s">&quot;.bar&quot;</span><span class="p">,</span> <span class="n">lock_proxy</span><span class="p">,</span> <span class="n">dict_proxy</span><span class="p">,</span> <span class="n">list_proxy</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_task</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">lock_proxy</span><span class="p">,</span> <span class="n">dict_proxy</span><span class="p">,</span> <span class="n">list_proxy</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">lock_proxy</span><span class="p">:</span>
        <span class="n">list_proxy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">dict_proxy</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>However, you can also create proxy custom classes for your own objects.</p>
<p>In this case you may need to derive from  <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.managers.SyncManager">multiprocessing.managers.SyncManager</a>
and register proxy functions. See <tt class="docutils literal"><span class="pre">Ruffus.proxy_logger</span></tt> for an example of how to do this.</p>
</div></blockquote>
</div>
<div class="section" id="how-do-i-send-python-objects-back-and-forth-without-tangling-myself-in-horrible-synchronisation-code">
<h3>How do I send python objects back and forth without tangling myself in horrible synchronisation code?<a class="headerlink" href="#how-do-i-send-python-objects-back-and-forth-without-tangling-myself-in-horrible-synchronisation-code" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha simple">
<li>Sharing python objects by passing messages is a much more modern and safer way to coordinate multitasking than using synchronization primitives like locks.</li>
</ol>
<p>The python <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#pipes-and-queues">multiprocessing</a> module provides support for passing python objects as messages between processes.
You can either use <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Pipe">pipes</a>
or <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Queue">queues</a>.
The idea is that one process pushes and object onto a <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Pipe">pipe</a> or <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Queue">queue</a>
and the other processes pops it out at the other end. <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Pipe">Pipes</a> are
only two ended so <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Queue">queues</a> are usually a better fit for sending data to multiple Ruffus jobs.</p>
<p>Proxies for <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.managers.SyncManager.Queue">queues</a> can be passed between processes as in the previous section</p>
</div></blockquote>
</div>
<div class="section" id="how-do-i-share-large-amounts-of-data-efficiently-across-processes">
<h3>How do I share large amounts of data efficiently across processes?<a class="headerlink" href="#how-do-i-share-large-amounts-of-data-efficiently-across-processes" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="upperalpha simple">
<li>If it is really impractical to use data files on disk, you can put the data in shared memory.</li>
</ol>
<p>It is possible to create shared objects using shared memory which can be inherited by child processes or passed as Ruffus parameters.
This is probably most efficently done via the <a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.Array">array</a>
interface. Again, it is easy to create locks and proxies for synchronised access:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Lock</span>
<span class="kn">from</span> <span class="nn">multiprocessing.sharedctypes</span> <span class="kn">import</span> <span class="n">Value</span><span class="p">,</span> <span class="n">Array</span>
<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">c_double</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>

<span class="n">lock_proxy</span>          <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="n">int_array_proxy</span>     <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">123</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nd">@transform</span><span class="p">(</span><span class="n">previous_task</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.foo&quot;</span><span class="p">),</span> <span class="s">&quot;.bar&quot;</span><span class="p">,</span> <span class="n">lock_proxy</span><span class="p">,</span> <span class="n">int_array_proxy</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_task</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">lock_proxy</span><span class="p">,</span> <span class="n">int_array_proxy</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">lock_proxy</span><span class="p">:</span>
        <span class="n">int_array_proxy</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="mi">71</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FAQ</a><ul>
<li><a class="reference internal" href="#citations">Citations</a><ul>
<li><a class="reference internal" href="#q-how-should-ruffus-be-cited-in-academic-publications">Q. How should <em>Ruffus</em> be cited in academic publications?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#good-practices">Good practices</a><ul>
<li><a class="reference internal" href="#q-what-is-the-best-way-of-keeping-my-data-and-workings-separate">Q. What is the best way of keeping my data and workings separate?</a></li>
<li><a class="reference internal" href="#q-what-is-the-best-way-of-handling-data-in-file-pairs-or-triplets-etc">Q. What is the best way of handling data in file pairs (or triplets etc.)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general">General</a><ul>
<li><a class="reference internal" href="#q-ruffus-won-t-create-dependency-graphs">Q. <em>Ruffus</em> won&#8217;t create dependency graphs</a></li>
<li><a class="reference internal" href="#q-ruffus-seems-to-be-hanging-in-the-same-place">Q. <em>Ruffus</em> seems to be hanging in the same place</a></li>
<li><a class="reference internal" href="#q-regular-expression-substitutions-don-t-work">Q. Regular expression substitutions don&#8217;t work</a></li>
<li><a class="reference internal" href="#q-how-to-force-a-pipeline-to-appear-up-to-date">Q. How to force a pipeline to appear up to date?</a></li>
<li><a class="reference internal" href="#q-how-can-i-use-my-own-decorators-with-ruffus">Q. How can I use my own decorators with Ruffus?</a><ul>
<li><a class="reference internal" href="#use-wraps-from-functools-or-michele-simionato-s-decorator-module">1. Use &#64;wraps  from <tt class="docutils literal"><span class="pre">functools</span></tt> or Michele Simionato&#8217;s decorator module</a></li>
<li><a class="reference internal" href="#always-call-ruffus-decorators-first-before-your-own-decorators">2. Always call Ruffus decorators first before your own decorators.</a></li>
<li><a class="reference internal" href="#example-decorator">Example decorator:</a></li>
<li><a class="reference internal" href="#using-functools-wraps">1. Using functools &#64;wraps</a></li>
<li><a class="reference internal" href="#using-michele-simionato-s-decorator-module">2. Using Michele Simionato&#8217;s decorator module</a></li>
<li><a class="reference internal" href="#by-hand-using-a-callable-object">2. By hand, using a callable object</a></li>
</ul>
</li>
<li><a class="reference internal" href="#q-can-a-task-function-in-a-ruffus-pipeline-be-called-normally-outside-of-ruffus">Q. Can a task function in a <em>Ruffus</em> pipeline be called normally outside of Ruffus?</a></li>
<li><a class="reference internal" href="#q-my-ruffus-tasks-create-two-files-at-a-time-why-is-the-second-one-ignored-in-successive-stages-of-my-pipeline">Q. My  <em>Ruffus</em> tasks create two files at a time. Why is the second one ignored in successive stages of my pipeline?</a></li>
<li><a class="reference internal" href="#q-how-can-a-ruffus-task-produce-output-which-goes-off-in-different-directions">Q. How can a <em>Ruffus</em> task produce output which goes off in different directions?</a></li>
<li><a class="reference internal" href="#q-can-i-call-extra-code-before-each-job">Q. Can I call extra code before each job?</a></li>
<li><a class="reference internal" href="#q-does-ruffus-allow-checkpointing-to-distinguish-interrupted-and-completed-results">Q. Does <em>Ruffus</em> allow checkpointing: to distinguish interrupted and completed results?</a><ul>
<li><a class="reference internal" href="#a-use-the-builtin-sqlite-checkpointing">A. Use the builtin sqlite checkpointing</a></li>
<li><a class="reference internal" href="#a-use-a-flag-file">A. Use a flag file</a></li>
<li><a class="reference internal" href="#a-use-a-temp-file">A. Use a temp file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#windows">Windows</a><ul>
<li><a class="reference internal" href="#q-windows-seems-to-spawn-ruffus-processes-recursively">Q. Windows seems to spawn <em>ruffus</em> processes recursively</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sun-grid-engine-pbs-slurm-etc">Sun Grid Engine / PBS / SLURM etc</a><ul>
<li><a class="reference internal" href="#q-can-ruffus-be-used-to-manage-a-cluster-or-grid-based-pipeline">Q. Can Ruffus be used to manage a cluster or grid based pipeline?</a></li>
<li><a class="reference internal" href="#q-when-i-submit-lots-of-jobs-via-sun-grid-engine-sge-the-head-node-occassionally-freezes-and-dies">Q. When I submit lots of jobs via Sun Grid Engine (SGE), the head node occassionally freezes and dies</a></li>
<li><a class="reference internal" href="#q-keeping-large-intermediate-files">Q. Keeping Large intermediate files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sharing-python-objects-between-ruffus-processes-running-concurrently">Sharing python objects between Ruffus processes running concurrently</a><ul>
<li><a class="reference internal" href="#can-ordinary-python-objects-be-shared-between-processes">Can ordinary python objects be shared between processes?</a></li>
<li><a class="reference internal" href="#why-am-i-getting-picklingerror">Why am I getting <tt class="docutils literal"><span class="pre">PicklingError</span></tt>?</a></li>
<li><a class="reference internal" href="#how-about-synchronising-python-objects-in-real-time">How about synchronising python objects in real time?</a></li>
<li><a class="reference internal" href="#can-i-share-and-synchronise-my-own-python-classes-via-proxies">Can I  share and synchronise my own python classes via proxies?</a></li>
<li><a class="reference internal" href="#how-do-i-send-python-objects-back-and-forth-without-tangling-myself-in-horrible-synchronisation-code">How do I send python objects back and forth without tangling myself in horrible synchronisation code?</a></li>
<li><a class="reference internal" href="#how-do-i-share-large-amounts-of-data-efficiently-across-processes">How do I share large amounts of data efficiently across processes?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="implementation_notes.html"
                        title="previous chapter">Implementation Tips</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="glossary.html"
                        title="next chapter">Glossary</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/faq.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="decorators/originate.html">@originate</a>                           </li>
            <li><a href="decorators/split.html">@split</a>                                   </li>
            <li><a href="decorators/transform.html">@transform</a>                           </li>
            <li><a href="decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="decorators/collate.html">@collate</a>                               </li>
            <li><a href="decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="decorators/product.html">@product </a>                              </li>
            <li><a href="decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             >next</a> |</li>
        <li class="right" >
          <a href="implementation_notes.html" title="Implementation Tips"
             >previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="index.html">Home</a> | </li>
            <li><a href="contents.html">Contents</a> | </li>
            <li><a href="installation.html">Install</a>  | </li>
            <li><a href="tutorials/new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="tutorials/new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="#">FAQ</a>  | </li>
            <li><a href="cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="tutorials/new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="gallery.html">Gallery</a> |  </li>
            <li><a href="tutorials/new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>