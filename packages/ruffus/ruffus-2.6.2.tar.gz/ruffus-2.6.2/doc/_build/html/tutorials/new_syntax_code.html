<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Code for: New Object orientated syntax for Ruffus in Version 2.6 &mdash; ruffus 2.6 documentation</title>
    
    <link rel="stylesheet" href="../_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        Ruffus v. 2.6
            <li><a href="../index.html">Home</a> | </li>
            <li><a href="../contents.html">Contents</a> | </li>
            <li><a href="../installation.html">Install</a>  | </li>
            <li><a href="new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../faq.html">FAQ</a>  | </li>
            <li><a href="../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="../gallery.html">Gallery</a> |  </li>
            <li><a href="../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python-code-for-new-object-orientated-syntax-for-ruffus-in-version-2-6">
<span id="new-syntax-worked-example-code"></span><h1>Python Code for: New Object orientated syntax for Ruffus in Version 2.6<a class="headerlink" href="#python-code-for-new-object-orientated-syntax-for-ruffus-in-version-2-6" title="Permalink to this headline">Â¶</a></h1>
<blockquote>
<div><div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="new_syntax_worked_example.html#new-syntax-worked-example"><em>new_syntax.worked_example</em></a></li>
</ul>
</div>
<p>This code is from <tt class="docutils literal"><span class="pre">test/test_subpipeline.py</span></tt> in the <strong>Ruffus</strong> distribution</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    test_subpipeline.py</span>

<span class="sd">        Demonstrates the new Ruffus syntax in version 2.6</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># add grandparent to search path for testing</span>
<span class="n">grandparent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grandparent_dir</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">ruffus</span>
<span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="n">add_inputs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">output_from</span><span class="p">,</span> <span class="n">touch_file</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Ruffus Version = &quot;</span><span class="p">,</span> <span class="n">ruffus</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>

<span class="c">#   imports</span>


<span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>
<span class="kn">import</span> <span class="nn">shutil</span>


<span class="k">def</span> <span class="nf">touch</span> <span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>

<span class="c">#   Tasks</span>


<span class="c">#88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888</span>
<span class="n">tempdir</span> <span class="o">=</span> <span class="s">&quot;tempdir/&quot;</span>
<span class="k">def</span> <span class="nf">task_originate</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes new files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">touch</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">task_m_to_1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges files together</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">o_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">ii</span><span class="p">:</span>
                <span class="n">o_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span><span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="n">ii</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;; &quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">task_1_to_1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 to 1 for transform</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">o_file</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">as</span> <span class="n">ii</span><span class="p">:</span>
            <span class="n">o_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span><span class="s">&quot;+&quot;</span> <span class="o">+</span> <span class="n">ii</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="n">DEBUG_do_not_define_tail_task</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">DEBUG_do_not_define_head_task</span> <span class="o">=</span> <span class="bp">False</span>

<span class="kn">import</span> <span class="nn">unittest</span>

<span class="c">#</span>
<span class="hll"><span class="c">#   Returns a fully formed sub pipeline useable as a building block</span>
</span><span class="c">#</span>
<span class="k">def</span> <span class="nf">make_pipeline1</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span>   <span class="c"># Pipelines need to have a unique name</span>
                   <span class="n">starting_file_names</span><span class="p">):</span>
    <span class="n">test_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>

<span class="hll">    <span class="c">#   We can change the starting files later using</span>
</span><span class="hll">    <span class="c">#          set_input() for transform etc.</span>
</span><span class="hll">    <span class="c">#       or set_output() for originate</span>
</span><span class="hll">    <span class="c">#   But it can be more convenient to just pass this to the function making the pipeline</span>
</span>    <span class="c">#</span>
    <span class="n">test_pipeline</span><span class="o">.</span><span class="n">originate</span><span class="p">(</span><span class="n">task_originate</span><span class="p">,</span> <span class="n">starting_file_names</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">follows</span><span class="p">(</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tempdir</span><span class="p">),</span> <span class="n">mkdir</span><span class="p">(</span><span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;testdir&quot;</span><span class="p">,</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;testdir2&quot;</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">posttask</span><span class="p">(</span><span class="n">touch_file</span><span class="p">(</span><span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;testdir/whatever.txt&quot;</span><span class="p">))</span>
    <span class="n">test_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>   <span class="o">=</span> <span class="n">task_m_to_1</span><span class="p">,</span>
                            <span class="n">name</span>        <span class="o">=</span> <span class="s">&quot;add_input&quot;</span><span class="p">,</span>
<span class="hll">                            <span class="c"># Lookup Task from function name task_originate()</span>
</span><span class="hll">                            <span class="c">#   So long as this is unique in the pipeline</span>
</span>                            <span class="nb">input</span>       <span class="o">=</span> <span class="n">task_originate</span><span class="p">,</span>
                            <span class="nb">filter</span>      <span class="o">=</span> <span class="n">regex</span><span class="p">(</span><span class="s">r&quot;(.*)&quot;</span><span class="p">),</span>
                            <span class="n">add_inputs</span>  <span class="o">=</span> <span class="n">add_inputs</span><span class="p">(</span><span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;testdir/whatever.txt&quot;</span><span class="p">),</span>
                            <span class="n">output</span>      <span class="o">=</span> <span class="s">r&quot;\1.22&quot;</span><span class="p">)</span>
    <span class="n">test_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>   <span class="o">=</span> <span class="n">task_1_to_1</span><span class="p">,</span>
                            <span class="n">name</span>        <span class="o">=</span> <span class="s">&quot;22_to_33&quot;</span><span class="p">,</span>
<span class="hll">                            <span class="c"># Lookup Task from Task name</span>
</span><span class="hll">                            <span class="c">#   Function name is not unique in the pipeline</span>
</span>                            <span class="nb">input</span>       <span class="o">=</span> <span class="n">output_from</span><span class="p">(</span><span class="s">&quot;add_input&quot;</span><span class="p">),</span>
                            <span class="nb">filter</span>      <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.22&quot;</span><span class="p">),</span>
                            <span class="n">output</span>      <span class="o">=</span> <span class="s">&quot;.33&quot;</span><span class="p">)</span>
    <span class="n">tail_task</span> <span class="o">=</span> <span class="n">test_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>   <span class="o">=</span> <span class="n">task_1_to_1</span><span class="p">,</span>
                                        <span class="n">name</span>        <span class="o">=</span> <span class="s">&quot;33_to_44&quot;</span><span class="p">,</span>
<span class="hll">                                        <span class="c"># Ask Pipeline to lookup Task from Task name</span>
</span>                                        <span class="nb">input</span>       <span class="o">=</span> <span class="n">test_pipeline</span><span class="p">[</span><span class="s">&quot;22_to_33&quot;</span><span class="p">],</span>
                                        <span class="nb">filter</span>      <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.33&quot;</span><span class="p">),</span>
                                        <span class="n">output</span>      <span class="o">=</span> <span class="s">&quot;.44&quot;</span><span class="p">)</span>

<span class="hll">    <span class="c">#   Set the tail task so that users of my sub pipeline can use it as a dependency</span>
</span><span class="hll">    <span class="c">#       without knowing the details of task names</span>
</span>    <span class="c">#</span>
<span class="hll">    <span class="c">#   Use Task() object directly without having to lookup</span>
</span>    <span class="n">test_pipeline</span><span class="o">.</span><span class="n">set_tail_tasks</span><span class="p">([</span><span class="n">tail_task</span><span class="p">])</span>

<span class="hll">    <span class="c">#   If we try to connect a Pipeline without tail tasks defined, we have to</span>
</span><span class="hll">    <span class="c">#       specify the exact task within the Pipeline.</span>
</span><span class="hll">    <span class="c">#   Otherwise Ruffus will not know which task we mean and throw an exception</span>
</span>    <span class="k">if</span> <span class="n">DEBUG_do_not_define_tail_task</span><span class="p">:</span>
        <span class="n">test_pipeline</span><span class="o">.</span><span class="n">set_tail_tasks</span><span class="p">([])</span>

<span class="hll">    <span class="c"># Set the head task so that users of my sub pipeline send input into it</span>
</span><span class="hll">    <span class="c">#   without knowing the details of task names</span>
</span>    <span class="n">test_pipeline</span><span class="o">.</span><span class="n">set_head_tasks</span><span class="p">([</span><span class="n">test_pipeline</span><span class="p">[</span><span class="n">task_originate</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">test_pipeline</span>

<span class="c">#</span>
<span class="hll"><span class="c">#   Returns a fully formed sub pipeline useable as a building block</span>
</span><span class="c">#</span>
<span class="k">def</span> <span class="nf">make_pipeline2</span><span class="p">(</span> <span class="n">pipeline_name</span> <span class="o">=</span> <span class="s">&quot;pipeline2&quot;</span><span class="p">):</span>
    <span class="n">test_pipeline2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>   <span class="o">=</span> <span class="n">task_1_to_1</span><span class="p">,</span>
<span class="hll">                             <span class="c"># task name</span>
</span>                            <span class="n">name</span>        <span class="o">=</span> <span class="s">&quot;44_to_55&quot;</span><span class="p">,</span>
<span class="hll">                             <span class="c"># placeholder: will be replaced later with set_input()</span>
</span>                            <span class="nb">input</span>       <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="nb">filter</span>      <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.44&quot;</span><span class="p">),</span>
                            <span class="n">output</span>      <span class="o">=</span> <span class="s">&quot;.55&quot;</span><span class="p">)</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>   <span class="n">task_func</span>   <span class="o">=</span> <span class="n">task_m_to_1</span><span class="p">,</span>
                            <span class="nb">input</span>       <span class="o">=</span> <span class="n">test_pipeline2</span><span class="p">[</span><span class="s">&quot;44_to_55&quot;</span><span class="p">],</span>
                            <span class="n">output</span>      <span class="o">=</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;final.output&quot;</span><span class="p">,)</span>

    <span class="c"># Set head and tail</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">set_tail_tasks</span><span class="p">([</span><span class="n">test_pipeline2</span><span class="p">[</span><span class="n">task_m_to_1</span><span class="p">]])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">DEBUG_do_not_define_head_task</span><span class="p">:</span>
        <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">set_head_tasks</span><span class="p">([</span><span class="n">test_pipeline2</span><span class="p">[</span><span class="s">&quot;44_to_55&quot;</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">test_pipeline2</span>


<span class="k">def</span> <span class="nf">run_pipeline</span><span class="p">():</span>

<span class="hll">    <span class="c">#   First two pipelines are created as separate instances by the make_pipeline1 function</span>
</span>    <span class="n">test_pipeline1a</span> <span class="o">=</span> <span class="n">make_pipeline1</span><span class="p">(</span><span class="n">pipeline_name</span> <span class="o">=</span> <span class="s">&quot;pipeline1a&quot;</span><span class="p">,</span> <span class="n">starting_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tempdir</span> <span class="o">+</span> <span class="n">ss</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;a.1&quot;</span><span class="p">,</span> <span class="s">&quot;b.1&quot;</span><span class="p">)])</span>
    <span class="n">test_pipeline1b</span> <span class="o">=</span> <span class="n">make_pipeline1</span><span class="p">(</span><span class="n">pipeline_name</span> <span class="o">=</span> <span class="s">&quot;pipeline1b&quot;</span><span class="p">,</span> <span class="n">starting_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tempdir</span> <span class="o">+</span> <span class="n">ss</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;c.1&quot;</span><span class="p">,</span> <span class="s">&quot;d.1&quot;</span><span class="p">)])</span>

<span class="hll">    <span class="c">#   The Third pipeline is a clone of pipeline1b</span>
</span>    <span class="n">test_pipeline1c</span> <span class="o">=</span> <span class="n">test_pipeline1b</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">new_name</span> <span class="o">=</span> <span class="s">&quot;pipeline1c&quot;</span><span class="p">)</span>

<span class="hll">    <span class="c">#   Set the &quot;originate&quot; files for pipeline1c to (&quot;e.1&quot; and &quot;f.1&quot;)</span>
</span><span class="hll">    <span class="c">#       Otherwise they would use the original (&quot;c.1&quot;, &quot;d.1&quot;)</span>
</span>    <span class="n">test_pipeline1c</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="n">test_pipeline1c</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">tempdir</span> <span class="o">+</span> <span class="n">ss</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;e.1&quot;</span><span class="p">,</span> <span class="s">&quot;f.1&quot;</span><span class="p">)])</span>

<span class="hll">    <span class="c">#   Join all pipeline1a-c to pipeline2</span>
</span>    <span class="n">test_pipeline2</span> <span class="o">=</span> <span class="n">make_pipeline2</span><span class="p">()</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_pipeline1a</span><span class="p">,</span> <span class="n">test_pipeline1b</span><span class="p">,</span> <span class="n">test_pipeline1c</span><span class="p">])</span>


    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">printout_graph</span><span class="p">(</span><span class="s">&quot;test.svg&quot;</span><span class="p">,</span> <span class="s">&quot;svg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">task_m_to_1</span><span class="p">])</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">printout</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">test_pipeline2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">multiprocess</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Test_task</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">tearDown</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">test_subpipelines</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">run_pipeline</span><span class="p">()</span>

        <span class="c"># Check that the output reflecting the pipeline topology is correct.</span>
        <span class="n">correct_output</span> <span class="o">=</span> <span class="s">&#39;tempdir/a.1.55=tempdir/a.1.44+tempdir/a.1.33+tempdir/a.1.22+tempdir/a.1=; tempdir/testdir/whatever.txt=; ; &#39;</span> \
                         <span class="s">&#39;tempdir/b.1.55=tempdir/b.1.44+tempdir/b.1.33+tempdir/b.1.22+tempdir/b.1=; tempdir/testdir/whatever.txt=; ; &#39;</span> \
                         <span class="s">&#39;tempdir/c.1.55=tempdir/c.1.44+tempdir/c.1.33+tempdir/c.1.22+tempdir/c.1=; tempdir/testdir/whatever.txt=; ; &#39;</span> \
                         <span class="s">&#39;tempdir/d.1.55=tempdir/d.1.44+tempdir/d.1.33+tempdir/d.1.22+tempdir/d.1=; tempdir/testdir/whatever.txt=; ; &#39;</span> \
                         <span class="s">&#39;tempdir/e.1.55=tempdir/e.1.44+tempdir/e.1.33+tempdir/e.1.22+tempdir/e.1=; tempdir/testdir/whatever.txt=; ; &#39;</span> \
                         <span class="s">&#39;tempdir/f.1.55=tempdir/f.1.44+tempdir/f.1.33+tempdir/f.1.22+tempdir/f.1=; tempdir/testdir/whatever.txt=; ; &#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tempdir</span> <span class="o">+</span> <span class="s">&quot;final.output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">real_output</span><span class="p">:</span>
            <span class="n">real_output_str</span> <span class="o">=</span> <span class="n">real_output</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">correct_output</span><span class="p">,</span> <span class="n">real_output_str</span><span class="p">)</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorials/new_syntax_code.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="../decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="../decorators/originate.html">@originate</a>                           </li>
            <li><a href="../decorators/split.html">@split</a>                                   </li>
            <li><a href="../decorators/transform.html">@transform</a>                           </li>
            <li><a href="../decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="../decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="../decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="../decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="../decorators/collate.html">@collate</a>                               </li>
            <li><a href="../decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="../decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="../decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="../decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="../decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="../decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="../decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="../decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="../decorators/product.html">@product </a>                              </li>
            <li><a href="../decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="../decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="../decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="../decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="../decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="../decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="../decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="../decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="../drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="../todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        Ruffus v. 2.6
            <li><a href="../index.html">Home</a> | </li>
            <li><a href="../contents.html">Contents</a> | </li>
            <li><a href="../installation.html">Install</a>  | </li>
            <li><a href="new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../faq.html">FAQ</a>  | </li>
            <li><a href="../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="../gallery.html">Gallery</a> |  </li>
            <li><a href="../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>