<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Ruffus is a Computation Pipeline library for python. It is open-sourced, powerful and user-friendly, and widely used in science and bioinformatics" name="description" />
<meta content="python, pipeline, computation, cluster, Ruffus, bioinformatics, parallel' name='keywords" name="keywords" />
<meta content="Leo Goodstadt" name="Author" />
<meta content="Leo Goodstadt" name="Publisher" />
<meta content="ruffus&#64;llew.org.uk" name="Email" />
<meta content="index, follow" name="robots" />
<meta content="en-uk" name="language" />
<meta content="United Kingdom" name="country" />
<meta content="Leo Goodstadt 2009-2014" name="copyright" />

    <title>Chapter 2: Transforming data in a pipeline with @transform &mdash; ruffus 2.6.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6.2 documentation" href="../../index.html" />
    <link rel="next" title="Chapter 3: More on @transform-ing data" href="transform_in_parallel.html" />
    <link rel="prev" title="Chapter 1: An introduction to basic Ruffus syntax" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="transform_in_parallel.html" title="Chapter 3: More on @transform-ing data"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Chapter 1: An introduction to basic Ruffus syntax"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="new-manual-transform-chapter-num-transforming-data-in-a-pipeline-with-transform">
<span id="new-manual-transform"></span><span id="index-0"></span><h1><strong>Chapter 2</strong>: Transforming data in a pipeline with <a class="reference internal" href="../../decorators/transform.html#decorators-transform"><em>&#64;transform</em></a><a class="headerlink" href="#new-manual-transform-chapter-num-transforming-data-in-a-pipeline-with-transform" title="Permalink to this headline">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="manual_contents.html#new-manual-table-of-contents"><em>Manual Table of Contents</em></a></li>
<li><a class="reference internal" href="../../decorators/transform.html#decorators-transform"><em>&#64;transform</em></a> syntax</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Remember to look at the example code:</p>
<ul class="last simple">
<li><a class="reference internal" href="transform_code.html#new-manual-transform-code"><em>Chapter 1: Python Code for Transforming data in a pipeline with &#64;transform</em></a></li>
</ul>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/theoretical_pipeline_schematic.png"><img alt="../../_images/theoretical_pipeline_schematic.png" src="../../_images/theoretical_pipeline_schematic.png" style="width: 610.0px; height: 71.0px;" /></a>
<p>Computational pipelines transform your data in stages until the final result is produced.
Ruffus automates the plumbing in your pipeline. You supply the python functions which perform the data transformation,
and tell Ruffus how these pipeline stages or <a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a> functions are connected together.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>The best way to design a pipeline is to:</strong></p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>write down the file names of the data as it flows across your pipeline</strong></li>
<li><strong>write down the names of functions which transforms the data at each stage of the pipeline.</strong></li>
</ul>
</div></blockquote>
</div>
</div></blockquote>
</div>
<div class="section" id="task-functions-as-recipes">
<h2>Task functions as recipes<a class="headerlink" href="#task-functions-as-recipes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Each <a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a> function of the pipeline is a recipe or
<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Rule-Introduction">rule</a>
which can be applied repeatedly to our data.</p>
<p>For example, one can have</p>
<blockquote>
<div><ul class="simple">
<li>a <tt class="docutils literal"><span class="pre">compile()</span></tt> <em>task</em> which will compile any number of source code files, or</li>
<li>a <tt class="docutils literal"><span class="pre">count_lines()</span></tt> <em>task</em> which will count the number of lines in any file or</li>
<li>an <tt class="docutils literal"><span class="pre">align_dna()</span></tt> <em>task</em> which will align the DNA of many chromosomes.</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="transform-is-a-1-to-1-operation">
<span id="index-1"></span><h2><a class="reference internal" href="../../decorators/transform.html#decorators-transform"><em>&#64;transform</em></a> is a 1 to 1 operation<a class="headerlink" href="#transform-is-a-1-to-1-operation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">&#64;transform</span></tt> is a 1:1 operation because for each input, it generates one output.</p>
<a class="reference internal image-reference" href="../../_images/transform_1_to_1_example.png"><img alt="../../_images/transform_1_to_1_example.png" src="../../_images/transform_1_to_1_example.png" style="width: 535.5px; height: 371.0px;" /></a>
<p>This is obvious when you count the number of jobs at each step. In our example pipeline, there are always
three jobs moving through in step at each stage (<a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a>).</p>
<p>Each <strong>Input</strong> or <strong>Output</strong> is not limited, however, to a single filename. Each job can accept, for example,
a pair of files as its <strong>Input</strong>, or generate more than one file or a dictionary or numbers as its <strong>Output</strong>.</p>
<p>When each job outputs a pair of files, this does not generate two jobs downstream. It just means that the successive
<a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a> in the pipeline will receive a list or tuple of files as its input parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The different sort of decorators in Ruffus determine the <em>topology</em> of your pipeline,
i.e. how the jobs from different tasks are linked together seamlessly.</p>
<p><a class="reference internal" href="../../decorators/transform.html#decorators-transform"><em>&#64;transform</em></a> always generates one <strong>Output</strong> for one <strong>Input</strong>.</p>
<p>In the later parts of the tutorial, we will encounter more decorators which can <em>split up</em>, or <em>join together</em> or <em>group</em> inputs.</p>
<p class="last">In other words, using other decorators <strong>Input</strong> and <strong>Output</strong>  can have <strong>many to one</strong>, <strong>many to many</strong> etc. relationships.</p>
</div>
</div></blockquote>
<div class="section" id="a-pair-of-files-as-the-input">
<h3>A pair of files as the <strong>Input</strong><a class="headerlink" href="#a-pair-of-files-as-the-input" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Let us rewrite our previous example so that the <strong>Input</strong> of the first task
are <a class="reference external" href="http://en.wikipedia.org/wiki/DNA_sequencing_theory#Pairwise_end-sequencing">matching pairs</a>
of DNA sequence files, processed in tandem.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">starting_files</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;a.1.fastq&quot;</span><span class="p">,</span> <span class="s">&quot;a.2.fastq&quot;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;a.1.fastq&quot;</span><span class="p">,</span> <span class="s">&quot;a.2.fastq&quot;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;a.1.fastq&quot;</span><span class="p">,</span> <span class="s">&quot;a.2.fastq&quot;</span><span class="p">)]</span>
<span class="hll">
</span><span class="hll"><span class="c">#</span>
</span><span class="hll"><span class="c">#   STAGE 1 fasta-&gt;sam</span>
</span><span class="c">#</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">starting_files</span><span class="p">,</span>                     <span class="c"># Input = starting files</span>
            <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.1.fastq&quot;</span><span class="p">),</span>                <span class="c">#         suffix = .1.fastq</span>
            <span class="s">&quot;.sam&quot;</span><span class="p">)</span>                            <span class="c"># Output  suffix = .sam</span>
<span class="k">def</span> <span class="nf">map_dna_sequence</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span>
                    <span class="n">output_file</span><span class="p">):</span>
    <span class="c"># remember there are two input files now</span>
    <span class="n">ii1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="hll">    <span class="n">ii2</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="hll">    <span class="n">oo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div></blockquote>
<p>The only changes are to the first task:</p>
<blockquote>
<div><div class="highlight-pycon"><div class="highlight"><pre><span class="go">pipeline_run()</span>
<span class="go">    Job  = [[a.1.fastq, a.2.fastq] -&gt; a.sam] completed</span>
<span class="go">    Job  = [[a.1.fastq, a.2.fastq] -&gt; a.sam] completed</span>
<span class="go">    Job  = [[a.1.fastq, a.2.fastq] -&gt; a.sam] completed</span>
<span class="go">Completed Task = map_dna_sequence</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix</em></a> always matches only the first file name in each <strong>Input</strong>.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="input-and-output-parameters">
<span id="index-2"></span><h2><strong>Input</strong> and <strong>Output</strong> parameters<a class="headerlink" href="#input-and-output-parameters" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><strong>Ruffus</strong> chains together different tasks by taking the <strong>Output</strong> from one job
and plugging it automatically as the <strong>Input</strong> of the next.</p>
<p>The first two parameters of each job are the <strong>Input</strong> and <strong>Output</strong> parameters respectively.</p>
<p>In the above example, we have:</p>
<blockquote>
<div><div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pipeline_run</span><span class="p">()</span>
<span class="go">    Job  = [a.bam -&gt; a.statistics, use_linear_model] completed</span>
<span class="go">    Job  = [b.bam -&gt; b.statistics, use_linear_model] completed</span>
<span class="go">    Job  = [c.bam -&gt; c.statistics, use_linear_model] completed</span>
<span class="go">Completed Task = summarise_bam_file</span>
</pre></div>
</div>
<table border="1" class="docutils">
<caption>Parameters for <tt class="docutils literal"><span class="pre">summarise_bam_file()</span></tt></caption>
<colgroup>
<col width="20%" />
<col width="25%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Inputs</strong></th>
<th class="head"><strong>Outputs</strong></th>
<th class="head"><strong>Extra</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;a.bam&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a.statistics&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;use_linear_model&quot;</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;b.bam&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;b.statistics&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;use_linear_model&quot;</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;c.bam&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;c.statistics&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;use_linear_model&quot;</span></tt></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Extra</strong> parameters are for the consumption of <tt class="docutils literal"><span class="pre">summarise_bam_file()</span></tt> and will not passed to the next task.</p>
<p>Ruffus was designed for pipelines which save intermediate data in files. This is not
compulsory but saving your data in files at each step provides many advantages:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Ruffus can use file system time stamps to check if your pipeline is up to date</li>
<li>Your data is persistent across runs</li>
<li>This is a good way to pass large amounts of data across processes and computational nodes</li>
</ol>
</div></blockquote>
<p>Nevertheless, <em>all</em> the <a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a> parameters can include anything which suits your workflow, from lists of files, to numbers,
sets or tuples. <em>Ruffus</em> imposes few constraints on what <em>you</em>
would like to send to each stage of your pipeline.</p>
<p><em>Ruffus</em> does, however, assume that if the <strong>Input</strong> and <strong>Output</strong> parameter contains strings, these will be interpreted as file names
required by and produced by that job. As we shall see, the modification times of these file names
indicate whether that part of the pipeline is up to date or needs to be rerun.</p>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><strong>Chapter 2</strong>: Transforming data in a pipeline with <tt class="docutils literal"><span class="pre">&#64;transform</span></tt></a><ul>
<li><a class="reference internal" href="#review">Review</a></li>
<li><a class="reference internal" href="#task-functions-as-recipes">Task functions as recipes</a></li>
<li><a class="reference internal" href="#transform-is-a-1-to-1-operation"><tt class="docutils literal"><span class="pre">&#64;transform</span></tt> is a 1 to 1 operation</a><ul>
<li><a class="reference internal" href="#a-pair-of-files-as-the-input">A pair of files as the <strong>Input</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-and-output-parameters"><strong>Input</strong> and <strong>Output</strong> parameters</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter"><strong>Chapter 1</strong>: An introduction to basic <em>Ruffus</em> syntax</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="transform_in_parallel.html"
                        title="next chapter"><strong>Chapter 3</strong>: More on <tt class="docutils literal"><span class="pre">&#64;transform</span></tt>-ing data</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/new_tutorial/transform.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="../../decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="../../decorators/originate.html">@originate</a>                           </li>
            <li><a href="../../decorators/split.html">@split</a>                                   </li>
            <li><a href="../../decorators/transform.html">@transform</a>                           </li>
            <li><a href="../../decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="../../decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="../../decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="../../decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="../../decorators/collate.html">@collate</a>                               </li>
            <li><a href="../../decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="../../decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="../../decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="../../decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="../../decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="../../decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="../../decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="../../decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="../../decorators/product.html">@product </a>                              </li>
            <li><a href="../../decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="../../decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="../../decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="../../decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="../../decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="../../decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="../../decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="../../decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="../../drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="../../todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="transform_in_parallel.html" title="Chapter 3: More on @transform-ing data"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Chapter 1: An introduction to basic Ruffus syntax"
             >previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>