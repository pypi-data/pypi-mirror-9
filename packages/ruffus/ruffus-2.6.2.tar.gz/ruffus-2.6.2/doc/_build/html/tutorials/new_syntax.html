<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Ruffus is a Computation Pipeline library for python. It is open-sourced, powerful and user-friendly, and widely used in science and bioinformatics" name="description" />
<meta content="python, pipeline, computation, cluster, Ruffus, bioinformatics, parallel' name='keywords" name="keywords" />
<meta content="Leo Goodstadt" name="Author" />
<meta content="Leo Goodstadt" name="Publisher" />
<meta content="ruffus&#64;llew.org.uk" name="Email" />
<meta content="index, follow" name="robots" />
<meta content="en-uk" name="language" />
<meta content="United Kingdom" name="country" />
<meta content="Leo Goodstadt 2009-2014" name="copyright" />

    <title>New Object orientated syntax for Ruffus in Version 2.6 &mdash; ruffus 2.6.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6.2 documentation" href="../index.html" />
    <link rel="next" title="Worked Example for New Object orientated syntax for Ruffus in Version 2.6" href="new_syntax_worked_example.html" />
    <link rel="prev" title="Major Features added to Ruffus" href="../history.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="new_syntax_worked_example.html" title="Worked Example for New Object orientated syntax for Ruffus in Version 2.6"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../history.html" title="Major Features added to Ruffus"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="../index.html">Home</a> | </li>
            <li><a href="../contents.html">Contents</a> | </li>
            <li><a href="../installation.html">Install</a>  | </li>
            <li><a href="new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../faq.html">FAQ</a>  | </li>
            <li><a href="../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="../gallery.html">Gallery</a> |  </li>
            <li><a href="#">New syntax in v 2.6</a> | </li>
            <li><a href="../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p><span class="raw-html"><style> .highlight-blue {color:blue} </style></span></p>
<p><span class="raw-html"><style> .highlight-red {color:red} </style></span></p>
<div class="section" id="new-object-orientated-syntax-for-ruffus-in-version-2-6">
<span id="new-syntax"></span><h1>New Object orientated syntax for Ruffus in Version 2.6<a class="headerlink" href="#new-object-orientated-syntax-for-ruffus-in-version-2-6" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>Ruffus Pipelines can now be created and manipulated directly using <span class="highlight-red">Pipeline</span> and <span class="highlight-red">Task</span> objects instead of via decorators.</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may want to go through the <a class="reference internal" href="new_syntax_worked_example.html#new-syntax-worked-example"><em>worked_example</em></a> first.</p>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This traditional Ruffus code:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># task function</span>
<span class="n">starting_files</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;input/a.fasta&quot;</span><span class="p">,</span><span class="s">&quot;input/b.fasta&quot;</span><span class="p">]</span>
<span class="nd">@transform</span><span class="p">(</span><span class="nb">input</span>      <span class="o">=</span> <span class="n">starting_files</span><span class="p">,</span>
           <span class="nb">filter</span>     <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&#39;.fasta&#39;</span><span class="p">),</span>
           <span class="n">output</span>     <span class="o">=</span> <span class="s">&#39;.sam&#39;</span><span class="p">,</span>
           <span class="n">output_dir</span> <span class="o">=</span> <span class="s">&quot;output&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">map_dna_sequence</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">pass</span>

<span class="n">pipeline_run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Can also be written as:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># undecorated task function</span>
<span class="k">def</span> <span class="nf">map_dna_sequence</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">pass</span>

<span class="n">starting_files</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;input/a.fasta&quot;</span><span class="p">,</span><span class="s">&quot;input/b.fasta&quot;</span><span class="p">]</span>

<span class="hll"><span class="c">#   make ruffus Pipeline() object</span>
</span><span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="n">my_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>  <span class="o">=</span> <span class="n">map_dna_sequence</span><span class="p">,</span>
                      <span class="nb">input</span>      <span class="o">=</span> <span class="n">starting_files</span><span class="p">,</span>
                      <span class="nb">filter</span>     <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&#39;.fasta&#39;</span><span class="p">),</span>
                      <span class="n">output</span>     <span class="o">=</span> <span class="s">&#39;.sam&#39;</span><span class="p">,</span>
                      <span class="n">output_dir</span> <span class="o">=</span> <span class="s">&quot;output&quot;</span><span class="p">)</span>

<span class="n">my_pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">The two different syntax are almost identical:</div>
<div class="line">The first parameter <strong>task_func=</strong><tt class="docutils literal"><span class="pre">your_python_function</span></tt> is mandatory.</div>
<div class="line">Otherwise, all other parameters are in the same order as before, and can be given by position or as named arguments.</div>
</div>
</div></blockquote>
</div>
<div class="section" id="advantages">
<h2>Advantages<a class="headerlink" href="#advantages" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>These are some of the advantages of the new syntax:</p>
<ol class="arabic">
<li><p class="first"><strong>Pipeline topology is assembled in one place</strong></p>
<p>This is a matter of personal preference.</p>
<p>Nevertheless, using decorators to locally annotate python functions with pipeline parameters arguably
helps separation of concerns.</p>
</li>
<li><p class="first"><strong>Pipelines can be created</strong> <em>on the fly</em></p>
<p>For example, using parameters parsed from configuration files.</p>
<p>Ruffus pipelines no longer have to be defined at global scope.</p>
</li>
<li><p class="first"><strong>Reuse common sub-pipelines</strong></p>
<p>Shared sub pipelines can be created from discrete python modules and joined together
as needed. Bioinformaticists may have &#8220;mapping&#8221;, &#8220;aligning&#8221;, &#8220;variant-calling&#8221; sub-pipelines etc.</p>
</li>
<li><p class="first"><strong>Multiple Tasks can share the same python function</strong></p>
<p>Tasks are normally referred to by their associated functions (as with decoratored Ruffus tasks).
However, you can also disambiguate Tasks by specifying their name directly.</p>
</li>
<li><p class="first"><strong>Pipeline topology can be specified at run time</strong></p>
<p>Some (especially bioinformatics) tasks require binary merging. This can be very inconvenient.</p>
<p>For example, if we have 8 data files, we need three successive rounds of merging (8-&gt;4-&gt;2-&gt;1)
or three tasks) to produce the output. But if we are given 10 data files, we now find that
we needed to have four tasks for four rounds of merging (10-&gt;5-&gt;3-&gt;2-&gt;1).</p>
<p>There was previously no easy way to arrange different Ruffus topologies in response to the
data. Now we can add as many extra merging tasks to our pipeline (all sharing the same underlying
python function) as needed.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="compatability">
<h2>Compatability<a class="headerlink" href="#compatability" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>The changes are fully backwards compatibile. All valid Ruffus code continues to work</li>
<li>Decorators and <tt class="docutils literal"><span class="pre">Pipeline</span></tt> objects can be used interchangeably:</li>
</ul>
<dl class="docutils">
<dt>Decorated functions are automatically part of a default constructed <tt class="docutils literal"><span class="pre">Pipeline</span></tt> named <tt class="docutils literal"><span class="pre">&quot;main&quot;</span></tt>.</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="n">main_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">pipelines</span><span class="p">[</span><span class="s">&quot;main&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<p>In the following example, a pipeline using the
Ruffus with classes syntax <span class="highlight-red">(1)</span> and <span class="highlight-red">(3)</span> has a traditionally decorated task function in the middle <span class="highlight-red">(2)</span>.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># get default pipeline</span>
<span class="n">main_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">pipelines</span><span class="p">[</span><span class="s">&quot;main&quot;</span><span class="p">]</span>

<span class="c"># undecorated task functions</span>
<span class="k">def</span> <span class="nf">compress_sam_to_bam</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">create_files</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c">#</span>
<span class="hll"><span class="c">#   1. Ruffus with classes</span>
</span><span class="c">#</span>
<span class="n">starting_files</span> <span class="o">=</span> <span class="n">main_pipeline</span><span class="o">.</span><span class="n">originate</span><span class="p">(</span><span class="n">create_files</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;input/a.fasta&quot;</span><span class="p">,</span><span class="s">&quot;input/b.fasta&quot;</span><span class="p">])</span>\
    <span class="o">.</span><span class="n">follows</span><span class="p">(</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="s">&quot;output&quot;</span><span class="p">))</span>

<span class="c">#</span>
<span class="hll"><span class="c">#   2. Ruffus with python decorations</span>
</span><span class="c">#</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">starting_files</span><span class="p">,</span>
           <span class="n">suffix</span><span class="p">(</span><span class="s">&#39;.fasta&#39;</span><span class="p">),</span>
           <span class="s">&#39;.sam&#39;</span><span class="p">,</span>
           <span class="n">output_dir</span> <span class="o">=</span> <span class="s">&quot;output&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">map_dna_sequence</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c">#</span>
<span class="hll"><span class="c">#   3. Ruffus with classes</span>
</span><span class="c">#</span>
<span class="n">main_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">task_func</span>   <span class="o">=</span> <span class="n">compress_sam_to_bam</span><span class="p">,</span>
                        <span class="nb">input</span>       <span class="o">=</span> <span class="n">map_dna_sequence</span><span class="p">,</span>
                        <span class="nb">filter</span>      <span class="o">=</span> <span class="n">suffix</span><span class="p">(</span><span class="s">&quot;.sam&quot;</span><span class="p">),</span>
                        <span class="n">output</span>      <span class="o">=</span> <span class="s">&quot;.bam&quot;</span><span class="p">)</span>

<span class="c"># main_pipeline.run()</span>
<span class="c">#    or</span>
<span class="n">pipeline_run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="class-methods">
<h2>Class methods<a class="headerlink" href="#class-methods" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The <strong>ruffus.Pipeline</strong> class has the following self-explanatory methods:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">Pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">printout</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">printout_graph</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>These methods return a <strong>ruffus.Task</strong> object</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">Pipeline</span><span class="o">.</span><span class="n">originate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">Pipeline</span><span class="o">.</span><span class="n">collate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">subdivide</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">Pipeline</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">Pipeline</span><span class="o">.</span><span class="n">follows</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">check_if_uptodate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">graphviz</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">Pipeline</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Pipeline</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>A Ruffus <strong>Task</strong> can be modified with the following methods</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">Task</span><span class="o">.</span><span class="n">active_if</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">check_if_uptodate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">follows</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">graphviz</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">jobs_limit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Task</span><span class="o">.</span><span class="n">posttask</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="call-chaining">
<h2>Call chaining<a class="headerlink" href="#call-chaining" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The syntax is designed to allow call chaining:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">Pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">follows</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">active_if</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">graphviz</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="referring-to-tasks">
<h2>Referring to Tasks<a class="headerlink" href="#referring-to-tasks" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Ruffus pipelines are chained together or specified by referring to each stage or Task.</p>
<p><span class="highlight-red">(1)</span> and <span class="highlight-red">(2)</span> are ways to referring to tasks that Ruffus has always supported.</p>
<p><span class="highlight-red">(3)</span> - <span class="highlight-red">(6)</span> are new to Ruffus v 2.6 but apply
to both using decorators or the new Ruffus with classes syntax.</p>
</div></blockquote>
<div class="section" id="python-function">
<h3>1) Python function<a class="headerlink" href="#python-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="nd">@transform</span><span class="p">(</span><span class="n">prev_task</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_task</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">next_task</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="python-function-name-using-output-from">
<h3>2) Python function name (using <em>output_from</em>)<a class="headerlink" href="#python-function-name-using-output-from" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">output_from</span><span class="p">(</span><span class="s">&quot;prev_task&quot;</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The above <span class="highlight-red">(1) and (2) only work if the Python function specifies the task unambiguously in a pipeline.</span>
If you reuse the same Python function for multiple tasks, use the following methods.</p>
<p class="last">Ruffus will complain with Exceptions if your code is ambiguous.</p>
</div>
</div>
<div class="section" id="task-object">
<h3>3) Task object<a class="headerlink" href="#task-object" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre> <span class="n">prev_task</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="hll"> <span class="c"># prev_task is a Task object</span>
</span> <span class="n">next_task</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">prev_task</span><span class="p">,</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="task-name-using-output-from">
<h3>4) Task name (using <em>output_from</em>)<a class="headerlink" href="#task-name-using-output-from" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="hll"><span class="c"># name this task &quot;prev_task&quot;</span>
</span><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;prev_task&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">output_from</span><span class="p">(</span><span class="s">&quot;prev_task&quot;</span><span class="p">),</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Tasks from other pipelines can be referred to using full qualified names in the <strong>pipeline</strong>::<em>task</em> format</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">output_from</span><span class="p">(</span><span class="s">&quot;other_pipeline::prev_task&quot;</span><span class="p">),</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div></blockquote>
</div>
<div class="section" id="pipeline">
<h3>5) Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>When we are assembling our pipeline from sub-pipelines (especially those in other modules which other people might have written)
it is inconvenient to break encapsulation to find out the component <strong>Task</strong> of the subpipeline.</p>
<p>In which case, the sub-pipeline author can assign particular tasks to the <strong>head</strong> and <strong>tail</strong> of the pipeline.
The pipeline will be an alias for these:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Note: these functions take lists</span>
<span class="n">sub_pipeline</span><span class="o">.</span><span class="n">set_head_tasks</span><span class="p">([</span><span class="n">first_task</span><span class="p">])</span>
<span class="n">sub_pipeline</span><span class="o">.</span><span class="n">set_tail_tasks</span><span class="p">([</span><span class="n">last_task</span><span class="p">])</span>

<span class="hll"><span class="c"># first_task.set_input(...)</span>
</span><span class="n">sub_pipeline</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="s">&quot;*.txt&quot;</span><span class="p">)</span>

<span class="hll"><span class="c"># (input = last_task,...)</span>
</span><span class="n">main_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">sub_pipeline</span><span class="p">,</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
<p>If you don&#8217;t have access to a pipeline object, you can look it up via the Pipeline object</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="hll"><span class="c"># This is the default &quot;main&quot; pipeline which holds decorated task functions</span>
</span><span class="n">main_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">pipelines</span><span class="p">[</span><span class="s">&quot;main&quot;</span><span class="p">]</span>

<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>

<span class="n">alias_to_my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">pipelines</span><span class="p">[</span><span class="s">&quot;test&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="lookup-task-via-the-pipeline">
<h3>6) Lookup Task via the Pipeline<a class="headerlink" href="#lookup-task-via-the-pipeline" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>We can ask a Pipeline to lookup task names, functions and function names for us.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="hll"><span class="c"># Lookup task name</span>
</span><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">[</span><span class="s">&quot;prev_task&quot;</span><span class="p">],</span> <span class="o">....</span><span class="p">)</span>

<span class="hll"><span class="c"># Lookup via python function</span>
</span><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">[</span><span class="n">python_function</span><span class="p">],</span> <span class="o">....</span><span class="p">)</span>

<span class="hll"><span class="c"># Lookup via python function name</span>
</span><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">[</span><span class="s">&quot;python_function_name&quot;</span><span class="p">],</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
<p>This is straightforward if the lookup is unambiguous for the pipeline.</p>
<p>If the names are not found in the pipeline, Ruffus will look across all pipelines.</p>
<p>Any ambiguities will result in an immediate error.</p>
<p><em>In extremis</em>, you can use pipeline qualified names</p>
<div class="highlight-python"><div class="highlight"><pre><span class="hll"><span class="c"># Pipeline qualified task name</span>
</span><span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">[</span><span class="s">&quot;other_pipeline::prev_task&quot;</span><span class="p">],</span> <span class="o">....</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All this will be much clearer going through the <a class="reference internal" href="new_syntax_worked_example.html#new-syntax-worked-example"><em>worked_example</em></a>.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">New Object orientated syntax for Ruffus in Version 2.6</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#advantages">Advantages</a></li>
<li><a class="reference internal" href="#compatability">Compatability</a></li>
<li><a class="reference internal" href="#class-methods">Class methods</a></li>
<li><a class="reference internal" href="#call-chaining">Call chaining</a></li>
<li><a class="reference internal" href="#referring-to-tasks">Referring to Tasks</a><ul>
<li><a class="reference internal" href="#python-function">1) Python function</a></li>
<li><a class="reference internal" href="#python-function-name-using-output-from">2) Python function name (using <em>output_from</em>)</a></li>
<li><a class="reference internal" href="#task-object">3) Task object</a></li>
<li><a class="reference internal" href="#task-name-using-output-from">4) Task name (using <em>output_from</em>)</a></li>
<li><a class="reference internal" href="#pipeline">5) Pipeline</a></li>
<li><a class="reference internal" href="#lookup-task-via-the-pipeline">6) Lookup Task via the Pipeline</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../history.html"
                        title="previous chapter">Major Features added to Ruffus</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="new_syntax_worked_example.html"
                        title="next chapter">Worked Example for New Object orientated syntax for Ruffus in Version 2.6</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorials/new_syntax.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="../decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="../decorators/originate.html">@originate</a>                           </li>
            <li><a href="../decorators/split.html">@split</a>                                   </li>
            <li><a href="../decorators/transform.html">@transform</a>                           </li>
            <li><a href="../decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="../decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="../decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="../decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="../decorators/collate.html">@collate</a>                               </li>
            <li><a href="../decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="../decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="../decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="../decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="../decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="../decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="../decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="../decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="../decorators/product.html">@product </a>                              </li>
            <li><a href="../decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="../decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="../decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="../decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="../decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="../decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="../decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="../decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="../pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="../drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="../todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="new_syntax_worked_example.html" title="Worked Example for New Object orientated syntax for Ruffus in Version 2.6"
             >next</a> |</li>
        <li class="right" >
          <a href="../history.html" title="Major Features added to Ruffus"
             >previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="../index.html">Home</a> | </li>
            <li><a href="../contents.html">Contents</a> | </li>
            <li><a href="../installation.html">Install</a>  | </li>
            <li><a href="new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../faq.html">FAQ</a>  | </li>
            <li><a href="../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="../gallery.html">Gallery</a> |  </li>
            <li><a href="#">New syntax in v 2.6</a> | </li>
            <li><a href="../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>