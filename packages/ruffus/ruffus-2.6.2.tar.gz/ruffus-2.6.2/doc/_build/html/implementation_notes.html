<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Implementation Tips &mdash; ruffus 2.6.2 documentation</title>
    
    <link rel="stylesheet" href="_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6.2 documentation" href="index.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Where I see Ruffus going" href="todo.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="faq.html" title="FAQ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="todo.html" title="Where I see Ruffus going"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="index.html">Home</a> | </li>
            <li><a href="contents.html">Contents</a> | </li>
            <li><a href="installation.html">Install</a>  | </li>
            <li><a href="tutorials/new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="tutorials/new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="faq.html">FAQ</a>  | </li>
            <li><a href="cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="tutorials/new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="gallery.html">Gallery</a> |  </li>
            <li><a href="tutorials/new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="implementation-tips">
<h1>Implementation Tips<a class="headerlink" href="#implementation-tips" title="Permalink to this headline">¶</a></h1>
<div class="section" id="items-remaining-for-current-release">
<h2>Items remaining for current release<a class="headerlink" href="#items-remaining-for-current-release" title="Permalink to this headline">¶</a></h2>
<div class="section" id="code">
<h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li>update_checksum_level_on_tasks(checksum_level) is non reentrant</li>
<li><tt class="docutils literal"><span class="pre">Task.description_with_args_placeholder</span></tt> needs to only fill in placeholders at the last minute
Otherwise cloned pipelines will have the wrong name</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li>output_dir for &#64;mkdir</li>
<li>When are things defined / linked up</li>
<li>When can we join up Pipelines / tasks / set_input()?</li>
<li>Sub pipeline</li>
<li>Whether setup occurs <tt class="docutils literal"><span class="pre">pipeline_run()</span></tt> where <tt class="docutils literal"><span class="pre">target_tasks</span></tt> and <tt class="docutils literal"><span class="pre">forcedtorun_tasks</span></tt> are in different linked or unlinked pipelines</li>
<li>name lookup</li>
<li>Task (dependency) parsing inside &#64;transform, pipeline.transform(input = , add_inputs, replace_inputs =), pipeline.split(..., output=)</li>
<li><tt class="docutils literal"><span class="pre">mkdir()</span></tt> should not be allowed inside input parameters apart from &#64;follows</li>
<li>Cannot dependency cannot be self</li>
<li><tt class="docutils literal"><span class="pre">Pipeline.clone()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Task.set_input()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&#64;product</span></tt> <tt class="docutils literal"><span class="pre">set_input</span></tt> should take (<tt class="docutils literal"><span class="pre">input</span></tt>, <tt class="docutils literal"><span class="pre">input2</span></tt>...)</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="release">
<h2>Release<a class="headerlink" href="#release" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">Change <tt class="docutils literal"><span class="pre">ruffus_version.py</span></tt></p>
</li>
<li><p class="first">Rebuild pdf and copy it to <tt class="docutils literal"><span class="pre">doc/static_data</span></tt></p>
<blockquote>
<div><p>cd doc
make latexpdf
cp _build/latex/ruffus.pdf static_data</p>
</div></blockquote>
</li>
<li><p class="first">Rebuild documentation:</p>
<div class="highlight-python"><div class="highlight"><pre>make htmlsync
</pre></div>
</div>
</li>
<li><p class="first">tag git with, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag -a v2.6 -m &quot;Version 2.6&quot;
</pre></div>
</div>
</li>
<li><p class="first">Upload to pypi:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py sdist --format=gztar upload
</pre></div>
</div>
</li>
<li><p class="first">Upload to repository:</p>
<div class="highlight-python"><div class="highlight"><pre>git push googlecode
git push
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="blogger">
<h2>blogger<a class="headerlink" href="#blogger" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>.article-content h2 {color: #ad3a2b}
.article-content h3 {color: #0100b4}
    #header .header-bar .title h1
    {
    background-image: url(&#39;http://www.ruffus.org.uk/_static/small_logo.png&#39;);
    background-repeat: no-repeat;
    background-position: left;
    }
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="dbdict-py">
<h2>dbdict.py<a class="headerlink" href="#dbdict-py" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This is an sqlite backed dictionary originally written by Jacob Sondergaard and
contributed by Jake Biesinger who added automatic pickling of python objects.</p>
<p>The pickling code was refactored out by Leo Goodstadt into separate functions as
part of the preparation to make Ruffus python3 ready.</p>
<p>Python original saved (pickled) objects as 7 bit ASCII strings. Later formats
(protocol = -1 is the latest format) uses 8 bit strings and are rather more efficient.</p>
<p>These then need to be saved as BLOBs to sqlite3 rather than normal strings. We
can signal this by wrapping the pickled string in a object providing a &#8220;buffer interface&#8221;.
This is <tt class="docutils literal"><span class="pre">buffer</span></tt> in python2.6/2.7 and <tt class="docutils literal"><span class="pre">memoryview</span></tt> in python3.</p>
<p><a class="reference external" href="http://bugs.python.org/issue7723">http://bugs.python.org/issue7723</a> suggests there is no portable python2/3 way to write
blobs to Sqlite without these two incompatible wrappers.
This would require conditional compilation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&gt;=</span> <span class="mh">0x03000000</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">buffer</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Despite the discussion on the bug report, sqlite3.Binary seems to work.
We shall see if this is portable to python3.</p>
</div></blockquote>
</div>
<div class="section" id="how-to-write-new-decorators">
<h2>how to write new decorators<a class="headerlink" href="#how-to-write-new-decorators" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>New placeholder class. E.g. for <tt class="docutils literal"><span class="pre">&#64;new_deco</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">new_deco</span><span class="p">(</span><span class="n">task_decorator</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Add to list of action names and ids:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">action_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;unspecified&quot;</span><span class="p">,</span>
                <span class="o">...</span>
                <span class="s">&quot;task_new_deco&quot;</span><span class="p">,</span>

<span class="n">action_task_new_deco</span>     <span class="o">=</span>  <span class="mi">15</span>
</pre></div>
</div>
<p>Add function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_transform</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_args</span><span class="p">):</span>
</pre></div>
</div>
<p>Add documentation to:</p>
<blockquote>
<div><ul class="simple">
<li>decorators/NEW_DECORATOR.rst</li>
<li>decorators/decorators.rst</li>
<li>_templates/layout.html</li>
<li>manual</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="implementation-notes">
<h1>Implementation notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h1>
<p>N.B. Remember to cite Jake Biesinger and see if he is interested to be a co-author if we ever resubmit the drastically changed version...
He contributed checkpointing, travis and tox etc.</p>
<div class="section" id="ctrl-c-handling">
<span id="todo-misfeatures"></span><h2><tt class="docutils literal"><span class="pre">Ctrl-C</span></tt> handling<a class="headerlink" href="#ctrl-c-handling" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Pressing <tt class="docutils literal"><span class="pre">Ctrl-C</span></tt> left dangling process in Ruffus 2.4 because <tt class="docutils literal"><span class="pre">KeyboardInterrupt</span></tt> does not play nice with python <tt class="docutils literal"><span class="pre">multiprocessing.Pool</span></tt>
See <a class="reference external" href="http://stackoverflow.com/questions/1408356/keyboard-interrupts-with-pythons-multiprocessing-pool/1408476#1408476">http://stackoverflow.com/questions/1408356/keyboard-interrupts-with-pythons-multiprocessing-pool/1408476#1408476</a></p>
<p><a class="reference external" href="http://bryceboe.com/2012/02/14/python-multiprocessing-pool-and-keyboardinterrupt-revisited/">http://bryceboe.com/2012/02/14/python-multiprocessing-pool-and-keyboardinterrupt-revisited/</a> provides a reimplementation of Pool which
however only works when you have a fixed number of jobs which should then run in parallel to completion. Ruffus is considerably more
complicated because we have a variable number of jobs completing and being submitted into the job queue at any one time. Think
of tasks stalling waiting for the dependent tasks to complete and then all the jobs of the task being released onto the queue</p>
<p>The solution is</p>
<blockquote>
<div><ol class="arabic simple">
<li>Use a <tt class="docutils literal"><span class="pre">timeout</span></tt> parameter when using <tt class="docutils literal"><span class="pre">IMapIterator.next(timeout=None)</span></tt> to iterate through <tt class="docutils literal"><span class="pre">pool.imap_unordered</span></tt> because only timed <tt class="docutils literal"><span class="pre">condition</span></tt> s can be interruptible by signals...!!</li>
<li>This involves rewriting the <tt class="docutils literal"><span class="pre">for</span></tt> loop manually as a <tt class="docutils literal"><span class="pre">while</span></tt> loop</li>
<li>We use a timeout of <tt class="docutils literal"><span class="pre">99999999</span></tt>, i.e. 3 years, which should be enough for any job to complete...</li>
<li>Googling after the fact, it looks like the galaxy guys (cool dudes or what) have written similar <a class="reference external" href="https://galaxy-dist.readthedocs.org/en/latest/_modules/galaxy/objectstore/s3_multipart_upload.html">code</a></li>
<li><tt class="docutils literal"><span class="pre">next()</span></tt> for normal iterators do not take <tt class="docutils literal"><span class="pre">timeout</span></tt> as an extra parameter so we have to wrap next in a conditional :-(. The galaxy guys do a <a class="reference external" href="http://en.wikipedia.org/wiki/Shim_(computing)">shim</a> around <tt class="docutils literal"><span class="pre">next()</span></tt> but that is as much obsfucation as a simple if...</li>
<li>After jobs are interrupted by a signal, we rethrow with our own exception because we want something that inherits from <tt class="docutils literal"><span class="pre">Exception</span></tt> unlike <tt class="docutils literal"><span class="pre">KeyboardInterrupt</span></tt></li>
<li>When a signal happens, we need to immediately stop <tt class="docutils literal"><span class="pre">feed_job_params_to_process_pool()</span></tt> from sending more parameters into the job queue (<tt class="docutils literal"><span class="pre">parameter_q</span></tt>)
We use a proxy to a <tt class="docutils literal"><span class="pre">multiprocessing.Event</span></tt> (via <tt class="docutils literal"><span class="pre">syncmanager.Event()</span></tt>). When <tt class="docutils literal"><span class="pre">death_event</span></tt> is set, all further processing stops...</li>
<li>We also signal that all jobs should finish by putting <tt class="docutils literal"><span class="pre">all_tasks_complete()</span></tt> into <tt class="docutils literal"><span class="pre">parameter_q</span></tt> but only <tt class="docutils literal"><span class="pre">death_event</span></tt> prevents jobs already in the queue from going through</li>
<li>Ater signalling, some of the child processes appear to be dead by the time we start cleaning up. <tt class="docutils literal"><span class="pre">pool.terminate()</span></tt> sometimes tries and fails to
re-connect to the the <tt class="docutils literal"><span class="pre">death_event</span></tt> proxy via sockets and throws an exception. We should really figure out a better solution but in the meantime
wrapping it in a <tt class="docutils literal"><span class="pre">try</span> <span class="pre">/</span> <span class="pre">except</span></tt> allows a clean exit.</li>
<li>If a vanilla exception is raised without multiprocessing running, we still need to first save the exception in <tt class="docutils literal"><span class="pre">job_errors</span></tt> (even if it is just one) before
cleaning up, because the cleaning up process may lead to further (ignored) exceptions which would overwrite the current exception when we need to rethrow it</li>
</ol>
</div></blockquote>
<p>Exceptions thrown in the middle of a multiprocessing / multithreading job appear to be handled gracefully.</p>
<p>For drmaa jobs, <tt class="docutils literal"><span class="pre">qdel</span></tt> may still be necessary.</p>
</div></blockquote>
</div>
<div class="section" id="python3-compatability">
<h2>Python3 compatability<a class="headerlink" href="#python3-compatability" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Required extensive changes especially in unit test code.</p>
<p>Changes:</p>
<ol class="arabic">
<li><p class="first"><tt class="docutils literal"><span class="pre">sort</span></tt> in python3 does not order mixed types, i.e. <tt class="docutils literal"><span class="pre">int()</span></tt>, <tt class="docutils literal"><span class="pre">list()</span></tt> and <tt class="docutils literal"><span class="pre">str()</span></tt> are incommensurate</p>
<ul>
<li><p class="first">In <tt class="docutils literal"><span class="pre">task.get_output_files</span> <span class="pre">(...)</span></tt>, sort after conversion to string</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_filenames</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">In <tt class="docutils literal"><span class="pre">file_name_parameters.py</span></tt>: <tt class="docutils literal"><span class="pre">collate_param_factory</span> <span class="pre">(...)</span></tt>, <tt class="docutils literal"><span class="pre">sort</span></tt> after conversion to string, then <tt class="docutils literal"><span class="pre">groupby</span></tt> without string conversion. This is
because we can&#8217;t guarantee that two different objects do not have the same string representation. But <tt class="docutils literal"><span class="pre">groupby</span></tt> requires that similar things are adjacent...</p>
<p>In other words, <tt class="docutils literal"><span class="pre">groupby</span></tt> is a refinement of <tt class="docutils literal"><span class="pre">sorted</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">output_extra_params</span><span class="p">,</span> <span class="n">grouped_params</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">io_params_iter</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_output_extras_str</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_output_extras</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">print()</span></tt> is a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">items()</span></tt> only returns a list in python2. Rewrite <tt class="docutils literal"><span class="pre">dict.iteritems()</span></tt> whenever this might cause a performance bottleneck</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">zip</span></tt> and <tt class="docutils literal"><span class="pre">map</span></tt> return iterators. Conditionally import in python2</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03000000</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">future_builtins</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">map</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">cPickle-&gt;pickle</span></tt> <tt class="docutils literal"><span class="pre">CStringIO-&gt;io</span></tt> need to be conditionally imported</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">StringIO</span> <span class="kn">as</span> <span class="nn">io</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">io</span> <span class="kn">as</span> <span class="nn">io</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">map</span></tt> code can be changed to list comprehensions. Use <tt class="docutils literal"><span class="pre">2to3</span></tt> to do heavy lifting</p>
</li>
<li><p class="first">All normal strings are unicode in python3. Have to use <tt class="docutils literal"><span class="pre">bytes</span></tt> to support 8-bit char arrays.
Normally, this means that <tt class="docutils literal"><span class="pre">str</span></tt> &#8220;just works&#8221;. However, to provide special handling of
both 8-bit and unicode strings in python2, we often need to check for <tt class="docutils literal"><span class="pre">isinstance(xxx,</span> <span class="pre">basestring)</span></tt>.</p>
<p>We need to conditionally define:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&gt;=</span> <span class="mh">0x03000000</span><span class="p">:</span>
    <span class="c"># everything is unicode in python3</span>
    <span class="n">path_str_type</span> <span class="o">=</span> <span class="nb">str</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">path_str_type</span> <span class="o">=</span> <span class="nb">basestring</span>

<span class="c"># further down...</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compiled_regex</span><span class="p">,</span> <span class="n">path_str_type</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="refactoring-parameter-handling">
<h2>Refactoring: parameter handling<a class="headerlink" href="#refactoring-parameter-handling" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="docutils">
<dt>Though the code is still split in a not very sensible way between <tt class="docutils literal"><span class="pre">ruffus_utility.py</span></tt>, <tt class="docutils literal"><span class="pre">file_name_parameters.py</span></tt> and <tt class="docutils literal"><span class="pre">task.py</span></tt>,</dt>
<dd>some rationalisation has taken place, and comments added so further refactoring can be made more easily.</dd>
</dl>
<p>Common code for:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">file_name_parameters</span><span class="o">.</span><span class="n">split_ex_param_factory</span><span class="p">()</span>
<span class="n">file_name_parameters</span><span class="o">.</span><span class="n">transform_param_factory</span><span class="p">()</span>
<span class="n">file_name_parameters</span><span class="o">.</span><span class="n">collate_param_factory</span><span class="p">()</span>
</pre></div>
</div>
<p>has been moved to <tt class="docutils literal"><span class="pre">file_name_parameters.py.yield_io_params_per_job()</span></tt></p>
<p>unit tests added to <tt class="docutils literal"><span class="pre">test_file_name_parameters.py</span></tt> and <tt class="docutils literal"><span class="pre">test_ruffus_utility.py</span></tt></p>
</div></blockquote>
</div>
<div class="section" id="formatter">
<h2><tt class="docutils literal"><span class="pre">formatter</span></tt><a class="headerlink" href="#formatter" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">get_all_paths_components(paths,</span> <span class="pre">regex_str)</span></tt> in <tt class="docutils literal"><span class="pre">ruffus_utility.py</span></tt></p>
<p>Input files names are first squished into a flat list of files.
<tt class="docutils literal"><span class="pre">get_all_paths_components()</span></tt> returns both the regular expression matches and the break down of the path.</p>
<p>In case of name clashes, the classes with higher priority override:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Captures by name</p>
</li>
<li><p class="first">Captures by index</p>
</li>
<li><dl class="first docutils">
<dt>Path components:</dt>
<dd><p class="first last">&#8216;ext&#8217; = extension with dot
&#8216;basename&#8217; = file name without extension
&#8216;path&#8217; = path before basename, not ending with slash
&#8216;subdir&#8217; = list of directories starting with the most nested and ending with the root (if normalised)
&#8216;subpath&#8217; = list of &#8216;path&#8217; with successive directories removed starting with the most nested and ending with the root (if normalised)</p>
</dd>
</dl>
</li>
</ol>
<p>E.g.  <tt class="docutils literal"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">'/a/b/c/sample1.bam'</span></tt>, <tt class="docutils literal"><span class="pre">formatter=r&quot;(.*)(?P&lt;id&gt;\d+)\.(.+)&quot;)</span></tt> returns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span><span class="p">:</span>          <span class="s">&#39;/a/b/c/sample1.bam&#39;</span><span class="p">,</span>           <span class="o">//</span> <span class="n">Entire</span> <span class="n">match</span> <span class="n">captured</span> <span class="n">by</span> <span class="n">index</span>
<span class="mi">1</span><span class="p">:</span>          <span class="s">&#39;/a/b/c/sample&#39;</span><span class="p">,</span>                <span class="o">//</span> <span class="n">captured</span> <span class="n">by</span> <span class="n">index</span>
<span class="mi">2</span><span class="p">:</span>          <span class="s">&#39;bam&#39;</span><span class="p">,</span>                          <span class="o">//</span> <span class="n">captured</span> <span class="n">by</span> <span class="n">index</span>
<span class="s">&#39;id&#39;</span><span class="p">:</span>       <span class="s">&#39;1&#39;</span>                             <span class="o">//</span> <span class="n">captured</span> <span class="n">by</span> <span class="n">name</span>
<span class="s">&#39;ext&#39;</span><span class="p">:</span>      <span class="s">&#39;.bam&#39;</span><span class="p">,</span>
<span class="s">&#39;subdir&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">],</span>
<span class="s">&#39;subpath&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s">&#39;/a/b/c&#39;</span><span class="p">,</span> <span class="s">&#39;/a/b&#39;</span><span class="p">,</span> <span class="s">&#39;/a&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">],</span>
<span class="s">&#39;path&#39;</span><span class="p">:</span>     <span class="s">&#39;/a/b/c&#39;</span><span class="p">,</span>
<span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;sample1&#39;</span><span class="p">,</span>
</pre></div>
</div>
</div></blockquote>
<p>The code is in <tt class="docutils literal"><span class="pre">ruffus_utility.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">results</span> <span class="o">=</span> <span class="n">get_all_paths_components</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">regex_str</span><span class="p">)</span>
<span class="n">string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>All the magic is hidden inside black boxes <tt class="docutils literal"><span class="pre">filename_transform</span></tt> classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">t_suffix_filename_transform</span><span class="p">(</span><span class="n">t_filename_transform</span><span class="p">):</span>
<span class="k">class</span> <span class="nc">t_regex_filename_transform</span><span class="p">(</span><span class="n">t_filename_transform</span><span class="p">):</span>
<span class="k">class</span> <span class="nc">t_format_filename_transform</span><span class="p">(</span><span class="n">t_filename_transform</span><span class="p">):</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="formatter-regex-and-suffix">
<h3><tt class="docutils literal"><span class="pre">formatter()</span></tt>: <tt class="docutils literal"><span class="pre">regex()</span></tt> and <tt class="docutils literal"><span class="pre">suffix()</span></tt><a class="headerlink" href="#formatter-regex-and-suffix" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The previous behaviour with regex() where mismatches fail even if no substitution is made is retained by the use of <tt class="docutils literal"><span class="pre">re.subn()</span></tt>.
This is a corner case but I didn&#8217;t want user code to break</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># filter on &quot;.txt&quot;</span>
<span class="n">input_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;a.wrong&quot;</span><span class="p">,</span> <span class="s">&quot;b.txt&quot;</span><span class="p">]</span>
<span class="n">regex</span><span class="p">(</span><span class="s">&quot;(.txt)$&quot;</span><span class="p">)</span>

<span class="c"># fails, no substitution possible</span>
<span class="s">r&quot;\1&quot;</span>

<span class="c"># fails anyway even through regular expression matches not referenced...</span>
<span class="s">r&quot;output.filename&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="product">
<h2>&#64;product()<a class="headerlink" href="#product" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Use combinatoric generators from itertools and keep that naming scheme</li>
<li>Put all new generators in an <tt class="docutils literal"><span class="pre">combinatorics</span></tt> submodule namespace to avoid breaking user code. (They can imported if necessary.)</li>
<li>test code in test/test_combinatorics.py</li>
<li>The <tt class="docutils literal"><span class="pre">itertools.product(repeat)</span></tt> parameter doesn&#8217;t make sense for Ruffus and will not be used</li>
<li>Flexible number of pairs of <tt class="docutils literal"><span class="pre">task</span></tt> / <tt class="docutils literal"><span class="pre">glob</span></tt> / file names + <tt class="docutils literal"><span class="pre">formatter()</span></tt></li>
<li>Only <tt class="docutils literal"><span class="pre">formatter([OPTIONAl_REGEX])</span></tt> provides the necessary flexibility to construct the output so we won&#8217;t bother with suffix and regex</li>
<li>Similar to <tt class="docutils literal"><span class="pre">&#64;transform</span></tt> but with extra level of nested-ness</li>
</ul>
<dl class="docutils">
<dt>Retain same code for <tt class="docutils literal"><span class="pre">&#64;product</span></tt> and <tt class="docutils literal"><span class="pre">&#64;transform</span></tt> by adding an additional level of indirection:</dt>
<dd><ul class="first last">
<li><p class="first">generator wrap around <tt class="docutils literal"><span class="pre">get_strings_in_nested_sequence</span></tt> to convert nested input parameters either to a single flat list of file names or to nested lists of file names</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">file_name_parameters</span><span class="o">.</span><span class="n">input_param_to_file_name_list</span> <span class="p">(</span><span class="n">input_params</span><span class="p">)</span>
<span class="n">file_name_parameters</span><span class="o">.</span><span class="n">list_input_param_to_file_name_list</span> <span class="p">(</span><span class="n">input_params</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">t_file_names_transform</span></tt> class which stores a list of regular expressions, one for each <tt class="docutils literal"><span class="pre">formatter()</span></tt> object corresponding to a single set of input parameters</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t_formatter_file_names_transform</span>
<span class="n">t_nested_formatter_file_names_transform</span>
</pre></div>
</div>
</li>
<li><p class="first">string substitution functions which will apply a list of <tt class="docutils literal"><span class="pre">formatter</span></tt> changes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ruffus</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">t_formatter_replace</span><span class="p">()</span>
<span class="n">ruffus</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">t_nested_formatter_replace</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ruffus_uilility.swap_doubly_nested_order()</span></tt> makes the syntax / implementation very orthogonal</p>
</li>
</ul>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="permutations-combinations-combinations-with-replacement">
<h2><tt class="docutils literal"><span class="pre">&#64;permutations(...),</span></tt> <tt class="docutils literal"><span class="pre">&#64;combinations(...),</span></tt> <tt class="docutils literal"><span class="pre">&#64;combinations_with_replacement(...)</span></tt><a class="headerlink" href="#permutations-combinations-combinations-with-replacement" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Similar to <tt class="docutils literal"><span class="pre">&#64;product</span></tt> extra level of nested-ness is self versus self</p>
<dl class="docutils">
<dt>Retain same code for <tt class="docutils literal"><span class="pre">&#64;product</span></tt></dt>
<dd><ul class="first last simple">
<li>forward to a sinble <tt class="docutils literal"><span class="pre">file_name_parameters.combinatorics_param_factory()</span></tt></li>
<li>use <tt class="docutils literal"><span class="pre">combinatorics_type</span></tt> to dispatch to <tt class="docutils literal"><span class="pre">combinatorics.permutations</span></tt>, <tt class="docutils literal"><span class="pre">combinatorics.combinations</span></tt> and <tt class="docutils literal"><span class="pre">combinatorics.combinations_with_replacement</span></tt></li>
<li>use <tt class="docutils literal"><span class="pre">list_input_param_to_file_name_list</span></tt> from <tt class="docutils literal"><span class="pre">file_name_parameters.product_param_factory()</span></tt></li>
</ul>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="drmaa-alternatives">
<h2>drmaa alternatives<a class="headerlink" href="#drmaa-alternatives" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Alternative, non-drmaa polling code at</p>
<p><a class="reference external" href="https://github.com/bjpop/rubra/blob/master/rubra/cluster_job.py">https://github.com/bjpop/rubra/blob/master/rubra/cluster_job.py</a></p>
</div></blockquote>
</div>
<div class="section" id="task-completion-monitoring">
<h2>Task completion monitoring<a class="headerlink" href="#task-completion-monitoring" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-easy-is-it-to-abstract-out-the-database">
<h3>How easy is it to abstract out the database?<a class="headerlink" href="#how-easy-is-it-to-abstract-out-the-database" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>The database is Jacob Sondergaard&#8217;s <tt class="docutils literal"><span class="pre">dbdict</span></tt> which is a nosql / key-value store wrapper around sqlite</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="n">job_history</span> <span class="o">=</span> <span class="n">dbdict</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">RUFFUS_HISTORY_FILE</span><span class="p">,</span> <span class="n">picklevalues</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p class="first">The key is the output file name, so it is important not to confuse Ruffus by having different tasks generate the same output file!</p>
</li>
<li><p class="first">Is it possible to abstract this so that <strong>jobs</strong> get timestamped as well?</p>
</li>
<li><p class="first">If we should ever want to abstract out <tt class="docutils literal"><span class="pre">dbdict</span></tt>, we need to have a similar key-value store class,
and make sure that a single instance of <tt class="docutils literal"><span class="pre">dbdict</span></tt> is used through <tt class="docutils literal"><span class="pre">pipeline_run</span></tt> which is passed up
and down the function call chain. <tt class="docutils literal"><span class="pre">dbdict</span></tt> would then be drop-in replaceable by our custom (e.g. flat-file-based) dbdict alternative.</p>
</li>
</ul>
<p>To peek into the database:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sqlite3 .ruffus_history.sqlite
sqlite&gt; .tables
data
sqlite&gt; .schema data
CREATE TABLE data <span class="o">(</span>key PRIMARY KEY,value<span class="o">)</span>;
sqlite&gt; <span class="k">select </span>key from data order by key;
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="can-we-query-the-database-get-job-history-stats">
<h3>Can we query the database, get Job history / stats?<a class="headerlink" href="#can-we-query-the-database-get-job-history-stats" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Yes, if we write a function to read and dump the entire database but this is only useful with timestamps and task names. See below</div></blockquote>
</div>
<div class="section" id="what-are-the-run-time-performance-implications">
<h3>What are the run time performance implications?<a class="headerlink" href="#what-are-the-run-time-performance-implications" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Should be fast: a single db connection is created and used inside <tt class="docutils literal"><span class="pre">pipeline_run</span></tt>,  <tt class="docutils literal"><span class="pre">pipeline_printout</span></tt>,  <tt class="docutils literal"><span class="pre">pipeline_printout_graph</span></tt></div></blockquote>
</div>
<div class="section" id="avoid-pauses-between-tasks">
<h3>Avoid pauses between tasks<a class="headerlink" href="#avoid-pauses-between-tasks" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Allows Ruffus to avoid adding an extra 1 second pause between tasks to guard against file systems with low timestamp granularity.</p>
<blockquote>
<div><ul class="simple">
<li>If the local file time looks to be in sync with the underlying file system, saved system time is used instead of file timestamps</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="mkdir">
<h2><tt class="docutils literal"><span class="pre">&#64;mkdir(...),</span></tt><a class="headerlink" href="#mkdir" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">mkdir</span></tt> continues to work seamlessly inside <tt class="docutils literal"><span class="pre">&#64;follows</span></tt> but also as its own decorator <tt class="docutils literal"><span class="pre">&#64;mkdir</span></tt> due to the original happy orthogonal design</li>
<li>fixed bug in checking so that Ruffus does&#8217;t blow up if non strings are in the output (number...)</li>
<li>note: adding the decorator to a previously undecorated function might have unintended consequences. The undecorated function turns into a zombie.</li>
<li>fixed ugly bug in <tt class="docutils literal"><span class="pre">pipeline_printout</span></tt> for printing single line output</li>
<li>fixed description and printout indent</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="parameter-handling">
<h2>Parameter handling<a class="headerlink" href="#parameter-handling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="current-design">
<h3>Current design<a class="headerlink" href="#current-design" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Parameters in Ruffus v 2.x are obtained using a &#8220;pull&#8221; model.</p>
<p>Each task has its self.param_generator_func()
This is an iterator function which yields <tt class="docutils literal"><span class="pre">param</span></tt> and <tt class="docutils literal"><span class="pre">descriptive_param</span></tt> per iteration:</p>
<div class="highlight-python"><div class="highlight"><pre>   <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">descriptive_param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_generator_func</span><span class="p">(</span><span class="n">runtime_data</span><span class="p">):</span>
       <span class="k">pass</span>


<span class="sb">``</span><span class="n">param</span><span class="sb">``</span> <span class="ow">and</span> <span class="sb">``</span><span class="n">descriptive_param</span><span class="sb">``</span> <span class="n">are</span> <span class="n">basically</span> <span class="n">the</span> <span class="n">same</span> <span class="k">except</span> <span class="n">that</span> <span class="n">globs</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">expanded</span> <span class="ow">in</span> <span class="sb">``</span><span class="n">descriptive_param</span><span class="sb">``</span> <span class="n">because</span>
<span class="n">they</span> <span class="n">are</span> <span class="n">used</span> <span class="k">for</span> <span class="n">display</span><span class="o">.</span>
</pre></div>
</div>
<p>The iterator functions have all the state they need to generate their input, output and extra parameters
(only <tt class="docutils literal"><span class="pre">runtime_data</span></tt>) is added at run time.
These closures are generated as nested functions inside &#8220;factory&#8221; functions defined in <tt class="docutils literal"><span class="pre">file_name_parameters.py</span></tt></p>
<p>Each task type has its own factory function. For example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">args_param_factory</span> <span class="p">(</span><span class="n">orig_args</span><span class="p">)</span>
<span class="n">files_param_factory</span> <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span> <span class="n">flatten_input</span><span class="p">,</span> <span class="n">do_not_expand_single_job_tasks</span><span class="p">,</span> <span class="n">output_extras</span><span class="p">)</span>
<span class="n">split_param_factory</span> <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span> <span class="n">output_files_task_globs</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_params</span><span class="p">)</span>
<span class="n">merge_param_factory</span> <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span> <span class="n">output_param</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_params</span><span class="p">)</span>
<span class="n">originate_param_factory</span> <span class="p">(</span><span class="n">list_output_files_task_globs</span><span class="p">,</span> <span class="n">extras</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>The following factory files delegate most of their work to <tt class="docutils literal"><span class="pre">yield_io_params_per_job</span></tt>:</p>
<blockquote>
<div><p>to support:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">inputs()</span></tt>, <tt class="docutils literal"><span class="pre">add_inputs()</span></tt> input parameter supplementing</li>
<li>extra inputs, outputs, extra parameter replacement with <tt class="docutils literal"><span class="pre">suffix()</span></tt>, <tt class="docutils literal"><span class="pre">regex()</span></tt> and <tt class="docutils literal"><span class="pre">formatter</span></tt></li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="n">collate_param_factory</span>       <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span>      <span class="n">flatten_input</span><span class="p">,</span>                              <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_pattern</span><span class="p">,</span>          <span class="o">*</span><span class="n">extra_specs</span><span class="p">)</span>
<span class="n">transform_param_factory</span>     <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span>      <span class="n">flatten_input</span><span class="p">,</span>                              <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_pattern</span><span class="p">,</span>          <span class="o">*</span><span class="n">extra_specs</span><span class="p">)</span>
<span class="n">combinatorics_param_factory</span> <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span>      <span class="n">flatten_input</span><span class="p">,</span> <span class="n">combinatorics_type</span><span class="p">,</span> <span class="n">k_tuple</span><span class="p">,</span> <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_pattern</span><span class="p">,</span>          <span class="o">*</span><span class="n">extra_specs</span><span class="p">)</span>
<span class="n">subdivide_param_factory</span>     <span class="p">(</span><span class="n">input_files_task_globs</span><span class="p">,</span>      <span class="n">flatten_input</span><span class="p">,</span>                              <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_files_task_globs</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_specs</span><span class="p">)</span>
<span class="n">product_param_factory</span>       <span class="p">(</span><span class="n">list_input_files_task_globs</span><span class="p">,</span> <span class="n">flatten_input</span><span class="p">,</span>                              <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_pattern</span><span class="p">,</span>          <span class="o">*</span><span class="n">extra_specs</span><span class="p">)</span>


<span class="n">yield_io_params_per_job</span> <span class="p">(</span><span class="n">input_params</span><span class="p">,</span> <span class="n">file_names_transform</span><span class="p">,</span> <span class="n">extra_input_files_task_globs</span><span class="p">,</span> <span class="n">replace_inputs</span><span class="p">,</span> <span class="n">output_pattern</span><span class="p">,</span> <span class="n">extra_specs</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">expand_globs_in_output</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">The first thing they do is to get a list of input parameters, either directly, or by expanding globs or by query upstream tasks:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">file_names_from_tasks_globs</span><span class="p">(</span><span class="n">files_task_globs</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">,</span> <span class="n">do_not_expand_single_job_tasks</span> <span class="o">=</span> <span class="n">True_if_split_or_merge</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><tt class="docutils literal"><span class="pre">True_if_split_or_merge</span></tt> is a wierd parameter which directly queries the upstream dependency for its output files if it is a single task...</p>
<p class="last">This is legacy code. Probably should be refactored out of existence...</p>
</div>
</div></blockquote>
</li>
<li><p class="first">They then convert the input parameters to a flattened list of file names (passing through unchanged the original input parameters structure)</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_param_to_file_name_list</span><span class="p">()</span>
<span class="c"># combinatorics and product call:</span>
<span class="n">list_input_param_to_file_name_list</span><span class="p">()</span>
</pre></div>
</div>
<p>This is done at the iterator level because the combinatorics decorators do not have just a
list of input parameters (They have combinations, permutations, products of
input parameters etc) but a list of lists of input parameters.</p>
<p>transform, collate, subdivide =&gt; list of strings.
combinatorics / product       =&gt; list of lists of strings</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">yield_io_params_per_job</span></tt> yields pairs of param sets by</p>
<blockquote>
<div><ul class="simple">
<li>Replacing or supplementing input parameters for the indicator objects <tt class="docutils literal"><span class="pre">inputs()</span></tt> and <tt class="docutils literal"><span class="pre">add_inputs()</span></tt></li>
<li>Expanding extra parameters</li>
<li>Expanding output parameters (with or without expanding globs)</li>
</ul>
<dl class="docutils">
<dt>In each case:</dt>
<dd><ul class="first last simple">
<li>If these contains objects which look like strings, we do regular expression / file component substitution</li>
<li>If they contain tasks, these are queries for output files</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This should be changed:</p>
<p class="last">If the flattened list of input file names is empty, ie. if the input parameters
contain just other stuff, then the entire parameter is ignored.</p>
</div>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="handling-file-names">
<h3>Handling file names<a class="headerlink" href="#handling-file-names" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>All strings in input (or output parameters) are treated as file names unless they are wrapped
with <tt class="docutils literal"><span class="pre">output_from</span></tt> in which case they are <tt class="docutils literal"><span class="pre">Task</span></tt>, <tt class="docutils literal"><span class="pre">Pipeline</span></tt> or function names.</p>
<p>A list of strings for ready for substitution to output parameters is obtained from the
<tt class="docutils literal"><span class="pre">ruffus_utility.get_strings_in_flattened_sequence()</span></tt></p>
<p>This is called from:</p>
<blockquote>
<div><p>file_name_parameters</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Either to check that input files exist:
<tt class="docutils literal"><span class="pre">check_input_files_exist()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_directory_missing()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_exist()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_modify_time()</span></tt></p>
</li>
<li><p class="first">Or to generate parameters from the various param factories</p>
<p><tt class="docutils literal"><span class="pre">product_param_factory()</span></tt>
<tt class="docutils literal"><span class="pre">transform_param_factory()</span></tt>
<tt class="docutils literal"><span class="pre">collate_param_factory()</span></tt>
<tt class="docutils literal"><span class="pre">combinatorics_param_factory()</span></tt>
<tt class="docutils literal"><span class="pre">subdivide_param_factory()</span></tt></p>
</li>
</ol>
<p>These first call <tt class="docutils literal"><span class="pre">file_names_from_tasks_globs()</span></tt> to get the input parameters,
then pass a flattened list of strings to <tt class="docutils literal"><span class="pre">yield_io_params_per_job()</span></tt></p>
<blockquote>
<div>-&gt; <tt class="docutils literal"><span class="pre">file_names_from_tasks_globs()</span></tt>
-&gt; <tt class="docutils literal"><span class="pre">yield_io_params_per_job(</span></tt> <tt class="docutils literal"><span class="pre">input_param_to_file_name_list()</span></tt> / <tt class="docutils literal"><span class="pre">list_input_param_to_file_name_list()</span></tt> <tt class="docutils literal"><span class="pre">)</span></tt></div></blockquote>
</div></blockquote>
<p>task</p>
<blockquote>
<div><ol class="arabic" start="3">
<li><p class="first">to obtain a list of file names to <tt class="docutils literal"><span class="pre">touch</span></tt></p>
<p><tt class="docutils literal"><span class="pre">job_wrapper_io_files</span></tt></p>
</li>
<li><p class="first">to make directories</p>
<p><tt class="docutils literal"><span class="pre">job_wrapper_mkdir</span></tt></p>
</li>
<li><p class="first">update / remove files in <tt class="docutils literal"><span class="pre">job_history</span></tt> if job succeeded or failed</p>
<p><tt class="docutils literal"><span class="pre">pipeline_run</span></tt></p>
</li>
</ol>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="refactor-to-handle-input-parameter-objects-with-ruffus-params-functions">
<h3>Refactor to handle input parameter objects with ruffus_params() functions<a class="headerlink" href="#refactor-to-handle-input-parameter-objects-with-ruffus-params-functions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>We want to expand objects with ruffus_params <em>only</em> when doing output parameter
substitution, i.e. Case (2) above. They are not file names: cases (1), (3), (4), (5).</p>
<p>Therefore: Expand in <tt class="docutils literal"><span class="pre">file_names_from_tasks_globs()</span></tt> which also handles
<tt class="docutils literal"><span class="pre">inputs()</span></tt> and <tt class="docutils literal"><span class="pre">add_inputs</span></tt> and <tt class="docutils literal"><span class="pre">&#64;split</span></tt> outputs.</p>
</div></blockquote>
</div>
<div class="section" id="refactor-to-handle-formatter-replacement-with-extras-0-1-3-and-inputs-1-2">
<h3>Refactor to handle formatter() replacement with &#8220;{EXTRAS[0][1][3]}&#8221; and &#8220;[INPUTS[1][2]]&#8221;<a class="headerlink" href="#refactor-to-handle-formatter-replacement-with-extras-0-1-3-and-inputs-1-2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Non-recursive Substitution in all:</p>
<blockquote>
<div><p>construct new list where each item is replaced referring to the original and then assign</p>
<p>extra_inputs()      &#8220;[INPUTS[1][2]]&#8221; refers to the original input
output / extras     &#8220;[INPUTS[1][2]]&#8221; refers to substituted input</p>
</div></blockquote>
<p>In addition to the flattened input paramters, we need to pass in the unflattened input and extra parameters</p>
<p>In <tt class="docutils literal"><span class="pre">file_name_parameters.py.</span></tt>: <tt class="docutils literal"><span class="pre">yield_io_params_per_job</span></tt></p>
<blockquote>
<div><p>From:
.. code-block:: python</p>
<blockquote>
<div>extra_inputs = extra_input_files_task_globs.file_names_transformed (filenames, file_names_transform)
extra_params = tuple( file_names_transform.substitute(filenames, p) for p in extra_specs)
output_pattern_transformed = output_pattern.file_names_transformed (filenames, file_names_transform)
output_param = file_names_transform.substitute_output_files(filenames, output_pattern)</div></blockquote>
<p>To:
.. code-block:: python</p>
<blockquote>
<div>extra_inputs = extra_input_files_task_globs.file_names_transformed (orig_input_param, extra_specs, filenames, file_names_transform)
extra_params = tuple( file_names_transform.substitute(input_param, extra_specs, filenames, p) for p in extra_specs)
output_pattern_transformed = output_pattern.file_names_transformed (input_param, extra_specs, filenames, file_names_transform)
output_param = file_names_transform.substitute_output_files(input_param, extra_specs, filenames, output_pattern)</div></blockquote>
</div></blockquote>
<p>In other words, we need two extra parameters for inputs and extras</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">t_file_names_transform</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">substitute</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_param</span><span class="p">,</span> <span class="n">extra_param</span><span class="p">,</span> <span class="n">starting_file_names</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">substitute_output_files</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_param</span><span class="p">,</span> <span class="n">extra_param</span><span class="p">,</span> <span class="n">starting_file_names</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">t_params_tasks_globs_run_time_data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">file_names_transformed</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_param</span><span class="p">,</span> <span class="n">extra_param</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">file_names_transform</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="refactor-to-handle-alternative-outputs-with-either-or">
<h3>Refactor to handle alternative outputs with either_or(...,...)<a class="headerlink" href="#refactor-to-handle-alternative-outputs-with-either-or" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first">what happens to get_outputs or checkpointing when the job completes but the output files are not made?</p>
</li>
<li><p class="first">either_or matches</p>
<blockquote>
<div><ul class="simple">
<li>the only alternative to have all files existing</li>
<li>the alternative with the most recent file</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">either_or behaves as <tt class="docutils literal"><span class="pre">list()</span></tt> in <tt class="docutils literal"><span class="pre">file_name_parameters.py.</span></tt> : <tt class="docutils literal"><span class="pre">file_names_from_tasks_globs</span></tt></p>
</li>
<li><p class="first">Handled to check that input files exist:</p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">check_input_files_exist()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_directory_missing()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_exist()</span></tt>
<tt class="docutils literal"><span class="pre">needs_update_check_modify_time()</span></tt></p>
</div></blockquote>
</li>
<li><p class="first">Handled to update / remove files in <tt class="docutils literal"><span class="pre">job_history</span></tt> if job succeeded or failed</p>
</li>
<li><p class="first">Only first either_or is used to obtain list of file names to <tt class="docutils literal"><span class="pre">touch</span></tt></p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">task.job_wrapper_io_files</span></tt></p>
</div></blockquote>
</li>
<li><p class="first">Only first either_or is used to obtain list of file names to make directories</p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">job_wrapper_mkdir</span></tt></p>
</div></blockquote>
</li>
<li><p class="first">What happens in <tt class="docutils literal"><span class="pre">task.get_output_files()</span></tt>?</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="add-object-orientated-interface">
<h2>Add Object Orientated interface<a class="headerlink" href="#add-object-orientated-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="passed-unit-tests">
<h3>Passed Unit tests<a class="headerlink" href="#passed-unit-tests" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Refactored to remove unused &#8220;flattened&#8221; code paths / parameters</p>
</li>
<li><p class="first">Prefix all attributes for Task into underscore so that help(Task) is not overloaded with details</p>
</li>
<li><dl class="first docutils">
<dt>Named parameters</dt>
<dd><ul class="first last">
<li><p class="first">parse named parameters in order filling in from unnamed</p>
</li>
<li><p class="first">save parameters in <tt class="docutils literal"><span class="pre">dict</span></tt>  <tt class="docutils literal"><span class="pre">Task.parsed_args</span></tt></p>
</li>
<li><dl class="first docutils">
<dt>call <tt class="docutils literal"><span class="pre">setup_task_func()</span></tt> afterwards which knows how to setup:</dt>
<dd><ul class="first last simple">
<li>poor man&#8217;s OOP but</li>
<li>allows type to be changed after constructor:
Because can&#8217;t guarantee that <tt class="docutils literal"><span class="pre">&#64;transform</span></tt> <tt class="docutils literal"><span class="pre">&#64;merge</span></tt> is the first Ruffus decorator to be encountered.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">setup_task_func()</span></tt> is called for every task before pipeline_xxx()</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Much more informative messages for errors when parsing decorator arguments</p>
</li>
<li><p class="first">Pipeline decorator methods renamed to decorator_xxx as in <tt class="docutils literal"><span class="pre">decorator_follows</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Task.get_task_name()</span></tt>
* rename to <tt class="docutils literal"><span class="pre">Task.get_display_name()</span></tt>
* distinguish between decorator and OO interface</p>
</li>
<li><p class="first">Rename <tt class="docutils literal"><span class="pre">_task</span></tt> to <tt class="docutils literal"><span class="pre">Task</span></tt></p>
</li>
<li><dl class="first docutils">
<dt>Identifying tasks from t_job_result:</dt>
<dd><ul class="first last simple">
<li>job results do not contain references to <tt class="docutils literal"><span class="pre">Task</span></tt> so that it can be marshalled more easily</li>
<li>we need to look up task at job completion</li>
<li>use  <tt class="docutils literal"><span class="pre">_node_index</span></tt> from <tt class="docutils literal"><span class="pre">graph.py</span></tt> so we have always a unique identifier for each <tt class="docutils literal"><span class="pre">Task</span></tt></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Parse arguments using ruffus_utility.parse_task_arguments</dt>
<dd><ul class="first last simple">
<li>Reveals full hackiness and inconsistency between <tt class="docutils literal"><span class="pre">add_inputs</span></tt> and <tt class="docutils literal"><span class="pre">inputs</span></tt>. The latter only takes a single argument. Each of the elements of the former gets added along side the existing inputs.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Add <tt class="docutils literal"><span class="pre">Pipeline</span></tt> class
* Create global called <tt class="docutils literal"><span class="pre">&quot;main&quot;</span></tt> (accessed by Pipeline.pipelines[&#8220;main&#8221;])</p>
</li>
<li><dl class="first docutils">
<dt>Task name lookup</dt>
<dd><ul class="first last simple">
<li>Task names are unique (Otherwise Ruffus will complain at Task creation)</li>
<li>Can also lookup by fully qualified or unqualified function name but these can be ambiguous</li>
<li>Ambiguous lookups give a list of tasks only so we can have nice diagnostic messages ... UI trumps clean design</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Look up strings across pipelines
#. Is pipeline name qualified? Check that
#. Check default (current) pipeline
#. Check if pipeline name. In which case returns all tail functions
#. Check all pipelines</p>
<ul class="simple">
<li>Will blow up at any instance of ambiguity in any particular pipeline</li>
<li>Will blow up at any instance of ambiguity across pipelines</li>
<li>Note that mis-spellings will cause problems but if this were c++, I would enforce stricter checking</li>
</ul>
</li>
<li><p class="first">Look up functions across pipelines
* Try current pipeline first, then all pipelines
* Will blow up at any instance of ambiguity in any particular pipeline
* Will blow up at any instance of ambiguity across pipelines (if not in current pipeline)</p>
</li>
<li><p class="first">&#64;mkdir, &#64;follows(mkdir)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Pipeline.get_head_tasks(self)</span></tt> (including tasks with mkdir())</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Pipeline.get_tail_tasks(self)</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Pipeline._complete_task_setup()</span></tt> which follows chain of dependencies for each task in a pipeline</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="pipeline-and-task-creation">
<h3>Pipeline and Task creation<a class="headerlink" href="#pipeline-and-task-creation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first">Share code as far as possible between decorator and OOP syntax</p>
</li>
<li><p class="first">Cannot use textbook OOP inheritance hierarchy easily because &#64;decorators are not necessarily
given in order.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Pipeline</span><span class="o">.</span><span class="n">transform</span>
    <span class="n">_do_create_task_by_OOP</span><span class="p">()</span>

<span class="nd">@transform</span>
    <span class="n">Pipeline</span><span class="o">.</span><span class="n">_create_task</span><span class="p">()</span>
    <span class="n">task</span><span class="o">.</span><span class="n">_decorator_transform</span>

        <span class="n">task</span><span class="o">.</span><span class="n">_prepare_transform</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_task_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_setup</span>
            <span class="n">parse_task_arguments</span>


<span class="n">Pipeline</span><span class="o">.</span><span class="n">run</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">_complete_task_setup</span><span class="p">()</span>
        <span class="c"># walk up ancestors of all task and call setup_task_func</span>
        <span class="n">unprocessed_tasks</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">tasks</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">unprocessed_tasks</span><span class="p">):</span>
            <span class="n">ancestral_tasks</span> <span class="o">=</span> <span class="n">setup_task_func</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">already</span> <span class="n">processed</span><span class="p">:</span>
                <span class="n">unprocessed_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ancestral_tasks</span><span class="p">)</span>

        <span class="n">Call</span> <span class="n">_complete_task_setup</span><span class="p">()</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">pipelines</span> <span class="n">of</span> <span class="n">each</span> <span class="n">task</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="connecting-task-into-a-dag">
<h3>Connecting Task into a DAG<a class="headerlink" href="#connecting-task-into-a-dag" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>task._complete_setup()
    task._remove_all_parents()
    task._deferred_connect_parents()
    task._setup_task_func()
        task._handle_tasks_globs_in_inputs()
            task._connect_parents()
                # re-lookup task from names in current pipeline so that pipeline.clone() works
</pre></div>
</div>
<ul class="simple">
<li>Task dependencies are normally deferred and saved to <tt class="docutils literal"><span class="pre">Task.deferred_follow_params</span></tt></li>
<li>If Task dependencies call for a new Task (<tt class="docutils literal"><span class="pre">follows</span></tt>/<tt class="docutils literal"><span class="pre">follows(mkdir)</span></tt>), this takes place
immediately</li>
<li>The parameters in <tt class="docutils literal"><span class="pre">Task.deferred_follow_params</span></tt> are updated with the created <tt class="docutils literal"><span class="pre">Task</span></tt> when
this happens</li>
<li><tt class="docutils literal"><span class="pre">Task._prepare_preceding_mkdir()</span></tt> has a <tt class="docutils literal"><span class="pre">defer</span></tt> flag to prevent it from updating
<tt class="docutils literal"><span class="pre">Task.deferred_follow_params</span></tt> when it is called to resolve deferred dependencies from
<tt class="docutils literal"><span class="pre">Task._connect_parents()</span></tt>. Otherwise we will have two copies of each deferred dependency...</li>
<li><tt class="docutils literal"><span class="pre">Task.deferred_follow_params</span></tt> must be deep-copied otherwise cloned pipelines will interfere
with each other when dependencies are resolved...</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Implementation Tips</a><ul>
<li><a class="reference internal" href="#items-remaining-for-current-release">Items remaining for current release</a><ul>
<li><a class="reference internal" href="#code">Code</a></li>
<li><a class="reference internal" href="#unit-tests">Unit tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#release">Release</a></li>
<li><a class="reference internal" href="#blogger">blogger</a></li>
<li><a class="reference internal" href="#dbdict-py">dbdict.py</a></li>
<li><a class="reference internal" href="#how-to-write-new-decorators">how to write new decorators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-notes">Implementation notes</a><ul>
<li><a class="reference internal" href="#ctrl-c-handling"><tt class="docutils literal"><span class="pre">Ctrl-C</span></tt> handling</a></li>
<li><a class="reference internal" href="#python3-compatability">Python3 compatability</a></li>
<li><a class="reference internal" href="#refactoring-parameter-handling">Refactoring: parameter handling</a></li>
<li><a class="reference internal" href="#formatter"><tt class="docutils literal"><span class="pre">formatter</span></tt></a><ul>
<li><a class="reference internal" href="#formatter-regex-and-suffix"><tt class="docutils literal"><span class="pre">formatter()</span></tt>: <tt class="docutils literal"><span class="pre">regex()</span></tt> and <tt class="docutils literal"><span class="pre">suffix()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#product">&#64;product()</a></li>
<li><a class="reference internal" href="#permutations-combinations-combinations-with-replacement"><tt class="docutils literal"><span class="pre">&#64;permutations(...),</span></tt> <tt class="docutils literal"><span class="pre">&#64;combinations(...),</span></tt> <tt class="docutils literal"><span class="pre">&#64;combinations_with_replacement(...)</span></tt></a></li>
<li><a class="reference internal" href="#drmaa-alternatives">drmaa alternatives</a></li>
<li><a class="reference internal" href="#task-completion-monitoring">Task completion monitoring</a><ul>
<li><a class="reference internal" href="#how-easy-is-it-to-abstract-out-the-database">How easy is it to abstract out the database?</a></li>
<li><a class="reference internal" href="#can-we-query-the-database-get-job-history-stats">Can we query the database, get Job history / stats?</a></li>
<li><a class="reference internal" href="#what-are-the-run-time-performance-implications">What are the run time performance implications?</a></li>
<li><a class="reference internal" href="#avoid-pauses-between-tasks">Avoid pauses between tasks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mkdir"><tt class="docutils literal"><span class="pre">&#64;mkdir(...),</span></tt></a></li>
<li><a class="reference internal" href="#parameter-handling">Parameter handling</a><ul>
<li><a class="reference internal" href="#current-design">Current design</a></li>
<li><a class="reference internal" href="#handling-file-names">Handling file names</a></li>
<li><a class="reference internal" href="#refactor-to-handle-input-parameter-objects-with-ruffus-params-functions">Refactor to handle input parameter objects with ruffus_params() functions</a></li>
<li><a class="reference internal" href="#refactor-to-handle-formatter-replacement-with-extras-0-1-3-and-inputs-1-2">Refactor to handle formatter() replacement with &#8220;{EXTRAS[0][1][3]}&#8221; and &#8220;[INPUTS[1][2]]&#8221;</a></li>
<li><a class="reference internal" href="#refactor-to-handle-alternative-outputs-with-either-or">Refactor to handle alternative outputs with either_or(...,...)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-object-orientated-interface">Add Object Orientated interface</a><ul>
<li><a class="reference internal" href="#passed-unit-tests">Passed Unit tests</a></li>
<li><a class="reference internal" href="#pipeline-and-task-creation">Pipeline and Task creation</a></li>
<li><a class="reference internal" href="#connecting-task-into-a-dag">Connecting Task into a DAG</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="todo.html"
                        title="previous chapter">Where I see Ruffus going</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq.html"
                        title="next chapter">FAQ</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/implementation_notes.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="decorators/originate.html">@originate</a>                           </li>
            <li><a href="decorators/split.html">@split</a>                                   </li>
            <li><a href="decorators/transform.html">@transform</a>                           </li>
            <li><a href="decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="decorators/collate.html">@collate</a>                               </li>
            <li><a href="decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="decorators/product.html">@product </a>                              </li>
            <li><a href="decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="faq.html" title="FAQ"
             >next</a> |</li>
        <li class="right" >
          <a href="todo.html" title="Where I see Ruffus going"
             >previous</a> |</li>
        Ruffus v. 2.6.2
            <li><a href="index.html">Home</a> | </li>
            <li><a href="contents.html">Contents</a> | </li>
            <li><a href="installation.html">Install</a>  | </li>
            <li><a href="tutorials/new_tutorial/introduction.html">Manual</a>  / </li>
            <li><a href="tutorials/new_tutorial/manual_contents.html">(TOC)</a>  | </li>
            <li><a href="faq.html">FAQ</a>  | </li>
            <li><a href="cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="tutorials/new_tutorial/command_line.html">Command Line</a> | </li>
            <li><a href="gallery.html">Gallery</a> |  </li>
            <li><a href="tutorials/new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>