<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Ruffus is a Computation Pipeline library for python. It is open-sourced, powerful and user-friendly, and widely used in science and bioinformatics" name="description" />
<meta content="python, pipeline, computation, cluster, Ruffus, bioinformatics, parallel' name='keywords" name="keywords" />
<meta content="Leo Goodstadt" name="Author" />
<meta content="Leo Goodstadt" name="Publisher" />
<meta content="ruffus&#64;llew.org.uk" name="Email" />
<meta content="index, follow" name="robots" />
<meta content="en-uk" name="language" />
<meta content="United Kingdom" name="country" />
<meta content="Leo Goodstadt 2009-2014" name="copyright" />

    <title>Chapter 8: Specifying output file names with formatter() and regex() &mdash; ruffus 2.6 documentation</title>
    
    <link rel="stylesheet" href="../../_static/ruffus.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ruffus 2.6 documentation" href="../../index.html" />
    <link rel="next" title="Chapter 9: Preparing directories for output with @mkdir()" href="mkdir.html" />
    <link rel="prev" title="Chapter 7: Displaying the pipeline visually with pipeline_printout_graph(...)" href="pipeline_printout_graph.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mkdir.html" title="Chapter 9: Preparing directories for output with @mkdir()"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pipeline_printout_graph.html" title="Chapter 7: Displaying the pipeline visually with pipeline_printout_graph(...)"
             accesskey="P">previous</a> |</li>
        Ruffus v. 2.6
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="new-manual-output-file-names-chapter-num-specifying-output-file-names-with-formatter-and-regex">
<span id="new-manual-output-file-names"></span><span id="index-0"></span><h1><strong>Chapter 8</strong>: Specifying output file names with <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> and <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a><a class="headerlink" href="#new-manual-output-file-names-chapter-num-specifying-output-file-names-with-formatter-and-regex" title="Permalink to this headline">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="manual_contents.html#new-manual-table-of-contents"><em>Manual Table of Contents</em></a></li>
<li><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a> syntax</li>
<li><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> syntax</li>
<li><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> syntax</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Remember to look at the example code:</p>
<ul class="last simple">
<li><a class="reference internal" href="output_file_names_code.html#new-manual-output-file-names-code"><em>Chapter 8: Python Code for Specifying output file names with formatter() and regex()</em></a></li>
</ul>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/theoretical_pipeline_schematic.png"><img alt="../../_images/theoretical_pipeline_schematic.png" src="../../_images/theoretical_pipeline_schematic.png" style="width: 610.0px; height: 71.0px;" /></a>
<p>Computational pipelines transform your data in stages until the final result is produced.
The most straightforward way to use Ruffus is to hold the intermediate results after each stage
in a series of files with related file names.</p>
<p>Part of telling Ruffus how these pipeline stages or <a class="reference internal" href="../../glossary.html#term-task"><em class="xref std std-term">task</em></a> functions are connected
together is to write simple rules for how to the file names for each stage follow on from each other.
Ruffus helps you to specify these file naming rules.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>The best way to design a pipeline is to:</strong></p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>Write down the file names of the data as it flows across your pipeline.</strong>
Do these file names follow a <em>pattern</em> ?</li>
<li><strong>Write down the names of functions which transforms the data at each stage of the pipeline.</strong></li>
</ul>
</div></blockquote>
</div>
</div></blockquote>
</div>
<div class="section" id="a-different-file-name-suffix-for-each-pipeline-stage">
<span id="new-manual-suffix"></span><h2>A different file name <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a> for each pipeline stage<a class="headerlink" href="#a-different-file-name-suffix-for-each-pipeline-stage" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The easiest and cleanest way to write Ruffus pipelines is to use a different suffix
for each stage of your pipeline.</p>
<p>We used this approach in <a class="reference internal" href="introduction.html#new-manual-introduction"><em>Chapter 1: An introduction to basic Ruffus syntax</em></a>  and in <a class="reference internal" href="transform_in_parallel_code.html#new-manual-transform-in-parallel-code"><em>code</em></a> from <a class="reference internal" href="transform_in_parallel.html#new-manual-transform-in-parallel"><em>Chapter 3: More on &#64;transform-ing data</em></a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="hll">    <span class="c">#Task Name:                  File suffices</span>
</span>    _________________________      ______________________
    create_initial_file_pairs            *.start
    first_task                           *.output.1
    second_task                          *.output.2
</pre></div>
</div>
<p>There is a long standing convention of using file suffices to denote file type: For example, a <strong>&#8220;compile&#8221;</strong> task might convert <strong>source</strong> files of type <tt class="docutils literal"><span class="pre">*.c</span></tt> to <strong>object</strong> files of type <tt class="docutils literal"><span class="pre">*.o</span></tt>.</p>
<dl class="docutils">
<dt>We can think of Ruffus tasks comprising :</dt>
<dd><ul class="first last simple">
<li>recipes in <tt class="docutils literal"><span class="pre">&#64;transform(...)</span></tt> for transforming file names: changing  <tt class="docutils literal"><span class="pre">.c</span></tt> to a <tt class="docutils literal"><span class="pre">.o</span></tt> (e.g. <tt class="docutils literal"><span class="pre">AA.c</span> <span class="pre">-&gt;</span> <span class="pre">AA.o</span></tt> <tt class="docutils literal"><span class="pre">BB.c</span> <span class="pre">-&gt;</span> <span class="pre">BB.o</span></tt>)</li>
<li>recipes in a task function <tt class="docutils literal"><span class="pre">def</span> <span class="pre">foo_bar()</span></tt> for transforming your data: from <strong>source</strong> <tt class="docutils literal"><span class="pre">.c</span></tt> to <strong>object</strong> <tt class="docutils literal"><span class="pre">.o</span></tt></li>
</ul>
</dd>
</dl>
<p>Let us review the Ruffus syntax for doing this:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="hll">@transform<span class="o">(</span> create_initial_file_pairs,  <span class="c"># Input:   Name of previous task(s)</span>
</span><span class="hll">            suffix<span class="o">(</span><span class="s2">&quot;.start&quot;</span><span class="o">)</span>,           <span class="c"># Matching suffix</span>
</span><span class="hll">            <span class="s2">&quot;.output.1&quot;</span><span class="o">)</span>                <span class="c"># Replacement string</span>
</span>def first_task<span class="o">(</span>input_files, output_file<span class="o">)</span>:
    with open<span class="o">(</span>output_file, <span class="s2">&quot;w&quot;</span><span class="o">)</span>: pass
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p class="first"><strong>Input</strong>:</p>
<blockquote>
<div><dl class="docutils">
<dt>The first parameter for <tt class="docutils literal"><span class="pre">&#64;transform</span></tt> can be a mixture of one or more:</dt>
<dd><ul class="first last simple">
<li>previous tasks (e.g. <tt class="docutils literal"><span class="pre">create_initial_file_pairs</span></tt>)</li>
<li>file names (all python strings are treated as paths)</li>
<li>glob specifications (e.g <tt class="docutils literal"><span class="pre">*.c</span></tt>, <tt class="docutils literal"><span class="pre">/my/path/*.foo</span></tt>)</li>
</ul>
</dd>
</dl>
<p>Each element provides an input for the task. So if the previous task <tt class="docutils literal"><span class="pre">create_initial_file_pairs</span></tt> has five outputs, the next <tt class="docutils literal"><span class="pre">&#64;transform</span></tt> task will accept
these as five separate inputs leading to five independent jobs.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a>:</p>
<blockquote>
<div><p>The second parameter <tt class="docutils literal"><span class="pre">suffix(&quot;.start&quot;)</span></tt> must match the end of the first string in each input.
For example, <tt class="docutils literal"><span class="pre">create_initial_file_pairs</span></tt> produces the list <tt class="docutils literal"><span class="pre">['job1.a.start',</span> <span class="pre">'job1.b.start']</span></tt>, then <tt class="docutils literal"><span class="pre">suffix(&quot;.start&quot;)</span></tt>  must matches the first string, i.e. <tt class="docutils literal"><span class="pre">'job1.a.start'</span></tt>.
If the input is nested structure, this would be iterated through recursively to find the first string.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Inputs which do not match the suffix are discarded altogether.</p>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Replacement</strong>:</p>
<blockquote>
<div><p>The third parameter is the replacement for the suffix.
The pair of input strings in the step3 example produces the following output parameter</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_parameters</span>   <span class="o">=</span> <span class="p">[</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">]</span>
<span class="n">matching_input</span>     <span class="o">=</span> <span class="s">&#39;job1.a.start&#39;</span>
<span class="n">output_parameter</span>   <span class="o">=</span> <span class="s">&#39;job1.a.output.1&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>When the pipeline is run, this results in the following equivalent call to <tt class="docutils literal"><span class="pre">first_task(...)</span></tt>:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">first_task</span><span class="p">([</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">],</span> <span class="s">&#39;job1.a.output.1&#39;</span><span class="p">):</span>
</pre></div>
</div>
</div></blockquote>
<p>The replacement parameter can itself be a list or any arbitrary complicated structure:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="hll">@transform<span class="o">(</span>create_initial_file_pairs,            <span class="c"># Input</span>
</span><span class="hll">            suffix<span class="o">(</span><span class="s2">&quot;.a.start&quot;</span><span class="o">)</span>,                  <span class="c"># Matching suffix</span>
</span><span class="hll">            <span class="o">[</span><span class="s2">&quot;.output.a.1&quot;</span>, <span class="s2">&quot;.output.b.1&quot;</span>, 45<span class="o">])</span>  <span class="c"># Replacement list</span>
</span>def first_task<span class="o">(</span>input_files, output_parameters<span class="o">)</span>:
    print <span class="s2">&quot;input_parameters = &quot;</span>, input_files
    print <span class="s2">&quot;output_parameters = &quot;</span>, output_parameters
</pre></div>
</div>
</div></blockquote>
<p>In which case, all the strings are used as replacements, other values are left untouched, and we obtain the following:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="hll"><span class="c"># job #1</span>
</span><span class="nv">input</span>  <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job1.a.start&#39;</span>,    <span class="s1">&#39;job1.b.start&#39;</span><span class="o">]</span>
<span class="nv">output</span> <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job1.output.a.1&#39;</span>, <span class="s1">&#39;job1.output.b.1&#39;</span>, 45<span class="o">]</span>

<span class="hll"><span class="c"># job #2</span>
</span><span class="nv">input</span>  <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job2.a.start&#39;</span>,    <span class="s1">&#39;job2.b.start&#39;</span><span class="o">]</span>
<span class="nv">output</span> <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job2.output.a.1&#39;</span>, <span class="s1">&#39;job2.output.b.1&#39;</span>, 45<span class="o">]</span>

<span class="hll"><span class="c"># job #3</span>
</span><span class="nv">input</span>  <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job3.a.start&#39;</span>,    <span class="s1">&#39;job3.b.start&#39;</span><span class="o">]</span>
<span class="nv">output</span> <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;job3.output.a.1&#39;</span>, <span class="s1">&#39;job3.output.b.1&#39;</span>, 45<span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Note how task function is called with the value <tt class="docutils literal"><span class="pre">45</span></tt> <em>verbatim</em> because it is not a string.</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="formatter-manipulates-pathnames-and-regular-expression">
<span id="new-manual-formatter"></span><h2><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> manipulates pathnames and regular expression<a class="headerlink" href="#formatter-manipulates-pathnames-and-regular-expression" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a> replacement is the cleanest and easiest way to generate suitable output file names for each stage in a pipeline.
Often, however, we require more complicated manipulations to specify our file names.
For example,</p>
<blockquote>
<div><ul class="simple">
<li>It is common to have to change directories from a <em>data</em> directory to a <em>working</em> directory as the first step of a pipeline.</li>
<li>Data management can be simplified by separate files from each pipeline stage into their own directory.</li>
<li>Information may have to be decoded from data file names, e.g. <tt class="docutils literal"><span class="pre">&quot;experiment373.IBM.03March2002.txt&quot;</span></tt></li>
</ul>
</div></blockquote>
<p>Though <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> is much more powerful, the principle and syntax are the same:
we take string elements from the <strong>Input</strong> and perform some replacements to generate the <strong>Output</strong> parameters.</p>
<p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a></p>
<blockquote>
<div><ul class="simple">
<li>Allows easy manipulation of path subcomponents in the style of <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.split">os.path.split()</a>, and <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.basename">os.path.basename</a></li>
<li>Uses familiar python <a class="reference external" href="http://docs.python.org/2/library/string.html#string-formatting">string.format</a> syntax (See <a class="reference external" href="http://docs.python.org/2/library/string.html#format-examples">string.format examples</a>. )</li>
<li>Supports optional regular expression (<a class="reference external" href="http://docs.python.org/2/library/re.html#re.MatchObject.group">re</a>) matches including named captures.</li>
<li>Can refer to any file path (i.e. python string) in each input and is not limited like <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a> to the first string.</li>
<li>Can even refer to individual letters within a match</li>
</ul>
</div></blockquote>
</div></blockquote>
<div class="section" id="path-name-components">
<h3>Path name components<a class="headerlink" href="#path-name-components" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> breaks down each input pathname into path name components which can then be recombined in whichever way by the replacement string.</p>
<p>Given an example string of :</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_string</span> <span class="o">=</span> <span class="s">&quot;/directory/to/a/file.name.ext&quot;</span>
<span class="n">formatter</span><span class="p">()</span>
</pre></div>
</div>
<p>the path components are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">basename</span></tt>: The <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.basename">base name</a> <em>excluding</em> <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.splitext">extension</a>, <tt class="docutils literal"><span class="pre">&quot;file.name&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ext</span></tt>     : The <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.splitext">extension</a>, <tt class="docutils literal"><span class="pre">&quot;.ext&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">path</span></tt>    : The <a class="reference external" href="http://docs.python.org/2/library/os.path.html#os.path.dirname">dirname</a>, <tt class="docutils literal"><span class="pre">&quot;/directory/to/a&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">subdir</span></tt>  : A list of sub-directories in the <tt class="docutils literal"><span class="pre">path</span></tt> in reverse order, <tt class="docutils literal"><span class="pre">[&quot;a&quot;,</span> <span class="pre">&quot;to&quot;,</span> <span class="pre">&quot;directory&quot;,</span> <span class="pre">&quot;/&quot;]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">subpath</span></tt> : A list of descending sub-paths in reverse order, <tt class="docutils literal"><span class="pre">[&quot;/directory/to/a&quot;,</span> <span class="pre">&quot;/directory/to&quot;,</span> <span class="pre">&quot;/directory&quot;,</span> <span class="pre">&quot;/&quot;]</span></tt></li>
</ul>
</div></blockquote>
<p>The replacement string refers to these components by using python <a class="reference external" href="http://docs.python.org/2/library/string.html#string-formatting">string.format</a> style curly braces. <tt class="docutils literal"><span class="pre">&quot;{NAME}&quot;</span></tt></p>
<p>We refer to an element from the Nth input string by index, for example:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">&quot;{ext[0]}&quot;</span></tt>     is the extension of the first file name string in <strong>Input</strong>.</li>
<li><tt class="docutils literal"><span class="pre">&quot;{basename[1]}&quot;</span></tt> is the basename of the second file name in <strong>Input</strong>.</li>
<li><tt class="docutils literal"><span class="pre">&quot;{basename[1][0:3]}&quot;</span></tt> are the first three letters from the basename of the second file name in <strong>Input</strong>.</li>
</ul>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">subdir</span></tt>, <tt class="docutils literal"><span class="pre">subpath</span></tt> were designed to help you navigate directory hierachies with the minimum of fuss.
For example, you might want to graft a hierachical path to another location:
<tt class="docutils literal"><span class="pre">&quot;{subpath[0][2]}/from/{subdir[0][0]}/{basename[0]}&quot;</span></tt> neatly replaces just one directory (<tt class="docutils literal"><span class="pre">&quot;to&quot;</span></tt>) in the path with another  (<tt class="docutils literal"><span class="pre">&quot;from&quot;</span></tt>):</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">replacement_string</span> <span class="o">=</span> <span class="s">&quot;{subpath[0][2]}/from/{subdir[0][0]}/{basename[0]}&quot;</span>

<span class="n">input_string</span>    <span class="o">=</span> <span class="s">&quot;/directory/to/a/file.name.ext&quot;</span>
<span class="n">result_string</span>   <span class="o">=</span> <span class="s">&quot;/directory/from/a/file.name.ext&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="filter-and-parse-using-regular-expressions">
<span id="new-manual-formatter-regex"></span><h3>Filter and parse using regular expressions<a class="headerlink" href="#filter-and-parse-using-regular-expressions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><a class="reference external" href="http://docs.python.org/2/library/re.html#re.MatchObject.group">Regular expression</a> matches can be used with the similar syntax.
Our example string can be parsed using the following regular expression:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_string</span> <span class="o">=</span> <span class="s">&quot;/directory/to/a/file.name.ext&quot;</span>
<span class="n">formatter</span><span class="p">(</span><span class="s">r&quot;/directory/(.+)/(?P&lt;MYFILENAME&gt;)\.ext&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We capture part of the path using <tt class="docutils literal"><span class="pre">(.+)</span></tt>, and the base name using <tt class="docutils literal"><span class="pre">(?P&lt;MYFILENAME&gt;)</span></tt>.
These <a class="reference external" href="http://docs.python.org/2/library/re.html#re.MatchObject.group">matching subgroups</a> can be referred to by index
but for greater clarity the second named capture can also be referred to by name, i.e. <tt class="docutils literal"><span class="pre">{MYFILENAME}</span></tt>.</p>
</div></blockquote>
<p>The regular expression components for the first string can thus be referred to as follows:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">{0[0]}</span></tt>          : The entire match captured by index, <tt class="docutils literal"><span class="pre">&quot;/directory/to/a/file.name.ext&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{1[0]}</span></tt>          : The first match captured by index, <tt class="docutils literal"><span class="pre">&quot;to/a&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{2[0]}</span></tt>          : The second match captured by index, <tt class="docutils literal"><span class="pre">&quot;file.name&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{MYFILENAME[0]}</span></tt> : The match captured by name, <tt class="docutils literal"><span class="pre">&quot;file.name&quot;</span></tt></li>
</ul>
</div></blockquote>
<p>If each input consists of a list of paths such as <tt class="docutils literal"><span class="pre">['job1.a.start',</span> <span class="pre">'job1.b.start',</span> <span class="pre">'job1.c.start']</span></tt>, we can match each of them separately
by using as many regular expressions as necessary. For example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_string</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.c.start&#39;</span><span class="p">]</span>
<span class="c"># Regular expression matches for 1st, 2nd but not 3rd element</span>
<span class="n">formatter</span><span class="p">(</span><span class="s">&quot;.+a.start&quot;</span><span class="p">,</span> <span class="s">&quot;b.start$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Or if you only wanted regular expression matches for the second file name (string), pad with <tt class="docutils literal"><span class="pre">None</span></tt>:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">input_string</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.c.start&#39;</span><span class="p">]</span>
<span class="c"># Regular expression matches for 2nd but not 1st or 3rd elements</span>
<span class="n">formatter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;b.start$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="using-transform-with-formatter">
<h3>Using <a class="reference internal" href="../../decorators/transform.html#decorators-transform"><em>&#64;transform()</em></a> with <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a><a class="headerlink" href="#using-transform-with-formatter" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>We can put these together in the following example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">#   create initial files</span>
<span class="nd">@originate</span><span class="p">([</span>   <span class="p">[</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">],</span>
               <span class="p">[</span><span class="s">&#39;job2.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job2.b.start&#39;</span><span class="p">],</span>
               <span class="p">[</span><span class="s">&#39;job3.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job3.c.start&#39;</span><span class="p">]</span>    <span class="p">])</span>
<span class="k">def</span> <span class="nf">create_initial_file_pairs</span><span class="p">(</span><span class="n">output_files</span><span class="p">):</span>
    <span class="c"># create both files as necessary</span>
    <span class="k">for</span> <span class="n">output_file</span> <span class="ow">in</span> <span class="n">output_files</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">oo</span><span class="p">:</span> <span class="k">pass</span>


<span class="c">#---------------------------------------------------------------</span>
<span class="c">#</span>
<span class="c">#   formatter</span>
<span class="c">#</span>

<span class="c">#   first task</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">create_initial_file_pairs</span><span class="p">,</span>                               <span class="c"># Input</span>

<span class="hll">            <span class="n">formatter</span><span class="p">(</span><span class="s">&quot;.+/job(?P&lt;JOBNUMBER&gt;\d+).a.start&quot;</span><span class="p">,</span>           <span class="c"># Extract job number</span>
</span><span class="hll">                      <span class="s">&quot;.+/job[123].b.start&quot;</span><span class="p">),</span>                       <span class="c"># Match only &quot;b&quot; files</span>
</span>
            <span class="p">[</span><span class="s">&quot;{path[0]}/jobs{JOBNUMBER[0]}.output.a.1&quot;</span><span class="p">,</span>             <span class="c"># Replacement list</span>
             <span class="s">&quot;{path[1]}/jobs{JOBNUMBER[0]}.output.b.1&quot;</span><span class="p">,</span> <span class="mi">45</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">first_task</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">output_parameters</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;input_parameters = &quot;</span><span class="p">,</span> <span class="n">input_files</span>
    <span class="k">print</span> <span class="s">&quot;output_parameters = &quot;</span><span class="p">,</span> <span class="n">output_parameters</span>


<span class="c">#</span>
<span class="c">#       Run</span>
<span class="c">#</span>
<span class="n">pipeline_run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go">input_parameters  =  [&#39;job1.a.start&#39;,</span>
<span class="go">                      &#39;job1.b.start&#39;]</span>
<span class="go">output_parameters =  [&#39;/home/lg/src/temp/jobs1.output.a.1&#39;,</span>
<span class="go">                      &#39;/home/lg/src/temp/jobs1.output.b.1&#39;, 45]</span>

<span class="go">input_parameters  =  [&#39;job2.a.start&#39;,</span>
<span class="go">                      &#39;job2.b.start&#39;]</span>
<span class="go">output_parameters =  [&#39;/home/lg/src/temp/jobs2.output.a.1&#39;,</span>
<span class="go">                      &#39;/home/lg/src/temp/jobs2.output.b.1&#39;, 45]</span>
</pre></div>
</div>
<p>Notice that <tt class="docutils literal"><span class="pre">job3</span></tt> has <tt class="docutils literal"><span class="pre">'job3.c.start'</span></tt> as the second file.
This fails to match the regular expression and is discarded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Failed regular expression mismatches are ignored.</p>
<p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> regular expressions are thus very useful in filtering out all
files which do not match your specified criteria.</p>
<p class="last">If your some of your task inputs have a mixture of different file types, a simple <tt class="docutils literal"><span class="pre">Formatter(&quot;.txt$&quot;)</span></tt>, for example, will make
your code a lot simpler...</p>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="string-substitution-for-extra-arguments">
<h3>string substitution for &#8220;extra&#8221; arguments<a class="headerlink" href="#string-substitution-for-extra-arguments" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The first two arguments for Ruffus task functions are special because they are the <strong>Input</strong> and <strong>Output</strong>
parameters which link different stages of a pipeline.</p>
<p>Python strings in these arguments are names of data files whose modification times indicate whether the pipeline is up to date or not.</p>
<p>Other arguments to task functions are not passed down the pipeline but consumed.
Any python strings they contain do not need to be file names. These extra arguments are very useful
for passing data to pipelined tasks, such as shared values, loggers, programme options etc.</p>
<p>One helpful feature is that strings in these extra arguments are also subject to <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> string substitution.
This means you can leverage the parsing capabilities of Ruffus to decode any information about the pipeline data files,
These might include the directories you are running in and parts of the file name.</p>
<p>For example, if we would want to know which files go with which &#8220;job number&#8221; in the previous example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">#   create initial files</span>
<span class="nd">@originate</span><span class="p">([</span>   <span class="p">[</span><span class="s">&#39;job1.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job1.b.start&#39;</span><span class="p">],</span>
               <span class="p">[</span><span class="s">&#39;job2.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job2.b.start&#39;</span><span class="p">],</span>
               <span class="p">[</span><span class="s">&#39;job3.a.start&#39;</span><span class="p">,</span> <span class="s">&#39;job3.c.start&#39;</span><span class="p">]</span>    <span class="p">])</span>
<span class="k">def</span> <span class="nf">create_initial_file_pairs</span><span class="p">(</span><span class="n">output_files</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">output_file</span> <span class="ow">in</span> <span class="n">output_files</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">oo</span><span class="p">:</span> <span class="k">pass</span>


<span class="c">#---------------------------------------------------------------</span>
<span class="c">#</span>
<span class="c">#   print job number as an extra argument</span>
<span class="c">#</span>

<span class="c">#   first task</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">create_initial_file_pairs</span><span class="p">,</span>                               <span class="c"># Input</span>

            <span class="n">formatter</span><span class="p">(</span><span class="s">&quot;.+/job(?P&lt;JOBNUMBER&gt;\d+).a.start&quot;</span><span class="p">,</span>           <span class="c"># Extract job number</span>
<span class="hll">                      <span class="s">&quot;.+/job[123].b.start&quot;</span><span class="p">),</span>                       <span class="c"># Match only &quot;b&quot; files</span>
</span><span class="hll">
</span>            <span class="p">[</span><span class="s">&quot;{path[0]}/jobs{JOBNUMBER[0]}.output.a.1&quot;</span><span class="p">,</span>             <span class="c"># Replacement list</span>
             <span class="s">&quot;{path[1]}/jobs{JOBNUMBER[0]}.output.b.1&quot;</span><span class="p">],</span>

             <span class="s">&quot;{JOBNUMBER[0]}&quot;</span>
<span class="k">def</span> <span class="nf">first_task</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">output_parameters</span><span class="p">,</span> <span class="n">job_number</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">job_number</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">input_files</span>


<span class="n">pipeline_run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pipeline_run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">1 : [&#39;job1.a.start&#39;, &#39;job1.b.start&#39;]</span>
<span class="go">2 : [&#39;job2.a.start&#39;, &#39;job2.b.start&#39;]</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="changing-directories-using-formatter-in-a-zoo">
<span id="new-manual-output-file-names-formatter-zoo"></span><h3>Changing directories using <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> in a zoo...<a class="headerlink" href="#changing-directories-using-formatter-in-a-zoo" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Here is a more fun example. We would like to feed the denizens of a zoo. Unfortunately, the file names for
these are spread over several directories. Ideally, we would like their food supply to be grouped more
sensibly. And, of course, we only want to feed the animals, not the plants.</p>
<p>I have colour coded the input and output files for this task to show how we would like to rearrange them:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/simple_tutorial_zoo_animals_formatter_example.jpg"><img alt="../../_images/simple_tutorial_zoo_animals_formatter_example.jpg" src="../../_images/simple_tutorial_zoo_animals_formatter_example.jpg" style="width: 915.5px; height: 208.5px;" /></a>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ruffus</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">#   Make directories</span>
<span class="nd">@mkdir</span><span class="p">([</span><span class="s">&quot;tiger&quot;</span><span class="p">,</span> <span class="s">&quot;lion&quot;</span><span class="p">,</span> <span class="s">&quot;dog&quot;</span><span class="p">,</span> <span class="s">&quot;crocodile&quot;</span><span class="p">,</span> <span class="s">&quot;rose&quot;</span><span class="p">])</span>

<span class="nd">@originate</span><span class="p">(</span>
<span class="hll">            <span class="c">#   List of animals and plants</span>
</span>            <span class="p">[</span>    <span class="s">&quot;tiger/mammals.wild.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;lion/mammals.wild.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;lion/mammals.handreared.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;dog/mammals.tame.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;dog/mammals.wild.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;crocodile/reptiles.wild.animals&quot;</span><span class="p">,</span>
                <span class="s">&quot;rose/flowering.handreared.plants&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">create_initial_files</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">oo</span><span class="p">:</span> <span class="k">pass</span>


<span class="c">#   Put different animals in different directories depending on their clade</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">create_initial_files</span><span class="p">,</span>                                       <span class="c"># Input</span>

<span class="hll">           <span class="n">formatter</span><span class="p">(</span><span class="s">&quot;.+/(?P&lt;clade&gt;\w+).(?P&lt;tame&gt;\w+).animals&quot;</span><span class="p">),</span>       <span class="c"># Only animals: ignore plants!</span>
</span>
           <span class="s">&quot;{subpath[0][1]}/{clade[0]}/{tame[0]}.{subdir[0][0]}.food&quot;</span><span class="p">,</span> <span class="c"># Replacement</span>

<span class="hll">           <span class="s">&quot;{subpath[0][1]}/{clade[0]}&quot;</span><span class="p">,</span>                               <span class="c"># new_directory</span>
</span><span class="hll">           <span class="s">&quot;{subdir[0][0]}&quot;</span><span class="p">,</span>                                           <span class="c"># animal_name</span>
</span><span class="hll">           <span class="s">&quot;{tame[0]}&quot;</span><span class="p">)</span>                                                <span class="c"># tameness</span>
</span><span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">new_directory</span><span class="p">,</span> <span class="n">animal_name</span><span class="p">,</span> <span class="n">tameness</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Food for the {tameness:11s} {animal_name:9s} = {output_file:90s} will be placed in {new_directory}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

<span class="n">pipeline_run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We can see that the food for each animal are now grouped by clade in the same directory, which makes a lot more sense...</p>
<p>Note how we used <tt class="docutils literal"><span class="pre">subpath[0][1]</span></tt> to move down one level of the file path to build a new file name.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pipeline_run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">Food for the wild        crocodile = ./reptiles/wild.crocodile.food will be placed in ./reptiles</span>
<span class="go">Food for the tame        dog       = ./mammals/tame.dog.food        will be placed in ./mammals</span>
<span class="go">Food for the wild        dog       = ./mammals/wild.dog.food        will be placed in ./mammals</span>
<span class="go">Food for the handreared  lion      = ./mammals/handreared.lion.food will be placed in ./mammals</span>
<span class="go">Food for the wild        lion      = ./mammals/wild.lion.food       will be placed in ./mammals</span>
<span class="go">Food for the wild        tiger     = ./mammals/wild.tiger.food      will be placed in ./mammals</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="regex-manipulates-via-regular-expressions">
<span id="new-manual-regex"></span><h2><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> manipulates via regular expressions<a class="headerlink" href="#regex-manipulates-via-regular-expressions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>If you are a hard core regular expressions fan, you may want to use <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> instead of <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-suffix"><em>suffix()</em></a> or <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> uses regular expressions like <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> but</p>
<blockquote>
<div><ul class="simple">
<li>It only matches the first file name in the input. As described above, <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> can match any one or more of the input filename strings.</li>
<li>It does not understand file paths so you may have to perform your own directory / file name parsing.</li>
<li>String replacement uses syntax borrowed from <a class="reference external" href="http://docs.python.org/2/library/re.html#re.sub">re.sub()</a>, rather than building a result from parsed regular expression (and file path) components</li>
</ul>
</div></blockquote>
<p class="last">In general <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> is more powerful and was introduced from version 2.4 is intended to be a more user friendly replacement for <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a>.</p>
</div>
<p>Let us see how the previous zoo example looks with <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a>:</p>
<blockquote>
<div><p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-formatter"><em>formatter()</em></a> code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#   Put different animals in different directories depending on their clade</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">create_initial_files</span><span class="p">,</span>                                       <span class="c"># Input</span>

<span class="hll">           <span class="n">formatter</span><span class="p">(</span><span class="s">&quot;.+/(?P&lt;clade&gt;\w+).(?P&lt;tame&gt;\w+).animals&quot;</span><span class="p">),</span>       <span class="c"># Only animals: ignore plants!</span>
</span>
<span class="hll">           <span class="s">&quot;{subpath[0][1]}/{clade[0]}/{tame[0]}.{subdir[0][0]}.food&quot;</span><span class="p">,</span> <span class="c"># Replacement</span>
</span>
           <span class="s">&quot;{subpath[0][1]}/{clade[0]}&quot;</span><span class="p">,</span>                               <span class="c"># new_directory</span>
           <span class="s">&quot;{subdir[0][0]}&quot;</span><span class="p">,</span>                                           <span class="c"># animal_name</span>
           <span class="s">&quot;{tame[0]}&quot;</span><span class="p">)</span>                                                <span class="c"># tameness</span>
<span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">new_directory</span><span class="p">,</span> <span class="n">animal_name</span><span class="p">,</span> <span class="n">tameness</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Food for the {tameness:11s} {animal_name:9s} = {output_file:90s} will be placed in {new_directory}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#   Put different animals in different directories depending on their clade</span>
<span class="nd">@transform</span><span class="p">(</span><span class="n">create_initial_files</span><span class="p">,</span>                                        <span class="c"># Input</span>

<span class="hll">           <span class="n">regex</span><span class="p">(</span><span class="s">r&quot;(.*?/?)(\w+)/(?P&lt;clade&gt;\w+).(?P&lt;tame&gt;\w+).animals&quot;</span><span class="p">),</span> <span class="c"># Only animals: ignore plants!</span>
</span>
<span class="hll">           <span class="s">r&quot;\1/\g&lt;clade&gt;/\g&lt;tame&gt;.\2.food&quot;</span><span class="p">,</span>                            <span class="c"># Replacement</span>
</span>
           <span class="s">r&quot;\1/\g&lt;clade&gt;&quot;</span><span class="p">,</span>                                             <span class="c"># new_directory</span>
           <span class="s">r&quot;\2&quot;</span><span class="p">,</span>                                                       <span class="c"># animal_name</span>
           <span class="s">&quot;\g&lt;tame&gt;&quot;</span><span class="p">)</span>                                                  <span class="c"># tameness</span>
<span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">new_directory</span><span class="p">,</span> <span class="n">animal_name</span><span class="p">,</span> <span class="n">tameness</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Food for the {tameness:11s} {animal_name:9s} = {output_file:90s} will be placed in {new_directory}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<p>The regular expression to parse the input file path safely was a bit hairy to write, and it is not
clear that it handles all edge conditions (e.g. files in the root directory). Apart from that, if the
limitations of <a class="reference internal" href="../../decorators/indicator_objects.html#decorators-regex"><em>regex()</em></a> do not preclude its use, then the two approaches
are not so different in practice.</p>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><strong>Chapter 8</strong>: Specifying output file names with <tt class="docutils literal"><span class="pre">formatter()</span></tt> and <tt class="docutils literal"><span class="pre">regex()</span></tt></a><ul>
<li><a class="reference internal" href="#review">Review</a></li>
<li><a class="reference internal" href="#a-different-file-name-suffix-for-each-pipeline-stage">A different file name <tt class="docutils literal"><span class="pre">suffix()</span></tt> for each pipeline stage</a></li>
<li><a class="reference internal" href="#formatter-manipulates-pathnames-and-regular-expression"><tt class="docutils literal"><span class="pre">formatter()</span></tt> manipulates pathnames and regular expression</a><ul>
<li><a class="reference internal" href="#path-name-components">Path name components</a></li>
<li><a class="reference internal" href="#filter-and-parse-using-regular-expressions">Filter and parse using regular expressions</a></li>
<li><a class="reference internal" href="#using-transform-with-formatter">Using <tt class="docutils literal"><span class="pre">&#64;transform()</span></tt> with <tt class="docutils literal"><span class="pre">formatter()</span></tt></a></li>
<li><a class="reference internal" href="#string-substitution-for-extra-arguments">string substitution for &#8220;extra&#8221; arguments</a></li>
<li><a class="reference internal" href="#changing-directories-using-formatter-in-a-zoo">Changing directories using <tt class="docutils literal"><span class="pre">formatter()</span></tt> in a zoo...</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regex-manipulates-via-regular-expressions"><tt class="docutils literal"><span class="pre">regex()</span></tt> manipulates via regular expressions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pipeline_printout_graph.html"
                        title="previous chapter"><strong>Chapter 7</strong>: Displaying the pipeline visually with <tt class="docutils literal"><span class="pre">pipeline_printout_graph(...)</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mkdir.html"
                        title="next chapter"><strong>Chapter 9</strong>: Preparing directories for output with <tt class="docutils literal"><span class="pre">&#64;mkdir()</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/new_tutorial/output_file_names.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3> Quick Reference:</h3>
    <ul>
        <h4><a href="../../decorators/decorators.html#core">Core:</a></h4>   
        <ul>
            <li><a href="../../decorators/originate.html">@originate</a>                           </li>
            <li><a href="../../decorators/split.html">@split</a>                                   </li>
            <li><a href="../../decorators/transform.html">@transform</a>                           </li>
            <li><a href="../../decorators/merge.html">@merge</a>                                   </li>
        </ul>

        <h4><a href="../../decorators/decorators.html#advanced">Advanced</a></h4>   
        <ul>
            <li><a href="../../decorators/subdivide.html">@subdivide</a>                           </li>
            <li><a href="../../decorators/transform_ex.html">@transform (add_inputs) </a>          </li>
            <li><a href="../../decorators/collate.html">@collate</a>                               </li>
            <li><a href="../../decorators/collate_ex.html">@collate (add_inputs)</a>               </li>
            <li><a href="../../decorators/graphviz.html">@graphviz</a>                             </li>
            <li><a href="../../decorators/mkdir.html">@mkdir</a>                                   </li>
            <li><a href="../../decorators/follows.html">@follows / mkdir</a>                       </li>
            <li><a href="../../decorators/posttask.html">@posttask touch_file</a>                  </li>
            <li><a href="../../decorators/active_if.html">@active_if</a>                           </li>
            <li><a href="../../decorators/jobs_limit.html">@jobs_limit</a>                         </li>
        </ul>
    
        <h4><a href="../../decorators/decorators.html#combinatorics">Combinatorial:</a></h4>   
        <ul>
            <li><a href="../../decorators/product.html">@product </a>                              </li>
            <li><a href="../../decorators/permutations.html">@permutations </a>                    </li>
            <li><a href="../../decorators/combinations.html">@combinations </a>                    </li>
            <li><a href="../../decorators/combinations_with_replacement.html">@combinations_ _with_replacement </a>                    </li>
        </ul>

                        
        <h4><a href="../../decorators/decorators.html#esoteric">Esoteric</a></h4>   
        <ul>
            <li><a href="../../decorators/files_ex.html">@files (on the fly)</a>                   </li>
            <li><a href="../../decorators/parallel.html">@parallel</a>                             </li>
            <li><a href="../../decorators/check_if_uptodate.html">@check_if_uptodate</a>           </li>
        </ul>


        <h4 ><a href="../../decorators/indicator_objects.html">Indicator objects</a></h4>
        <h4 >Pipeline functions</h4>
        <ul>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-run">pipeline_run</a>                       </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout">pipeline_printout</a>                      </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-printout-graph">pipeline_printout_graph</a>          </li>
            <li><a href="../../pipeline_functions.html#pipeline-functions-pipeline-get-task-names">pipeline_get_task_names</a>          </li>
            <li><a href="../../drmaa_wrapper_functions.html#drmaa-wrapper-functions-drmaa_wrapper-run_job">drmaa_wrapper.run_job</a>          </li>
        </ul>

         <a href="../../todo.html">Future plans</a>
    </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mkdir.html" title="Chapter 9: Preparing directories for output with @mkdir()"
             >next</a> |</li>
        <li class="right" >
          <a href="pipeline_printout_graph.html" title="Chapter 7: Displaying the pipeline visually with pipeline_printout_graph(...)"
             >previous</a> |</li>
        Ruffus v. 2.6
            <li><a href="../../index.html">Home</a> | </li>
            <li><a href="../../contents.html">Contents</a> | </li>
            <li><a href="../../installation.html">Install</a>  | </li>
            <li><a href="introduction.html">Manual</a>  / </li>
            <li><a href="manual_contents.html">(TOC)</a>  | </li>
            <li><a href="../../faq.html">FAQ</a>  | </li>
            <li><a href="../../cheatsheet.html">Cheat sheet</a> | </li>
            <li><a href="command_line.html">Command Line</a> | </li>
            <li><a href="../../gallery.html">Gallery</a> |  </li>
            <li><a href="../../new_syntax.html">New syntax in v 2.6</a> | </li>
            <li><a href="../../history.html">Latest Changes</a> &raquo; </li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013 Leo Goodstadt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>